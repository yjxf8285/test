/*! 2018-3-2 author:liuxiaofan */
webpackJsonp([29],{602:function(e,t,o){o(853);var i=o(54)(o(811),o(900),null,null);e.exports=i.exports},754:function(e,t,o){e.exports={default:o(755),__esModule:!0}},755:function(e,t,o){o(757),e.exports=o(24).Object.values},756:function(e,t,o){var i=o(67),a=o(58),n=o(73).f;e.exports=function(e){return function(t){for(var o,l=a(t),r=i(l),s=r.length,c=0,p=[];s>c;)n.call(l,o=r[c++])&&p.push(e?[o,l[o]]:l[o]);return p}}},757:function(e,t,o){var i=o(65),a=o(756)(!1);i(i.S,"Object",{values:function(e){return a(e)}})},811:function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(211),n=i(a),l=o(754),r=i(l),s=o(91),c=i(s),p=o(35),f=o(202);t.default={name:"app-list",components:{"el-button":p.Button,"el-table":p.Table,"el-table-column":p.TableColumn,"el-input":p.Input,"el-form":p.Form,"el-form-item":p.FormItem,"el-dialog":p.Dialog,"el-pagination":p.Pagination,"el-tag":p.Tag,"el-tabs":p.Tabs,"el-tab-pane":p.TabPane,"el-switch":p.Switch,"el-checkbox":p.Checkbox},mounted:function(){this.getApplicationList(),this.configMap2ConfigForm(),this.searchName=this.$route.query.applicationFilterName},data:function(){return{originAppList:[],currApp:{},applistLoading:!1,paginator:{pageSize:20,currentPage:1,total:50},searchName:"",configTabsValue:"common",configDialogVisible:!1,createDialogVisible:!1,configMap:_.cloneDeep(f.appConfig),configTypeMap:_.cloneDeep(f.configTypeMap),configIndexMap:_.cloneDeep(f.configIndexMap),configForm:{},configRules:f.configItemValidators,createForm:{name:"",description:""},creatingLoading:!1,createRules:{name:[{required:!0,message:"请输入应用名称",trigger:"blur"},{max:80,message:"应用名称不能超过80个字符",trigger:"blur"},{validator:f.nameValidator,trigger:"blur"}]},downloadDialogVisible:!1,currentDownload:"",customConfigList:[]}},computed:{appList:function(){var e=this;return this.originAppList.filter(function(t){return!e.searchName||-1!==t.name.indexOf(e.searchName)})}},watch:{configMap:{deep:!0,handler:function(e){this.configMap2ConfigForm()}},searchName:function(e){this.$router.push({query:{applicationFilterName:this.searchName}})}},methods:{create:function(){var e=this;e.$refs.createForm.validate(function(t){t&&e.api.createApplication({data:e.createForm,beforeSend:function(){e.creatingLoading=!0},complete:function(){e.creatingLoading=!1},success:function(t){e.createDialogVisible=!1,0===t.code?((0,p.Notification)({title:"创建成功",type:"success"}),e.getApplicationList(),e.createForm={name:"",description:""}):(0,p.Notification)({title:"创建失败",message:t.message,type:"error"})}})})},getApplicationList:function(){var e=this,t=null;e.api.getApplicationList({data:{pageSize:e.paginator.pageSize,pageIndex:e.paginator.currentPage-1},beforeSend:function(){t=p.Loading.service({target:e.$refs.tableContainer})},complete:function(){t.close(),t=null},success:function(t){if(0===t.code){var o=window.location.protocol+"//"+window.location.hostname+":"+window.location.port;e.originAppList=t.data.applicationHierarchy.map(function(e){return(0,c.default)({webProbe:'<script src="'+o+"/js-sdks/"+e.name+'.js"><\/script>'},e)}),e.paginator.total=t.data.total}}})},getAppConf:function(e){var t=this;t.currApp=e,t.configDialogVisible=!0;var o=null;t.api.getAppConf({data:{applicationId:e.id},beforeSend:function(){o=p.Loading.service({target:t.$refs.configFormContainer})},complete:function(){o.close()},success:function(e){0===e.code&&e.data.forEach(function(e){var o=e.key.replace(/\./g,"_");t.configMap[o]=(0,c.default)({},t.configMap[o],e)})}})},configMap2ConfigForm:function(){var e={};for(var t in this.configMap)e[t]=this.configMap[t].isBoolean?"true"===this.configMap[t].value.toString():this.configMap[t].value;this.configForm=e},modifyConfig:function(){var e=this;this.$refs.configForm.validate(function(t){t&&e.api.updateAppConf({data:{applicationName:e.currApp.name,configurations:(0,r.default)(e.configMap)},beforeSend:function(){e.updateLoading=!0},complete:function(){e.updateLoading=!1},success:function(t){0===t.code?(e.configDialogVisible=!1,(0,p.Notification)({title:"修改成功",type:"success"}),e.getApplicationList()):(0,p.Notification)({title:"修改失败",message:t.message,type:"error"})}})})},startDownload:function(e){this.currApp=e,this.currentDownload="",this.downloadDialogVisible=!0;var t=!0,o=!1,i=void 0;try{for(var a,l=(0,n.default)(this.appList);!(t=(a=l.next()).done);t=!0){if(a.value.id===e.id){this.currentDownload=e.webProbe;break}}}catch(e){o=!0,i=e}finally{try{!t&&l.return&&l.return()}finally{if(o)throw i}}},onSwitchChange:function(){console.log(arguments)},appendCustomMethod:function(){this.customConfigList.push({className:{value:"",correct:!0,warning:""},methodName:{value:"",correct:!0,warning:""},containSubClass:!1,description:""})},validateConfigItem:function(e,t){var o=f.customConfigItemValidators[t]?f.customConfigItemValidators[t][1]:null;return o&&"function"==typeof o.validator?o.validator({},e.value,function(t){return t instanceof Error?(e.warning=t.toString().substring(7),e.correct=!1):e.correct=!0,e.correct}):(e.correct=!0,e.correct)}}}},819:function(e,t,o){t=e.exports=o(566)(),t.push([e.i,".settings-app-list .search-input{position:relative;width:250px}.settings-app-list .paginator{margin-top:10px;text-align:right}.settings-app-list .config-type{margin-left:5px}.settings-app-list .config-switch{position:relative;bottom:-4px}.settings-app-list .label-things{display:inline-block}.settings-app-list .required-mark{font-size:16px}.settings-app-list .el-form-item.is-required .el-form-item__label:before{display:none}.settings-app-list .el-dialog{max-width:600px}.settings-app-list .right-info{margin-top:10px}",""])},853:function(e,t,o){var i=o(819);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);o(567)("c7ef14ba",i,!0)},900:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"settings-app-list"},[o("div",{staticClass:"common-container"},[o("div",{staticClass:"header-title"},[o("span",{staticClass:"title-name"},[e._v("应用列表")]),e._v(" "),o("div",{staticClass:"right-info"},[o("div",{staticClass:"theme-border-color-base"},[o("el-button",{attrs:{icon:"ion-plus-round",type:"primary",size:"small"},on:{click:function(t){e.createDialogVisible=!0}}}),e._v(" "),o("el-input",{staticClass:"search-input",attrs:{placeholder:"请输入应用名称","prefix-icon":"el-icon-search",size:"small"},model:{value:e.searchName,callback:function(t){e.searchName=t},expression:"searchName"}})],1)])]),e._v(" "),o("div",{ref:"tableContainer",staticClass:"content"},[o("el-table",{staticClass:"list-table",staticStyle:{width:"100%"},attrs:{data:e.appList,"row-key":"id"}},[o("el-table-column",{attrs:{label:"应用"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("router-link",{staticClass:"theme-font-color-primary",attrs:{to:{name:"settings-tier-list",query:{applicationId:t.row.id,applicationName:t.row.name,applicationFilterName:e.searchName}}}},[e._v("\n              "+e._s(t.row.name)+"\n\n            ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"tierTotal",label:"tier数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.tierTotal)+"\n\n          ")]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"instanceTotal",label:"实例数量"}}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.getAppConf(t.row)}}},[e._v("配置")]),e._v(" "),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){e.startDownload(t.row)}}},[e._v("获取Web探针")])]}}])})],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"应用配置",visible:e.configDialogVisible},on:{"update:visible":function(t){e.configDialogVisible=t}}},[o("div",{ref:"configFormContainer",staticStyle:{position:"relative"}},[o("el-form",{ref:"configForm",attrs:{model:e.configForm,rules:e.configRules}},[o("el-tabs",{staticClass:"tabs",attrs:{value:e.configTabsValue}},[o("el-tab-pane",{staticStyle:{"padding-right":"20px"},attrs:{name:"common",label:"通用"}},e._l(e.configIndexMap,function(t,i){return 0==e.configMap[t].type?o("el-form-item",{key:i,attrs:{label:e.configMap[t].name,prop:t,"label-width":"100px"}},["boolean"!=typeof e.configForm[t]?o("el-input",{attrs:{maxlength:"ApdexT"==e.configMap[t].name?8:5e3,size:"small"},on:{change:function(o){e.configMap[t].value=e.configForm[t]}},model:{value:e.configForm[t],callback:function(o){e.$set(e.configForm,t,o)},expression:"configForm[configKey]"}}):e._e()],1):e._e()})),e._v(" "),o("el-tab-pane",{staticStyle:{"padding-right":"20px"},attrs:{name:"java",label:"Java"}},[e._l(e.configIndexMap,function(t,i){return 1==e.configMap[t].type?o("el-form-item",{key:i,attrs:{label:e.configMap[t].name,prop:t,"label-width":"160px"}},["boolean"!=typeof e.configForm[t]?o("el-input",{attrs:{size:"small"},on:{change:function(o){e.configMap[t].value=e.configForm[t]}},model:{value:e.configForm[t],callback:function(o){e.$set(e.configForm,t,o)},expression:"configForm[configKey]"}}):e._e(),e._v(" "),"boolean"==typeof e.configForm[t]?o("el-switch",{staticClass:"config-switch",on:{change:function(o){e.configMap[t].value=String(o).toLowerCase()}},model:{value:e.configForm[t],callback:function(o){e.$set(e.configForm,t,o)},expression:"configForm[configKey]"}}):e._e()],1):e._e()}),e._v(" "),o("div",{staticClass:"custom-config-table",staticStyle:{display:"none"}},[o("el-table",{staticClass:"apm-table-bordered",staticStyle:{width:"100%",height:"100%"},attrs:{data:e.customConfigList}},[o("el-table-column",{attrs:{property:"className",label:"类名",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{size:"mini"},on:{change:function(o){e.validateConfigItem(t.row.className,"className")}},model:{value:t.row.className.value,callback:function(o){e.$set(t.row.className,"value",o)},expression:"scope.row.className.value"}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.row.className.correct,expression:"!scope.row.className.correct"}],staticClass:"warning theme-font-color-danger"},[e._v("\n                        "+e._s(t.row.className.warning)+"\n                      ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{property:"methodName",label:"方法名",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{size:"mini"},on:{change:function(o){e.validateConfigItem(t.row.methodName,"methodName")}},model:{value:t.row.methodName.value,callback:function(o){e.$set(t.row.methodName,"value",o)},expression:"scope.row.methodName.value"}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.row.methodName.correct,expression:"!scope.row.methodName.correct"}],staticClass:"warning theme-font-color-danger"},[e._v("\n                        "+e._s(t.row.methodName.warning)+"\n                      ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{property:"description",label:"描述",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{size:"mini"},model:{value:t.row.description,callback:function(o){e.$set(t.row,"description",o)},expression:"scope.row.description"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{property:"containSubClass",label:"包含子类",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-checkbox",{attrs:{size:"mini"},model:{value:t.row.containSubClass,callback:function(o){e.$set(t.row,"containSubClass",o)},expression:"scope.row.containSubClass"}})]}}])})],1),e._v(" "),o("div",{staticStyle:{"text-align":"center"}},[o("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-plus"},on:{click:e.appendCustomMethod}},[e._v("添加自定义方法")])],1)],1)],2),e._v(" "),o("el-tab-pane",{staticStyle:{"padding-right":"20px"},attrs:{name:"browser",label:"Browser"}},e._l(e.configIndexMap,function(t,i){return 3==e.configMap[t].type?o("el-form-item",{key:i,attrs:{label:e.configMap[t].name,prop:t,"label-width":"180px"}},["boolean"!=typeof e.configForm[t]?o("el-input",{attrs:{size:"small"},on:{change:function(o){e.configMap[t].value=e.configForm[t]}},model:{value:e.configForm[t],callback:function(o){e.$set(e.configForm,t,o)},expression:"configForm[configKey]"}}):e._e(),e._v(" "),"boolean"==typeof e.configForm[t]?o("el-switch",{staticClass:"config-switch",on:{change:function(o){e.configMap[t].value=String(o).toLowerCase()}},model:{value:e.configForm[t],callback:function(o){e.$set(e.configForm,t,o)},expression:"configForm[configKey]"}}):e._e()],1):e._e()}))],1)],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.configDialogVisible=!1}}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.modifyConfig}},[e._v("确定")])],1)]),e._v(" "),o("el-dialog",{attrs:{title:"添加应用",visible:e.createDialogVisible},on:{"update:visible":function(t){e.createDialogVisible=t}}},[o("el-form",{ref:"createForm",attrs:{model:e.createForm,rules:e.createRules}},[o("el-form-item",{attrs:{label:"名称",prop:"name"}},[o("el-input",{model:{value:e.createForm.name,callback:function(t){e.$set(e.createForm,"name",t)},expression:"createForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"描述"}},[o("el-input",{attrs:{prop:"description",maxlength:80},model:{value:e.createForm.description,callback:function(t){e.$set(e.createForm,"description",t)},expression:"createForm.description"}})],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.createDialogVisible=!1}}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary",loading:e.creatingLoading},on:{click:e.create}},[e._v("确定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"获取Web探针",visible:e.downloadDialogVisible},on:{"update:visible":function(t){e.downloadDialogVisible=t}}},[o("div",[e._v("\n        "+e._s(e.currentDownload)+"\n\n      ")])])],1)])},staticRenderFns:[]}}});