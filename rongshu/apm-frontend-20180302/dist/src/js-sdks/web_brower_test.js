!function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return n(r||e)},u,u.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,t,r){var i=e("./config"),n=e("./json"),o=e("./ua"),s=Array.prototype,a=Object.prototype,c=s.slice,u=a.toString,l=a.hasOwnProperty,d=window.navigator,p=window.document,h=d.userAgent,f=i.LIB_VERSION,g=s.forEach,m=s.indexOf,b=Array.isArray,T={},v={},w=v.each=function(e,t,r){if(null==e)return!1;if(g&&e.forEach===g)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,n=e.length;i<n;i++)if(i in e&&t.call(r,e[i],i,e)===T)return!1}else for(var o in e)if(l.call(e,o)&&t.call(r,e[o],o,e)===T)return!1};v.extend=function(e){return w(c.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&(e[r]=t[r])}),e},v.coverExtend=function(e){return w(c.call(arguments,1),function(t){for(var r in t)void 0!==t[r]&&void 0===e[r]&&(e[r]=t[r])}),e},v.isArray=b||function(e){return"[object Array]"===u.call(e)},v.isFunction=function(e){try{return/^\s*\bfunction\b/.test(e)}catch(e){return!1}},v.isArguments=function(e){return!(!e||!l.call(e,"callee"))},v.toArray=function(e){return e?e.toArray?e.toArray():v.isArray(e)?c.call(e):v.isArguments(e)?c.call(e):v.values(e):[]},v.values=function(e){var t=[];return null==e?t:(w(e,function(e){t[t.length]=e}),t)},v.include=function(e,t){var r=!1;return null==e?r:m&&e.indexOf===m?-1!==e.indexOf(t):(w(e,function(e){if(r||(r=e===t))return T}),r)},v.includes=function(e,t){return-1!==e.indexOf(t)},v.arrayFilter=function(e,t){for(var r=-1,i=e?e.length:0,n=0,o=[];++r<i;){var s=e[r];t(s,r,e)&&(o[n++]=s)}return o},v.inherit=function(e,t){return e.prototype=new t,e.prototype.constructor=e,e.superclass=t.prototype,e},v.isObject=function(e){return"[object Object]"===u.call(e)},v.isEmptyObject=function(e){if(v.isObject(e)){for(var t in e)if(l.call(e,t))return!1;return!0}return!1};var y=/^\s+|\s+$/;v.trim="".trim?function(e){return e.trim()}:function(e){return e.replace(y)},v.isUndefined=function(e){return void 0===e},v.isString=function(e){return"[object String]"===u.call(e)},v.isDate=function(e){return"[object Date]"===u.call(e)},v.isBoolean=function(e){return"[object Boolean]"===u.call(e)},v.isNumber=function(e){return"[object Number]"===u.call(e)&&/[\d\.]+/.test(String(e))},v.encodeDates=function(e){return v.each(e,function(t,r){v.isDate(t)?e[r]=v.formatDate(t):v.isObject(t)&&(e[r]=v.encodeDates(t))}),e},v.formatDate=function(e){function t(e){return e<10?"0"+e:e}return[e.getFullYear(),"-",t(e.getMonth()+1),"-",t(e.getDate()),"T",t(e.getHours()),":",t(e.getMinutes()),":",t(e.getSeconds()),".",t(e.getMilliseconds()),"+08:00"].join("")},v.searchObjDate=function(e){v.isObject(e)&&v.each(e,function(t,r){v.isObject(t)?v.searchObjDate(e[r]):v.isDate(t)&&(e[r]=v.formatDate(t))})},v.utf8Encode=function(e){var t,r,i,n="",o=0;for(t=r=0,o=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,i=0;i<o;i++){var s=e.charCodeAt(i),a=null;s<128?r++:a=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==a&&(r>t&&(n+=e.substring(t,r)),n+=a,t=r=i+1)}return r>t&&(n+=e.substring(t,e.length)),n},v.detector=o,v.base64Encode=function(e){var t,r,i,n,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,c=0,u="",l=[];if(!e)return e;e=v.utf8Encode(e);do{t=(o=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,r=o>>12&63,i=o>>6&63,n=63&o,l[c++]=s.charAt(t)+s.charAt(r)+s.charAt(i)+s.charAt(n)}while(a<e.length);switch(u=l.join(""),e.length%3){case 1:u=u.slice(0,-2)+"==";break;case 2:u=u.slice(0,-1)+"="}return u},v.UUID=function(){var e=function(){for(var e=1*new Date,t=0;e===1*new Date;)t++;return e.toString(16)+t.toString(16)},t=function(){return Math.random().toString(16).replace(".","")},r=function(e){function t(e,t){var r,i=0;for(r=0;r<t.length;r++)i|=o[r]<<8*r;return e^i}var r,i,n=h,o=[],s=0;for(r=0;r<n.length;r++)i=n.charCodeAt(r),o.unshift(255&i),o.length>=4&&(s=t(s,o),o=[]);return o.length>0&&(s=t(s,o)),s.toString(16)};return function(){var i=(screen.height*screen.width).toString(16);return e()+"-"+t()+"-"+r()+"-"+i+"-"+e()}}(),v.getQueryParam=function(e,t,r,i){var n,o;return t&&"string"==typeof t||(t=window.location[i?"hash":"search"]),(o=t.indexOf(i?"#":"?"))<0?null:(n="&"+t.slice(o+1))&&new RegExp("&"+e+"=([^&#]*)").test(n)?r?RegExp.$1:unescape(RegExp.$1):null},v.concatQueryParam=function(e,t,r){var i="";-1!==e.indexOf("#")&&(i=e.split("#")[1],e=e.split("#")[0]),void 0!==r&&null!==r||(r="");var n="[\\?&]"+t+"=([^&#]*)",o=new RegExp(n).exec(e);return e=null===o||o&&"string"!=typeof o[1]&&o[1].length?-1!==e.indexOf("?")||-1!==e.indexOf("=")?e+"&"+t+"="+r:e+"?"+t+"="+r:e.replace(o[0],o[0].replace(o[1],r)),""!==i&&(e+="#"+i),e},v.parseUrl=function(e){var t=p.createElement("a"),r=window.location,i={};t.href=e,i.port=t.port;var n=t.href.split("://");return!i.port&&n[1]&&(i.port=n[1].split("/")[0].split(":")[1]),i.port&&"0"!==i.port||(i.port="https"===n[0]?"443":"80"),i.hostname=t.hostname||r.hostname,i.pathname=t.pathname,"/"!==i.pathname.charAt(0)&&(i.pathname="/"+i.pathname),i.sameOrigin=!t.hostname||t.hostname===p.domain&&t.port===r.port&&t.protocol===r.protocol,i},v.xhr=function(e){var t;if(e&&(t=new XMLHttpRequest,t="withCredentials"in t?t:"undefined"!=typeof XDomainRequest?new XDomainRequest:t),XMLHttpRequest&&(t=new XMLHttpRequest),window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return"setRequestHeader"in t||(t.setRequestHeader=function(){}),t.__apm_xhr__=!0,t},v.ajax=function(e){function t(e){try{return n.parse(e)}catch(e){return{}}}var r=v.xhr(e.cors);if(e.type||(e.type=e.data?"POST":"GET"),e=v.extend({success:function(){},error:function(e,t,r){v.log(e.status),v.log(e.readyState),v.log(t)},complete:function(e){}},e),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300||304===r.status?e.success(t(r.responseText)):e.error(r),e.complete(r),r.onreadystatechange&&(r.onreadystatechange=null),r.onload&&(r.onload=null))},r.open(e.type,e.url,void 0===e.async||e.async),v.isObject(e.header))for(var i in e.header)r.setRequestHeader(i,e.header[i]);e.data&&(r.setRequestHeader("X-Requested-With","XMLHttpRequest"),"application/json"===e.contentType?r.setRequestHeader("Content-type","application/json; charset=UTF-8"):r.setRequestHeader("Content-type","application/x-www-form-urlencoded")),r.send(e.data||null)},v.info={searchEngine:function(e){return 0===e.search("https?://(.*)google.([^/?]*)")?"google":0===e.search("https?://(.*)bing.com")?"bing":0===e.search("https?://(.*)yahoo.com")?"yahoo":0===e.search("https?://(.*)duckduckgo.com")?"duckduckgo":0===e.search("https?://(.*)sogou.com")?"sogou":0===e.search("https?://(.*)so.com")?"360so":null},browser:function(e,t,r){var i=t||"";return r||v.includes(e," OPR/")?v.includes(e,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":v.includes(e,"IEMobile")||v.includes(e,"WPDesktop")?"Internet Explorer Mobile":v.includes(e,"Edge")?"Microsoft Edge":v.includes(e,"FBIOS")?"Facebook Mobile":v.includes(e,"Chrome")?"Chrome":v.includes(e,"CriOS")?"Chrome iOS":v.includes(i,"Apple")?v.includes(e,"Mobile")?"Mobile Safari":"Safari":v.includes(e,"Android")?"Android Mobile":v.includes(e,"Konqueror")?"Konqueror":v.includes(e,"Firefox")?"Firefox":v.includes(e,"MSIE")||v.includes(e,"Trident/")?"Internet Explorer":v.includes(e,"Gecko")?"Mozilla":""},browserVersion:function(e,t,r){var i={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/Chrome\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[v.info.browser(e,t,r)];if(void 0===i)return null;var n=e.match(i);return n?String(parseFloat(n[n.length-2])):null},os:function(){var e=h;return/Windows/i.test(e)?/Phone/.test(e)?"Windows Mobile":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"Mac OS X":/Linux/.test(e)?"Linux":""},device:function(e){return/iPad/.test(e)?"iPad":/iPod/i.test(e)?"iPod":/iPhone/i.test(e)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Windows Phone/i.test(e)?"Windows Phone":/Windows/i.test(e)?"Windows":/Macintosh/i.test(e)?"Macintosh":/Android/i.test(e)?"Android":/Linux/i.test(e)?"Linux":""},referringDomain:function(e){var t=e.split("/");return t.length>=3?t[2]:""},getBrowser:function(){return{browser:o.browser.name,browser_version:String(o.browser.version)}},getWindow:function(){var e,t;return window.innerWidth?e=window.innerWidth:p.body&&p.body.clientWidth&&(e=p.body.clientWidth),window.innerHeight?t=window.innerHeight:p.body&&p.body.clientHeight&&(t=p.body.clientHeight),p.documentElement&&p.documentElement.clientHeight&&p.documentElement.clientWidth&&(t=p.documentElement.clientHeight,e=p.documentElement.clientWidth),{win_width:e,win_height:t}},properties:function(){var e=p.body&&p.body.getElementsByTagName("h1"),t="";return e&&e.length&&e.length>0&&(t=e[0].innerText||e.textContent||""),v.extend({},{os:o.os.name,os_version:o.os.fullVersion,device:o.device.name,device_version:o.device.fullVersion},{browser_engine:o.engine.name,screen_height:screen.height,screen_width:screen.width,page_title:p.title,page_h1:t,page_referrer:p.referrer,page_url:location.href,page_url_path:location.pathname,lib:"js",lib_version:f},v.info.getBrowser())},currentProps:{},register:function(e){v.extend(v.info.currentProps,e)}},t.exports=v},{"./config":2,"./json":9,"./ua":20}],2:[function(e,t,r){t.exports={LIB_VERSION:"1.0.0",LIB_KEY:"RXAPM201708",maxLimit:10,crossSubDomain:!0,loadTime:new Date,apiHost:"http://172.16.12.187:8099",oAuth:!1,agentId:"35"}},{}],3:[function(e,t,r){t.exports={pageLoader_loaded:"pageLoader_loaded",pageLoader_domloading:"pageLoader_domloading",kepler_message_type:"Kepler-Message-Type",kepler_agent_token:"Kepler-Agent-Token",kepler_config_version:"Kepler-Config-Version",WEB_ERROR:"WEB_ERROR",WEB_LOAD_BATCH:"WEB_LOAD_BATCH",WEB_AJAX_BATCH:"WEB_AJAX_BATCH"}},{}],4:[function(e,t,r){var i=e("./common"),n=e("./json"),o=document.documentElement,s=/^(A|BUTTON)$/,a={addEvent:window.addEventListener?function(e,t,r){e.addEventListener(t,r,!0)}:function(e,t,r){e.attachEvent("on"+t,r)},innerText:"innerText"in o?function(e){return e.innerText}:function(e){return e.textContent},iAncestorTag:function(e,t,r){t.test||(t=t.toUpperCase()),r||(r=document);do{if(t.test?t.test(e.tagName):e.tagName===t)return e}while(e!==r&&(e=e.parentNode))},BUTTON_TYPE:{button:!0,image:!0,submit:!0,reset:!0},getClickPreset:function(e){e||(e=window.event);var t,r,o,c,u,l,d,p,h=e.target||e.srcElement;switch(h.tagName){case"INPUT":o=h.type,a.BUTTON_TYPE[o]&&(l=this.getDomSelector(h),p=this.getDomSize(h),d=this.getDomEventOffset(e,h),console.log(n.stringify({domPath:l,domSize:p,offset:d},null,2)),r={event:"btn_click",category:"click",properties:{b_dom_path:l,b_offset_x:d.offsetX,b_offset_y:d.offsetY,b_dom_width:p.width,b_dom_height:p.height,b_btn_type:o,b_btn_text:h.value,b_btn_name:h.getAttribute("name")||"",b_btn_value:h.getAttribute("value")||""}});break;default:if(t=a.iAncestorTag(h,s))switch(l=this.getDomSelector(t),p=this.getDomSize(t),d=this.getDomEventOffset(e,t),console.log(n.stringify({domPath:l,domSize:p,offset:d},null,2)),t.tagName){case"BUTTON":c=i.trim(a.innerText(t)),r={event:"btn_click",category:"click",properties:{b_dom_path:l,b_offset_x:d.offsetX,b_offset_y:d.offsetY,b_dom_width:p.width,b_dom_height:p.height,b_btn_type:t.type,b_btn_text:c,b_btn_name:t.getAttribute("name")||"",b_btn_value:t.getAttribute("value")||""}};break;case"A":c=i.trim(a.innerText(t)),u=t.href,r={event:"link_click",category:"click",properties:{b_dom_path:l,b_offset_x:d.offsetX,b_offset_y:d.offsetY,b_dom_width:p.width,b_dom_height:p.height,b_link_url:u,b_link_text:c}}}else l=this.getDomSelector(h),p=this.getDomSize(h),d=this.getDomEventOffset(e,h),console.log(n.stringify({domPath:l,domSize:p,offset:d},null,2)),r={event:"element_click",category:"click",properties:{b_dom_path:l,b_offset_x:d.offsetX,b_offset_y:d.offsetY,b_dom_width:p.width,b_dom_height:p.height}}}return r&&(r.properties.b_clientX=e.clientX,r.properties.b_clientY=e.clientY),r},getPageSize:function(){var e,t;window.innerHeight&&window.scrollMaxY?(e=window.innerWidth+window.scrollMaxX,t=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):document.body&&(e=document.body.offsetWidth,t=document.body.offsetHeight);var r,i;return window.innerHeight?(r=window.innerWidth,i=window.innerHeight):document.documentElement&&document.documentElement.clientHeight?(r=document.documentElement.clientWidth,i=document.documentElement.clientHeight):document.body&&(r=document.body.clientWidth,i=document.body.clientHeight),{PageWidth:e<r?r:e,PageHeight:t<i?i:t,WinWidth:r,WinHeight:i}},getPageScroll:function(){var e,t;return window.pageYOffset?(t=window.pageYOffset,e=window.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(e=document.documentElement.scrollLeft,t=document.documentElement.scrollTop):document.body&&(e=document.body.scrollLeft,t=document.body.scrollTop),{b_scrollX:e,b_scrollY:t}},getDomSelector:function(e){var t=e.nodeName.toLowerCase();if("body"===t||"html"===t)return"body";var r=e.parentNode;if(e.getAttribute("id"))return this.getDomSelector(r)+">#"+e.getAttribute("id");if(("input"===t||"select"===t||"textarea"===t||"button"===t)&&e.getAttribute("name"))return this.getDomSelector(r)+">"+t+":input[name='"+e.getAttribute("name")+"']";for(var i=[],n=0;n<r.children.length;n++){var o=r.children[n];o.nodeName&&o.nodeName.toLowerCase()===t&&i.push(o)}for(n=0;n<i.length;n++)if(i[n]===e)return this.getDomSelector(r)+">"+t+":eq("+n+")"},getDomOffset:function(e){var t={top:0,left:0};return void 0!==e.getBoundingClientRect?(t=document.documentElement,t={top:(e=e.getBoundingClientRect()).top+(window.pageYOffset||t.scrollTop)-(t.clientTop||0),left:e.left+(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):(t.top+=e.offsetTop,t.left+=e.offsetLeft,e.offsetParent&&(e=this.getDomOffset(e.offsetParent),t.top+=e.top,t.left+=e.left),t.top<0&&(t.top=0),t.left<0&&(t.left=0),t.top=isNaN(t.top)?0:parseInt(t.top,10),t.left=isNaN(t.left)?0:parseInt(t.left,10)),t.top=Math.round(t.top),t.left=Math.round(t.left),t},getDomEventOffset:function(e,t){var r={};if(e.offsetX&&e.offsetY)r.offsetX=e.offsetX,r.offsetY=e.offsetY;else{var i=t.getBoundingClientRect();r.offsetX=e.clientX-i.left,r.offsetY=e.clientY-i.top}return r},getDomSize:function(e){var t={};return t.width=e.offsetWidth,t.height=e.offsetHeight,t}};t.exports=a},{"./common":1,"./json":9}],5:[function(e,t,r){function i(e,t,r){this.message=e||"Uncaught error with no additional information",this.sourceURL=t,this.line=r}var n=e("../common"),o=e("../consts"),s=e("../eventEmitter"),a=e("../config"),c=e("../log"),u=window.onerror,l=[];console.log(a),s.on("err",function(e){c("====捕获到错误===="),c(arguments),l.push(e)}),setInterval(function(){var e=[];e=l.length>a.maxLimit?l.splice(0,a.maxLimit):l.splice(0,l.length);var t={url:a.apiHost,type:"get",cors:!0,data:e,success:function(e){c("错误信息已发送")},error:function(e){c(e.status),c(e.statusText)},complete:function(){c("错误信息发送完毕.")}};t.header={},t.header[o.kepler_message_type]=o.web_error,t.header[o.kepler_agent_token]=a.agentId,t.header[o.kepler_config_version]=a.LIB_VERSION},a.transFrequency),window.onerror=function(e,t,r,o,a){try{s.emit("err",[a||new i(e,t,r)])}catch(a){try{s.emit("innererr",[a,(new Date).getTime(),!0])}catch(a){}}return"function"==typeof u&&u.apply(this,n.toArray(arguments))},t.exports=s},{"../common":1,"../config":2,"../consts":3,"../eventEmitter":6,"../log":12}],6:[function(e,t,r){function i(){function e(){return{}}function t(t,r,i){i||(i={});var a=s(t),c=a.length,u={};try{u=n.setOnce(i,o,e)}catch(e){}for(var l=0;c>l;l++)a[l].apply(u,r);return u}function r(e,t){t||(t=function(){}),a[e]=s(e).concat(t)}function s(e){return a[e]||[]}var a={},c={};return{on:r,emit:t,create:function(){return i(t)},listeners:s,_events:a,addEventArgs:function(e,r,i){s(e).length?t(e,r,i):(c[e]||(c[e]=[]),c[e].push(r))},handleQueue:function(e,i){if(s(e).length)return!1;r(e,i);var n=c[e];if(n){for(var o=0;o<n.length;o++)t(e,n[o]);delete c[e]}return!0}}}var n=e("./globalContext"),o="__default_context__";t.exports=i()},{"./globalContext":8}],7:[function(e,t,r){var i=e("./main"),n={maxLimit:10,crossSubDomain:!0,loadTime:window.$$rxApmFirstByteTime||1*new Date,showLog:!0,openTracing:!0,transFrequency:5e3,apiHost:"http://10.200.10.22:8098",agentId:"pEdfa3M1",tierId:"1",appId:"1"};(n={disabled:!1,maxLimit:10,crossSubDomain:!0,loadTime:window.$$rxApmFirstByteTime||1*new Date,showLog:"true",openTracing:"false",transFrequency:"1000",apiHost:"http://10.205.16.130:28080",agentId:"4A3iHZls",tierId:"",appId:"723318498816004096"}).showLog=!0+""===n.showLog,n.openTracing=!0+""===n.openTracing,n.transFrequency=+n.transFrequency,i.init(n)},{"./main":13}],8:[function(e,t,r){function i(){return a.getSession("CURRENT_EVENT_ID")}function n(e){a.setSession("CURRENT_EVENT_ID",e)}var o=e("./common"),s=e("./config"),a=e("./store"),c=e("./locker"),u={},l={get:function(e){return e?u[e]:u},set:function(e,t){u[e]=t},push:function(e,t){var r=u[e];r||(r=u[e]=[]),r.push(t)},setOnce:function(e,t,r){if(Object.prototype.hasOwnProperty.call(e,t))return e[t];var i=r();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,t,{value:i,writable:!0,enumerable:!1}),i}catch(e){}try{e[t]=i}catch(e){}return i},getEventPool:function(){return o.localStorage.parse(s.LIB_KEY+"EventPool"+s.agentId,[])},setEventPool:function(e){o.localStorage.set(s.LIB_KEY+"EventPool"+s.agentId,JSON.stringify(e))},pushEvent:function(e){var t=this;e.sending=!1,c.exec(function(){e.cid=o.UUID();var r=i();r&&(e.pid=r),n(e.cid);var s=t.getEventPool();s.push(e),t.setEventPool(s)})}};t.exports=l},{"./common":1,"./config":2,"./locker":11,"./store":18}],9:[function(require,module,exports){var toString=Object.prototype.toString;module.exports="object"==typeof JSON&&"[object JSON]"===toString.call(JSON)?JSON:function(JSON){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return rx_escapable.lastIndex=0,rx_escapable.test(e)?'"'+e.replace(rx_escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function objectToJSON(e){switch(toString.call(e)){case"[object Date]":return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null;case"[object Boolean]":case"[object String]":case"[object Number]":return e.valueOf()}return e}function str(e,t){var r,i,n,o,s,a=gap,c=t[e];switch(c&&"object"==typeof c&&(c=objectToJSON(c)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===toString.call(c)){for(o=c.length,r=0;o>r;r+=1)s[r]=str(r,c)||"null";return n=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,n}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;o>r;r+=1)"string"==typeof rep[r]&&(i=rep[r],(n=str(i,c))&&s.push(quote(i)+(gap?": ":":")+n));else for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(n=str(i,c))&&s.push(quote(i)+(gap?": ":":")+n);return n=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,n}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta,rep;return"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,r){var i;if(gap="",indent="","number"==typeof r)for(i=0;r>i;i+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,i,n=e[t];if(n&&"object"==typeof n)for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(void 0!==(i=walk(n,r))?n[r]=i:delete n[r]);return reviver.call(e,t,n)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}),JSON}({})},{}],10:[function(e,t,r){var i=e("./thrift"),n=function(e){this.loadBatch=null,e&&void 0!==e.loadBatch&&null!==e.loadBatch&&(this.loadBatch=i.copyList(e.loadBatch,[null]))};(n.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),r=(t.fname,t.ftype),n=t.fid;if(r==i.Type.STOP)break;switch(n){case 1:if(r==i.Type.LIST){var s,a=0;this.loadBatch=[];(s=e.readListBegin()).etype,a=s.size;for(var c=0;c<a;++c){var u=null;(u=new o).read(e),this.loadBatch.push(u)}e.readListEnd()}else e.skip(r);break;case 0:e.skip(r);break;default:e.skip(r)}e.readFieldEnd()}e.readStructEnd()},n.prototype.write=function(e){if(e.writeStructBegin("TWebAgentLoadBatch"),null!==this.loadBatch&&void 0!==this.loadBatch){e.writeFieldBegin("loadBatch",i.Type.LIST,1),e.writeListBegin(i.Type.STRUCT,this.loadBatch.length);for(var t in this.loadBatch)this.loadBatch.hasOwnProperty(t)&&(t=this.loadBatch[t]).write(e);e.writeListEnd(),e.writeFieldEnd()}e.writeFieldStop(),e.writeStructEnd()};var o=function(e){this.agentId=null,this.tierId=null,this.appId=null,this.traceId=null,this.urlDomain=null,this.urlQuery=null,this.reportTime=null,this.firstScreenTime=null,this.whiteScreenTime=null,this.operableTime=null,this.resourceLoadedTime=null,this.loadedTime=null,this.browser=null,this.backupProperties=null,this.backupQuota=null,e&&(void 0!==e.agentId&&null!==e.agentId&&(this.agentId=e.agentId),void 0!==e.tierId&&null!==e.tierId&&(this.tierId=e.tierId),void 0!==e.appId&&null!==e.appId&&(this.appId=e.appId),void 0!==e.traceId&&null!==e.traceId&&(this.traceId=e.traceId),void 0!==e.urlDomain&&null!==e.urlDomain&&(this.urlDomain=e.urlDomain),void 0!==e.urlQuery&&null!==e.urlQuery&&(this.urlQuery=e.urlQuery),void 0!==e.reportTime&&null!==e.reportTime&&(this.reportTime=e.reportTime),void 0!==e.firstScreenTime&&null!==e.firstScreenTime&&(this.firstScreenTime=e.firstScreenTime),void 0!==e.whiteScreenTime&&null!==e.whiteScreenTime&&(this.whiteScreenTime=e.whiteScreenTime),void 0!==e.operableTime&&null!==e.operableTime&&(this.operableTime=e.operableTime),void 0!==e.resourceLoadedTime&&null!==e.resourceLoadedTime&&(this.resourceLoadedTime=e.resourceLoadedTime),void 0!==e.loadedTime&&null!==e.loadedTime&&(this.loadedTime=e.loadedTime),void 0!==e.browser&&null!==e.browser&&(this.browser=e.browser),void 0!==e.backupProperties&&null!==e.backupProperties&&(this.backupProperties=i.copyMap(e.backupProperties,[null])),void 0!==e.backupQuota&&null!==e.backupQuota&&(this.backupQuota=i.copyMap(e.backupQuota,[null])))};o.prototype={},o.prototype.read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),r=(t.fname,t.ftype),n=t.fid;if(r==i.Type.STOP)break;switch(n){case 1:r==i.Type.STRING?this.agentId=e.readString().value:e.skip(r);break;case 2:r==i.Type.STRING?this.tierId=e.readString().value:e.skip(r);break;case 3:r==i.Type.STRING?this.appId=e.readString().value:e.skip(r);break;case 4:r==i.Type.STRING?this.traceId=e.readString().value:e.skip(r);break;case 5:r==i.Type.STRING?this.urlDomain=e.readString().value:e.skip(r);break;case 6:r==i.Type.STRING?this.urlQuery=e.readString().value:e.skip(r);break;case 7:r==i.Type.I64?this.reportTime=e.readI64().value:e.skip(r);break;case 8:r==i.Type.I64?this.firstScreenTime=e.readI64().value:e.skip(r);break;case 9:r==i.Type.I64?this.whiteScreenTime=e.readI64().value:e.skip(r);break;case 10:r==i.Type.I64?this.operableTime=e.readI64().value:e.skip(r);break;case 11:r==i.Type.I64?this.resourceLoadedTime=e.readI64().value:e.skip(r);break;case 12:r==i.Type.I64?this.loadedTime=e.readI64().value:e.skip(r);break;case 13:r==i.Type.STRING?this.browser=e.readString().value:e.skip(r);break;case 14:if(r==i.Type.MAP){var o,s=0;this.backupProperties={};(o=e.readMapBegin()).ktype,o.vtype,s=o.size;for(var a=0;a<s;++a){a>0&&e.rstack.length>e.rpos[e.rpos.length-1]+1&&e.rstack.pop();var c=null,u=null;c=e.readString().value,u=e.readString().value,this.backupProperties[c]=u}e.readMapEnd()}else e.skip(r);break;case 15:if(r==i.Type.MAP){var l,d=0;this.backupQuota={};(l=e.readMapBegin()).ktype,l.vtype,d=l.size;for(var p=0;p<d;++p){p>0&&e.rstack.length>e.rpos[e.rpos.length-1]+1&&e.rstack.pop();var h=null,f=null;h=e.readString().value,f=e.readI64().value,this.backupQuota[h]=f}e.readMapEnd()}else e.skip(r);break;default:e.skip(r)}e.readFieldEnd()}e.readStructEnd()},o.prototype.write=function(e){if(e.writeStructBegin("TWebAgentLoad"),null!==this.agentId&&void 0!==this.agentId&&(e.writeFieldBegin("agentId",i.Type.STRING,1),e.writeString(this.agentId),e.writeFieldEnd()),null!==this.tierId&&void 0!==this.tierId&&(e.writeFieldBegin("tierId",i.Type.STRING,2),e.writeString(this.tierId),e.writeFieldEnd()),null!==this.appId&&void 0!==this.appId&&(e.writeFieldBegin("appId",i.Type.STRING,3),e.writeString(this.appId),e.writeFieldEnd()),null!==this.traceId&&void 0!==this.traceId&&(e.writeFieldBegin("traceId",i.Type.STRING,4),e.writeString(this.traceId),e.writeFieldEnd()),null!==this.urlDomain&&void 0!==this.urlDomain&&(e.writeFieldBegin("urlDomain",i.Type.STRING,5),e.writeString(this.urlDomain),e.writeFieldEnd()),null!==this.urlQuery&&void 0!==this.urlQuery&&(e.writeFieldBegin("urlQuery",i.Type.STRING,6),e.writeString(this.urlQuery),e.writeFieldEnd()),null!==this.reportTime&&void 0!==this.reportTime&&(e.writeFieldBegin("reportTime",i.Type.I64,7),e.writeI64(this.reportTime),e.writeFieldEnd()),null!==this.firstScreenTime&&void 0!==this.firstScreenTime&&(e.writeFieldBegin("firstScreenTime",i.Type.I64,8),e.writeI64(this.firstScreenTime),e.writeFieldEnd()),null!==this.whiteScreenTime&&void 0!==this.whiteScreenTime&&(e.writeFieldBegin("whiteScreenTime",i.Type.I64,9),e.writeI64(this.whiteScreenTime),e.writeFieldEnd()),null!==this.operableTime&&void 0!==this.operableTime&&(e.writeFieldBegin("operableTime",i.Type.I64,10),e.writeI64(this.operableTime),e.writeFieldEnd()),null!==this.resourceLoadedTime&&void 0!==this.resourceLoadedTime&&(e.writeFieldBegin("resourceLoadedTime",i.Type.I64,11),e.writeI64(this.resourceLoadedTime),e.writeFieldEnd()),null!==this.loadedTime&&void 0!==this.loadedTime&&(e.writeFieldBegin("loadedTime",i.Type.I64,12),e.writeI64(this.loadedTime),e.writeFieldEnd()),null!==this.browser&&void 0!==this.browser&&(e.writeFieldBegin("browser",i.Type.STRING,13),e.writeString(this.browser),e.writeFieldEnd()),null!==this.backupProperties&&void 0!==this.backupProperties){e.writeFieldBegin("backupProperties",i.Type.MAP,14),e.writeMapBegin(i.Type.STRING,i.Type.STRING,i.objectLength(this.backupProperties));for(var t in this.backupProperties)if(this.backupProperties.hasOwnProperty(t)){var r=this.backupProperties[t];e.writeString(t),e.writeString(r)}e.writeMapEnd(),e.writeFieldEnd()}if(null!==this.backupQuota&&void 0!==this.backupQuota){e.writeFieldBegin("backupQuota",i.Type.MAP,15),e.writeMapBegin(i.Type.STRING,i.Type.I64,i.objectLength(this.backupQuota));for(var n in this.backupQuota)if(this.backupQuota.hasOwnProperty(n)){var o=this.backupQuota[n];e.writeString(n),e.writeI64(o)}e.writeMapEnd(),e.writeFieldEnd()}e.writeFieldStop(),e.writeStructEnd()};var s=function(e){this.ajaxBatch=null,e&&void 0!==e.ajaxBatch&&null!==e.ajaxBatch&&(this.ajaxBatch=i.copyList(e.ajaxBatch,[null]))};(s.prototype={}).read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),r=(t.fname,t.ftype),n=t.fid;if(r==i.Type.STOP)break;switch(n){case 1:if(r==i.Type.LIST){var o,s=0;this.ajaxBatch=[];(o=e.readListBegin()).etype,s=o.size;for(var c=0;c<s;++c){var u=null;(u=new a).read(e),this.ajaxBatch.push(u)}e.readListEnd()}else e.skip(r);break;case 0:e.skip(r);break;default:e.skip(r)}e.readFieldEnd()}e.readStructEnd()},s.prototype.write=function(e){if(e.writeStructBegin("TWebAgentAjaxBatch"),null!==this.ajaxBatch&&void 0!==this.ajaxBatch){e.writeFieldBegin("ajaxBatch",i.Type.LIST,1),e.writeListBegin(i.Type.STRUCT,this.ajaxBatch.length);for(var t in this.ajaxBatch)this.ajaxBatch.hasOwnProperty(t)&&(t=this.ajaxBatch[t]).write(e);e.writeListEnd(),e.writeFieldEnd()}e.writeFieldStop(),e.writeStructEnd()};var a=function(e){this.agentId=null,this.tierId=null,this.appId=null,this.traceId=null,this.urlDomain=null,this.urlQuery=null,this.reportTime=null,this.loadedTime=null,this.browser=null,this.backupProperties=null,this.backupQuota=null,e&&(void 0!==e.agentId&&null!==e.agentId&&(this.agentId=e.agentId),void 0!==e.tierId&&null!==e.tierId&&(this.tierId=e.tierId),void 0!==e.appId&&null!==e.appId&&(this.appId=e.appId),void 0!==e.traceId&&null!==e.traceId&&(this.traceId=e.traceId),void 0!==e.urlDomain&&null!==e.urlDomain&&(this.urlDomain=e.urlDomain),void 0!==e.urlQuery&&null!==e.urlQuery&&(this.urlQuery=e.urlQuery),void 0!==e.reportTime&&null!==e.reportTime&&(this.reportTime=e.reportTime),void 0!==e.loadedTime&&null!==e.loadedTime&&(this.loadedTime=e.loadedTime),void 0!==e.browser&&null!==e.browser&&(this.browser=e.browser),void 0!==e.backupProperties&&null!==e.backupProperties&&(this.backupProperties=i.copyMap(e.backupProperties,[null])),void 0!==e.backupQuota&&null!==e.backupQuota&&(this.backupQuota=i.copyMap(e.backupQuota,[null])))};a.prototype={},a.prototype.read=function(e){for(e.readStructBegin();;){var t=e.readFieldBegin(),r=(t.fname,t.ftype),n=t.fid;if(r==i.Type.STOP)break;switch(n){case 1:r==i.Type.STRING?this.agentId=e.readString().value:e.skip(r);break;case 2:r==i.Type.STRING?this.tierId=e.readString().value:e.skip(r);break;case 3:r==i.Type.STRING?this.appId=e.readString().value:e.skip(r);break;case 4:r==i.Type.STRING?this.traceId=e.readString().value:e.skip(r);break;case 5:r==i.Type.STRING?this.urlDomain=e.readString().value:e.skip(r);break;case 6:r==i.Type.STRING?this.urlQuery=e.readString().value:e.skip(r);break;case 7:r==i.Type.I64?this.reportTime=e.readI64().value:e.skip(r);break;case 8:r==i.Type.I64?this.loadedTime=e.readI64().value:e.skip(r);break;case 9:r==i.Type.STRING?this.browser=e.readString().value:e.skip(r);break;case 10:if(r==i.Type.MAP){var o,s=0;this.backupProperties={};(o=e.readMapBegin()).ktype,o.vtype,s=o.size;for(var a=0;a<s;++a){a>0&&e.rstack.length>e.rpos[e.rpos.length-1]+1&&e.rstack.pop();var c=null,u=null;c=e.readString().value,u=e.readString().value,this.backupProperties[c]=u}e.readMapEnd()}else e.skip(r);break;case 11:if(r==i.Type.MAP){var l,d=0;this.backupQuota={};(l=e.readMapBegin()).ktype,l.vtype,d=l.size;for(var p=0;p<d;++p){p>0&&e.rstack.length>e.rpos[e.rpos.length-1]+1&&e.rstack.pop();var h=null,f=null;h=e.readString().value,f=e.readI64().value,this.backupQuota[h]=f}e.readMapEnd()}else e.skip(r);break;default:e.skip(r)}e.readFieldEnd()}e.readStructEnd()},a.prototype.write=function(e){if(e.writeStructBegin("TWebAgentAjax"),null!==this.agentId&&void 0!==this.agentId&&(e.writeFieldBegin("agentId",i.Type.STRING,1),e.writeString(this.agentId),e.writeFieldEnd()),null!==this.tierId&&void 0!==this.tierId&&(e.writeFieldBegin("tierId",i.Type.STRING,2),e.writeString(this.tierId),e.writeFieldEnd()),null!==this.appId&&void 0!==this.appId&&(e.writeFieldBegin("appId",i.Type.STRING,3),e.writeString(this.appId),e.writeFieldEnd()),null!==this.traceId&&void 0!==this.traceId&&(e.writeFieldBegin("traceId",i.Type.STRING,4),e.writeString(this.traceId),e.writeFieldEnd()),null!==this.urlDomain&&void 0!==this.urlDomain&&(e.writeFieldBegin("urlDomain",i.Type.STRING,5),e.writeString(this.urlDomain),e.writeFieldEnd()),null!==this.urlQuery&&void 0!==this.urlQuery&&(e.writeFieldBegin("urlQuery",i.Type.STRING,6),e.writeString(this.urlQuery),e.writeFieldEnd()),null!==this.reportTime&&void 0!==this.reportTime&&(e.writeFieldBegin("reportTime",i.Type.I64,7),e.writeI64(this.reportTime),e.writeFieldEnd()),null!==this.loadedTime&&void 0!==this.loadedTime&&(e.writeFieldBegin("loadedTime",i.Type.I64,8),e.writeI64(this.loadedTime),e.writeFieldEnd()),null!==this.browser&&void 0!==this.browser&&(e.writeFieldBegin("browser",i.Type.STRING,9),e.writeString(this.browser),e.writeFieldEnd()),null!==this.backupProperties&&void 0!==this.backupProperties){e.writeFieldBegin("backupProperties",i.Type.MAP,10),e.writeMapBegin(i.Type.STRING,i.Type.STRING,i.objectLength(this.backupProperties));for(var t in this.backupProperties)if(this.backupProperties.hasOwnProperty(t)){var r=this.backupProperties[t];e.writeString(t),e.writeString(r)}e.writeMapEnd(),e.writeFieldEnd()}if(null!==this.backupQuota&&void 0!==this.backupQuota){e.writeFieldBegin("backupQuota",i.Type.MAP,11),e.writeMapBegin(i.Type.STRING,i.Type.I64,i.objectLength(this.backupQuota));for(var n in this.backupQuota)if(this.backupQuota.hasOwnProperty(n)){var o=this.backupQuota[n];e.writeString(n),e.writeI64(o)}e.writeMapEnd(),e.writeFieldEnd()}e.writeFieldStop(),e.writeStructEnd()},t.exports={TWebAgentLoad:o,TWebAgentAjax:a,TWebAgentLoadBatch:n,TWebAgentAjaxBatch:s}},{"./thrift":19}],11:[function(e,t,r){var i=e("./log"),n=null,o=!1,s=[],a={exec:function(e){s.push(e),n||(n=setInterval(function(){o||s.length<=0||(o=!0,s.shift()(),i("队列函数数量："+s.length),0===s.length&&(clearInterval(n),n=null),o=!1)},0))}};t.exports=a},{"./log":12}],12:[function(e,t,r){var i=e("./config");t.exports=function(){if(i.showLog&&"object"==typeof console&&console.log)try{console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}},{"./config":2}],13:[function(e,t,r){var i=e("./common"),n=e("./config"),o=e("./performance"),s={config:n};s.init=function(t){var r=this;t&&!i.isEmptyObject(t)&&i.extend(r.config,t),window.$$rxApmSetting&&i.extend(r.config,window.$$rxApmSetting),o(),e("./error"),e("./xhr")},t.exports=s},{"./common":1,"./config":2,"./error":5,"./performance":14,"./xhr":22}],14:[function(e,t,r){function i(){setTimeout(function(){u.addEventArgs("mark",["domLoading",g.getDomLoadingStartTime()]),c||console.warn("firstScreen not find"),u.addEventArgs("mark",["firstScreen",c.getFirstScreenTime()]),u.addEventArgs("mark",["onLoad",f.getCurrentTime()]),u.emit(d.pageLoader_loaded,[S])},0)}function n(){(_||"complete"===v.readyState)&&o()}function o(){u.addEventArgs("mark",["domContent",f.getCurrentTime()]),p("onDomContentLoaded executed, the firstScreen object:"),c=f.firstScreen(),p(c)}function s(){var e={};return u.handleQueue("mark",function(t,r){e[t]="firstByte"!==t?r-S.firstByte:S.firstByte}),e.domLoading=m.getWriteScreenTimeSpan()||e.domLoading,e.domContent=m.getDomReadyTimeSpan()||e.domContent,e.firstScreen=e.firstScreen||e.domContent||-1,e.onLoad=m.getPageReadyTimeSpan()||e.onLoad,e.dns=m.getDNSTimeSpan()||-1,e.tcp=m.getTCPTimeSpan()||-1,e.resourceCount=m.getResourceCount()||-1,e}function a(){u.addEventArgs("mark",["firstByte",h.loadTime||window.$$rxApmFirstByteTime||f.getCurrentTime()])}var c,u=e("../eventEmitter"),l=e("../common"),d=e("../consts"),p=e("../log"),h=e("../config"),f=e("./pageLoader"),g=f.domLoading(),m=e("./performance"),b=e("./sender"),T=window,v=T.document,w=(""+location).split("?")[0],y=!1,_=!1,S={firstByte:h.loadTime||window.$$rxApmFirstByteTime||f.getCurrentTime(),origin:w,features:{}};u.on(d.pageLoader_loaded,function(e){var t=s();b.sendPerformances(l.extend({},t,l.info.properties()))}),t.exports=function(){function e(){if(!_){try{y.doScroll("left")}catch(t){return setTimeout(e,50)}_=!0,o()}}a(),p(v.readyState);var t=document.readyState;"complete"===t?(o(),i()):("interactive"===t&&o(),v.addEventListener?(p("current readyState "+v.readyState+", exec dateTime :"+1*new Date),v.addEventListener("DOMContentLoaded",o,!1),T.addEventListener("load",i,!1)):(p("ie:current readyState "+v.readyState+", exec dateTime :"+1*new Date),v.attachEvent("onreadystatechange",n),T.attachEvent("onload",i)));try{y=null==window.frameElement&&document.documentElement}catch(e){}y&&y.doScroll&&e()}},{"../common":1,"../config":2,"../consts":3,"../eventEmitter":6,"../log":12,"./pageLoader":15,"./performance":16,"./sender":17}],15:[function(e,t,r){function i(){return 1*new Date}var n=e("../dom"),o=window.document;t.exports={getCurrentTime:i,domLoading:function(){var e=o.createElement("script");return e.id="rx-"+1*new Date,e.text="window.$$rxApmDomLoadingStartTime=new Date() * 1;            var s = document.getElementById('"+e.id+"');             document.getElementsByTagName('head')[0].removeChild(s);",document.getElementsByTagName("head")[0].appendChild(e),{getDomLoadingStartTime:function(){var e=window.$$rxApmDomLoadingStartTime;try{delete window.$$rxApmDomLoadingStartTime}catch(e){}return e}}},firstScreen:function(){for(var e=function(){var t=this;t.removeEventListener&&t.removeEventListener("load",e,!1),o.push({img:this,time:i()})},t=document.getElementsByTagName("img"),r=i(),o=[],s=0;s<t.length;s++)!function(){var r=t[s];r.addEventListener?!r.complete&&r.addEventListener("load",e,!1):r.attachEvent&&r.attachEvent("onreadystatechange",function(){"complete"===r.readyState&&e.call(r,e)})}();return{getFirstScreenTime:function(){for(var e=document.documentElement.clientHeight,t=0;t<o.length;t++){var i=o[t],s=i.img,a=i.time,c=n.getDomOffset(s).top;c>0&&c<e&&(r=a>r?a:r)}return r}}}}},{"../dom":4}],16:[function(e,t,r){var i,n,o,s=window,a=s.document,c=s.performance,u={};t.exports={getWriteScreenTimeSpan:function(){var e=0,t=0,r=0;if(c&&a.querySelectorAll&&c.getEntriesByType){r=c.timing.domLoading,i=a.querySelectorAll("head>link"),n=a.querySelectorAll("head>script");for(var s in i)""!==i[s].href&&void 0!==i[s].href&&(u[unescape(i[s].href)]=1);for(s in n)""!==n[s].src&&void 0!==n[s].src&&1!==n[s].async&&(u[unescape(n[s].src)]=1);for(t+=i.length,2*(t+=n.length)>(o=c.getEntriesByType("resource")).length?t=o.length:t+=t,e;t>=e;e++)o[e]&&1===u[unescape(o[e].name)]&&o[e].responseEnd>0&&o[e].responseEnd+c.timing.navigationStart>=r&&(r=o[e].responseEnd+c.timing.navigationStart);return r-=c.timing.navigationStart,parseInt(r)}},getStartTime:function(){return null},getSysConnectionType:function(){return window.navigator.connection?window.navigator.connection.type+"":""},getDNSTimeSpan:function(){if(window.performance)return window.performance.timing.domainLookupEnd-window.performance.timing.domainLookupStart},getTCPTimeSpan:function(){if(window.performance)return window.performance.timing.connectEnd-window.performance.timing.connectStart},getDomReadyTimeSpan:function(){if(window.performance)return window.performance.timing.domContentLoadedEventStart-window.performance.timing.navigationStart},getPageReadyTimeSpan:function(){if(window.performance)return window.performance.timing.loadEventStart-window.performance.timing.navigationStart},getResourceCount:function(){if(window.performance.getEntriesByType&&"function"==typeof window.performance.getEntriesByType)return window.performance.getEntriesByType("resource").length}}},{}],17:[function(e,t,r){function i(e,t){e.agentId=n.agentId,e.tierId=n.tierId,e.appId=n.appId,e.traceId=o.UUID(),e.urlDomain=document.domain||window.location.host,e.reportTime=1*new Date,e.firstScreenTime=t.firstScreen,e.whiteScreenTime=t.domLoading,e.operableTime=t.domContent,e.resourceLoadedTime=t.onLoad,e.loadedTime=t.onLoad,e.browser=t.browser,e.urlQuery=t.page_url_path,e.backupProperties={os:t.os,os_version:t.os_version,device:t.device,device_version:t.device_version,browser_engine:t.browser_engine,page_title:t.page_title,page_h1:t.page_h1,page_referrer:t.page_referrer,page_url:t.page_url,lib:t.lib,lib_version:t.lib_version,browser_version:t.browser_version},e.backupQuota={dns:t.dns,tcp:t.tcp,screen_height:t.screen_height,screen_width:t.screen_width}}var n=e("../config"),o=e("../common"),s=e("../consts"),a=e("../log"),c=e("../thrift"),u=e("../kepler");t.exports={sendPerformances:function(e){a("performance resource data:"),a(JSON.stringify(e,null,2));var t=new c.Transport(""),r=new c.Protocol(t),l=new u.TWebAgentLoad(e);i(l,e),r.writeMessageBegin("TWebAgentLoadBatch",c.MessageType.CALL,0),new u.TWebAgentLoadBatch({loadBatch:[l]}).write(r),r.writeMessageEnd();var d=t.flush(),p=JSON.parse(d);d=JSON.stringify(p[p.length-1]),a("performance thrift data:"),a(d);var h={url:n.apiHost,type:"post",cors:!0,data:d,success:function(e){a("性能数据已发送")},error:function(e){a("性能数据发送失败"),a(e.status),a(e.statusText)},complete:function(){a("事件发送完毕.")}};h.header={},h.header[s.kepler_message_type]=s.WEB_LOAD_BATCH,h.header[s.kepler_agent_token]=n.agentId,h.header[s.kepler_config_version]=n.LIB_VERSION,n.disabled||o.ajax(h)}}},{"../common":1,"../config":2,"../consts":3,"../kepler":10,"../log":12,"../thrift":19}],18:[function(e,t,r){var i=e("./config"),n=e("./common"),o=e("./json"),s=i.LIB_KEY;t.exports={getDeviceId:function(){return this._state.uniqueId},getSessionId:function(){return this._sessionState.sessionId},getDomain:function(){var e=this._state.domain;return e||(e=document.domain||window.location.host,this.setOnce("domain",e)),e},toState:function(e){var t=null;null!==e&&"object"==typeof(t=o.parse(e))&&(this._state=t)},initSessionState:function(){var e=n.cookie.get(s+"session"),t=null;null!==e&&"object"==typeof(t=o.parse(e))&&(this._sessionState=t)},get:function(e){return e?this._state[e]:this._state},getSession:function(e){return e?this._sessionState[e]:this._sessionState},set:function(e,t){this._state[e]=t,this.save()},setOnce:function(e,t){e in this._state||this.set(e,t)},setSession:function(e,t){this._sessionState[e]=t,this.sessionSave()},setSessionOnce:function(e,t){e in this._sessionState||this.setSession(e,t)},change:function(e,t){this._state[e]=t},sessionChange:function(e,t){this._sessionState[e]=t},setSessionProps:function(e){this._setSessionProps("props",e)},setSessionPropsOnce:function(e){this._setSessionPropsOnce("props",e)},setSessionSubject:function(e){this._setSessionProps("subject",e)},setSessionSubjectOnce:function(e){this._setSessionPropsOnce("subject",e)},clearSessionSubject:function(){this._sessionState.subject={},this.sessionSave()},setSessionObject:function(e){this._setSessionProps("object",e)},setSessionObjectOnce:function(e){this._setSessionPropsOnce("object",e)},clearSessionObject:function(){this._sessionState.object={},this.sessionSave()},setProps:function(e){this._setProps("props",e)},setPropsOnce:function(e){this._setPropsOnce("props",e)},setSubject:function(e){this._setProps("subject",e)},setSubjectOnce:function(e){this._setPropsOnce("subject",e)},clearSubject:function(){this._state.subject={},this.save()},setObject:function(e){this._setProps("subject",e)},setObjectOnce:function(e){this._setPropsOnce("subject",e)},clearObject:function(){this._state.object={},this.save()},_setProps:function(e,t){var r=this._state[e]||{};n.extend(r,t),this.set(e,r)},_setPropsOnce:function(e,t){var r=this._state[e]||{};n.coverExtend(r,t),this.set(e,r)},_setSessionProps:function(e,t){var r=this._sessionState[e]||{};n.extend(r,t),this.setSession(e,r)},_setSessionPropsOnce:function(e,t){var r=this._sessionState[e]||{};n.coverExtend(r,t),this.setSession(e,r)},sessionSave:function(e){e&&(this._sessionState=e),n.cookie.set(s+"session",o.stringify(this._sessionState),0,i.crossSubDomain)},save:function(){i.crossSubDomain?n.cookie.set(s+"jssdkcross",o.stringify(this._state),this._state.expires||730,!0):n.cookie.set(s+"jssdk",o.stringify(this._state),this._state.expires||730,!1)},_sessionState:{props:{},subject:{},object:{}},_state:{props:{},subject:{},object:{}},init:function(){var e=n.cookie.get(s+"jssdk"),t=n.cookie.get(s+"jssdkcross"),r=null;i.crossSubDomain?(r=t,null!==e&&(n.log("在根域且子域有值，删除子域的cookie"),n.cookie.remove(s+"jssdk",!1),n.cookie.remove(s+"jssdk",!0)),null===r&&null!==e&&(n.log("在根域且根域没值，子域有值，根域＝子域的值",e),r=e)):(n.log("在子域"),r=e),this.initSessionState(),null!==r?(this.toState(r),i.crossSubDomain&&null===t&&(n.log("在根域且根域没值，保存当前值到cookie中"),this.save())):(n.log("没有值，set值"),this.set("uniqueId",n.UUID())),this.setSessionOnce("sessionId",n.UUID())}}},{"./common":1,"./config":2,"./json":9}],19:[function(require,module,exports){var Thrift={Version:"1.0.0-dev",Type:{STOP:0,VOID:1,BOOL:2,BYTE:3,I08:3,DOUBLE:4,I16:6,I32:8,I64:10,STRING:11,UTF7:11,STRUCT:12,MAP:13,SET:14,LIST:15,UTF8:16,UTF16:17},MessageType:{CALL:1,REPLY:2,EXCEPTION:3,ONEWAY:4},objectLength:function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&t++;return t},inherits:function(e,t,r){function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.name=r||""}};Thrift.TException=function(e){this.message=e},Thrift.inherits(Thrift.TException,Error,"TException"),Thrift.TException.prototype.getMessage=function(){return this.message},Thrift.TApplicationExceptionType={UNKNOWN:0,UNKNOWN_METHOD:1,INVALID_MESSAGE_TYPE:2,WRONG_METHOD_NAME:3,BAD_SEQUENCE_ID:4,MISSING_RESULT:5,INTERNAL_ERROR:6,PROTOCOL_ERROR:7,INVALID_TRANSFORM:8,INVALID_PROTOCOL:9,UNSUPPORTED_CLIENT_TYPE:10},Thrift.TApplicationException=function(e,t){this.message=e,this.code="number"==typeof t?t:0},Thrift.inherits(Thrift.TApplicationException,Thrift.TException,"TApplicationException"),Thrift.TApplicationException.prototype.read=function(e){for(;;){var t=e.readFieldBegin();if(t.ftype==Thrift.Type.STOP)break;switch(t.fid){case 1:t.ftype==Thrift.Type.STRING?(t=e.readString(),this.message=t.value):t=e.skip(t.ftype);break;case 2:t.ftype==Thrift.Type.I32?(t=e.readI32(),this.code=t.value):t=e.skip(t.ftype);break;default:t=e.skip(t.ftype)}e.readFieldEnd()}e.readStructEnd()},Thrift.TApplicationException.prototype.write=function(e){e.writeStructBegin("TApplicationException"),this.message&&(e.writeFieldBegin("message",Thrift.Type.STRING,1),e.writeString(this.getMessage()),e.writeFieldEnd()),this.code&&(e.writeFieldBegin("type",Thrift.Type.I32,2),e.writeI32(this.code),e.writeFieldEnd()),e.writeFieldStop(),e.writeStructEnd()},Thrift.TApplicationException.prototype.getCode=function(){return this.code},Thrift.TProtocolExceptionType={UNKNOWN:0,INVALID_DATA:1,NEGATIVE_SIZE:2,SIZE_LIMIT:3,BAD_VERSION:4,NOT_IMPLEMENTED:5,DEPTH_LIMIT:6},Thrift.TProtocolException=function(e,t){Error.call(this),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.type=e,this.message=t},Thrift.inherits(Thrift.TProtocolException,Thrift.TException,"TProtocolException"),Thrift.Transport=Thrift.TXHRTransport=function(e,t){this.url=e,this.wpos=0,this.rpos=0,this.useCORS=t&&t.useCORS,this.customHeaders=t&&t.customHeaders?t.customHeaders:{},this.send_buf="",this.recv_buf=""},Thrift.TXHRTransport.prototype={getXmlHttpRequestObject:function(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw"Your browser doesn't support XHR."},flush:function(e,t){var r=this;if(e&&!t||void 0===this.url||""===this.url)return this.send_buf;var i=this.getXmlHttpRequestObject();if(i.overrideMimeType&&i.overrideMimeType("application/vnd.apache.thrift.json; charset=utf-8"),t&&(i.onreadystatechange=function(){var e=t;return function(){4==this.readyState&&200==this.status&&(r.setRecvBuffer(this.responseText),e())}}(),i.onerror=function(){var e=t;return function(){e()}}()),i.open("POST",this.url,!!e),Object.keys(r.customHeaders).forEach(function(e){i.setRequestHeader(e,r.customHeaders[e])}),i.setRequestHeader&&(i.setRequestHeader("Accept","application/vnd.apache.thrift.json; charset=utf-8"),i.setRequestHeader("Content-Type","application/vnd.apache.thrift.json; charset=utf-8")),i.send(this.send_buf),!e||!t){if(4!=i.readyState)throw"encountered an unknown ajax ready state: "+i.readyState;if(200!=i.status)throw"encountered a unknown request status: "+i.status;this.recv_buf=i.responseText,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0}},jqRequest:function(e,t,r,i){if("undefined"==typeof jQuery||void 0===jQuery.Deferred)throw"Thrift.js requires jQuery 1.5+ to use asynchronous requests";var n=this;return jQuery.ajax({url:this.url,data:t,type:"POST",cache:!1,contentType:"application/vnd.apache.thrift.json; charset=utf-8",dataType:"text thrift",converters:{"text thrift":function(t){return n.setRecvBuffer(t),i.call(e)}},context:e,success:jQuery.makeArray(r).pop()})},setRecvBuffer:function(e){this.recv_buf=e,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return!0},open:function(){},close:function(){},read:function(e){var t=this.wpos-this.rpos;if(0===t)return"";var r=e;t<e&&(r=t);var i=this.read_buf.substr(this.rpos,r);return this.rpos+=r,i},readAll:function(){return this.recv_buf},write:function(e){this.send_buf=e},getSendBuffer:function(){return this.send_buf}},Thrift.TWebSocketTransport=function(e){this.__reset(e)},Thrift.TWebSocketTransport.prototype={__reset:function(e){this.url=e,this.socket=null,this.callbacks=[],this.send_pending=[],this.send_buf="",this.recv_buf="",this.rb_wpos=0,this.rb_rpos=0},flush:function(e,t){var r=this;this.isOpen()?(this.socket.send(this.send_buf),this.callbacks.push(function(){var e=t;return function(t){r.setRecvBuffer(t),e()}}())):this.send_pending.push({buf:this.send_buf,cb:t})},__onOpen:function(){var e=this;this.send_pending.length>0&&(this.send_pending.forEach(function(t){this.socket.send(t.buf),this.callbacks.push(function(){var r=t.cb;return function(t){e.setRecvBuffer(t),r()}}())}),this.send_pending=[])},__onClose:function(e){this.__reset(this.url)},__onMessage:function(e){this.callbacks.length&&this.callbacks.shift()(e.data)},__onError:function(e){console.log("Thrift WebSocket Error: "+e.toString()),this.socket.close()},setRecvBuffer:function(e){this.recv_buf=e,this.recv_buf_sz=this.recv_buf.length,this.wpos=this.recv_buf.length,this.rpos=0},isOpen:function(){return this.socket&&this.socket.readyState==this.socket.OPEN},open:function(){this.socket&&this.socket.readyState!=this.socket.CLOSED||(this.socket=new WebSocket(this.url),this.socket.onopen=this.__onOpen.bind(this),this.socket.onmessage=this.__onMessage.bind(this),this.socket.onerror=this.__onError.bind(this),this.socket.onclose=this.__onClose.bind(this))},close:function(){this.socket.close()},read:function(e){var t=this.wpos-this.rpos;if(0===t)return"";var r=e;t<e&&(r=t);var i=this.read_buf.substr(this.rpos,r);return this.rpos+=r,i},readAll:function(){return this.recv_buf},write:function(e){this.send_buf=e},getSendBuffer:function(){return this.send_buf}},Thrift.TJSONProtocol=Thrift.Protocol=function(e){this.tstack=[],this.tpos=[],this.transport=e},Thrift.Protocol.Type={},Thrift.Protocol.Type[Thrift.Type.BOOL]='"tf"',Thrift.Protocol.Type[Thrift.Type.BYTE]='"i8"',Thrift.Protocol.Type[Thrift.Type.I16]='"i16"',Thrift.Protocol.Type[Thrift.Type.I32]='"i32"',Thrift.Protocol.Type[Thrift.Type.I64]='"i64"',Thrift.Protocol.Type[Thrift.Type.DOUBLE]='"dbl"',Thrift.Protocol.Type[Thrift.Type.STRUCT]='"rec"',Thrift.Protocol.Type[Thrift.Type.STRING]='"str"',Thrift.Protocol.Type[Thrift.Type.MAP]='"map"',Thrift.Protocol.Type[Thrift.Type.LIST]='"lst"',Thrift.Protocol.Type[Thrift.Type.SET]='"set"',Thrift.Protocol.RType={},Thrift.Protocol.RType.tf=Thrift.Type.BOOL,Thrift.Protocol.RType.i8=Thrift.Type.BYTE,Thrift.Protocol.RType.i16=Thrift.Type.I16,Thrift.Protocol.RType.i32=Thrift.Type.I32,Thrift.Protocol.RType.i64=Thrift.Type.I64,Thrift.Protocol.RType.dbl=Thrift.Type.DOUBLE,Thrift.Protocol.RType.rec=Thrift.Type.STRUCT,Thrift.Protocol.RType.str=Thrift.Type.STRING,Thrift.Protocol.RType.map=Thrift.Type.MAP,Thrift.Protocol.RType.lst=Thrift.Type.LIST,Thrift.Protocol.RType.set=Thrift.Type.SET,Thrift.Protocol.Version=1,Thrift.Protocol.prototype={getTransport:function(){return this.transport},writeMessageBegin:function(e,t,r){this.tstack=[],this.tpos=[],this.tstack.push([Thrift.Protocol.Version,'"'+e+'"',t,r])},writeMessageEnd:function(){var e=this.tstack.pop();this.wobj=this.tstack.pop(),this.wobj.push(e),this.wbuf="["+this.wobj.join(",")+"]",this.transport.write(this.wbuf)},writeStructBegin:function(e){this.tpos.push(this.tstack.length),this.tstack.push({})},writeStructEnd:function(){var e=this.tpos.pop(),t=this.tstack[e],r="{",i=!0;for(var n in t)i?i=!1:r+=",",r+=n+":"+t[n];r+="}",this.tstack[e]=r},writeFieldBegin:function(e,t,r){this.tpos.push(this.tstack.length),this.tstack.push({fieldId:'"'+r+'"',fieldType:Thrift.Protocol.Type[t]})},writeFieldEnd:function(){var e=this.tstack.pop(),t=this.tstack.pop();this.tstack[this.tstack.length-1][t.fieldId]="{"+t.fieldType+":"+e+"}",this.tpos.pop()},writeFieldStop:function(){},writeMapBegin:function(e,t,r){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[e],Thrift.Protocol.Type[t],0])},writeMapEnd:function(){var e=this.tpos.pop();if(e!=this.tstack.length){(this.tstack.length-e-1)%2!=0&&this.tstack.push("");var t=(this.tstack.length-e-1)/2;this.tstack[e][this.tstack[e].length-1]=t;for(var r="}",i=!0;this.tstack.length>e+1;){var n=this.tstack.pop(),o=this.tstack.pop();i?i=!1:r=","+r,isNaN(o)||(o='"'+o+'"'),r=o+":"+n+r}r="{"+r,this.tstack[e].push(r),this.tstack[e]="["+this.tstack[e].join(",")+"]"}},writeListBegin:function(e,t){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[e],t])},writeListEnd:function(){for(var e=this.tpos.pop();this.tstack.length>e+1;){var t=this.tstack[e+1];this.tstack.splice(e+1,1),this.tstack[e].push(t)}this.tstack[e]="["+this.tstack[e].join(",")+"]"},writeSetBegin:function(e,t){this.tpos.push(this.tstack.length),this.tstack.push([Thrift.Protocol.Type[e],t])},writeSetEnd:function(){for(var e=this.tpos.pop();this.tstack.length>e+1;){var t=this.tstack[e+1];this.tstack.splice(e+1,1),this.tstack[e].push(t)}this.tstack[e]="["+this.tstack[e].join(",")+"]"},writeBool:function(e){this.tstack.push(e?1:0)},writeByte:function(e){this.tstack.push(e)},writeI16:function(e){this.tstack.push(e)},writeI32:function(e){this.tstack.push(e)},writeI64:function(e){this.tstack.push(e)},writeDouble:function(e){this.tstack.push(e)},writeString:function(e){if(null===e)this.tstack.push(null);else{for(var t="",r=0;r<e.length;r++){var i=e.charAt(r);t+='"'===i?'\\"':"\\"===i?"\\\\":"\b"===i?"\\b":"\f"===i?"\\f":"\n"===i?"\\n":"\r"===i?"\\r":"\t"===i?"\\t":i}this.tstack.push('"'+t+'"')}},writeBinary:function(e){var t="";if("string"==typeof e)t=e;else{if(!(e instanceof Uint8Array))throw new TypeError("writeBinary only accepts String or Uint8Array.");for(var r=e,i=0;i<r.length;++i)t+=String.fromCharCode(r[i])}this.tstack.push('"'+btoa(t)+'"')},readMessageBegin:function(){this.rstack=[],this.rpos=[],"undefined"!=typeof JSON&&"function"==typeof JSON.parse?this.robj=JSON.parse(this.transport.readAll()):"undefined"!=typeof jQuery?this.robj=jQuery.parseJSON(this.transport.readAll()):this.robj=eval(this.transport.readAll());var r={},version=this.robj.shift();if(version!=Thrift.Protocol.Version)throw"Wrong thrift protocol version: "+version;return r.fname=this.robj.shift(),r.mtype=this.robj.shift(),r.rseqid=this.robj.shift(),this.rstack.push(this.robj.shift()),r},readMessageEnd:function(){},readStructBegin:function(e){var t={};return t.fname="",this.rstack[this.rstack.length-1]instanceof Array&&this.rstack.push(this.rstack[this.rstack.length-1].shift()),t},readStructEnd:function(){this.rstack[this.rstack.length-2]instanceof Array&&this.rstack.pop()},readFieldBegin:function(){var e={},t=-1,r=Thrift.Type.STOP;for(var i in this.rstack[this.rstack.length-1])if(null!==i){t=parseInt(i,10),this.rpos.push(this.rstack.length);var n=this.rstack[this.rstack.length-1][t];delete this.rstack[this.rstack.length-1][t],this.rstack.push(n);break}if(-1!=t)for(var o in this.rstack[this.rstack.length-1])null!==Thrift.Protocol.RType[o]&&(r=Thrift.Protocol.RType[o],this.rstack[this.rstack.length-1]=this.rstack[this.rstack.length-1][o]);return e.fname="",e.ftype=r,e.fid=t,e},readFieldEnd:function(){for(var e=this.rpos.pop();this.rstack.length>e;)this.rstack.pop()},readMapBegin:function(){var e=this.rstack.pop(),t=e.shift();t instanceof Array&&(this.rstack.push(e),t=(e=t).shift());var r={};return r.ktype=Thrift.Protocol.RType[t],r.vtype=Thrift.Protocol.RType[e.shift()],r.size=e.shift(),this.rpos.push(this.rstack.length),this.rstack.push(e.shift()),r},readMapEnd:function(){this.readFieldEnd()},readListBegin:function(){var e=this.rstack[this.rstack.length-1],t={};return t.etype=Thrift.Protocol.RType[e.shift()],t.size=e.shift(),this.rpos.push(this.rstack.length),this.rstack.push(e.shift()),t},readListEnd:function(){this.readFieldEnd()},readSetBegin:function(e,t){return this.readListBegin(e,t)},readSetEnd:function(){return this.readListEnd()},readBool:function(){var e=this.readI32();return null!==e&&"1"==e.value?e.value=!0:e.value=!1,e},readByte:function(){return this.readI32()},readI16:function(){return this.readI32()},readI32:function(e){void 0===e&&(e=this.rstack[this.rstack.length-1]);var t={};if(e instanceof Array)0===e.length?t.value=void 0:t.value=e.shift();else if(e instanceof Object){for(var r in e)if(null!==r){this.rstack.push(e[r]),delete e[r],t.value=r;break}}else t.value=e,this.rstack.pop();return t},readI64:function(){return this.readI32()},readDouble:function(){return this.readI32()},readString:function(){return this.readI32()},readBinary:function(){var e=this.readI32();return e.value=atob(e.value),e},skip:function(e){var t,r;switch(e){case Thrift.Type.STOP:return null;case Thrift.Type.BOOL:return this.readBool();case Thrift.Type.BYTE:return this.readByte();case Thrift.Type.I16:return this.readI16();case Thrift.Type.I32:return this.readI32();case Thrift.Type.I64:return this.readI64();case Thrift.Type.DOUBLE:return this.readDouble();case Thrift.Type.STRING:return this.readString();case Thrift.Type.STRUCT:for(this.readStructBegin();;){if((t=this.readFieldBegin()).ftype==Thrift.Type.STOP)break;this.skip(t.ftype),this.readFieldEnd()}return this.readStructEnd(),null;case Thrift.Type.MAP:for(t=this.readMapBegin(),r=0;r<t.size;r++)r>0&&this.rstack.length>this.rpos[this.rpos.length-1]+1&&this.rstack.pop(),this.skip(t.ktype),this.skip(t.vtype);return this.readMapEnd(),null;case Thrift.Type.SET:for(t=this.readSetBegin(),r=0;r<t.size;r++)this.skip(t.etype);return this.readSetEnd(),null;case Thrift.Type.LIST:for(t=this.readListBegin(),r=0;r<t.size;r++)this.skip(t.etype);return this.readListEnd(),null}}},Thrift.MultiplexProtocol=function(e,t,r,i){Thrift.Protocol.call(this,t,r,i),this.serviceName=e},Thrift.inherits(Thrift.MultiplexProtocol,Thrift.Protocol,"multiplexProtocol"),Thrift.MultiplexProtocol.prototype.writeMessageBegin=function(e,t,r){t===Thrift.MessageType.CALL||t===Thrift.MessageType.ONEWAY?Thrift.Protocol.prototype.writeMessageBegin.call(this,this.serviceName+":"+e,t,r):Thrift.Protocol.prototype.writeMessageBegin.call(this,e,t,r)},Thrift.Multiplexer=function(){this.seqid=0},Thrift.Multiplexer.prototype.createClient=function(e,t,r){t.Client&&(t=t.Client);var i=this;return t.prototype.new_seqid=function(){return i.seqid+=1,i.seqid},new t(new Thrift.MultiplexProtocol(e,r))};var copyList,copyMap;copyList=function(e,t){if(!e)return e;var r,i,n,o=r=void 0===t.shift?t:t[0],s=e.length,a=[];for(i=0;i<s;i++)n=e[i],null===r?a.push(n):r===copyMap||r===copyList?a.push(r(n,t.slice(1))):a.push(new o(n));return a},copyMap=function(e,t){if(!e)return e;var r,i,n=r=void 0===t.shift?t:t[0],o={};for(var s in e)e.hasOwnProperty(s)&&(i=e[s],o[s]=null===r?i:r===copyMap||r===copyList?r(i,t.slice(1)):new n(i));return o},Thrift.copyMap=copyMap,Thrift.copyList=copyList,module.exports=Thrift},{}],20:[function(e,t,r){function i(e){return Object.prototype.toString.call(e)}function n(e){return"[object Object]"===i(e)}function o(e){return"[object Function]"===i(e)}function s(e,t){for(var r=0,i=e.length;r<i&&!1!==t.call(e,e[r],r);r++);}function a(e){if(!T.test(e))return null;var t,r,i,n,o;if(-1!==e.indexOf("trident/")&&(t=/\btrident\/([0-9.]+)/.exec(e))&&t.length>=2){i=t[1];var s=t[1].split(".");s[0]=parseInt(s[0],10)+4,o=s.join(".")}n=(t=T.exec(e))[1];var a=t[1].split(".");return void 0===o&&(o=n),a[0]=parseInt(a[0],10)-4,r=a.join("."),void 0===i&&(i=r),{browserVersion:o,browserMode:n,engineVersion:i,engineMode:r,compatible:i!==r}}function c(e){if(f)try{var t=f.twGetRunPath.toLowerCase(),r=f.twGetSecurityID(h),i=f.twGetVersion(r);if(t&&-1===t.indexOf(e))return!1;if(i)return{version:i}}catch(e){}}function u(e,t,r){var s=o(t)?t.call(null,r):t;if(!s)return null;var a={name:e,version:p,codename:""},c=i(s);if(!0===s)return a;if("[object String]"===c){if(-1!==r.indexOf(s))return a}else{if(n(s))return s.hasOwnProperty("version")&&(a.version=s.version),a;if(s.exec){var u=s.exec(r);if(u)return u.length>=2&&u[1]?a.version=u[1].replace(/_/g,"."):a.version=p,a}}}function l(e,t,r,i){var n=x;s(t,function(t){var r=u(t[0],t[1],e);if(r)return n=r,!1}),r.call(i,n.name,n.version)}var d={},p="-1",h=window,f=h.external,g=h.navigator.userAgent||"",m=h.navigator.appVersion||"",b=h.navigator.vendor||"",T=/\b(?:msie |ie |trident\/[0-9].*rv[ :])([0-9.]+)/,v=/\bbb10\b.+?\bversion\/([\d.]+)/,w=/\bblackberry\b.+\bversion\/([\d.]+)/,y=/\bblackberry\d+\/([\d.]+)/,_=[["nokia",function(e){return-1!==e.indexOf("nokia ")?/\bnokia ([0-9]+)?/:/\bnokia([a-z0-9]+)?/}],["samsung",function(e){return-1!==e.indexOf("samsung")?/\bsamsung(?:[ \-](?:sgh|gt|sm))?-([a-z0-9]+)/:/\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/}],["wp",function(e){return-1!==e.indexOf("windows phone ")||-1!==e.indexOf("xblwp")||-1!==e.indexOf("zunewp")||-1!==e.indexOf("windows ce")}],["pc","windows"],["ipad","ipad"],["ipod","ipod"],["iphone",/\biphone\b|\biph(\d)/],["mac","macintosh"],["mi",/\bmi[ \-]?([a-z0-9 ]+(?= build|\)))/],["hongmi",/\bhm[ \-]?([a-z0-9]+)/],["aliyun",/\baliyunos\b(?:[\-](\d+))?/],["meizu",function(e){return e.indexOf("meizu")>=0?/\bmeizu[\/ ]([a-z0-9]+)\b/:/\bm([0-9cx]{1,4})\b/}],["nexus",/\bnexus ([0-9s.]+)/],["huawei",function(e){var t=/\bmediapad (.+?)(?= build\/huaweimediapad\b)/;return-1!==e.indexOf("huawei-huawei")?/\bhuawei\-huawei\-([a-z0-9\-]+)/:t.test(e)?t:/\bhuawei[ _\-]?([a-z0-9]+)/}],["lenovo",function(e){return-1!==e.indexOf("lenovo-lenovo")?/\blenovo\-lenovo[ \-]([a-z0-9]+)/:/\blenovo[ \-]?([a-z0-9]+)/}],["zte",function(e){return/\bzte\-[tu]/.test(e)?/\bzte-[tu][ _\-]?([a-su-z0-9\+]+)/:/\bzte[ _\-]?([a-su-z0-9\+]+)/}],["vivo",/\bvivo(?: ([a-z0-9]+))?/],["htc",function(e){return/\bhtc[a-z0-9 _\-]+(?= build\b)/.test(e)?/\bhtc[ _\-]?([a-z0-9 ]+(?= build))/:/\bhtc[ _\-]?([a-z0-9 ]+)/}],["oppo",/\boppo[_]([a-z0-9]+)/],["konka",/\bkonka[_\-]([a-z0-9]+)/],["sonyericsson",/\bmt([a-z0-9]+)/],["coolpad",/\bcoolpad[_ ]?([a-z0-9]+)/],["lg",/\blg[\-]([a-z0-9]+)/],["android",/\bandroid\b|\badr\b/],["blackberry",function(e){return e.indexOf("blackberry")>=0?/\bblackberry\s?(\d+)/:"bb10"}]],S=[["wp",function(e){return-1!==e.indexOf("windows phone ")?/\bwindows phone (?:os )?([0-9.]+)/:-1!==e.indexOf("xblwp")?/\bxblwp([0-9.]+)/:-1!==e.indexOf("zunewp")?/\bzunewp([0-9.]+)/:"windows phone"}],["windows",/\bwindows nt ([0-9.]+)/],["macosx",/\bmac os x ([0-9._]+)/],["ios",function(e){return/\bcpu(?: iphone)? os /.test(e)?/\bcpu(?: iphone)? os ([0-9._]+)/:-1!==e.indexOf("iph os ")?/\biph os ([0-9_]+)/:/\bios\b/}],["yunos",/\baliyunos ([0-9.]+)/],["android",function(e){return e.indexOf("android")>=0?/\bandroid[ \/-]?([0-9.x]+)?/:e.indexOf("adr")>=0?e.indexOf("mqqbrowser")>=0?/\badr[ ]\(linux; u; ([0-9.]+)?/:/\badr(?:[ ]([0-9.]+))?/:"android"}],["chromeos",/\bcros i686 ([0-9.]+)/],["linux","linux"],["windowsce",/\bwindows ce(?: ([0-9.]+))?/],["symbian",/\bsymbian(?:os)?\/([0-9.]+)/],["blackberry",function(e){var t=e.match(v)||e.match(w)||e.match(y);return t?{version:t[1]}:"blackberry"}]],k=[["edgehtml",/edge\/([0-9.]+)/],["trident",T],["blink",function(){return"chrome"in h&&"CSS"in h&&/\bapplewebkit[\/]?([0-9.+]+)/}],["webkit",/\bapplewebkit[\/]?([0-9.+]+)/],["gecko",function(e){var t;if(t=e.match(/\brv:([\d\w.]+).*\bgecko\/(\d+)/))return{version:t[1]+"."+t[2]}}],["presto",/\bpresto\/([0-9.]+)/],["androidwebkit",/\bandroidwebkit\/([0-9.]+)/],["coolpadwebkit",/\bcoolpadwebkit\/([0-9.]+)/],["u2",/\bu2\/([0-9.]+)/],["u3",/\bu3\/([0-9.]+)/]],I=[["edge",/edge\/([0-9.]+)/],["sogou",function(e){return e.indexOf("sogoumobilebrowser")>=0?/sogoumobilebrowser\/([0-9.]+)/:e.indexOf("sogoumse")>=0||/ se ([0-9.x]+)/}],["theworld",function(){var e=c("theworld");return void 0!==e?e:"theworld"}],["360",function(e){var t=c("360se");return void 0!==t?t:-1!==e.indexOf("360 aphone browser")?/\b360 aphone browser \(([^\)]+)\)/:/\b360(?:se|ee|chrome|browser)\b/}],["maxthon",function(){try{if(f&&(f.mxVersion||f.max_version))return{version:f.mxVersion||f.max_version}}catch(e){}return/\b(?:maxthon|mxbrowser)(?:[ \/]([0-9.]+))?/}],["micromessenger",/\bmicromessenger\/([\d.]+)/],["qq",/\bm?qqbrowser\/([0-9.]+)/],["green","greenbrowser"],["tt",/\btencenttraveler ([0-9.]+)/],["liebao",function(e){if(e.indexOf("liebaofast")>=0)return/\bliebaofast\/([0-9.]+)/;if(-1===e.indexOf("lbbrowser"))return!1;var t;try{f&&f.LiebaoGetVersion&&(t=f.LiebaoGetVersion())}catch(e){}return{version:t||p}}],["tao",/\btaobrowser\/([0-9.]+)/],["coolnovo",/\bcoolnovo\/([0-9.]+)/],["saayaa","saayaa"],["baidu",/\b(?:ba?idubrowser|baiduhd)[ \/]([0-9.x]+)/],["ie",T],["mi",/\bmiuibrowser\/([0-9.]+)/],["opera",function(e){var t=/\bopera.+version\/([0-9.ab]+)/;return t.test(e)?t:/\bopr\/([0-9.]+)/}],["oupeng",/\boupeng\/([0-9.]+)/],["yandex",/yabrowser\/([0-9.]+)/],["ali-ap",function(e){return e.indexOf("aliapp")>0?/\baliapp\(ap\/([0-9.]+)\)/:/\balipayclient\/([0-9.]+)\b/}],["ali-ap-pd",/\baliapp\(ap-pd\/([0-9.]+)\)/],["ali-am",/\baliapp\(am\/([0-9.]+)\)/],["ali-tb",/\baliapp\(tb\/([0-9.]+)\)/],["ali-tb-pd",/\baliapp\(tb-pd\/([0-9.]+)\)/],["ali-tm",/\baliapp\(tm\/([0-9.]+)\)/],["ali-tm-pd",/\baliapp\(tm-pd\/([0-9.]+)\)/],["uc",function(e){return e.indexOf("ucbrowser/")>=0?/\bucbrowser\/([0-9.]+)/:e.indexOf("ubrowser/")>=0?/\bubrowser\/([0-9.]+)/:/\buc\/[0-9]/.test(e)?/\buc\/([0-9.]+)/:e.indexOf("ucweb")>=0?/\bucweb([0-9.]+)?/:/\b(?:ucbrowser|uc)\b/}],["chrome",/ (?:chrome|crios|crmo)\/([0-9.]+)/],["android",function(e){if(-1!==e.indexOf("android"))return/\bversion\/([0-9.]+(?: beta)?)/}],["blackberry",function(e){var t=e.match(v)||e.match(w)||e.match(y);return t?{version:t[1]}:"blackberry"}],["safari",/\bversion\/([0-9.]+(?: beta)?)(?: mobile(?:\/[a-z0-9]+)?)? safari\//],["webview",/\bcpu(?: iphone)? os (?:[0-9._]+).+\bapplewebkit\b/],["firefox",/\bfirefox\/([0-9.ab]+)/],["nokia",/\bnokiabrowser\/([0-9.]+)/]],x={name:"na",version:p};d=function(e){var t={};l(e=(e||"").toLowerCase(),_,function(e,r){var i=parseFloat(r);t.device={name:e,version:i,fullVersion:r},t.device[e]=i},t),l(e,S,function(e,r){var i=parseFloat(r);t.os={name:e,version:i,fullVersion:r},t.os[e]=i},t);var r=a(e);return l(e,k,function(e,i){var n=i;r&&(i=r.engineVersion||r.engineMode,n=r.engineMode);var o=parseFloat(i);t.engine={name:e,version:o,fullVersion:i,mode:parseFloat(n),fullMode:n,compatible:!!r&&r.compatible},t.engine[e]=o},t),l(e,I,function(e,i){var n=i;r&&("ie"===e&&(i=r.browserVersion),n=r.browserMode);var o=parseFloat(i);t.browser={name:e,version:o,fullVersion:i,mode:parseFloat(n),fullMode:n,compatible:!!r&&r.compatible},t.browser[e]=o},t),t}(g+" "+m+" "+b),t.exports=d},{}],21:[function(e,t,r){var i=function(){function e(e){return e&&"function"==typeof e}function t(e,t){var r={UNSENT:0,OPENED:1,HEADERS__RECEIVED:2,LOADING:3,DONE:4,readyState:null,status:0,statusText:"",response:"",responseText:"",responseURL:"",responseXML:null};for(var i in r)if(e[i]=r[i],t)try{e[i]=t[i]}catch(e){}}function r(e,t){e.onabort=null,e.onerror=null,e.onload=null,e.onloadend=null,e.onloadstart=null,e.onprogress=null,e.ontimeout=null,t||(e.onreadystatechange=null),e.__events={abort:[],error:[],load:[],loadend:[],loadstart:[],progress:[],timeout:[],readystatechange:[]},t||(e.__events.onreadystatechange=[])}function i(e){for(var r in e.__events)e.__events[r][0]=function(){t(e,e.__xhr)}}function n(t,r,i,n){var o=r.substring(2);return function(){var n=arguments,s=[],a=function(){for(var i=1;i<t.__events[o].length;i++)e(t.__events[o][i])&&t.__events[o][i].apply(t,s);e(t[r])&&t[r].apply(t,n)};t.__events[o][0].apply(t,s);for(var c=0;c<arguments.length;c++)s.push(arguments[c]);e(i[r])?(s.push(a),i[r].apply(t,s)):a()}}function o(t,r,i,n){for(var o=[],s=0;s<i.length;s++)o.push(i[s]);o.unshift(n),e(t.__config[r])?t.__config[r].apply(t,o):n()}function s(){}function a(e,n){this.__config=n,this.__xhr=e,t(this),this.responseType="",this.timeout=0,this.withCredentials=!1,r(this),i(this),this.__upload=e.upload,this.upload=new s,this.upload.__xhr=this.__xhr,r(this.upload,!0),i(this.upload)}return s.prototype.addEventListener=function(e,t,r){this.__events[e].push(t)},s.prototype.removeEventListener=function(e,t,r){for(var i=this.__events[e],n=0;n<i.length;n++)i[n]!==t&&i.splice(n,1)},s.prototype.dispatchEvent=function(e){this.__xhr.dispatchEvent(e)},a.prototype=new s,a.prototype.open=function(e,r,i,n,s){var a=this;o(a,"beforeOpen",arguments,function(){a.__xhr.open(e,r,i,n,s),t(a,a.__xhr)})},a.prototype.send=function(e){var r=this;o(r,"beforeSend",arguments,function(){r.__xhr.responseType=r.__config.responseType||"",r.__xhr.timeout=r.__config.timeout||r.timeout,r.__xhr.withCredentials=r.__config.withCredentials||r.withCredentials;var i;for(i in r.__xhr)/^on/g.test(i)&&(r.__xhr[i]=n(r,i,r.__config||{}));for(i in r.__upload)/^on/g.test(i)&&(r.__upload[i]=n(r.upload,i,r.__config.upload||{}));r.__xhr.send(e),t(r,r.__xhr)})},a.prototype.abort=function(){var e=this;o(e,"beforeAbord",arguments,function(){e.__xhr.abort(),t(e,e.__xhr)})},a.prototype.setRequestHeader=function(e,t){this.__xhr.setRequestHeader(e,t)},a.prototype.getAllResponseHeaders=function(){this.__xhr.getAllResponseHeaders()},a.prototype.overrideMimeType=function(e){this.__xhr.overrideMimeType(e)},a.prototype.getResponseHeader=function(){this.__xhr.getResponseHeader(name)},function(e){if(window.__XHRAlreadyModified)return!1;var t;window.XMLHttpRequest&&(t=window.XMLHttpRequest,window.XMLHttpRequest=function(r){return new a(new t,e||{})}),window.ActiveXObject&&(t=window.ActiveXObject,window.ActiveXObject=function(r){return"Microsoft.XMLHTTP"===r?new a(new t,e||{}):t(r)}),window.XDomainRequest&&(t=window.XDomainRequest,window.XDomainRequest=function(r){return new a(new t,e||{})}),window.__XHRAlreadyModified=!0}}();t.exports=i},{}],22:[function(e,t,r){var i=e("./xhrWrap");t.exports=i},{"./xhrWrap":24}],23:[function(e,t,r){function i(e,t){e.agentId=n.agentId,e.tierId=n.tierId,e.appId=n.appId,e.traceId=o.UUID(),e.urlDomain=document.domain||window.location.host,e.reportTime=1*new Date,e.loadedTime=t.allTime||-1,e.browser=t.browser,e.urlQuery=t.page_url_path,e.backupProperties={os:t.os,os_version:t.os_version,device:t.device,device_version:t.device_version,browser_engine:t.browser_engine,page_title:t.page_title,page_h1:t.page_h1,page_referrer:t.page_referrer,page_url:t.page_url,page_url_path:t.page_url_path,lib:t.lib,lib_version:t.lib_version,browser_version:t.browser_version,startTime:t.startTime,endTime:t.endTime,status:t.status||0,dataSize:t.dataSize||0},e.backupQuota={screen_height:t.screen_height,screen_width:t.screen_width}}var n=e("../config"),o=e("../common"),s=e("../consts"),a=e("../log"),c=e("../thrift"),u=e("../kepler");t.exports={send:function(e){if(e.ok){a("send XHR data:"),a(e);var t=new c.Transport(""),r=new c.Protocol(t);r.writeMessageBegin("TWebAgentAjax",c.MessageType.CALL,0);var l=new u.TWebAgentAjax(e);i(l,o.extend({},e,o.info.properties())),l.write(r),r.writeMessageEnd();var d=t.flush(),p=JSON.parse(d);d=JSON.stringify(p[p.length-1]),a(d);var h={url:n.apiHost,type:"POST",cors:!0,data:d,success:function(e){a("事件发送返回消息错误")},error:function(e){a(e.status),a(e.statusText)},complete:function(){a("事件发送完毕.")}};h.header={},h.header[s.kepler_message_type]=s.WEB_AJAX,h.header[s.kepler_agent_token]=n.agentId,h.header[s.kepler_config_version]=n.LIB_VERSION,o.ajax(h)}},sendBatch:function(e){a("send XHRS data:"),a(e);var t=new c.Transport(""),r=new c.Protocol(t);r.writeMessageBegin("TWebAgentAjaxBatch",c.MessageType.CALL,0);for(var l=0,d=e.length;l<d;l++){var p=e[l],h=new u.TWebAgentAjax(p);i(h,o.extend({},p,o.info.properties())),e[l]=h}var f={ajaxBatch:e};new u.TWebAgentAjaxBatch(f).write(r),r.writeMessageEnd();var g=t.flush(),m=JSON.parse(g);g=JSON.stringify(m[m.length-1]),a(g);var b={url:n.apiHost,type:"POST",cors:!0,data:g,success:function(e){a("事件发送返回消息错误")},error:function(e){a(e.status),a(e.statusText)},complete:function(){a("事件发送完毕.")}};b.header={},b.header[s.kepler_message_type]=s.WEB_AJAX_BATCH,b.header[s.kepler_agent_token]=n.agentId,b.header[s.kepler_config_version]=n.LIB_VERSION,n.disabled||o.ajax(b)}}},{"../common":1,"../config":2,"../consts":3,"../kepler":10,"../log":12,"../thrift":19}],24:[function(e,t,r){function i(e){if(!e.__apm_xhr__){var t,r=e.tracingId;for(t in h)if(h[t]&&h[t].tracingId&&h[t].tracingId===r)return void(h[t]=c.extend(h[t],e));u("collected a xhr :",e),h.push(e)}}function n(e){if("string"==typeof e&&e.length)return e.length;if("object"==typeof e){if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer&&e.byteLength)return e.byteLength;if("undefined"!=typeof Blob&&e instanceof Blob&&e.size)return e.size;if(!("undefined"!=typeof FormData&&e instanceof FormData))try{return l.stringify(e).length}catch(e){return}}}function o(e,t){var r=c.parseUrl(t);e.host=r.hostname+":"+r.port,e.pathname=r.pathname,e.sameOrigin=r.sameOrigin}function s(){if(h&&h.length>0){for(var e=[],t=h.length;t>0&&e.length<a.maxLimit;){var r=h.shift();r.ok?e.push(r):h.push(r),t--}e.length>0&&p.sendBatch(e)}}var a=e("../config"),c=e("../common"),u=e("../log"),l=e("../json"),d=e("../eventEmitter").create(),p=e("./sender");d.on("xhr-wrap",function(){var e=Array.prototype.splice.call(arguments,0);switch(e[0]){case"collect":i(e[1]);break;case"send":s()}});var h=[];e("./ajaxHacker")({beforeOpen:function(e,t,r,i,n,s){this.performance={__apm_xhr__:this.__apm_xhr__,method:t,async:i,user:n,password:s},o(this.performance,r),d.emit("xhr-wrap",["collect",this.performance]),e()},beforeSend:function(e,t){u("before send:"),u(this);var r=c.UUID(),i=1*new Date,n="object"==typeof t||t instanceof Array?l.stringify(t).length:void 0===t?0:t.length;a.openTracing&&(this.setRequestHeader("type","web-span"),this.setRequestHeader("Kepler-TraceId",r),this.setRequestHeader("Content-Length",n)),this.performance.startTime=i,this.performance.agentId=a.agentId,this.performance.tracingId=r,this.performance.ok=!1,d.emit("xhr-wrap",["collect",this.performance]),e()},beforeAbord:function(e){e()},onabord:function(e,t){this.performance.status="aborded",this.performance.endTime=1*new Date,this.performance.ok=!0,d.emit("xhr-wrap",["collect",this.performance]),t()},onerror:function(e,t){this.performance.status="error",this.performance.endTime=1*new Date,this.performance.ok=!0,d.emit("xhr-wrap",["collect",this.performance]),t()},onload:function(e,t){t()},onloadend:function(e,t){u("xhr-wrapper:onloaded",e),this.performance.type="loadend",this.performance.statusCode=this.status,this.performance.endTime=1*new Date,this.performance.allTime=this.performance.endTime-this.performance.startTime,this.performance.ok=!0,d.emit("xhr-wrap",["collect",this.performance]),t()},onloadstart:function(e,t){t()},onprogress:function(e,t){t()},ontimeout:function(e,t){this.performance.type="timeout",this.performance.statusCode=this.status,this.performance.endTime=1*new Date,this.performance.ok=!0,d.emit("xhr-wrap",["collect",this.performance]),t()},onreadystatechange:function(e){if(this.performance.type="readystatechanged",this.performance.endTime=1*new Date,4===this.readyState){this.performance.status=this.status;var t=this.responseType,r=n("arraybuffer"===t||"blob"===t||"json"===t?this.response:this.responseText)||0;r&&(this.performance.dataSize=r),this.performance.ok=!0}else this.performance.status=0;d.emit("xhr-wrap",["collect",this.performance])},upload:{onprogress:function(e,t){t()}}}),setInterval(function(){d.emit("xhr-wrap",["send"])},a.transFrequency),t.exports=d},{"../common":1,"../config":2,"../eventEmitter":6,"../json":9,"../log":12,"./ajaxHacker":21,"./sender":23}]},{},[7]);
