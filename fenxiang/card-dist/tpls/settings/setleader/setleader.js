/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/settings/setleader/setleader",["tabs","util","../settings-common","dialog","../settings-common.html","../settings-common.css","modules/crm-select-colleague/crm-select-colleague"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=(a("tabs"),a("util")),g=a("../settings-common"),h=f.getContactData(),i=(h.u,a("modules/crm-select-colleague/crm-select-colleague"));b.init=function(){function a(a){a&&a.employeeID?(c=a.employeeID,$(".set-leader-bar",h).show(),l.attr("data-id",a.employeeID).find(".leader-box-inner").show(),l.children("span").hide(),a.profileImage?l.find("img").attr("src",f.getAvatarLink(a.profileImage,"2")):l.find("img").attr("src",f.getAvatarLink()),l.find(".colleague-spell").text(a.name),l.removeClass("set-leader-box-border")):(c=void 0,l.children("span").show(),l.children(".leader-box-inner").hide(),$(".set-leader-bar",h).hide(),l.addClass("set-leader-box-border"))}var c,h=b.tplEl,j=b.tplName,k=f.getCurrentEmp().employeeID,l=$(".set-leader-box",h),m=new i({isMultiSelect:!1,hasWorkLeaveBtn:!1,title:"选择上级"});m.on("selected",function(b){f.confirm("是否确定要将您的上级设置为【"+b.name+"】吗?设置后他（她）将可以看到您及您下属的全部客户数据。"," ",function(){f.api({url:"/Employee/SetEmployeeLeader",type:"post",dataType:"json",errorMsgTitle:"设置我的上级时发生错误。原因：",data:{leaderID:b.employeeID},success:function(d){d.success&&(c=b.employeeID,a(b))}})})}),$(".add-leader",h).on("click",function(){m.show({exceptEmployeeIDs:k+""})}),$(".leader-box-inner",h).on("click",function(){var a=[];a.push(k),c&&a.push(c),m.show({exceptEmployeeIDs:a.join(",")})}),$(".modify-leader",h).on("click",function(){var a=[];a.push(k),c&&a.push(c),m.show({exceptEmployeeIDs:a.join(",")})}),$(".cancel-leader",h).on("click",function(){f.confirm("是否确定不设置上级？在销售团队中，一般是只有最高负责人不需要设置上级"," ",function(){f.api({url:"/Employee/CancelEmployeeLeader",type:"post",dataType:"json",errorMsgTitle:"取消我的上级时发生错误。原因：",data:{},success:function(){c=void 0,$(".set-leader-box",h).addClass("set-leader-box-border").find(".leader-box-inner").hide(),$(".set-leader-box",h).children("span").show(),$(".set-leader-bar",h).hide()}},{submitSelector:""})})}),f.api({url:"/Employee/GetEmployeeLeader",type:"post",dataType:"json",errorMsgTitle:"",data:{},success:function(b){b.success&&a(b.value)}},{submitSelector:""}),d.getAppStore("contactData")&&d.getAppStore("contactData").isAllowSetOwnLeader||setTimeout(function(){f.alert("没有权限，即将自动跳转个人信息页面"),setTimeout(function(){e.navRouter.navigate("#settings/personalsetting",{trigger:!0})},1e3)},200),g.init(h,j)}});