/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/settings/boundexmail/boundexmail",["tabs","util","../settings-common","dialog","../settings-common.html","../settings-common.css"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=(a("tabs"),a("util")),g=a("../settings-common"),h=f.getContactData(),i=h.u;b.init=function(){var a=b.tplEl,c=b.tplName,e=$(".bemn-input",a),h=$(".bemb-code-btn",a),j=$(".bemn-code-input",a),k=$(".bemb-btn",a),l=$(".bemain",a),m=$("#email-bc",a),n=$(".email-wrapper",a),o="@"+i.exmailDomain;$(".exmail-domain",a).text(i.exmailDomain),h.click(function(){if(""==e.val())f.showInputError(e);else{var a="<time id='bebtn-time'>60</time>秒后可重新发送";f.api({type:"post",data:{exmail:e.val()+o},url:"/Account/GetBindingEmployeeExmailCode/",success:function(b){if(b.success){h.attr("disabled","disabled"),h.addClass("bebtn-disabled"),h.html(a),h.next("a").show();var c=$("#bebtn-time"),d=60,f=setInterval(function(){1>d?(clearInterval(f),h.removeAttr("disabled"),h.removeClass("bebtn-disabled"),h.html("获取验证码")):(c.text(d),d--)},1e3);n.html(e.val()+o)}}})}}),k.click(function(){""==j.val()?f.showInputError(j):f.api({type:"post",data:{code:j.val()},url:"/Account/BindingEmployeeExmail/",success:function(a){a.success&&(l.hide(),m.show(),$("#tip-settings-boundexmail").attr("href",d.BASE_PATH+"/H/Account/GetBindingEmployeeExmailLoginUrl").attr("target","_blank"))}})});var p=$("#edit-number",a),q=$("#cannel-bind",a);q.click(function(a){f.api({type:"post",data:{},url:"/Account/CancelBindingEmployeeExmail/",success:function(a){a.success&&(l.show(),m.hide(),e.val(""),j.val(""),$("#tip-settings-boundexmail").attr("href","#settings/boundexmail").removeAttr("target"))}}),a.preventDefault()}),p.click(function(){l.show(),m.hide(),e.val(""),j.val("")}),i.boundEmployeeExmail?(l.hide(),m.show()):(l.show(),m.hide()),g.init(a,c)}});