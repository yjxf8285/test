/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/datamanage/smsstatistics/smsstatistics",["util","uilibs/pagination"],function(a,b){var c=window,d=c.FS;d.tpl;var e=a("util"),f=a("uilibs/pagination");b.init=function(){b.tplName;var a=b.tplEl,c=d.getAppStore("globalData"),g=c.model,h=$(".smsstatistics-nulltip",a),i=$(".smsstatistics-table",a),j=$("thead",i),k=$("tbody",i),l=$(".smsstatistics-pagination",a),m=$(".smsstatistics-top-info",a),n=$(".smsstatistics-tit",a),o=$("select",a),p=$(".smsstatistics-top-selcetyear",a),q=$(".smsstatistics-top-selcetmonth",a),r=(new Date).getFullYear(),s=(new Date).getMonth()+1,t="";10>s&&(s="0"+s);for(var u=2012;r>=u;u++)t+='<option value="'+u+'"> '+u+"年 </option>",p.html(t);p.val(r),q.val(s);var v=r.toString()+s.toString();o.on("change",function(){v=p.val()+q.val(),y(1)});var w=new f({element:l,pageSize:20}).render();w.on("page",function(a){y(a)});var x=function(a){var b="",c=a.records||[];return _.each(c,function(a){var c=a.employeeName,d=a.employeeID;a.yearMonth;var e=a.workAmount,f=a.customerAmount,h=a.netMarketingAmount,i=a.smsMarketingAmount;b+=1==g?'<tr><td class="txt-left"><a href="#datamanage/smsstatisticsdetail/=/id-'+d+"/name-"+c+'">'+c+'</a></td><td class="txt-center">'+e+'</td><td class="txt-center">'+f+"</td></tr>":'<tr><td class="txt-left"><a href="#datamanage/smsstatisticsdetail/=/id-'+d+"/name-"+c+'">'+c+'</a></td><td class="txt-center">'+e+'</td><td class="txt-center">'+f+'</td><td class="txt-center">'+h+'</td><td class="txt-center">'+i+"</td></tr>"}),b},y=function(a){e.api({url:"/Management/GetSMSStatistics",type:"get",dataType:"json",data:{yearMonth:v,employeeID:-1,pageSize:20,pageNumber:a},success:function(a){var b=a.value||{},c=b.records,d=b.totalCount,e=b.workAmount,f=b.customerAmount,l=b.netMarketingAmount,o=b.smsMarketingAmount,p=' <tr><th>员工姓名</th><th width="100" class="txt-center">工作短信(条)</th><th width="100" class="txt-center">客群短信(条)</th><th width="100">营销网信（条）</th><th width="100">营销短信（条）</th></tr>',q="工作短信："+e+"条&nbsp;&nbsp;&nbsp;&nbsp;客群短信："+f+"条";a.success&&(1==g?p=' <tr><th>员工姓名</th><th width="180" class="txt-center">工作短信(条)</th><th width="180" class="txt-center">客群短信(条)</th></tr>':q="工作短信："+e+"条&nbsp;&nbsp;&nbsp;&nbsp;客群短信："+f+"条&nbsp;&nbsp;&nbsp;&nbsp;营销网信："+l+"条&nbsp;&nbsp;&nbsp;&nbsp;营销短信："+o+"条",c.length>0?(j.html(p),k.html(x(b)),h.hide(),i.show()):(i.hide(),h.show()),n.text("短信统计("+d+")"),m.html(q),w.setTotalSize(d))}})};y(1),e.regTplNav($(".tpl-l .flag-left-list a",a),"fl-item-on"),2==g&&$(".tpl-l .flag-left-list li",a).hide()}});