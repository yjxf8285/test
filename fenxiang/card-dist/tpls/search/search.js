/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/search/search",["util","modules/feed-list/feed-list","./search-common","filter","moment","./search-common.html","autocomplete","events"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.store,e.event;var f=a("util"),g=a("modules/feed-list/feed-list"),h=a("./search-common"),i=function(a,b){var c=f.getPersonalConfig("searchHistory")||[],d="";c=_.reject(c,function(b){return b==a}),c.unshift(a),c=c.slice(0,10),_.each(c,function(a){d+='<li><a href="#search/=/key-'+a+'"><i class="srl-icon"></i>'+a+"</a></li>"}),b.html(d),f.setPersonalConfig("searchHistory",c),f.updatePersonalConfig()};b.init=function(){var a,c=b.tplEl,d=b.tplName,e=$(".tpl-l",c),j=$(".tpl-r",c),k=$(".feed-list",c),l=$(".feed-list-pagination",c),m=$(".search-inp-s",c),n=$(".search-r-list",j),o=h.init(c,d);a=new g({element:k,pagSelector:l,pagOpts:{pageSize:20,visiblePageNums:7},loadSize:15,listPath:"/FeedSearch/GetFeedForSearch",defaultRequestData:function(){return{feedType:0,keyword:_.str.trim(m.val()),feedAttachType:0}},listEmptyText:"没有符合条件的搜索结果"}),j.on("click",".clear-search-l",function(){n.empty(),f.setPersonalConfig("searchHistory",[]),f.updatePersonalConfig()}),o.on("search",function(b){var c=_.str.trim(m.val()),d=_.extend({feedType:0,keyword:c,feedAttachType:0},b);d.keyword.length>0&&(a.opts.defaultRequestData=d,a.reload()),i(c,n)}),function(){var a=f.getTplQueryParams(),b=a?a.key:"";m.val(decodeURIComponent(b)).keyup(),$(".tpl-nav-l",e).eq(0).addClass("depw-menu-aon"),$(".all-employee",c).click(),$(".search-include-nav-list",e).hide()}()},e.event.on("switched",function(a,b){var c,d,e;"search"==a&&(c=f.getTplQueryParams(),d=c?c.key:"",e=$(".tpl-r .search-r-list",b),i(d,e))})});