/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/index/index",["moment","util"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=(e.store,a("moment"));e.event,a("util"),b.init=function(){var a=b.tplEl;b.tplName;var c=d.getAppStore("globalData"),e=$(".department-count-tpl",a),g=$(".employee-count-tpl",a),h=$(".empcount-ofnotincircle-wrap",a),i=$(".empcount-ofnotincircle-number",a),j="",k="";j=c.departmentCount>0?'<span class="rlist-icon"></span>至少创建1个部门（已完成）':'<span class="rlist-icon rlist-icon02"></span><a href="#departmentstaff/=/create-circle">点击立即创建</a>',e.html(j),k=c.employeeCount>5?'<span class="rlist-icon"></span>至少新建5位同事（已完成）':'<span class="rlist-icon rlist-icon02"></span><a href="#departmentstaff/=/create-employee">点击立即创建</a>',g.html(k),c.empCountOfNotInCircle>0?(h.show(),i.text(c.empCountOfNotInCircle)):h.hide();var l=function(a,b,c,d){var e,f;0!=b?(e=100*c/b,f=100*(c/b)+"%"):e=0,a.find(".strip-width").css("width",f),60>=e?(a.css("border-color","#6D89BC"),d.css("color","#6D89BC"),a.find(".strip-width").css("background-color","#aebeda")):e>60&&80>=e?(a.css("border-color","#EB9523"),d.css("color","#EB9523"),a.find(".strip-width").css("background-color","#f4c485")):(a.css("border-color","#D04B38"),d.css("color","#D04B38"),a.find(".strip-width").css("background-color","#e59b91"))},m=$(".sms-total-amount",a),n=$(".sms-used-amount",a),o=$(".sms-recharge-url",a),p=$(".sesp-tpl",a),q=c.smsTotalAmount-c.smsUsedAmount;0>q?p.html("已超过"+Math.abs(q)+"条"):p.html("剩余"+q+"条"),m.html(c.smsTotalAmount),n.html(c.smsUsedAmount),o.attr("href",c.smsRechargeUrl);var r=$(".sms-strip-tpl",a);l(r,c.smsTotalAmount,c.smsUsedAmount,p);var s=$(".account-total-amount",a),t=$(".account-used-amount",a),u=$(".assp-tpl",a),v=c.accountTotalAmount-c.accountUsedAmount;0>v?u.html("已超过"+Math.abs(v)+"个"):u.html("剩余"+v+"个"),s.html(c.accountTotalAmount),t.html(c.accountUsedAmount);var w=$(".account-strip-tpl",a);l(w,c.accountTotalAmount,c.accountUsedAmount,u);var x=$(".storage-total-space",a),y=$(".storage-used-space",a),z=$(".ss-recharge-url",a),A=$(".sssp-tpl",a),B=c.storageTotalSpace-c.storageUsedSpace;0>B?A.html("已超过"+c.storageUnusedSpaceDesc):A.html("剩余"+c.storageUnusedSpaceDesc),x.html(c.storageTotalSpaceDesc),y.html(c.storageUsedSpaceDesc),z.attr("href",c.ssRechargeUrl);var C=$(".space-strip-tpl",a);l(C,c.storageTotalSpace,c.storageUsedSpace,A);var D=$(".card-number-tpl",a),E=$(".business-card-used-amount",a),F=$(".scsp-tpl",a),G=$(".card-used-tpl",a),H=c.businessCardTotalAmount-c.businessCardUsedAmount;0>H?F.html("已超过"+Math.abs(H)+"张"):F.html("剩余"+H+"张");var I=c.businessCardTotalAmount,J=c.businessCardUsedAmount;0==c.businessCardUseType?(D.html("未开通服务"),I=0,J=0,G.hide(),F.hide()):2==c.businessCardUseType?(D.html("不限量使用"),I=0,J=0,G.show(),F.hide()):(D.html("购买数量"+c.businessCardTotalAmount+"张"),G.show(),F.show()),E.html(c.businessCardUsedAmount);var K=$(".card-strip-tpl",a);l(K,I,J,F);var L=$(".end-time-tpl",a),M=$(".end-day-tpl",a),N=f.unix(c.endTime).format("YYYY年MM月DD日"),O=new Date,P=O.getTime(),Q=Math.floor(P/864e5),R=Math.floor(c.endTime/86400),S=R-Q;L.html(N),S>=90?M.css("color","#6D89BC"):S>=30&&90>S?M.css("color","#EB9523"):M.css("color","#D04B38"),S>=0?M.html("（剩余"+S+"天）"):M.html("（已超过"+Math.abs(S)+"天）"),2==c.model&&($(".shortcut-links",a).html('<li>1、创建员工帐号（<a href="#employeemgtformarketing/=/create-employee" class="create-employee-l">点击立即创建</a>）</li>'),$(".create-circle-box,.disk-manage-box",a).hide(),$(".create-employee-box",a).attr("href","#employeemgtformarketing/=/create-employee"),$(".itplr-toplist-wrap",a).hide()),"admin"==c.account&&$(".modify-pwd-tip").show(),$(".modify-admin-pwd-l",a).on("click",function(a){$(".hd .change-pwd-l").click(),a.preventDefault()})}});