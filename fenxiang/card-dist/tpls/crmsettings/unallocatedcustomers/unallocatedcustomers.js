/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/crmsettings/unallocatedcustomers/unallocatedcustomers",["util","../settings-common","dialog","modules/crm-high-seas/crm-high-seas","../settings-common.html","../settings-common.css","modules/crm-list-header/crm-list-header","modules/crm-setting-customerlist/crm-setting-customerlist","modules/crm-object-import/crm-object-import","modules/crm-customer-export/crm-customer-export","modules/crm-select-colleague/crm-select-colleague","modules/crm-select-highseas/crm-select-highseas","modules/crm-customerinsetting-edit/crm-customerinsetting-edit","moment"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=a("util"),g=a("../settings-common"),h=a("modules/crm-list-header/crm-list-header"),i=a("modules/crm-setting-customerlist/crm-setting-customerlist"),j=a("modules/crm-object-import/crm-object-import"),k=a("modules/crm-customer-export/crm-customer-export"),l=a("modules/crm-select-colleague/crm-select-colleague"),m=a("modules/crm-select-highseas/crm-select-highseas"),n=a("modules/crm-customerinsetting-edit/crm-customerinsetting-edit"),o=a("moment");b.init=function(){var a,c,d=b.tplEl,e=b.tplName,p={keyword:"",sortType:1,pageNumber:1,pageSize:25},q=null,r=null,s=null,t=null,u=null;g.createCrmSettingLeftNav(d,e);var v=function(){c=new h({element:$(".crm-list-hd",d),title:"未分配客户",searchPlaceholder:"搜索客户"}),c.on("search",function(b){a.refresh({keyword:b})})},w=function(){a=new i({warpEl:$(".list-warp",d),url:"/HighSeas/GetFCustomersUnUsedForManager",hasButtons:!1,overwriteRowClick:!0,aoColumns:[{mData:"customerID",sWidth:"26px",sClass:"td-checkbox-warp",bSortable:!1,mRender:function(a){var b='<div class="mn-checkbox-box checkbox-for-comtable crm-datatable-checkboxinput">&nbsp;&nbsp;<span data-value="'+a+'" class="mn-checkbox-item"></span> </div>';return b}},{mData:"customerID",sWidth:"0px",sClass:"customer-foolo",bSortable:!1,mRender:function(){return""}},{mData:"name",sWidth:"240px",sClass:"black-name crmtable-sort-name",bSortable:!1,mRender:function(a){var b='<span title="'+a+'">'+a+"</span>";return b}},{mData:"customerID",sWidth:"0",sClass:"black-name crmtable-sort-ownername",bSortable:!1,mRender:function(){return""}},{mData:"customerStateTagOption",sWidth:"170px",sClass:"crmtable-sort-customer-status",bSortable:!1,mRender:function(a){var b='<span title="'+a+'">'+a+"</span>";return b}},{mData:"lastUpdateTime",sWidth:"170px",sClass:"crmtable-sort-lastupdatetime",bSortable:!1,asSorting:["desc","asc"],mRender:function(a){var b='<span title="'+o.unix(a).format("YYYY-MM-DD HH:mm")+'">'+o.unix(a).format("YYYY-MM-DD HH:mm")+"</span>";return b}},{mData:"createTime",sClass:"crmtable-sort-createtime",sWidth:"160px",bSortable:!1,mRender:function(a){var b='<span title="'+o.unix(a).format("YYYY-MM-DD HH:mm")+'">'+o.unix(a).format("YYYY-MM-DD HH:mm")+"</span>";return b}},{mData:"createTime",sClass:"th-blank",bSortable:!1,mRender:function(){var a="";return a}}]});var b=$(".crm-setting-multyset",d),c=$(".crm-button-submit",d);a.refresh(p),a.on("rowClick",function(a){s.show({customerID:a})}),a.on("isSelected",function(){b.show(),c.hide()}),a.on("unSelected",function(){b.hide(),c.show()})},x=function(){q||(q=new j({title:"客户导入",downloadApi:"GetFCustomerUnUsedExcelTemplate",importApi:"/HighSeas/ImportFCustomerUnUsed",downloadText:"未分配客户导入模板"}),q.on("uploaded",function(){a.refresh(p)}))},y=function(){r||(r=new k({title:"未分配客户导出",exportApi:"/HighSeas/ExportFCustomersUnUsedExcel"}))},z=function(){t||(t=new l({isMultiSelect:!1,hasWorkLeaveBtn:!0,title:"选择归属人"}),t.on("selected",function(b){var c=a.getSelected(),d=c.length,e=b.employeeID,g=b.name,h="是否将选中的"+d+"个客户的归属人设置为"+g;f.confirm(h,"设置归属人",function(){f.api({url:"/FCustomer/ModifyFCustomerOwners",type:"post",dataType:"json",data:{customerIDs:c.join(","),ownerID:e},success:function(b){if(b.success){for(var c=0,d=0,e=b.value.ChangeOwnerResults,g=0;g<e.length;g++)1==e[g].value1?c+=1:d+=1;a.refresh(p),a.trigger("unSelected"),f.alert("本次调整有"+c+"个成功，"+d+"个失败")}}},{submitSelector:""})})}))},A=function(){u||(u=new m({title:"选择公海",url:"/HighSeas/GetAllHighSeas/",hasCreate:!0}),u.on("selected",function(b){var c=a.getSelected();f.confirm("是否将选中的"+c.length+"个客户移动到"+b.name+"？","",function(){f.api({url:"/HighSeas/MoveHighseasCustomersForManager",type:"post",dataType:"json",data:{targetHighSeasID:b.id,customerIDs:c.join(",")},success:function(b){if(b.success){for(var c=0,d=0,e=b.value.result,g=0;g<e.length;g++)1==e[g].value1?c+=1:d+=1;a.refresh(p),a.trigger("unSelected"),f.alert("本次调整有"+c+"个成功，"+d+"个失败")}}})})}),u.on("created",function(){g.refreshHighSeas()}))},B=function(){s||(s=new n,s.on("success",function(){a.refresh(p)}))},C=function(){$(".customer-import",d).on("click",function(){q.show()}),$(".customer-export",d).on("click",function(){r.show()}),$(".crm-unallocatedcustomers-setting",d).on("click",function(){t.show()}),$(".crm-unallocatedcustomers-mvSea",d).on("click",function(){u.show()})};!function(){v(),x(),y(),z(),B(),A(),w(),C()}()}});