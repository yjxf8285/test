/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/marketings/marketing/marketing",["util","modules/crm-subordinate-select/crm-subordinate-select","modules/crm-list-header/crm-list-header","modules/crm-marketing-list/crm-marketing-list"],function(a,b){var c,d,e,f=window,g=f.FS,h=g.tpl,i=h.event,j=a("util"),k=a("modules/crm-subordinate-select/crm-subordinate-select"),l=a("modules/crm-list-header/crm-list-header"),m=a("modules/crm-marketing-list/crm-marketing-list"),n=j.getCrmData().currentEmp,o=j.getCrmData().currentEmp;b.init=function(){var a=b.tplEl;$(".crm-list-left-nav",a),c=b.tplName;var f=function(b){var c=$(".crm-tpl-l .tpl-inner .crm-list-left-nav .employee-name",a);if(b){var f=new k({element:$(".tpl-marketing-subordinate-wrapper",a),employeeName:b.name,imageSrc:j.getAvatarLink(b.profileImage,"2"),canSelect:b.subEmployees&&b.subEmployees.length>0});f.on("selected",function(f){var g=f.name;b=f,f.employeeID==n.employeeID?(g="我",$(".create-salesclue-btn",a).show(),e.setTitle("我负责或参与的市场活动")):(g=f.name,$(".create-salesclue-btn",a).hide(),e.setTitle(f.name+"负责或参与的市场活动")),c.text(g),d&&d.refresh({employeeID:f.employeeID,states:0,tagOptionIDsJson:"",sortType:6,pageSize:10,pageNumber:1,queryType:1,keyword:""}),d&&d.reSetMnselect(),h.navRouter.navigate("#marketings/marketing"),$(".crm-list-left-nav li a",a).removeClass("state-active").eq(1).addClass("state-active")})}},g=function(){e=new l({element:$(".crm-list-hd",a),title:"我负责或参与的市场活动",searchPlaceholder:"搜索市场活动"}),e.on("search",function(a){d&&d.refresh({keyword:a})})},i=function(){d=new m({data:{employeeID:o.employeeID,queryType:0,keyword:"",states:0,tagOptionIDsJson:"",sortType:6,pageSize:10,pageNumber:1},warpEl:$(".marketings-marketing-warp",a),url:"/MarketingEvent/GetMarketingEventList"}),d.load()};!function(){f(o),g(),i()}()},i.on("switched",function(a,b){var f,g,h;if(a==c){if(f=j.getTplQueryParams2(),f&&f.id)return;switch(g=f?f.queryType:1){case 3:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(0).addClass("state-active"),e&&e.setTitle($(".crm-list-left-nav li a",b).eq(0).text());break;case 1:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(1).addClass("state-active"),e&&e.setTitle($(".crm-list-left-nav li a",b).eq(1).text());break;case 2:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(2).addClass("state-active"),e&&e.setTitle($(".crm-list-left-nav li a",b).eq(2).text())}e.setTitle($(".crm-list-left-nav .state-active").text()+j.addListTitle($(".crm-list-left-nav .state-active").text(),"市场活动",4)),e.clearSearch(),h={states:0,tagOptionIDsJson:"",sortType:6,pageSize:10,pageNumber:1,queryType:parseFloat(g),keyword:""},d&&d.refresh(h),d&&d.reSetMnselect()}})});