/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/salesperformances/salesperformance/salesperformance",["util","modules/crm-chart/mainchart","modules/crm-subordinate-select/crm-subordinate-select","modules/crm-salestarget-setting/crm-salestarget-setting"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=a("util"),g=a("modules/crm-chart/mainchart"),h=a("modules/crm-subordinate-select/crm-subordinate-select"),i=a("modules/crm-salestarget-setting/crm-salestarget-setting");b.init=function(){var a=b.tplEl;b.tplName;var c=$(".crm-chart-header-spanc span",a),d={xiashu:$(".crm-chart-setting-checkbox",a),path:"/SalesStatistic/GetSalesKeyNumbersOfEmployee",monthTarget:c.eq(2),monthWin:c.eq(0),monthRate:c.eq(1),payMent:c.eq(3),remaidDay:c.eq(4),init:function(a){this.perid=a,!!f.mnGetter(this.xiashu),this.addEvent(),this.update(!0)},update:function(a){var b,c=this;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0];var d={employeeID:c.perid,containSubordinate:b},e=Raphael.fn.transNumber;f.api({type:"GET",url:this.path,data:d,success:function(a){var b=a.value;0==b.monthSalesTargetAmount?c.monthRate.text("--"):c.monthRate.text(Math.round(100*(b.monthWinAmount/b.monthSalesTargetAmount))+"%"),c.monthWin.text(e(b.monthWinAmount)),c.monthTarget.text(e(b.monthSalesTargetAmount)),c.payMent.text(e(b.paymentAmount)),c.remaidDay.text(b.remaidDays)}})},addEvent:function(){var a=this;f.mnEvent(this.xiashu,"change",function(){a.update(!1)})},changeId:function(a){this.perid=a,this.update(!0)}},e={year:$("#crm-chart-a-year",a),month:$("#crm-chart-a-time",a),xiashu:$("#crm-chart-a-involve",a),init:function(a){this.perid=a;var b=f.mnGetter(this.year),c=f.mnGetter(this.month),d=!!f.mnGetter(this.xiashu);this.chart=new g.Typea("#crm-chart-a",{salesForecastTimeRange:c,fiscalYear:b,employeeID:a,containSubordinate:d}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-a",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-a-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=f.mnGetter(this.month),e=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({salesForecastTimeRange:d,fiscalYear:c,employeeID:e,containSubordinate:b})},changeId:function(a){this.perid=a,this._infochange(!0)},destory:function(){},update:function(){this._infochange(!0)}},j={year:$("#crm-chart-b-year",a),month:$("#crm-chart-b-time",a),xiashu:$("#crm-chart-b-involve",a),init:function(a){this.perid=a;var b=f.mnGetter(this.year),c=f.mnGetter(this.month),d=!!f.mnGetter(this.xiashu);this.chart=new g.Typeb("#crm-chart-b",{salesForecastTimeRange:c,fiscalYear:b,employeeID:a,containSubordinate:d,monthNo:0}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-b",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-b-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=f.mnGetter(this.month),e=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({salesForecastTimeRange:d,fiscalYear:c,employeeID:e,containSubordinate:b,monthNo:0})},changeId:function(a){this.perid=a,this._infochange(!0)},destory:function(){},update:function(){this._infochange(!0)}},k={year:$("#crm-chart-c-year",a),month:$("#crm-chart-c-time",a),xiashu:$("#crm-chart-c-involve",a),init:function(a){var b=f.mnGetter(this.year),c=f.mnGetter(this.month),d=!!f.mnGetter(this.xiashu);this.perid=a,this.chart=new g.Typec("#crm-chart-c",{salesForecastTimeRange:c,fiscalYear:b,employeeID:a,containSubordinate:d,monthNo:0,dataType:1}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-c",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-c-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=f.mnGetter(this.month),e=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({salesForecastTimeRange:d,fiscalYear:c,employeeID:e,containSubordinate:b,monthNo:0,dataType:1})},changeId:function(a){this.perid=a,this._infochange(!0)},destory:function(){},update:function(){this._infochange(!0)}},l={year:$("#crm-chart-d-year",a),month:$("#crm-chart-d-time",a),xiashu:$("#crm-chart-d-involve",a),init:function(a){var b=f.mnGetter(this.year),c=f.mnGetter(this.month),d=!!f.mnGetter(this.xiashu);this.perid=a,this.chart=new g.Typed("#crm-chart-d",{salesForecastTimeRange:c,fiscalYear:b,employeeID:a,containSubordinate:d,monthNo:0,dataType:2}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-d",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-d-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=f.mnGetter(this.month),e=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({salesForecastTimeRange:d,fiscalYear:c,employeeID:e,containSubordinate:b,monthNo:0,dataType:2})},changeId:function(a){this.perid=a,this._infochange(!0)},update:function(){this._infochange(!0)}},m={year:$("#crm-chart-e-year",a),xiashu:$("#crm-chart-e-involve",a),init:function(a){var b=f.mnGetter(this.year),c=!!f.mnGetter(this.xiashu);this.perid=a,this.chart=new g.Typee("#crm-chart-e",{fiscalYear:b,employeeID:a,containSubordinate:c}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-e",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-e-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({fiscalYear:c,employeeID:d,containSubordinate:b})},changeId:function(a){this.perid=a,this._infochange(!0)},update:function(){this._infochange(!0)}},n={year:$("#crm-chart-f-year",a),xiashu:$("#crm-chart-f-involve",a),init:function(a){var b=f.mnGetter(this.year),c=!!f.mnGetter(this.xiashu);this.perid=a,this.chart=new g.Typef("#crm-chart-f",{fiscalYear:b,employeeID:a,containSubordinate:c}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-f",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-f-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({fiscalYear:c,employeeID:d,containSubordinate:b})},changeId:function(a){this.perid=a,this._infochange(!0)},update:function(){this._infochange(!0)}},o={year:$("#crm-chart-g-year",a),xiashu:$("#crm-chart-g-involve",a),init:function(a){var b=f.mnGetter(this.year),c=!!f.mnGetter(this.xiashu);this.perid=a,this.chart=new g.Typeg("#crm-chart-g",{fiscalYear:b,employeeID:a,containSubordinate:c}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-g",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-g-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({fiscalYear:c,employeeID:d,containSubordinate:b})},changeId:function(a){this.perid=a,this._infochange(!0)},update:function(){this._infochange(!0)}},p={year:$("#crm-chart-h-year",a),xiashu:$("#crm-chart-h-involve",a),init:function(a){var b=f.mnGetter(this.year),c=!!f.mnGetter(this.xiashu);this.perid=a,this.chart=new g.Typeh("#crm-chart-h",{fiscalYear:b,employeeID:a,containSubordinate:c}),this.addEvent()},addEvent:function(){var b=this;$(".crm-chart-h",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!0)})}),$(".crm-chart-h-chekbox",a).each(function(){f.mnEvent(this,"change",function(){b._infochange(!1)})})},_infochange:function(a){var b,c=f.mnGetter(this.year),d=this.perid;b=a?!!f.mnGetter(this.xiashu)[0]:!f.mnGetter(this.xiashu)[0],this.chart.update({fiscalYear:c,employeeID:d,containSubordinate:b})},changeId:function(a){this.perid=a,this._infochange(!0)},update:function(){this._infochange(!0)}};$(".sub-tpl-switch-mask").hide(),$(".crm-chart-list",a).children().addClass("crm-chart-list-loadingcard");var q=f.getCrmData().currentEmp;d.init(q.employeeID),e.init(q.employeeID),j.init(q.employeeID),k.init(q.employeeID),l.init(q.employeeID),m.init(q.employeeID),n.init(q.employeeID),o.init(q.employeeID),p.init(q.employeeID);var r=new h({element:$(".crm-chart-settingperson-wrapper",a),employeeName:q.name,imageSrc:f.getAvatarLink(q.profileImage,"2"),canSelect:q.subEmployees&&q.subEmployees.length>0});r.on("selected",function(b){q=b;var c=f.getCrmData().currentEmp;$(".crm-chart-setting-target",a).html("设置"+(c.employeeID==q.employeeID?"我":q.name)+"的业务目标"),d.changeId(q.employeeID),e.changeId(q.employeeID),j.changeId(q.employeeID),k.changeId(q.employeeID),l.changeId(q.employeeID),m.changeId(q.employeeID),n.changeId(q.employeeID),o.changeId(q.employeeID),p.changeId(q.employeeID)});var s=new i({});$(".crm-chart-setting-target",a).on("click",function(){s.show(q)}),s.on("saved",function(){d.update(),e.update()})}});