/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/contacts/contact/contact",["util","dialog","modules/crm-subordinate-select/crm-subordinate-select","modules/crm-list-header/crm-list-header","modules/crm-contact-list/crm-contact-list"],function(a,b){var c,d,e,f=window,g=f.FS,h=g.tpl,i=h.event,j=a("util"),k=a("dialog"),l=a("modules/crm-subordinate-select/crm-subordinate-select"),m=a("modules/crm-list-header/crm-list-header"),n=a("modules/crm-contact-list/crm-contact-list");b.init=function(){var a=b.tplEl;c=b.tplName;var f=j.getCrmData().currentEmp,g=j.getCrmData().currentEmp,i=$(".crm-tpl-l .tpl-inner",a),o=$(".crm-list-left-nav",a),p=function(b){var c=$(".crm-tpl-l .tpl-inner .crm-list-left-nav .employee-name",a);if(b){var g=!1;g=b.subEmployees&&b.subEmployees.length>0?!0:!1;var i=new l({element:$(".tpl-salesopportunity-subordinate-wrapper",a),employeeName:b.name,imageSrc:j.getAvatarLink(b.profileImage,"2"),canSelect:g});i.on("selected",function(g){var i=g.name;b=g,g.employeeID==f.employeeID?(i="我",$(".will-be-hide",o).show(),$(".top-fn-btns",a).show(),e.setTitle("我的联系人")):(i=g.name,$(".will-be-hide",o).hide(),$(".top-fn-btns",a).hide(),e.setTitle(i+"的联系人")),c.text(i),d&&d.refresh({employeeID:g.employeeID,keyword:"",isFirstChar:!1,source:0,createCustomer:-1,startDate:0,endDate:0,listTagOptionID:"",sortType:12,isContainSubordinate:0,pageSize:10,pageNumber:1}),d&&d.reSetMnselect(),h.navRouter.navigate("#contacts/contact"),$(".crm-list-left-nav li a",a).removeClass("state-active").eq(0).addClass("state-active")})}},q=function(){e=new m({element:$(".crm-list-hd",a),title:"我的联系人",searchPlaceholder:"搜索联系人"}),e.on("search",function(a){d&&d.refresh({keyword:a})})},r=function(){d=new n({data:{employeeID:g.employeeID,keyword:"",isFirstChar:!1,source:0,createCustomer:-1,startDate:0,endDate:0,listTagOptionID:"",sortType:12,isContainSubordinate:0,pageSize:10,pageNumber:1},warpEl:$(".contacts-contact-warp",a),url:"/Contact/GetUserContacts"}),d.load()};!function(){p(g),q(),r()}(),d&&d.refresh();var s=k.extend({attrs:{width:800,height:596,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",content:'<div class="dialog-mobilecardscandialog-warp"> <p>名片扫描——智能而超酷的客户录入体验  <br/><br/>纷享销客与国内最优秀的名片扫描服务提供商“名片全能王”技术合作，将以最优秀的识别性能和最快的识别速度，带给您畅爽体验！ <br/> <br/><span style="color: #C80000;">使用名片扫描功能需要将手机客户端升级到最新版本（苹果手机3.1.0版，安卓手机3.1.0版），并根据提示安装“名片全能王”。如有疑问请致电400 668 9050</span> </p> <img src="../../html/card/assets/images/mobile_card_scan.jpg" alt=""/> </div>',className:"dialog-mobilecardscandialog"}}),t=new s;$(".mobile-card-scan-btn",i).on("click",function(){t.show()})},i.on("switched",function(a,b){var f,g,h,i;if(j.getCrmData().currentEmp,a==c){f=j.getTplQueryParams2(),g=f&&f.queryType?f.queryType:0;var k=$(".crm-list-left-nav .state-active");switch(g){case 0:i=0,"我"==k.find(".employee-name").text()?$(".top-fn-btns",b).show():$(".top-fn-btns",b).hide(),$(".crm-list-left-nav li a",b).removeClass("state-active").eq(0).addClass("state-active");break;case 2:i=1,$(".top-fn-btns",b).hide(),$(".crm-list-left-nav li a",b).removeClass("state-active").eq(1).addClass("state-active")}if($(".top-fn-btns",b).find(".create-sharetome-btn").hide(),e.setTitle($(".crm-list-left-nav .state-active").text()+j.addListTitle($(".crm-list-left-nav .state-active").text(),"联系人",3)),e.clearSearch(),f&&f.id)return;h={queryType:parseFloat(g),createCustomer:-1,sortType:12,isContainSubordinate:i,pageSize:10,pageNumber:1,keyword:""},d&&d.refresh(h),d&&d.reSetMnselect()}})});