/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/contracts/contract/contract",["util","modules/crm-subordinate-select/crm-subordinate-select","modules/crm-list-header/crm-list-header","modules/crm-contract-list/crm-contract-list"],function(a,b){var c,d,e,f=window,g=f.FS,h=g.tpl,i=h.event,j=a("util"),k=a("modules/crm-subordinate-select/crm-subordinate-select"),l=a("modules/crm-list-header/crm-list-header"),m=a("modules/crm-contract-list/crm-contract-list");b.init=function(){var a=b.tplEl;c=b.tplName;var f=j.getCrmData().currentEmp,g=j.getCrmData().currentEmp,i=function(b){var c=$(".crm-tpl-l .tpl-inner .crm-list-left-nav .employee-name",a);if(b){var g=new k({element:$(".tpl-marketing-subordinate-wrapper",a),employeeName:b.name,imageSrc:j.getAvatarLink(b.profileImage,"2"),canSelect:b.subEmployees&&b.subEmployees.length>0});g.on("selected",function(g){var i=g.name;b=g,g.employeeID==f.employeeID?(i="我",$(".create-contract-btn",a).show(),e.setTitle("我负责或参与的合同")):(i=g.name,$(".create-contract-btn",a).hide(),e.setTitle(g.name+"负责或参与的合同")),c.text(i),e.clearSearch(),d&&d.refresh({employeeID:g.employeeID,queryType:2,keyword:"",states:0,tagOptionIDsJson:"",sortType:6,pageSize:10,pageNumber:1,endDayType:0,deadlineBeginTime:-1,deadlineEndTime:-1,isOwner:-1}),d&&d.reSetMnselect(),h.navRouter.navigate("#contracts/contract"),$(".crm-list-left-nav li a",a).removeClass("state-active").eq(1).addClass("state-active")})}},n=function(){e=new l({element:$(".crm-list-hd",a),title:"我负责或参与的合同",searchPlaceholder:"搜索合同"}),e.on("search",function(a){d&&d.refresh({keyword:a})})},o=function(){d=new m({data:{employeeID:g.employeeID,queryType:2,keyword:"",states:0,tagOptionIDsJson:"",sortType:6,pageSize:10,pageNumber:1,endDayType:0,deadlineBeginTime:-1,deadlineEndTime:-1,isOwner:-1},warpEl:$(".contracts-contract-warp",a),url:"/Contract/GetContractList"}),d.load()};!function(){i(g),n(),o()}()},i.on("switched",function(a,b){var f,g,h;if(a==c){if(f=j.getTplQueryParams2(),g=f&&f.queryType?f.queryType:2,f&&f.id)return;switch(g){case 4:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(0).addClass("state-active"),$(".isowner-select-list-warp",b).hide();break;case 2:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(1).addClass("state-active"),$(".isowner-select-list-warp",b).show();break;case 3:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(2).addClass("state-active"),$(".isowner-select-list-warp",b).show()}e.setTitle($(".crm-list-left-nav .state-active").text()+j.addListTitle($(".crm-list-left-nav .state-active").text(),"合同",2)),e.clearSearch(),h={states:0,tagOptionIDsJson:"",sortType:6,pageSize:10,pageNumber:1,isOwner:-1,queryType:parseFloat(g),endDayType:0,deadlineBeginTime:-1,deadlineEndTime:-1,keyword:""},d&&d.refresh(h),d&&d.reSetMnselect()}})});