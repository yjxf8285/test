/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/profile/profile",["util","moment","tabs","dialog","modules/feed-list/feed-list","modules/fs-reply/fs-reply-list","modules/fs-search-select/fs-search-select","modules/fs-attach/fs-attach-list","modules/fs-plan-calendar/fs-plan-calendar"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=a("util"),h=a("moment"),i=a("tabs"),j=a("dialog"),k=a("modules/feed-list/feed-list"),l=a("modules/fs-reply/fs-reply-list").replyList,m=a("modules/fs-search-select/fs-search-select"),n=a("modules/fs-attach/fs-attach-list"),o=a("modules/fs-plan-calendar/fs-plan-calendar"),p=o.FsPlanCalendar,q=o.ExportPlanDialog;$(".pamrk-apv-tpl");var r=j.extend({attrs:{width:"580px",className:"pamrk-apv-dialog",list:null,content:'<div class="ui-dialog-title"></div><div class="ui-dialog-text"><div class="pamrk-list-wrap"><table class="pamrk-list-table" cellspacing="1"><tr><th>员工</th><th>响应时间(分钟)</th><th>排名</th><th>趋势</th></tr><tbody class="pamrk-item-wrap"></tbody></table></div><div class="pamrk-btn-wrap marg20"><button class="f-cancel button-grey f-cancel" data-role="cancel">关闭</button></div></div>'},events:{"click .f-cancel":"_cancel"},renderTable:function(a,b){var c=this.element,e=$(".pamrk-item-wrap",c),f="";$(".ui-dialog-title",c).html(a),b.value.rankings.length>0&&_.each(b.value.rankings,function(a){var b=(a.employeeID,a.employee,a.employee.name),c=g.getAvatarLink(a.employee.profileImage,3),e=a.averageMinutes,h=a.ranking,i=a.trend;a.totalCount;var j="";j=i>0?"<img src="+d.ASSETS_PATH+"/images/arrowup.png />":0>i?"<img src="+d.ASSETS_PATH+"/images/arrowdown.png />":"-",f+='<tr><td style="text-align:left;padding-left:5px;"><img class="pamrk_tdimg_head" src="'+c+'" width="25" height="25" />'+b+"</td><td>"+e+"分钟</td><td>"+h+"</td><td>"+j+"</td></tr>"}),e.html(f)},show:function(){var a=r.superclass.show.apply(this,arguments);return a},hide:function(){var a=r.superclass.hide.apply(this,arguments);return this._clear(),a},_clear:function(){var a=this.element;$(".ui-dialog-title",a).html("");var b=$(".pamrk-item-wrap",a);b.empty()},_cancel:function(){var a=this.element;$(".ui-dialog-title",a).html("");var b=$(".pamrk-item-wrap",a);b.empty(),this.hide()}}),s=new r,t=function(){this.tplEl=b.tplEl,this.tplName=b.tplName,this.init()};_.extend(t.prototype,{init:function(){this.contactDataInit(),this.centerTopInit(),this.leftSideBarInit(),this.rightSideBarInit(),this.profileTabsInit(),this.otherInit()},destroy:function(){this.contactDestroy(),this.centerTopDestroy(),this.leftSideBarDestroy(),this.rightSideBarDestroy(),this.profileTabsDestroy(),this.feedDestroy(),this.replyDestroy(),this.attachDestroy(),this.tjDestroy(),this.otherDestroy()},contactDataInit:function(){this.contactData=g.getContactData()},contactDestroy:function(){this.contactData=null},centerTopInit:function(){var a,b=this.tplEl,c=$(".tpl-c",b),d=$(".edit-user-profile-l",c),e=$(".chat-l",c),f=g.getTplQueryParams(),h=f?f.empid:0,i=this.contactData,j=i.u;0==h||j.id==h?(d.show(),e.hide()):(a=g.getContactDataById(h,"p"),d.hide(),a?0!=h&&e.attr("data-employeeid",h).addClass("js-qx-quick-reply").show():e.hide())},centerTopDestroy:function(){},profileTabsInit:function(){var a=this;this.searchSelects=[],a.searchSelects[0]=new m({associatedIpt:$($(".search-inp",this.tplEl)[0]),trigger:$($(".search-select-btn",this.tplEl)[0]),selectColleague:!1,customClass:"fs-main-feed-list"}),a.searchSelects[1]=new m({associatedIpt:$($(".search-inp",this.tplEl)[1]),trigger:$($(".search-select-btn",this.tplEl)[1]),selectColleague:!1,customClass:"fs-main-feed-list"});var b=this.tplEl,c=$(".profile-tabs",b),d=new i({element:c,triggers:$(".ui-tab-item",c).removeClass("ui-tab-item-current"),panels:$(".ui-tab-panel",c).hide(),activeIndex:0,activeTriggerClass:"ui-tab-item-current",triggerType:"click",withTabEffect:!0}).render();d.on("switched",function(c){var e=d.get("panels").eq(c),f=e.attr("action"),g=$(".tpl-c",b),h=$(".tpl-r",b);e.data("rendered")||(a[f+"Init"]&&a[f+"Init"](),e.data("rendered",!0)),"attach"==f||"tj"==f?(g.css({width:"914px"}),h.hide()):(g.css({width:"578px"}),h.show(),a.planCalendar.refreshPlanDate())}),d.trigger("switched",0,-1),this.profileTabs=d},profileTabsDestroy:function(){this.profileTabs.get("panels").removeData(),this.profileTabs.destroy(),this.profileTabs=null},feedDestroy:function(){var a=this.tplEl,b=$(".profile-tabs",a),c=$(".feed-panel",b),d=$(".filter",c),e=$(".search-btn",c);this.feedList&&(this.feedList.destroy(),this.feedList=null),d.off(),e.unbind(),$(".sub-type .filter-field",d).hide().removeClass("state-active").eq(0).addClass("state-active"),$(".feed-type .filter-value",d).removeClass("state-active").eq(0).addClass("state-active"),$(".attach .filter-value",d).removeClass("state-active").eq(0).addClass("state-active")},feedInit:function(){var a=this,b=this.tplEl,c=(this.tplName,$(".profile-tabs",b)),d=$(".feed-panel",c),e=$(".filter",d),f=$(".feed-type",d),h=$(".sub-type",d),i=$(".attach",d),j=$(".search-inp",d),l=$(".search-btn",d),m=$(".feed-list",d),n=$(".feed-list-pagination",d),o=this.contactData,p=o.u,q=new k({element:m,pagSelector:n,pagOpts:{pageSize:20,visiblePageNums:7},loadSize:15,listPath:"/feed/getFeedsOfOneEmployeeSend",defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:p.id,c=$(".state-active",f).attr("val"),d=$(".filter-field",h).filter(":visible").find(".state-active").attr("val")||0,e=$(".state-active",i).attr("val");return{employeeID:b,feedAttachType:e,subType:d,feedType:c,keyword:_.str.trim(j.val())}},searchSelect:a.searchSelects[0],searchOpts:{inputSelector:j,btnSelector:l},listEmptyText:"没有获取到信息",listSuccessCb:function(b){var c,d;b.success&&(c=b.value,d=c.fullEmployee,a.renderEmployeeInfo(d))}});q.load(),e.on("click",".feed-type .filter-value",function(a){var b=$(this),c=b.attr("subtypename"),d=$("."+c+"-type",h);$(".filter-field",h).hide(),d.length>0&&d.show(),a.preventDefault()}).on("click",".filter-value",function(a){var b=$(this),c=b.closest(".filter-value-wrapper");$(".filter-value",c).removeClass("state-active"),b.addClass("state-active"),q.reload(),a.preventDefault()}),l.click(function(a){q.reload(),a.preventDefault()}),this.feedList=q},atfeedInit:function(){var a=this.tplEl,b=(this.tplName,$(".profile-tabs",a)),c=$(".atfeed-panel",b),d=$(".filter",c),e=$(".feed-type",c),f=$(".sub-type",c),h=$(".attach",c),i=$(".search-inp",c),j=$(".search-btn",c),l=$(".feed-list",c),m=$(".feed-list-pagination",c),n=this.contactData,o=n.u,p=new k({element:l,pagSelector:m,pagOpts:{pageSize:20,visiblePageNums:7},loadSize:15,listPath:"/feed/GetFeedsOfAtMe",defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:o.id,c=$(".state-active",e).attr("val"),d=$(".filter-field",f).filter(":visible").find(".state-active").attr("val")||0,j=$(".state-active",h).attr("val");return{employeeID:b,feedAttachType:j,subType:d,feedType:c,keyword:_.str.trim(i.val())}},searchOpts:{inputSelector:i,btnSelector:j},listEmptyText:"没有获取到信息",listSuccessCb:function(a){var b;a.success&&(b=a.value)}});p.load(),d.on("click",".atfeed .filter-value",function(a){var b=$(this),c=b.attr("subtypename"),d=$("."+c+"-type",f);$(".filter-field",f).hide(),d.length>0&&d.show(),a.preventDefault()}).on("click",".filter-value",function(a){var b=$(this),c=b.closest(".filter-value-wrapper");$(".filter-value",c).removeClass("state-active"),b.addClass("state-active"),p.reload(),a.preventDefault()}),j.click(function(a){p.reload(),a.preventDefault()}),this.feedList=p},atreplyInit:function(){var a=this.tplEl,b=$(".profile-tabs",a),c=$(".atreply-panel",b),d=$(".filter",c),e=$(".feed-type",c),f=$(".attach",c),h=$(".search-inp",c),i=$(".search-btn",c),j=$(".reply-list",c),k=$(".reply-list-pagination",c),m=this.contactData,n=m.u,o=new l({element:j,pagSelector:k,pagOpts:{pageSize:45,totalSize:0,visiblePageNums:7},hideReplyBtn:!1,listPath:"/feed/GetFeedReplysOfAtMe",defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:n.id,c=$(".state-active",e).attr("val"),d=$(".state-active",f).attr("val");return{employeeID:b,feedAttachType:d,feedType:c,keyword:_.str.trim(h.val())}},searchOpts:{inputSelector:h,btnSelector:i},replyCb:function(a){a.success&&o.reload()}});o.load(),d.on("click",".filter-value",function(a){var b=$(this),c=b.closest(".filter-value-wrapper");$(".filter-value",c).removeClass("state-active"),b.addClass("state-active"),o.reload(),a.preventDefault()}),i.click(function(a){o.reload(),a.preventDefault()}),this.replyList=o},replyInit:function(){var a=this,b=this.tplEl,c=$(".profile-tabs",b),d=$(".reply-panel",c),e=$(".filter",d),f=$(".feed-type",d),h=$(".attach",d),i=$(".search-inp",d),j=$(".search-btn",d),k=$(".reply-list",d),m=$(".reply-list-pagination",d),n=this.contactData,o=n.u,p=new l({element:k,pagSelector:m,pagOpts:{pageSize:45,totalSize:0,visiblePageNums:7},hideReplyBtn:!1,listPath:"/feed/getFeedReplysOfOneEmployee",defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:o.id,c=$(".state-active",f).attr("val"),d=$(".state-active",h).attr("val");return{employeeID:b,feedAttachType:d,feedType:c,keyword:_.str.trim(i.val())}},searchSelect:a.searchSelects[1],searchOpts:{inputSelector:i,btnSelector:j},replyCb:function(a){a.success&&p.reload()}});p.load(),e.on("click",".filter-value",function(a){var b=$(this),c=b.closest(".filter-value-wrapper");$(".filter-value",c).removeClass("state-active"),b.addClass("state-active"),p.reload(),a.preventDefault()}),j.click(function(a){p.reload(),a.preventDefault()}),this.replyList=p},replyDestroy:function(){var a=this.tplEl,b=$(".profile-tabs",a),c=$(".reply-panel",b),d=$(".filter",c),e=$(".search-btn",c);this.replyList&&(this.replyList.destroy(),this.replyList=null),d.off(),e.unbind(),$(".feed-type .filter-value",d).removeClass("state-active").eq(0).addClass("state-active"),$(".attach .filter-value",d).removeClass("state-active").eq(0).addClass("state-active")},attachInit:function(){var a=this.tplEl,b=$(".profile-tabs",a),c=$(".attach-panel",b),d=$(".filter",c),e=$(".attach",c),f=($(".search-inp",c),$(".search-btn",c)),h=$(".attach-list-wrapper",c),i=$(".attach-list",c),j=$(".attach-list-pagination",c),k=$(".img-list-wrapper",c),l=$(".img-list",c),m=$(".img-list-pagination",c),o=$(".audio-list-wrapper",c),p=$(".audio-list",c),q=$(".audio-list-pagination",c),r=this.contactData,s=r.u,t=function(){var a=$(".state-active",e).attr("val");"2"==a?(h.hide(),o.hide(),k.show(),v.reload()):"3"==a?(k.hide(),o.hide(),h.show(),u.reload()):"1"==a&&(k.hide(),h.hide(),o.show(),w.reload())},u=new n({element:i,pagSelector:j,pagOpts:{pageSize:15,visiblePageNums:7},attachType:"attach",listPath:"/attach/getAttachFilesOfOneEmployeeSend",loadSize:15,defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:s.id,c=$(".state-active",e).attr("val"),d=$(".search-inp",h);return{employeeID:b,attachType:c,keyword:_.str.trim(d.val())}},searchOpts:{inputSelector:$(".search-inp",h),btnSelector:$(".search-btn",h)},showSenderName:!1}),v=new n({element:l,pagSelector:m,pagOpts:{pageSize:24,visiblePageNums:7},attachType:"img",listPath:"/attach/getAttachFilesOfOneEmployeeSend",loadSize:15,defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:s.id,c=$(".state-active",e).attr("val"),d=$(".search-inp",k);return{employeeID:b,attachType:c,keyword:_.str.trim(d.val())}},searchOpts:{inputSelector:$(".search-inp",k),btnSelector:$(".search-btn",k)},showSenderName:!1}),w=new n({element:p,pagSelector:q,pagOpts:{pageSize:15,visiblePageNums:7},attachType:"audio",listPath:"/attach/getAttachFilesOfOneEmployeeSend",loadSize:15,defaultRequestData:function(){var a=g.getTplQueryParams(),b=a?a.empid:s.id,c=$(".state-active",e).attr("val"),d=$(".search-inp",o);return{employeeID:b,attachType:c,keyword:_.str.trim(d.val())}},searchOpts:{inputSelector:$(".search-inp",o),btnSelector:$(".search-btn",o)},showSenderName:!1});v.load(),f.click(function(a){t(),a.preventDefault()}),d.on("click",".filter-value",function(a){var b=$(this),c=b.closest(".filter-value-wrapper");b.attr("val"),$(".filter-value",c).removeClass("state-active"),b.addClass("state-active"),t(),a.preventDefault()}),this.attachList=u,this.imgList=v,this.audioList=w},attachDestroy:function(){var a=this.tplEl,b=$(".profile-tabs",a),c=$(".attach-panel",b),d=$(".filter",c),e=$(".search-btn",c);this.attachList&&(this.attachList.destroy(),this.attachList=null),this.imgList&&(this.imgList.destroy(),this.imgList=null),this.audioList&&(this.audioList.destroy(),this.audioList=null),e.unbind(),d.off(),$(".attach .filter-value",d).removeClass("state-active").eq(0).addClass("state-active")},renderEmployeeInfo:function(a){var b=this.tplEl,c=$(".userinfo-panel",b),d=$(".cen-user-info-wrap",c),e=$(".cen-user-info-tpl",c),f=_.template(e.html()),g=a.gender,h=a.department,i=a.post,j=a.qq,k=a.msn,l=a.email,m=a.tel,n=a.mobile,o=a.description;g="M"==g?"男":"女";var p=f({gender:g,department:h,post:i,qq:j,msn:k,email:l,tel:m,mobile:n,description:o});d.html(p),$(".tpl-c .employee-mobile",b).html(n),""!=i&&""!=h?$(".tpl-c .circle-job",b).html(i+"-"+h):$(".tpl-c .circle-job",b).html(i+h);var q=$(".tpl-c .profile-name-note",b).text();$(".tpl-c .profile-name-note",b).attr("title",q)},userinfoInit:function(){},userinfoDestroy:function(){},tjInit:function(){for(var a=this.tplEl,b=$(".tj-panel",a),c=$(".year-select",b),d=this.contactData,e=d.u,f=g.getTplQueryParams(),i=f?f.empid:e.id,j=$(".tjp-person-wrap",a),k=$(".tjp-person-list-tpl",a),l=_.template(k.html()),m=$(".tjp-manage-wrap",a),n=$(".tjp-manage-list-tpl",a),o=_.template(n.html()),p=h(new Date).year(),q="",r=p-2,t=p;t>r;r++)q+='<option value="'+r+'">'+r+"年</option>";q+='<option value="'+p+'" selected="selected">'+p+"年</option>",q+='<option value="'+(p+1)+'">'+(p+1)+"年</option>",c.html(q),c.change(function(){g.api({url:"/statistic/getMonthStatisticInfoByEmployeeID",data:{employeeID:i,year:c.val()},type:"get",success:function(c){var d;if(c.success){var e,f="",g="";if(d=c.value,e=d.items,e.length>0?b.find(".list-empty-tip").hide():b.find(".list-empty-tip").show(),e.reverse(),e.length>0){var h=0,i=0,k=0,n=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0;_.each(e,function(a){var b=a.month+"月",c=a.shareTotalCount,d=a.planTotalCount,e=a.planCommentCount,j=a.planTotalNumber,m=a.workTotalNumber,A=a.workCompleteTotalCount,B=a.workTimeoverCompleteTotalCount,C=a.planAverageMinutes,D=a.workAverageMinutes,E=a.approveAverageMinutes,F=a.approveTotalCount,G=a.workCommentCount,H=a.approveAverageMinuteRanking,I=a.planAverageMinuteRanking,J=a.workAverageMinuteRanking,K=0,L=0;K=0!=d?parseInt(j)/parseInt(d):0,L=0!=A?parseInt(m)/parseInt(A):0;var M;.5>K?M="star0":1>K?M="star0.5":1.5>K?M="star1":2>K?M="star1.5":2.5>K?M="star2":3>K?M="star2.5":3.5>K?M="star3":4>K?M="star3.5":4.5>K?M="star4":5>K?M="star4.5":5.5>K&&(M="star5");var N;.5>L?N="star0":1>L?N="star0.5":1.5>L?N="star1":2>L?N="star1.5":2.5>L?N="star2":3>L?N="star2.5":3.5>L?N="star3":4>L?N="star3.5":4.5>L?N="star4":5>L?N="star4.5":5.5>L&&(N="star5"),0==c&&(c="-"),0==d&&(d="-"),0==A&&(A="-"),0==B&&(B="-"),f+=l({month:b,shareTotalCount:c,planTotalCount:d,planStarImgName:M,workStarImgName:N,workCompleteTotalCount:A,workTimeoverCompleteTotalCount:B}),"-"==c&&(c=0),"-"==d&&(d=0),"-"==A&&(A=0),"-"==B&&(B=0),h+=parseInt(c),i+=parseInt(d),k+=parseInt(j),n+=parseInt(K),r+=L,p+=parseInt(m),q+=parseInt(G),s+=parseInt(A),t+=parseInt(B),0!=F?E/=F:E=0,0!=e?C/=e:C=0,0!=G?D/=G:D=0,C=0==C?"-":parseInt(C)+"分钟",D=0==D?"-":parseInt(D)+"分钟",E=0==E?"-":parseInt(E)+"分钟",g+=o({month:b,planAverageMinutes:C,workAverageMinutes:D,approveAverageMinutes:E,planAverageMinuteRanking:I,workAverageMinuteRanking:J,approveAverageMinuteRanking:H}),u+=parseInt(C),v+=parseInt(D),w+=parseInt(E),x+=parseInt(I),y+=parseInt(J),z+=parseInt(H)}),j.empty(),m.empty(),j.append(f),m.append(g),0==h&&(h="-"),0==i&&(i="-"),$("#shareTcount").html(h),$("#planTcount").html(i),"-"==h&&(h=0),"-"==i&&(i=0);var A,B=(u/e.length,x/e.length),C=(v/e.length,y/e.length),D=(w/e.length,z/e.length);A=0!=i?k/i:0;var E;.5>A?E="star0":1>A?E="star0.5":1.5>A?E="star1":2>A?E="star1.5":2.5>A?E="star2":3>A?E="star2.5":3.5>A?E="star3":4>A?E="star3.5":4.5>A?E="star4":5>A?E="star4.5":5.5>A&&(E="star5"),$("#plansrathtml").html('<img src="../../html/fs/assets/images/rating/'+E+'.png" />');var F;F=0!=q?p/q:0;var G;.5>F?G="star0":1>F?G="star0.5":1.5>F?G="star1":2>F?G="star1.5":2.5>F?G="star2":3>F?G="star2.5":3.5>F?G="star3":4>F?G="star3.5":4.5>F?G="star4":5>F?G="star4.5":5.5>F&&(G="star5"),0==s&&(s="-"),0==t&&(t="-"),$("#worksrathtml").html('<img src="../../html/fs/assets/images/rating/'+G+'.png" />'),$("#workCompleteTCount").html(s),$("#workTimeoverCompleteTCount").html(t),$("#planAmTCount").html("-"),$("#workAmTCount").html("-"),$("#approveAmTCount").html("-"),$("#planAMRkTCount").html(parseInt(B)),$("#workAMRkTCount").html(parseInt(C)),$("#approveAMRkTCount").html(parseInt(D))}else $("#worksrathtml").empty(),$("#workCompleteTCount").empty(),$("#workTimeoverCompleteTCount").empty(),$("#planAmTCount").empty(),$("#workAmTCount").empty(),$("#approveAmTCount").empty("-"),$("#planAMRkTCount").empty(),$("#workAMRkTCount").empty(),$("#approveAMRkTCount").empty(),j.empty(),m.empty(),$(".person-eff .total-summary tr span",a).empty()}}})}).change();var u=$(".person-eff",a);u.on("click",".pamrk-adialog",function(){var b=$(this),c=b.attr("type"),d=$(".year-select",a).val(),e=parseInt(b.attr("month")),f="";f=1==c?"日志":2==c?"指令":"审批";var h=d+"年"+e+"月"+f+"点评响应时间排名";g.api({type:"get",data:{rankingType:c,year:d,month:e},url:"/Statistic/GetYearMonthStatisticByRanking",success:function(a){s.show(),s.renderTable(h,a,c)}})})},tjDestroy:function(){var a=this.tplEl,b=$(".tj-panel",a),c=$(".year-select",b);c.unbind("change")},leftSideBarInit:function(){var a=this,b=this.tplEl,c=$(".tpl-l",b);$(".head-img-wrap",b),$(".nodisturb",c),$(".sms-alert",c);var d=this.contactData,e=d.u,f=g.getTplQueryParams(),h=f?f.empid:e.id,i=$(".puser-left-info-wrap",b),j=$(".puser-left-info-tpl",b),k=_.template(j.html());g.api({type:"get",data:{employeeID:h},url:"/statistic/getStatisticInfoByEmployeeID",success:function(d){var e,f,h,j,l="";if(d.success){e=d.value,f=e.smsNotDisturb,h=e.feedPlanRemaidObject,j=e.employee,$(".myuser-head-img",b).html('<img class="fn-left" src="'+g.getAvatarLink(j.profileImage,1)+'" />');var m=e.statistic,n=m.shareTotalCount,o=m.planTotalNumber,p=m.planTotalCount,q=m.planCommentCount,r=m.planAverageMinutes,s=m.workCompleteTotalCount,t=m.workTimeoverCompleteTotalCount,u=m.workTotalNumber,v=m.workCommentCount,w=m.workAverageMinutes,x=m.approveTotalCount,y=m.approveAverageMinutes;0!=x?y/=x:y=0,0!=q?r/=q:r=0,0!=v?w/=v:w=0;var z,A,B;z=0!=s?100*parseFloat(s-t)/s:0,A=0!=p?1*o/p:0,B=0!=s?1*u/s:0;var C;.5>A?C="star0":1>A?C="star0.5":1.5>A?C="star1":2>A?C="star1.5":2.5>A?C="star2":3>A?C="star2.5":3.5>A?C="star3":4>A?C="star3.5":4.5>A?C="star4":5>A?C="star4.5":5.5>A&&(C="star5");var D;.5>B?D="star0":1>B?D="star0.5":1.5>B?D="star1":2>B?D="star1.5":2.5>B?D="star2":3>B?D="star2.5":3.5>B?D="star3":4>B?D="star3.5":4.5>B?D="star4":5>B?D="star4.5":5.5>B&&(D="star5"),r=0==r?"-":parseInt(r)+"分钟",w=0==w?"-":parseInt(w)+"分钟",y=0==y?"-":parseInt(y)+"分钟",l=k({shareTotalCount:n,planStarImgName:C,planAverageMinutes:r,workCompletePrencet:z.toFixed(2),workStarImgName:D,workAverageMinutes:w,approveAverageMinutes:y}),i.html(l),$(".show-tj-detail-l",c).click(function(b){a.profileTabs.switchTo(6),b.preventDefault()}),f.length>0?(f=f.split(","),$(".c-nodisturb",b).html('免打扰 <strong class="color-blue">'+f[0]+":00~"+f[1]+":00</strong>")):$(".c-nodisturb",b).html("未设置免打扰"),h&&h.weekShow?$(".c-sms-alert",b).html('日志提醒 <strong class="color-blue">'+h.weekShow+'</strong>&nbsp;&nbsp;<strong class="color-blue">'+h.monthShow+"</strong>"):$(".c-sms-alert",b).html("还没有设置消息提醒"),$(".tpl-c .working-state",b).html(e.employee.workingState),$(".tpl-c .employee-namel",b).html(e.employee.name)}}}),g.autoAdjustPos($(".tpl-inner",c))},leftSideBarDestroy:function(){},rightSideBarInit:function(){var a=this.tplEl,b=$(".plan-calendar",a),c=$(".r-map-count",a),d=$(".r-map-sign-wrap",a),e=$(".export-plan-l",a),f=this.contactData,h=f.u,i=new p({element:b,listDefaultRequest:function(){var a=g.getTplQueryParams(),b=a?a.empid:h.id;return{employeeID:b}},refreshDefaultRequest:function(){var a=g.getTplQueryParams(),b=a?a.empid:h.id;return{employeeID:b}},refreshCb:function(a){var b,e=g.getTplQueryParams(),f=e?e.empid:h.id;a.success&&(b=a.value,c.text(b.totalLocationCount),b.totalLocationCount>0?d.addClass("map-flag").html('<a href="#profile/profilelocations/=/id-'+f+'" title="">&nbsp;</a>'):d.removeClass("map-flag").text("没有签到信息 "))}});i.render(),i.refreshPlanDate(),this.planCalendar=i;var j=g.getTplQueryParams(),k=j?j.empid:h.id;this.exportPlan=new q({trigger:e,employeeId:k}),g.autoAdjustPos($(".tpl-r .tpl-inner",a))},rightSideBarDestroy:function(){this.planCalendar&&this.planCalendar.destroy(),this.exportPlan&&this.exportPlan.destroy()},otherInit:function(){},otherDestroy:function(){}}),b.init=function(){var a,c=b.tplEl,d=b.tplName;a=new t;var e=function(){a.destroy()};f.one("beforeremove",function(a){a==d&&e()});var h=$(".ui-switchable-nav .if-me-hide",c),i=g.getContactData(),j=i.u.employeeID,k=g.getTplQueryParams2();k&&j!=k?h.show():h.hide()}});