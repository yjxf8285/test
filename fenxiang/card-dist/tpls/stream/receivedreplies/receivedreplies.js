/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/stream/receivedreplies/receivedreplies",["tabs","util","modules/fs-reply/fs-reply-list","../stream-common","assets/zclip/1.1.1/zclip","dialog","../stream-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=(a("tabs"),a("util")),h=a("modules/fs-reply/fs-reply-list"),i=a("../stream-common"),j=h.replyList;b.init=function(){var a=b.tplEl,c=b.tplName;try{var e=window.store.get("receivedreplies");e=e||"",e=e+"刷新回复页:"+ +new Date+"-",e.length>500&&(e=e.substring(e.length-500)),window.store.set("receivedreplies",e)}catch(h){}var k,l=$(".reply-tabs",a),m=$(".filter",a),n=$(".search-inp",a),o=$(".search-btn",a);i.init(a,c);var p=function(){try{var b=window.store.get("receivedreplies");b=b||"",b=b+"loadfirsttab-"+ +new Date+"-",b.length>500&&(b=b.substring(b.length-500)),window.store.set("receivedreplies",b)}catch(c){}$($(".ui-tab-item",a)[0]).removeClass("ui-tab-item-current").click()},q=function(a){a.success&&this.addNewReply(a.value)},r=function(a){var b=$(".depw-menu-aon",m).attr("replytype");a.opts.listPath="/feed/getFeedReplysOfI"+_.str.capitalize(b),a.opts.replyCb="send"==b?function(){a.reload()}:d.EMPTY_FN},s=null;l.on("click",".ui-tab-item",function(){var b=$(this),c=$(".ui-tab-panel",l),d=$(".fs-receivedreplies-list",c);if(!b.hasClass("ui-tab-item-current")){$(".ui-tab-item",a).removeClass("ui-tab-item-current"),b.addClass("ui-tab-item-current");var e=b.data("replyList"),f=b.attr("feedtype"),g=$(".pagination-"+f,c);if($(".reply-list-pagination",c).hide(),g.show(),e){r(e);try{var h=window.store.get("receivedreplies");h=h||"",h=h+"reload-feedtype-"+feedtype+"-"+ +new Date+"-",h.length>500&&(h=h.substring(h.length-500)),window.store.set("receivedreplies",h)}catch(i){}e.reload()}else{e=new j({element:d,pagSelector:g,pagOpts:{pageSize:45,visiblePageNums:7},listPath:"/feed/getFeedReplysOfIReceive",defaultRequestData:function(){return{feedType:f,keyword:_.str.trim(n.val())}},searchOpts:{inputSelector:n,btnSelector:o},replyCb:q}),r(e);try{var h=window.store.get("receivedreplies");h=h||"",h=h+"loadfeedtype-"+f+"-"+ +new Date+"-",h.length>500&&(h=h.substring(h.length-500)),window.store.set("receivedreplies",h)}catch(i){}e.load(),b.data("replyList",e)}s=e}}),f.on("switched",function(a){var b,c,d=$(".filter-field",m);if(d.removeClass("depw-menu-aon"),"stream-receivedreplies"==a){try{var e=window.store.get("receivedreplies");e=e||"",e=e+"切换到回复:"+ +new Date+"-",e.length>500&&(e=e.substring(e.length-500)),window.store.set("receivedreplies",e)}catch(f){}b=g.getTplQueryParams(),c=b?b.type:"receive","receive"==c?d.eq(0).addClass("depw-menu-aon"):"send"==c?d.eq(1).addClass("depw-menu-aon"):d.eq(2).addClass("depw-menu-aon"),p(k)}}),o.click(function(a){s.reload(),a.preventDefault()}),m.on("click",".filter-field",function(a){var b=$(this);$(".filter-field",m).removeClass("depw-menu-aon"),b.addClass("depw-menu-aon"),r(s),s.reload(),a.preventDefault()})}});