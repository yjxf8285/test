/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/stream/myreceipt/myreceipt",["tabs","util","modules/feed-list/feed-list","../stream-common","assets/zclip/1.1.1/zclip","dialog","../stream-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=(a("tabs"),a("util")),h=a("modules/feed-list/feed-list"),i=a("../stream-common");b.init=function(){var a=b.tplEl,c=b.tplName,d=$(".receipt-list",a),e=$(".receipt-list-pagination",a),j=($(".search-wrap",a),$(".search-inp",a)),k=$(".search-btn",a),l=$(".filter-wrapper",a),m=$(".sub-filter",l),n=!1,o=g.getEnterpriseConfig(107,!0)||{},p=g.getContactData(),q=p.u;_.isUndefined(o.IsShowReceiptionGuide)&&(o.IsShowReceiptionGuide=!0),i.init(a,c);var r=new h({element:d,pagSelector:e,pagOpts:{pageSize:20,visiblePageNums:7},listPath:"/Feed/GetReceiptFeedsOfIReceive",loadSize:15,defaultRequestData:function(){var a,b={},c=$(".filter .depw-menu-aon",l).attr("receipttype");return b.keyword=_.str.trim(j.val()),b.receiptType=c,"received"==c&&(a=$(".sub-filter .depw-tabs-aon",l).attr("receiptstatus"),b.receiptType=a),b},listXhrBeforeSend:function(){n=!1,$(".fs-guide-receipt-bracket").remove()},itemReadyCb:function(){var a=this.$el,b=$(".aj-receipt-fn",a);!q.isDemoAccount&&o.IsShowReceiptionGuide&&b.length>0&&!n&&(n=!0,g.showGuideTip(b,{leftTopIncrement:-10,rightTopIncrement:-10,imageName:"receiption-item.png",imagePosition:{top:"-94px",left:"20px"},renderCb:function(a,b,c,d){var e=$('<div class="fs-guide-shadow-link"></div>'),f=$('<div class="fs-guide-shadow-link"></div>'),h=function(){o.IsShowReceiptionGuide=!1,g.setEnterpriseConfig(107,o,!0),g.updateEnterpriseConfig(107),b.remove(),c.remove()};b.addClass("fs-guide-receipt-bracket"),c.addClass("fs-guide-receipt-bracket"),e.css({width:"26px",height:"26px",position:"absolute",top:"9px",left:"240px",cursor:"pointer"}).appendTo(a),f.css({width:"130px",height:"32px",position:"absolute",top:"124px",left:"100px",cursor:"pointer"}).appendTo(a),e.click(function(){h()}),f.click(function(){h()}),d.one("click",function(){h()})}}))},reloadAfterReply:!1,searchOpts:{inputSelector:j,btnSelector:k}});k.click(function(a){r.reload(),a.preventDefault()}),l.on("click",".filter-field",function(a){var b=$(this),c=b.attr("receipttype");$(".filter-field",l).removeClass("depw-menu-aon"),b.addClass("depw-menu-aon"),"received"==c?(r.opts.listPath="/Feed/GetReceiptFeedsOfIReceive",m.show()):(r.opts.listPath="/Feed/GetReceiptFeedsOfISend",m.hide()),r.reload(),a.preventDefault()}).on("click",".receipt-status",function(a){var b=$(this);$(".receipt-status",l).removeClass("depw-tabs-aon"),b.addClass("depw-tabs-aon"),r.reload(),a.preventDefault()});var s=!0;f.on("switched",function(a){a==c?(s?(r.load(),s=!1):($(".filter-field",l).removeClass("depw-menu-aon").eq(0).addClass("depw-menu-aon"),$(".receipt-status",l).removeClass("depw-tabs-aon").eq(0).addClass("depw-tabs-aon"),$(".sub-filter",l).show(),r.opts.listPath="/Feed/GetReceiptFeedsOfIReceive",r.reload()),$(".fs-guide-group-bracket,.fs-guide-avatar-bracket").css("visibility","hidden")):$(".fs-guide-group-bracket,.fs-guide-avatar-bracket").css("visibility","visible")})}});