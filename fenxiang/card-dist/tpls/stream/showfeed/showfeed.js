/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/stream/showfeed/showfeed",["util","widget","../stream-common","assets/zclip/1.1.1/zclip","dialog","../stream-common.html","modules/feed-list/feed-list-v","modules/feed-list/feed-list-m","modules/feed-list/feed-list-c"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=a("util"),h=a("widget"),i=(a("../stream-common"),a("modules/feed-list/feed-list-v")),j=a("modules/feed-list/feed-list-m"),k=a("modules/feed-list/feed-list-c"),l=i.itemV,m=j.itemM,n=k.listC,o=new n;b.init=function(){var a,d=b.tplEl,i=b.tplName,j=$(".feed",d),k=$(".tpl-l .tpl-inner",d),n=(g.getContactData(),$(".show-feed-tpl-left",d)),p=n.html(),q=function(a){var b={},c=_.template(p);_.extend(b,{userId:a.employeeID,userName:a.name,profileImage:g.getAvatarLink(a.profileImage,2)}),k.html(c(b))},r=function(){var b=g.getTplQueryParams(),c=b?b.id:0,d=b?b.pn:1,f=!1,h=!1,i=b?b.open:"reply";i||(i="reply"),b&&b.isprint&&(f=!0),b&&b.showvotedetail&&(h=!0),0!=c&&g.api({url:"/Feed/GetFeedByFeedID",data:{feedID:c},type:"get",success:function(b){var c;if(b.success){c=o.parse(b),q(c[0].originData.sender),a=new l({model:new m(c[0]),replyListOpts:{listPath:"/Feed/GetFeedReplysByFeedID",withPagination:!0,activePageNumber:d},withShowBoteFeed:h,withAvatar:!1,replyWithMedia:!0,noticeStyle:1,likeStyle:2,scheduleStyle:1,detailStyle:f?2:1,reloadAfterReply:!1,deleteCb:function(a){var b=this.model,c=b.get("feedType");a.success&&4!=c&&e.navRouter.navigate("stream",{trigger:!0})}}).render(),a.$el.appendTo(j),"reply"==i?($(".aj-Reply",a.$el).click(),$(".aj-approbtn",a.$el).click()):"like"==i&&a.islikelistbtn(),f&&t();var k=$(".aj-commenton",a.$el);k.is(":visible")&&(k.click(),a.showCommentDialog(!0));var n=$(".aj-approval",a.$el);n.is(":visible")&&n.click()}else g.alert(b.message,function(){e.navRouter.navigate("#stream",{trigger:!0})})}},{errorAlertModel:"1"})},s=function(){a.destroy(),j.empty()},t=function(){var a=h.query(".fs-demo-tip-dialog");a&&a.hide(),$(".tpl-l,.tpl-r",d).remove(),$(".hd,.ft").remove(),$("html").addClass("fs-print-html"),$("body").addClass("fs-print-body"),$(".right-apv-wrapper,.right-qq-apv").remove(),$(".fs-qx,.fs-chat-panel").addClass("fn-hide-abs").hide(),$(".browser-upgrade-tip").remove(),c.printModelCb&&c.printModelCb()};f.on("switched",function(b){b==i?(a?(s(),r()):r(),$("#tip-home").addClass("tnavon state-active")):k.html("&nbsp;")})}});