/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/opportunities/salesopportunity/salesopportunity",["util","modules/crm-subordinate-select/crm-subordinate-select","modules/crm-list-header/crm-list-header","modules/crm-opportunity-list/crm-opportunity-list"],function(a,b){var c,d,e,f=window,g=f.FS,h=g.tpl,i=h.event,j=a("util"),k=a("modules/crm-subordinate-select/crm-subordinate-select"),l=a("modules/crm-list-header/crm-list-header"),m=a("modules/crm-opportunity-list/crm-opportunity-list"),n=!0,o=j.getCrmData().currentEmp,p=o.employeeID;b.init=function(){var a=b.tplEl;c=b.tplName;var f=j.getCrmData().currentEmp,g=$(".crm-list-left-nav",a),i=function(){$(".crm-tpl-l .tpl-inner",a)},q=function(b){var c=$(".crm-tpl-l .tpl-inner .crm-list-left-nav .employee-name",a);if(b){var i=new k({element:$(".tpl-salesopportunity-subordinate-wrapper",a),employeeName:b.name,imageSrc:j.getAvatarLink(b.profileImage,"2"),canSelect:b.subEmployees&&b.subEmployees.length>0});i.on("selected",function(i){var k=i.name,l=j.getTplQueryParams2();l?l.queryType:1,b=i,i.employeeID==f.employeeID?(k="我",$(".managenav",g).show(),n=!0,e.setTitle("我负责或参与的机会"),$(".create-opportunity-btn",a).show(),p=f.employeeID):(n=!1,$(".crm-list-left-nav li a",a).removeClass("state-active").eq(1).addClass("state-active"),$(".managenav",g).hide(),e.setTitle(i.name+"负责或参与的机会"),$(".create-opportunity-btn",a).hide(),$(".update-opportunity-states-un-btn",a).show(),$(".update-opportunity-isreview-yes-btn",a).hide(),$(".update-opportunity-isreview-no-btn",a).hide(),$(".update-opportunity-states-on-btn",a).hide(),$(".update-opportunity-sowner-btn",a).show(),e.clearSearch(),p=i.employeeID),d&&d.refresh({employeeID:p,keyword:"",customerID:0,tagOptionIDsJson:"",sortType:1,beginSalesAmount:-1,endSalesAmount:-1,dealDayType:0,beginDealTime:-1,endDealTime:-1,beginStageDays:-1,endStageDays:-1,salesStageNos:"",isReview:-1,pageSize:10,pageNumber:1,isOwner:-1,queryType:1}),c.text(k),d&&d.reSetMnselect(),h.navRouter.navigate("#opportunities/salesopportunity"),$(".crm-list-left-nav li a",a).removeClass("state-active").eq(1).addClass("state-active")})}},r=function(){e=new l({element:$(".crm-list-hd",a),title:"我负责或参与的机会",searchPlaceholder:"搜索销售机会"}),e.on("search",function(a){d&&d.refresh({keyword:a})})};g.on("click","li a",function(){});var s=function(){d=new m({data:{employeeID:p,queryType:2,keyword:"",customerID:0,tagOptionIDsJson:"",sortType:1,beginSalesAmount:-1,endSalesAmount:-1,dealDayType:0,beginDealTime:-1,endDealTime:-1,beginStageDays:-1,endStageDays:-1,salesStageNos:"",isReview:-1,pageSize:10,pageNumber:1,isOwner:-1},warpEl:$(".opportunities-salesopportunity-warp",a),url:"/SalesOpportunity/GetSalesOpportunityList"}),d.load()};!function(){i(),q(o),r(),s()}()},i.on("switched",function(a,b){var f,g,h;if(a==c){if(f=j.getTplQueryParams2(),g=f?f.queryType:1,f&&f.id)return;switch(g){case 3:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(0).addClass("state-active");break;case 1:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(1).addClass("state-active");break;case 2:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(2).addClass("state-active");break;case 4:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(3).addClass("state-active");break;case 5:$(".crm-list-left-nav li a",b).removeClass("state-active").eq(4).addClass("state-active")}e.setTitle($(".crm-list-left-nav .state-active").text()+j.addListTitle($(".crm-list-left-nav .state-active").text(),"机会",2)),e.clearSearch(),4==g?($(".isreview-list-warp",b).show(),$(".isowner-list-warp",b).hide(),$(".update-opportunity-isreview-yes-btn",b).show(),$(".update-opportunity-isreview-no-btn",b).show(),$(".update-opportunity-states-on-btn",b).hide(),$(".create-opportunity-btn",b).hide(),$(".update-opportunity-sowner-btn",b).show(),$(".update-opportunity-states-un-btn",b).hide()):5==g?($(".update-opportunity-states-on-btn",b).show(),$(".update-opportunity-isreview-yes-btn",b).hide(),$(".update-opportunity-isreview-no-btn",b).hide(),$(".update-opportunity-states-un-btn",b).hide(),$(".create-opportunity-btn",b).hide(),$(".update-opportunity-sowner-btn",b).hide(),$(".isreview-list-warp",b).hide(),$(".isowner-list-warp",b).hide()):3==g?($(".isowner-list-warp",b).hide(),$(".update-opportunity-states-on-btn",b).hide(),$(".update-opportunity-isreview-yes-btn",b).hide(),$(".update-opportunity-isreview-no-btn",b).hide()):($(".update-opportunity-states-un-btn",b).show(),n?$(".create-opportunity-btn",b).show():$(".create-opportunity-btn",b).hide(),$(".update-opportunity-sowner-btn",b).show(),$(".update-opportunity-isreview-yes-btn",b).hide(),$(".update-opportunity-isreview-no-btn",b).hide(),$(".update-opportunity-states-on-btn",b).hide(),$(".isreview-list-warp",b).hide(),$(".isowner-list-warp",b).show()),h={queryType:parseFloat(g),keyword:"",customerID:0,tagOptionIDsJson:"",sortType:1,beginSalesAmount:-1,endSalesAmount:-1,dealDayType:0,beginDealTime:-1,endDealTime:-1,beginStageDays:-1,endStageDays:-1,salesStageNos:"",isReview:-1,pageSize:10,pageNumber:1,isOwner:-1},d&&d.refresh(h),d&&d.reSetMnselect()}})});