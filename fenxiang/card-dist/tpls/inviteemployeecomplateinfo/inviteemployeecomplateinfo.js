/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/inviteemployeecomplateinfo/inviteemployeecomplateinfo",["tabs","util"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=(a("tabs"),a("util"));b.init=function(){var a=b.tplEl;b.tplName;var c=d.getAppStore("contactData"),e=$(".settings-input",a),g=$(".resetpassword-form",a),h=$(".settings-input",g);g.on("click",".settings-input",function(a){var b=$(this);h.each(function(){var a=$(this);a.removeClass("settings-input-on"),a.next().hide()}),b.removeClass("settings-input-onerror"),b.nextAll(".settings-input-error").hide(),b.addClass("settings-input-on"),b.next().show(),b.next(".settings-input-prompt").show(),a.stopPropagation()}),f.regGlobalClick(h,function(){h.each(function(){var a=$(this);a.removeClass("settings-input-on"),a.next().hide()})});var i=$("#user-account",a),j=$("#new-pwd",a),k=$("#confirm-new-pwd",a),l=$("#user-fullname",a),m=$(".nick-name",a);i.val(c.account),i.blur(function(){var a=$(this),b=a.nextAll(".settings-input-error").html();""==_.str.trim(a.val())?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show(),b="请输入帐号"):_.str.trim(a.val()).length<2||_.str.trim(a.val()).length>50?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show(),b="2-50个字符，英文或数字开头的英文、数字和下划线组合"):(a.removeClass("settings-input-onerror"),a.nextAll(".settings-input-error").hide()),a.nextAll(".settings-input-error").html(b)}),j.blur(function(){var a=$(this),b=a.nextAll(".settings-input-error").html();b="",""==_.str.trim(a.val())?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show(),b="请输入新密码"):_.str.trim(a.val()).length<6||_.str.trim(a.val()).length>20?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show(),b="此项应为6-20半角字符（字母、数字、符号）组成"):(a.removeClass("settings-input-onerror"),a.nextAll(".settings-input-error").hide()),a.nextAll(".settings-input-error").html(b)}),k.blur(function(){var a=$(this),b=a.nextAll(".settings-input-error").html();b="",""==_.str.trim(a.val())?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show(),b="请输入确认密码"):_.str.trim(a.val())!==_.str.trim(j.val())?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show(),b="两次输入的密码不一致，请重新输入"):(a.removeClass("settings-input-onerror"),a.nextAll(".settings-input-error").hide()),a.nextAll(".settings-input-error").html(b)}),l.blur(function(){var a=$(this);""==_.str.trim(a.val())?(e.next(".settings-input-prompt").hide(),a.addClass("settings-input-onerror"),a.nextAll(".settings-input-error").show()):(a.removeClass("settings-input-onerror"),a.nextAll(".settings-input-error").hide())});var n=function(){var a={},b=_.str.trim(m.val());return a.password=_.str.trim(j.val()),a.account=_.str.trim(i.val()),a.fullName=_.str.trim(l.val()),a.name=b?b:a.fullName,a.department=_.str.trim($("#user-department").val()),a.post=_.str.trim($("#user-post").val()),a.gender=$('[name="s-sex"]',g).filter(":checked").val(),a},o=$(".pwd-save-btn",a);o.click(function(b){var c=!0;$(".settings-input",a).blur(),$(".settings-input",a).each(function(){return $(this).hasClass("settings-input-onerror")?(c=!1,!1):void 0}),c&&f.api({type:"post",data:n(),url:"/account/UpdateInviteCurrentUser",success:function(b){var c;if(b.success){var d=$(".save-success-apv",a);c=b.value,-1==c.value1?(m.closest("dl").show(),m.addClass("settings-input-onerror"),f.alert(b.message)):d.animate({top:"0px"},300,function(){setTimeout(function(){d.animate({top:"54px"},300),location.reload()},2e3)})}}}),b.preventDefault()})}});