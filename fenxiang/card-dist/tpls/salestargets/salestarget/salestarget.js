/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("tpls/salestargets/salestarget/salestarget",["util","modules/crm-subordinate-select/crm-subordinate-select","modules/crm-salestarget-table/crm-salestarget-table","modules/crm-salestarget-setting/crm-salestarget-setting"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=a("util"),g=a("modules/crm-subordinate-select/crm-subordinate-select"),h=a("modules/crm-salestarget-table/crm-salestarget-table"),i=a("modules/crm-salestarget-setting/crm-salestarget-setting");b.init=function(){var a=b.tplEl,c=(b.tplName,null),d=null,e=null,j=function(b){if(b){var d=new g({element:$(".crm-salestarget-subordinate-wrapper",a),employeeName:b.name,imageSrc:f.getAvatarLink(b.profileImage,"2"),canSelect:b&&b.subEmployees&&b.subEmployees.length>0});d.on("selected",function(b){c=b,e.refresh({employeeID:c.employeeID});var d=f.getCrmData().currentEmp;$(".crm-salestarget-button-set",a).html("设置"+(d.employeeID==c.employeeID?"我":c.name)+"的业务目标")})}},k=function(){e=new h({element:$(".crm-salestarget-table-wrapper",a),condition:{fiscalYear:0,salesForecastTimeRange:0,employeeID:c.employeeID,containSubordinate:!0,isFirst:!0}})},l=function(){d=new i({}),d.on("saved",function(){e.refresh()})},m=function(){f.mnEvent($(".crm-salestarget-checkbox",a),"change",function(a){var b=!1;a.length<1&&(b=!0),e.refresh({containSubordinate:b})}),$(".crm-salestarget-button-set",a).on("click",function(){d.show(c)}),$(".crm-salestarget-button-export",a).on("click",function(){e.showExport()})};!function(){c=f.getCrmData().currentEmp,j(c),k(),l(),m()}()}});