/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/feed-list/feed-list-c",["util","modules/feed-list/fl-util","moment","modules/feed-list/feed-list-m","./feed-list-helper"],function(a,b){function c(a,b){var c={};c=_.extend(c,r.common(a,b));var d=parseInt(a.feedType);switch(d){case 151:c=_.extend(c,r.myremind(a,c));break;case 1:c=_.extend(c,r.share(a,c));break;case 5:c=_.extend(c,r.crm(a,c));break;case 2:c=_.extend(c,r.plan(a,c));break;case 3:c=_.extend(c,r.work(a,c));break;case 4:c=_.extend(c,r.approve(a,c));break;case 2003:c=_.extend(c,r.worknotice(a,c));break;default:c=_.extend(c,r.share(a,c))}return c.originData=a,c.feedType=d,c}var d=window,e=d.FS,f=e.tpl;f.store,f.event;var g=a("util"),h=a("modules/feed-list/fl-util"),i=a("moment"),j=a("modules/feed-list/feed-list-m"),k=a("./feed-list-helper"),l=k.feedContentFormat,m=k.picturesFormat,n=k.filesFormat,o=g.getContactData(),p=o.u,q=k.feedContentFormat_,r={common:function(a,b){var c={};c.meProfileImage=p.profileImage,c.rootPath=e.API_PATH,c.isWhat=a.isWhat||"",c.feedContent=a.feedContent,c.fiveStar=a.fiveStar||"",c.leaderinfo=a.leaderinfo||"",c.replyContent=a.replyContent||"",c.feedID=a.feedID||"",c.employeeID=a.sender.employeeID||"",c.textcur=a.textcur||"",c.textbtn=a.textbtn||"",c.feedPic=a.feedPic||"",c.feedFiles=a.feedFiles||"",c.pictures=a.pictures||"",c.sourceDescription=a.sourceDescription||"",c.archive=a.archive||"",c.serviceTime=a.serviceTime||"",c.announcement=a.announcement||null,c.voteItem=a.voteItem||null,c.schedule=a.schedule||null,c.isHide="",c.morePendingW="",c.onencrypted="",c.isencryptedTit="";var d=a.isEncrypted;d&&(c.onencrypted="onencrypted",c.isencryptedTit=a.encryptTitle,c.isHide="hide");var f='<div class="fl-fn-btn feed-remind-btn"><i class="S_txt3">|</i> <div class="remind-more-menu" style="display: none;"> <a href="javascript:;" class="feed-remind-btn-item" data-value="1">1小时后提醒我</a> <a href="javascript:;" class="feed-remind-btn-item" data-value="3">3小时后提醒我</a> <a href="javascript:;" class="feed-remind-btn-item" data-value="5">5小时后提醒我</a> <a href="javascript:;" class="feed-remind-btn-item" data-value="998">自定义提醒</a> </div> <a href="javascript:;">提醒 <i class="arrow"></i></a> </div>';c.feedRemind=f;var h,j=a.like.likeCount,o=a.isAlreadyLike,r="",s="取消赞",t="islike cur",u='(<span class="likecountnum">'+j+"</span>)",v=a.like.likeEmployees,w="",x="",y="",z="";v&&(_.each(v,function(a){var b=a.name,c=g.getAvatarLink(a.profileImage,"2"),d=a.employeeID;x+='<a href="#profile/=/empid-'+d+'" class="js-empids" title="'+b+'"><img alt="'+b+'" src="'+c+'"></a>'}),v.length>5?(y='<a href="#stream/showfeed/=/id-'+c.feedID+'/open-like" title="更多" class="islike-more"></a>',h=200):(y='<a href="#stream/showfeed/=/id-'+c.feedID+'/open-like" title="更多" class="islike-more hide"></a>',h=40*v.length)),o||(s="赞",t="islike",u="",w=""),w='<div class="islike-tip" style="display:none;width: '+h+'px"><div class="toparrow"> <em>◆</em> <span>◆</span> </div>'+x+y+"</div>",j>0?(u='(<span class="likecountnum">'+j+"</span>)",z=""):(w="",z="hide"),r='<div class="fl-fn-btn '+t+'"><i class="S_txt3">|</i><span class="islike-btn aj-feed-fn-com-btn" title="'+s+'"><b></b><a href="javascript:void(0);" class="likecount '+z+'">'+u+"</a></span>"+w+"</div>",c.islike=r;var A=0,B='<div class="fl-fn-btn '+t+'"><span class="islike-btn aj-feed-fn-com-btn islikelist-btn" title="'+s+'"><b></b><a href="javascript:void(0);" class="likecount '+z+'">'+u+'</a><i class="S_txt3">|</i></span></div>';A&&(c.islike=B),c.listprofileImage=g.getAvatarLink(a.sender.profileImage,"2");var C='<div class="img-new"></div>';c.newico=a.isUnRead?C:"";var D=a.followTime,E="";D?(D=i.unix(D).format("YYYY年MMMDD日 HH:mm"),E='<div class="followtimeinfo">关注于：'+D+"</div>",c.oftimetext=E):c.oftimetext="";var F=g.getFeedTypeName(a.feedType);2==a.feedType&&(F=g.getPlanTypeName(a.plan.planType)),c.feedTypeDescription=F,c.feedRangeDescription=a.feedRangeDescription?'<span>-</span> <span class="group"> <a href="javascript:void(0);" title="'+g.cutBadStr(a.feedRangeTip)+'"> '+a.feedRangeDescription+"</a> </span>":'<span>-</span> <span class="group"> <a href="javascript:void(0);" title="'+a.feedRangeTip+'"> 数据错误 </a> </span>',c.sendername='<a class="employee-name" href="#profile/=/empid-'+a.sender.employeeID+'">'+a.sender.name+"</a>",c.senderNameNoLink=a.sender.name,_.extend(c,m(a.pictures||[]));var G=function(){var b=a.feedNDFiles,d="",f="",h='<a class="networklink-btn" href="#entnetworkdisk">进入网盘</a>';b.length>0?(_.each(b,function(a){var b=a.isPreview;f=b?'<a href="#" class="attach-preview-l v">预览</a>':"",d+='<dl attachid="'+a.ndFileID+'"><dt><img src="'+e.ASSETS_PATH+"/images/file/"+g.getFileType({name:a.attachName},!0)+'.png" alt=""></dt><dd><p>'+a.attachName+"("+g.getFileSize(a.attachSize)+')</p><p><a href="'+g.getDfLink(a.attachPath,a.attachName,!0)+'" class="d" title="'+a.name+'" target="_blank">下载</a> '+f+"</p></dd></dl>"}),c.feedFiles='<div class="feed-files feed-attach fn-clear netdiskfile">'+d+h+"</div>"):_.extend(c,n(a.files||[],a))};G(),c.archiveData=c.archive,c.archive=k.renderArchiveBar(c.archive,a);var H=a.createTime,I=g.getDateSummaryDesc(i.unix(H),i.unix(a.serviceTime),1);c.createTimeNoLink=I,c.createTime=2003==a.feedType?'<a href="#stream/showfeed/=/id-'+c.feedID+"/datalighted-app|workmessage"+'" class="f-date"> '+I+"</a>":'<a href="#stream/showfeed/=/id-'+c.feedID+(b?"/feedSource-crm":"")+'" class="f-date"> '+I+"</a>",c.nolinkcreateTime=I;var J=l(a.feedContent,a);c.feedText=J,c.pendfeedText=J,c.feedFormatContent=q(300,a);var K=a.replyCount;K=0==K?"":'(<span class="num">'+K+"</span>)";var L='<a href="javascript:void(0);" class="aj-delete aj-feed-fn-com-btn">删除</a>',M='<a href="javascript:void(0);" class="aj-unplaceonfile aj-feed-fn-com-btn">取消归档</a>',N='<a href="javascript:void(0);" class="aj-unattention follow-action-h aj-feed-fn-com-btn">取消关注</a>',O='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-pending aj-feed-fn-com-btn">待办</a></div>',P='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-Reply aj-feed-fn-com-btn"> 回复'+K+"</a></div>",Q='<div class="fl-fn-btn"><a href="javascript:void(0);" class="aj-Reply aj-feed-fn-com-btn rc">同事回复'+K+"</a></div>";c.fnReplyPre='<div class="fl-fn-btn"><a href="javascript:void(0);" class="aj-replytext aj-feed-fn-com-btn fl-common-up-arrow"> 回复'+K+"</a></div>",c.fnDeleteW="",c.fnUnplaceonfileW="",c.fnApprovalW="",c.fnPendingW=O,c.fnCommentonW="",c.fnCcW="",c.fnModifyapprovalW="",c.fnWorkingReW="",c.fnWorkSendW="",c.fnReplyW=P,c.fnReplyRcW=Q,p.id==c.employeeID&&a.canDelete&&(c.fnDeleteW=L),c.fnUnattentionW=a.isFollowed?N:'<a href="javascript:void(0);" class="aj-attention follow-action-h aj-feed-fn-com-btn">关注</a>',c.fnUnplaceonfileW=a.isArchived?M:'<a class="aj-placeonfile aj-feed-fn-com-btn" href="javascript:;">归档</a>',c.feedLocationStr="";var R,S=a.feedLocation,T="",U="",V="",W="",X="",Y="",Z="",$="",ab="";if(S&&(R=S.isTokenChenged,V=S.country,W=S.province,X=S.city,Y=S.district,Z=S.street,$=S.streetNumber,U=V+W+X+Y+Z+$,R&&(ab='<img src="'+e.ASSETS_PATH+'/images/location_istokenchenged.png" class="istokenchenged-ico" title="该用户本次签到所用设备与上次不同"> '),T='<div class="feed-location"><span class="feed-location-text fn-left">'+U+'</span><span class="feed-location-fn"><a href="#" class="feed-location-fn-map">显示地图</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="javascript: void(0);" class="aj-feed-fn-com-btn feed-location-fn-equipment">查看设备</a>'+ab+'</<span></span><span class="map-api fn-clear"><img class="feed-location-fn-map" src="http://restapi.amap.com/v3/staticmap?location='+S.longitude+","+S.latitude+"&zoom=10&size=546*140&markers=mid,,A:"+S.longitude+","+S.latitude+'&key=ee95e52bf08006f63fd29bcfbcf21df0" style="cursor:pointer;"/></span></div>',c.feedLocationStr=T,c.feedLocation=S),c.crmStartTime="",c.crmfBusinessTagRelationsStr="",b)switch(c.feedSource="crm",b.type){case"contract":a.crmContract&&a.crmContract.contractID==b.id&&(a.crmContract=null);break;case"opportunity":a.crmSalesOpportunity&&a.crmSalesOpportunity.salesOpportunityID==b.id&&(a.crmSalesOpportunity=null);break;case"marketing":a.crmMarketing&&a.crmMarketing.marketingEventID==b.id&&(a.crmMarketing=null);break;case"salesclue":a.crmSalesClue&&a.crmSalesClue.salesClueID==b.id&&(a.crmSalesClue=null);break;case"competitor":a.crmCompetitor&&a.crmCompetitor.competitorID==b.id&&(a.crmCompetitor=null);break;case"product":a.crmProduct&&a.crmProduct.productID==b.id&&(a.crmProduct=null)}else c.feedSource="oa";var bb=window.location.hash&&window.location.hash.toLowerCase().indexOf("showfeed")>=0,cb="";c.crmCustomersInfo="",(!b&&5!=parseInt(a.feedType)||b&&5!=parseInt(a.feedType))&&a.crmCustomers&&a.crmCustomers.length>0&&(_.each(a.crmCustomers,function(a){var b=a.customerID,c=a.name,d={id:b,returnUrl:window.location.href.split("#")[1]};cb+='<div><a href="#customers/showcustomer/=/param-'+encodeURIComponent(JSON.stringify(d))+'" >'+c+"</a></div>"}),c.crmCustomersInfo='<div class="crm-feedinfo-hd">关联客户('+a.crmCustomers.length+')</div><div class="crm-feedinfo-bd">'+cb+"</div>");var db="";c.crmContactsInfo="",(!b&&5!=parseInt(a.feedType)||bb||b&&5!=parseInt(a.feedType))&&a.crmContacts&&a.crmContacts.length>0&&(_.each(a.crmContacts,function(b,c){var d=b.contactID,e=b.name,f={id:d,returnUrl:window.location.href.split("#")[1]};db+='<span><a href="#contacts/showcontact/=/param-'+encodeURIComponent(JSON.stringify(f))+'" >'+e+(c==a.crmContacts.length-1?"":"、")+"</a></span>"}),c.crmContactsInfo='<div class="crm-feedinfo-hd">关联联系人('+a.crmContacts.length+')</div><div class="crm-feedinfo-bd">'+db+"</div>"),c.crmTopInfo="";var eb="",fb={},gb=g.getTplQueryParams(),hb=gb&&"crm"==gb.feedSource;if(!b&&!hb){if(5==parseInt(a.feedType)&&2==a.showCRMType){var ib=a.crmContacts&&a.crmContacts[0];ib&&(fb={id:ib.contactID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#contacts/showcontact/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+ib.name+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmcontact">'+eb+'<span title="联系人" class="crm-icon"></span></div>')}if(5==parseInt(a.feedType)&&1==a.showCRMType){var jb=a.crmCustomers&&a.crmCustomers[0];jb&&(fb={id:jb.customerID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#customers/showcustomer/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+jb.name+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmcustomer">'+eb+'<span title="客户" class="crm-icon"></span></div>')}a.crmSalesOpportunity&&3==a.showCRMType&&(fb={id:a.crmSalesOpportunity.salesOpportunityID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#opportunities/showopportunity/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+a.crmSalesOpportunity.name+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmsalesopportunity">'+eb+'<span title="机会" class="crm-icon"></span></div>'),a.crmContract&&6==a.showCRMType&&(fb={id:a.crmContract.contractID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#contracts/showcontract/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+a.crmContract.title+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmcontract">'+eb+'<span title="合同" class="crm-icon"></span></div>'),a.crmMarketing&&7==a.showCRMType&&(fb={id:a.crmMarketing.marketingEventID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#marketings/showmarketing/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+a.crmMarketing.name+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmmarketing">'+eb+'<span title="市场" class="crm-icon"></span></div>'),a.crmSalesClue&&8==a.showCRMType&&(fb={id:a.crmSalesClue.salesClueID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#salesclues/showsalesclue/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+a.crmSalesClue.name+"，"+a.crmSalesClue.company+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmsalesclue">'+eb+'<span title="线索" class="crm-icon"></span></div>'),a.crmCompetitor&&5==a.showCRMType&&(fb={id:a.crmCompetitor.competitorID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#competitors/showcompetitor/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+a.crmCompetitor.name+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmcompetitor">'+eb+'<span title="对手" class="crm-icon"></span></div>'),a.crmProduct&&4==a.showCRMType&&(fb={id:a.crmProduct.productID,returnUrl:window.location.href.split("#")[1]},eb='<a href="#products/showproduct/=/param-'+encodeURIComponent(JSON.stringify(fb))+'">'+a.crmProduct.name+"</a>",c.crmTopInfo='<div class="crm-crmtopinfo-warp crmproduct">'+eb+'<span title="产品" class="crm-icon"></span></div>')}return c},share:function(a){var b,c={},d=a.announcement,f="";c.deletegg="",d?(f=d.title,b=d.isShow,c.isShowText=b?"不显示":"显示",_.some(p.functionPermissions,function(a){return 1==a.value})&&(d.canDelete?(c.deletegg='<a class="aj-delete" href="javascript:void(0);">删除</a><i class="S_txt3">|</i>',c.fnDeleteW='<a href="javascript:void(0);" class="aj-delete">删除</a>'):(c.deletegg="",c.fnDeleteW="")),c.announcetit=f):c.announcetit="";var h=a.voteItem,j="",k="";h?(k=h.voteEmpCount,c.votecount=k,j=e.API_PATH+"/df/GetVoteResultExcel?feedID="+a.feedID,c.votedownurl=j):(c.votecount="",c.votedownurl=""),c.schedule=a.schedule;var l,m,n,o,q,r,s,t=a.schedule,u=a.sender.employeeID,v=g.getContactData().u.id,w="",x=a.serviceTime;t?(t.relateEmployees&&(m=t.relateEmployees,n=m.length,_.each(m,function(b){var c=(b.employeeID,b.name);b.profileImage,w+=c+"，",q=a.feedRangeDescription}),w=w.substr(0,w.length-1),w="",c.feedRangeDescription='<span>-</span> <span class="schedulesgroup"> <a href="javascript:void(0);" title="'+w+'"> '+q+" </a> </span>"),r=i.unix(t.startTime).format("YYYY"),s=i.unix(x).format("YYYY"),l=r==s?i.unix(t.startTime).format("MMMDD日 (dddd) HH:mm"):i.unix(t.startTime).format("YYYY年MMMDD日 (dddd) HH:mm"),o=g.getSmsRemindTypeName(t.smsRemindType),u==v?(c.voteico="voteico.gif",c.voteSenderInfo=""):(c.voteico="voteico_blue.gif",c.voteSenderInfo='<div class="from">该日程由<a href="#profile/=/empid-'+a.sender.employeeID+'">'+a.sender.name+"</a>为您创建。</div>"),c.startTime=l,c.smsRemindTypeText=o):c.startTime="错误了";var y=a.smsRemaindCount;a.readCount,c.smsRemaind=0==y?"":' <a href="#" class="msmremaindcount alertlistbtn">短信提醒'+y+"人</a>";var z=a.receipt,A=0,B=0,C=0,D=!1,E="",F="";return c.receiptfn="",c.receiptRemaind="",z&&(A=z.requireReceiptCount,B=z.receiptedCount,C=z.myReceiptStatus,D=z.isSendSms,1===C?c.receiptfn='<a href="javascript:;" class="receiptbtn aj-receipt-fn">立即回执</a>':2==C&&(c.receiptfn='<a href="javascript:;" class="receiptbtn disable">已回执</a>'),D&&(E="已发短信，"),F=a.pictures&&a.pictures.length>0||a.files&&a.files.length>0||a.voteItem?"no-top-line":"",c.receiptRemaind=' <div class="receiptfnwarp '+F+'"><a href="#" class="receiptalertlist alertlistbtn">需'+A+"人回执，"+E+"已回执"+B+"人</a></div>",c.receiptedCount=B),c},crm:function(a){var b,c={},d=a.announcement,f="",h=a.crmEvent||null,j=[],k="",l="",m="";if(h){if(h.startTime){var n=g.getDateSummaryDesc(i.unix(h.startTime),i.unix(a.serviceTime),2);k='<div class="crm-start-time-warp">'+n+"</div>"}j=h.fBusinessTagRelations||[],j&&j.length>0&&(_.each(j,function(a){var b='<a data-id="'+a.fBusinessTagOptionID+'" href="javascript:;">#'+a.fBusinessTagOptionName+"</a>";l+=b}),m="<div class=crm-tags-warp>"+l+"</div>")}c.crmStartTime=k||"",c.crmfBusinessTagRelationsStr=m||"",c.deletegg="",d?(f=d.title,b=d.isShow,c.isShowText=b?"不显示":"显示",_.some(p.functionPermissions,function(a){return 1==a.value})&&d.canDelete&&(c.deletegg='<a class="aj-delete" href="javascript:void(0);">删除</a><i class="S_txt3">|</i>',c.fnDeleteW='<a href="javascript:void(0);" class="aj-delete">删除</a>'),c.announcetit=f):c.announcetit="";var o=a.voteItem,q="",r="";o?(r=o.voteEmpCount,c.votecount=r,q=e.API_PATH+"/df/GetVoteResultExcel?feedID="+a.feedID,c.votedownurl=q):(c.votecount="",c.votedownurl=""),c.schedule=a.schedule;var s,t,u,v,w,x,y,z=a.schedule,A=a.sender.employeeID,B=g.getContactData().u.id,C="",D=a.serviceTime;z?(z.relateEmployees&&(t=z.relateEmployees,u=t.length,_.each(t,function(b){var c=(b.employeeID,b.name);b.profileImage,C+=c+"，",w=a.feedRangeDescription}),C=C.substr(0,C.length-1),C="",c.feedRangeDescription='<span>-</span> <span class="schedulesgroup"> <a href="javascript:void(0);" title="'+C+'"> '+w+" </a> </span>"),x=i.unix(z.startTime).format("YYYY"),y=i.unix(D).format("YYYY"),s=x==y?i.unix(z.startTime).format("MMMDD日 (dddd) HH:mm"):i.unix(z.startTime).format("YYYY年MMMDD日 (dddd) HH:mm"),v=g.getSmsRemindTypeName(z.smsRemindType),A==B?(c.voteico="voteico.gif",c.voteSenderInfo=""):(c.voteico="voteico_blue.gif",c.voteSenderInfo='<div class="from">该日程由<a href="#profile/=/empid-'+a.sender.employeeID+'">'+a.sender.name+"</a>为您创建。</div>"),c.startTime=s,c.smsRemindTypeText=v):c.startTime="错误了";var E=a.smsRemaindCount;a.readCount,c.smsRemaind=0==E?"":' <a href="#" class="msmremaindcount alertlistbtn">短信提醒'+E+"人</a>";var F=a.receipt,G=0,H=0,I=0,J=!1,K="",L="";return c.receiptfn="",c.receiptRemaind="",F&&(G=F.requireReceiptCount,H=F.receiptedCount,I=F.myReceiptStatus,J=F.isSendSms,1===I?c.receiptfn='<a href="javascript:;" class="receiptbtn aj-receipt-fn">立即回执</a>':2==I&&(c.receiptfn='<a href="javascript:;" class="receiptbtn disable">已回执</a>'),J&&(K="已发短信，"),L=a.pictures&&a.pictures.length>0||a.files&&a.files.length>0||a.voteItem?"no-top-line":"",c.receiptRemaind=' <div class="receiptfnwarp '+L+'"><a href="#" class="receiptalertlist alertlistbtn">需'+G+"人回执，"+K+"已回执"+H+"人</a></div>",c.receiptedCount=H),c},plan:function(a){var b,c={},d=l(a.feedContent,a),e=l(a.plan.reportContent,a),f=l(a.plan.planContent,a),g="",h="",i=a.replyCount;i=0==i?"":'(<span class="num">'+i+"</span>)";var j='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-commenton">点评'+i+"</a></div>";switch(c.feedID=a.feedID,a.plan.planType){case 0:h="planType为0";break;case 1:h='<p class="work-tit">今日工作总结</p><p>'+e+'</p><p>&nbsp;</p><p class="work-tit">明日工作计划</p><p>'+f+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+d+"</p>";break;case 2:h='<p class="work-tit">本周工作总结</p><p>'+e+'</p><p>&nbsp;</p><p class="work-tit">本周工作计划</p><p>'+f+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+d+"</p>";break;case 3:h='<p class="work-tit">本月工作总结</p><p>'+e+'</p><p>&nbsp;</p><p class="work-tit">本月工作计划</p><p>'+f+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+d+"</p>"}c.pendfeedText=d+" "+e+" "+f,c.feedText=h,a.plan.isComment?(c.leaderinfo="",c.isWhat='<span>-</span><span class="con"><a href="javascript:void(0);">已点评</a></span>'):(a.plan.leader?(g=a.plan.leader.name||"",b=a.plan.leader.employeeID,g='<a class="employee-name" href="#profile/=/empid-'+b+'">'+g+"</a>",c.leaderinfo='<div class="plan-leader">该日志由'+g+"点评。</div>"):c.leaderinfo="",c.isWhat='<span>-</span><span class="con"><a href="javascript:void(0);">未点评</a></span>',c.replyContent="");var k=a.plan.rate,m="";if(k>0){switch(k){case 1:m="一分：严重批评";break;case 2:m="二分：不合格";break;case 3:m="三分：符合要求";break;case 4:m="四分：超过预期";break;case 5:m="五分：非常满意"}c.fiveStar='<div class="five-star num'+k+'" title="'+m+'"></div>'}else c.fiveStar="";a.plan.canComment?(c.fnCommentonW=j,c.fnReplyW=""):c.fnCommentonW="",c.planType=a.plan.planType;var n=a.replies;return c.repliesBtn=n.length>0?'<a href="javascript:;" class="replies-btn aj-feed-fn-com-btn fl-common-up-arrow">关键回复('+n.length+")</a>":"",c},work:function(a){var b,c,d={};d.feedID=a.feedID,d.canCancel=a.canCancel;var e=a.work.rate;d.fiveStar=e>0?'<div class="five-star num'+e+'"></div>':"";var f="不提醒";switch(a.work.smsRemindType){case 1:f="";break;case 2:f="短信提醒一次";break;case 3:f="短信提醒两次";break;case 4:f="短信提醒三次"}var h="第一次短信提醒："+i.unix(a.work.smsRemindTime1).format("MMMDD日 HH:mm")+"&#10;";b=a.work.smsRemindTime2?"第二次短信提醒："+i.unix(a.work.smsRemindTime2).format("MMMDD日 HH:mm")+"&#10;":"",c=a.work.smsRemindTime3?"第三次短信提醒："+i.unix(a.work.smsRemindTime3).format("MMMDD日 HH:mm"):"";var j=h+b+c,k=g.getWorkStatusName(a.work.status);a.work.isComment&&(k="已点评"),d.isWhat=a.work.smsRemindType>1?'<span>-</span><span class="con"><a href="javascript:void(0);">'+k+'</a></span><span>-</span><span class="con"><a href="javascript:void(0);" title="'+j+'">'+f+"</a></span>":'<span>-</span><span class="con"><a href="javascript:void(0);">'+k+"</a></span>";var l=g.getDateSummaryDesc(i.unix(a.work.deadline),i.unix(a.serviceTime),2),m=g.getDateSummaryDesc(i.unix(a.work.endTime),i.unix(a.serviceTime),2),n="",o=a.work.executer.name,p=g.getContactData().u.id,q=a.work.executer.employeeID;switch(o='<a class="employee-name" href="#profile/=/empid-'+q+'">'+o+"</a>",d.executer=p==q?"1":"0",a.work.status){case 1:n=a.work.deadline<a.serviceTime?"应于"+l+'前完成，<span class="highlight">该指令已超时。</span>':"应于"+l+"前完成，该指令正在执行。";break;case 2:n="该指令已于"+m+"完成。";break;case 3:n="已于"+m+"取消。"}d.leaderinfo='<div class="plan-leader">该指令由'+o+"执行，"+n+"</div>";var r=a.replies;return d.repliesBtn=r.length>0?'<a href="javascript:;" class="replies-btn aj-feed-fn-com-btn fl-common-up-arrow">关键回复('+r.length+")</a>":"",a.work.canCancel&&(d.fnDeleteW='<a href="javascript:void(0);" class="aj-delete">取消</a>'),d},approve:function(a){if(a.approve){var b={},c=a.replyCount||"";b.feedID=a.feedID,b.canCancel=a.canCancel,s=g.getContactData().u.id;var d='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-approbtn aj-feed-fn-com-btn">批复</a></div>',f='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-cc aj-feed-fn-com-btn">抄送</a></div>',j='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-pending aj-feed-fn-com-btn">待办</a></div>',k='<div class="fl-fn-btn"><i class="S_txt3">|</i><a href="javascript:void(0);" class="aj-modifyapproval aj-feed-fn-com-btn">修改审批人</a></div>',m='<a href="javascript:void(0);" class="aj-pending aj-feed-fn-com-btn">待办</a>',n=g.getApproveStatusName(a.approve.status);if(d=c>0?'<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-approbtn aj-feed-fn-com-btn" data-replycount="'+c+'">批复('+c+")</a></div>":'<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-approbtn aj-feed-fn-com-btn" data-replycount="0">批复</a></div>',a.approve&&(p.id==a.approve.senderID&&a.approve.canCancel&&(b.fnDeleteW='<a href="javascript:void(0);" class="aj-delete aj-feed-fn-com-btn">取消</a>'),p.id==a.approve.currentApproverID&&a.approve.canCancel&&(b.fnDeleteW='<a href="javascript:void(0);" class="aj-delete aj-feed-fn-com-btn">取消</a>')),b.isWhat='<span>-</span><span class="con"><a href="javascript:void(0);">'+n+"</a></span>",1==a.approve.status){var o=a.approve.currentApprover.name||"",r=a.approve.currentApprover.employeeID||"",s=g.getContactData().u.id;o='<a class="employee-name" href="#profile/=/empid-'+r+'">'+o+"</a>",b.leaderinfo='<div class="plan-leader">已提交，待<a href="#">'+o+"</a>审批。</div>"}s==r?(b.approver="1",o="我"):b.approver="0";var t="",u="",v="",w="",x="",y="",z="",A=[];_.each(a.replies,function(b,c){var d=g.getDateSummaryDesc(i.unix(b.createTime),i.unix(a.serviceTime),1),f=q(300,b),j="",k="",m="",n="",p=l(b.replyContent,a);y=f.summaryHtml,A.push(f),f.leftHtml.length>0&&(k='<span class="feed-content-ellipsis">&#8230;</span>',j='<br/><br/><a href="javascript:;" class="feed-topreply-content-visible-h" data-index="'+c+'"> 展开正文（共'+f.feedWordNum+"个字）</a>"),function(){switch(b.operationType){case 1:v="同意",x='<img src="'+e.ASSETS_PATH+'/images/agree.gif" alt="" class="approve-isagree">';break;case 2:v="不同意",x='<img src="'+e.ASSETS_PATH+'/images/unagree.gif" alt="" class="approve-isagree">';break;case 3:v="设置为已取消",x=""}}(),function(){z=1==b.source?"":"，来自"+g.getSourceNameFromCode(b.source),b.sender?(r=b.sender.employeeID,o=s==r?"我":b.sender.name,w=b.sender.profileImage,m=b.sender.name,o='<a href="#profile/=/empid-'+r+'"> '+o+"</a>"):(o="",r="",w="")}(),n=h.delStrLink(p),t+='<dl class="comment-list fn-clear isappr"><dt>'+x+'<a class="master-reply-face-l" href="#profile/=/empid-'+r+'"><img src = "'+g.getAvatarLink(w,"3")+'" / ></a></dt><dd>'+o+'：<span class="feed-topreply-summary-text">'+y+"</span>"+k+" ("+d+"，"+v+z+")"+j+"</dd></dl>",u+='<dl class="comment-list fn-clear isappr-print"><dt>'+x+'</dt><dd><span class="print-approvername">'+m+"</span>："+n+" ("+d+"，"+v+z+")</dd></dl>"}),b.feedFormatContents=A,""==t?(b.replyContent="",b.printReplyContent=""):(b.replyContent='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-tit">以下为审批人的批复意见</div><div class="RC-feed">'+t+"</div></div>",b.printReplyContent='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-feed">'+u+"</div></div>"),b.fnCcW="",b.fnModifyapprovalW="",b.fnApprovalW="",b.fnPendingW=j,b.morePendingW="",a.approve.canApprove&&(b.fnApprovalW=d,b.fnReplyW=""),a.approve.canAddAtEmployees&&(b.fnCcW=f,b.fnPendingW="",b.morePendingW=m),a.approve.canChangeApprover&&(b.fnModifyapprovalW=k,b.fnPendingW="",0==a.approve.currentApproverID&&(b.fnModifyapprovalW='<div class="fl-fn-btn"><i class="S_txt3">|</i><a href="javascript:void(0);" class="aj-modifyapproval aj-feed-fn-com-btn">转审批人</a></div>')),function(){b.printSendername='<span class="print-sendername">'+a.sender.name+"</span>"||"",b.printPictures="",b.printFiles="",b.printText="",_.each(a.feedContent,function(a){b.printText+=a.text}),b.printText=b.printText.replace(/[\n|\r]/g,"<br/>"),_.each(a.pictures,function(a){b.printPictures+='<div class="print-img-item"><span class="print-img-warp"><img src="'+e.API_PATH+"/df/get?id="+a.attachPath+'1.jpg" class="print-pictures"/><img src="'+e.ASSETS_PATH+'/images/print-del-pic-ico.gif" title="不打印该图" class="print-del-pic-ico aj-feed-fn-com-btn" /></span></div>'});var c=1;_.each(a.files,function(a){b.printFiles+='<div class="print-feedfile">附件'+c+"："+a.attachName+" ("+g.getFileSize(a.attachSize)+")</div>",c++}),b.printCTime=i.unix(a.createTime).format("YYYY年MMMDD日 HH:mm")}();var B=a.replies;return b.repliesBtn=B.length>0?'<a href="javascript:;" class="replies-btn aj-feed-fn-com-btn fl-common-up-arrow">关键回复('+B.length+")</a>":"",b}},myremind:function(a,b){var c,d,e,f,g={},h=a.timingMessageRemaind,j=b.serviceTime;return c=i(h.remaindTime).format("YYYY"),f=i.unix(j).format("YYYY"),c==f?(d=i(h.createTime).format("MMMDD日 (dddd) HH:mm"),e=i(h.remaindTime).format("MMMDD日 HH:mm")):(d=i(h.createTime).format("YYYY年MMMDD日 (dddd) HH:mm"),e=i(h.remaindTime).format("YYYY年MMMDD日 HH:mm")),h.hideCreator=p.id==h.creator.employeeID?"fn-hide":"",h.createTime=d,h.remaindTime=e,g.timingMessageRemaind=h,g},worknotice:function(a){var b={};b.feedWorkNoticeRangesReaded=a.feedWorkNoticeRangesReaded||[],b.feedWorkNoticeRangesUnread=a.feedWorkNoticeRangesUnread||[],b.feedWorkNoticeRangesConfirmed=a.feedWorkNoticeRangesConfirmed||[],b.isNeedConfirm=a.feedWorkNotice&&a.feedWorkNotice.isNeedConfirm||!1,b.isNeedConfirm=a.feedWorkNotice.isNeedConfirm?_.some(b.feedWorkNoticeRangesConfirmed,function(a){return a.employeeID==p.employeeID?!0:void 0})?'<a href="javascript:;" class="receiptbtn disable">已确认</a>':'<a href="javascript:;" class="receiptbtn aj-confirmworknotice-btn">确认</a>':"";var c='<div class="fl-fn-btn feed-remind-btn"><div class="remind-more-menu" style="display: none;"> <a href="javascript:;" class="feed-remind-btn-item" data-value="1">1小时后提醒我</a> <a href="javascript:;" class="feed-remind-btn-item" data-value="3">3小时后提醒我</a> <a href="javascript:;" class="feed-remind-btn-item" data-value="5">5小时后提醒我</a> <a href="javascript:;" class="feed-remind-btn-item" data-value="998">自定义提醒</a> </div> <a href="javascript:;">提醒 <i class="arrow"></i></a> </div>';b.feedRemind=c,b.title=a.feedWorkNotice.title||"";var d="";_.each(b.feedWorkNoticeRangesReaded,function(a){var b=g.getAvatarLink(a.Employee&&a.Employee.profileImage,"2"),c=a.Employee&&a.Employee.name||"",e=a.employeeID||0;d+='<div class="items fn-clear"> <img alt="" src="'+b+'"> <a class="name" href="#profile/=/empid-'+e+'">'+c+"</a> </div>"}),b.feedWorkNoticeRangesReadedItemStr=d;var e="";_.each(b.feedWorkNoticeRangesUnread,function(a){var b=g.getAvatarLink(a.Employee&&a.Employee.profileImage,"2"),c=a.Employee&&a.Employee.name||"",d=a.employeeID||0;e+='<div class="items fn-clear"> <img alt="" src="'+b+'"> <a class="name" href="#profile/=/empid-'+d+'">'+c+"</a> </div>"}),b.feedWorkNoticeRangesUnreadItemStr=e;var f="";return _.each(b.feedWorkNoticeRangesConfirmed,function(a){var b=g.getAvatarLink(a.Employee&&a.Employee.profileImage,"2"),c=a.Employee&&a.Employee.name||"",d=a.employeeID||0;f+='<div class="items fn-clear"> <img alt="" src="'+b+'"> <a class="name" href="#profile/=/empid-'+d+'">'+c+"</a> </div>"}),b.feedWorkNoticeRangesConfirmedItemStr=f,b}},s=Backbone.Collection.extend({model:j.itemM,url:"/Feed/GetFeeds",sync:function(a,b,c){var d=c.data||{};return c.data=_.extend({circleID:0,subType:0,feedType:0,keyword:"",pageSize:30,pageNumber:2},d),Backbone.sync("read",b,_.extend(c,{apiCb:function(){}}))},parse:function(a){var b,d=[],e=this;return a.success&&(b=a.value.items,_.each(b,function(b,f){b.serviceTime=a.serviceTime,b.GetBatchFilesSource=e.GetBatchFilesSource,d[f]=c(b,e.crmParam)})),d}});b.listC=s});