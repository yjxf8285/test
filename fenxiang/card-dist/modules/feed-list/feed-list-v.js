/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/feed-list/feed-list-v",["util","modules/feed-list/fl-util","modules/feed-list/feed-fns","dialog","moment","modules/publish/publish","modules/feed-list/feed-list-m","modules/feed-list/feed-list-c","modules/fs-reply/fs-reply","modules/feed-list/feed-list-helper","modules/fs-attach/fs-attach-file-preview","modules/fs-attach/fs-attach-preview","swfobject","modules/fs-createremind/fs-createremind","uilibs/audio-player","modules/fs-map/fs-map","modules/card-reply/feed-reply","modules/crm-contact-view/crm-contact-view","modules/feed-list/feed-list.html","./feed-list","modules/feed-list/feed-list-v","modules/fs-lazyload/fs-lazyload","uilibs/pagination","spin"],function(a,b){var c,d=window,e=d.FS,f=e.tpl,g=(f.store,f.event),h=a("util"),i=a("modules/feed-list/fl-util"),j=a("modules/feed-list/feed-fns"),k=a("dialog"),l=a("moment"),m=a("modules/publish/publish"),n=a("modules/feed-list/feed-list-m"),o=a("modules/feed-list/feed-list-c"),p=(a("modules/fs-reply/fs-reply"),a("modules/feed-list/feed-list-helper")),q=a("modules/fs-attach/fs-attach-file-preview"),r=a("modules/fs-attach/fs-attach-preview"),s=a("swfobject"),t=a("modules/fs-createremind/fs-createremind"),u=a("uilibs/audio-player"),v=a("modules/fs-map/fs-map"),w=a("modules/card-reply/feed-reply.js"),x=a("modules/crm-contact-view/crm-contact-view"),y=a("modules/feed-list/feed-list.html");p.feedContentFormat;var z=(n.itemM,o.listC),A=$(y),B=m.mediaMaker,C=m.atInput,D=m.selectBar,E=m.selectPanel,F=m.timeSelect,G=m.dateSelect,H=h.getContactData(),I=H.u,J=(new r).render(),K=q.FileReader,L=new K,M=v.FsMapOverlay,N=new M,O=new t,P=!1,Q=function(a){var b=a.val(),c=!0;return b=$.trim(b),""==b&&(h.showInputError(a),c=!1),c},R=e.BASE_PATH+"/H/Home/Index"+("development"==PUBLISH_MODEL?"2":"")+"?model=print#stream/showfeed/=/id-";$(document).click(function(){$(".item-func .more-menu").hide(),$(".item-func .remind-more-menu").hide(),$(".item-vote .seemore-info").hide()});var S=new x,T=k.extend({attrs:{width:380,content:A.filter(".announce-on-time-templet").html(),className:"common-style-richard announce-on-time"},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel","change .selectlist":"_selectlistChange"},_renderCpt:function(){var a=this.element,b=$(".selecttimediv",a),c=new G({element:b,placeholder:"选择日期"});this.ds=c},render:function(){var a=T.superclass.render.apply(this,arguments);return this._renderCpt(),a},_selectlistChange:function(){var a=this.element,b=$(".selectlist",a),c=b.val(),d=$(".selecttimediv",a);12==c?d.show():d.hide()},_settimeshow:function(){var a=this,b=U.itemV,c=b.model,d=this.element,e=$(".selectlist",d),f=e.val(),g=c.get("originData"),i=g.feedID,j=this.ds.getValue(!0);j=j?l(j).unix():0,h.api({url:"/FeedAnnounce/SetAnnounceIsShow ",type:"post",data:{feedID:i,isShow:!0,showtimeDataType:f,time:j},dataType:"json",success:function(c){c.success&&(a.hide(),a._clear(),b.updateModel())}})},_clear:function(){},_submit:function(){this._settimeshow(),this.hide()},_cancel:function(){this.hide()},destroy:function(){var a;return this.ds&&this.ds.destroy(),a=T.superclass.destroy.apply(this,arguments)}}),U=new T,V=new k({width:"380",content:'<div class="fs-feed-comment-dialog"><div class="working-content"> <h1 class="ui-dialog-title"> </h1> <div class="working-warp fn-clear"> <p style="font-size:14px;"> 最多可选择<span class="Overstepnum">0</span>项 </p> <p class="working-btnwarp"><span class="button-r"> <button type="submit" class="button-green place-btn close-btn">确定</button> </span> </p> </div> </div></div>',className:"common-style-richard fs-feed-voteOverstep-dialog"});V.after("show",function(){$(".fs-feed-comment-dialog .Overstepnum").text(V.voteCountNum)});var W=new k({width:"380",content:'<div class="fs-feed-comment-dialog"><div class="working-content"> <h1 class="ui-dialog-title"> </h1> <div class="working-warp fn-clear"> <p> 请选择投票选项 </p> <p class="working-btnwarp"><span class="button-r"> <button type="submit" class="button-green place-btn close-btn">确定</button> </span> </p> </div> </div></div>',className:"common-style-richard fs-vote-comment-dialog"}),X=new k({width:909,zIndex:1500,content:A.filter(".commenton-box").html(),className:"common-style-richard fs-feed-comment-dialog"});X.after("show",function(){var a=X.element,b=$(".dialog-right",a),c=$(".input-text",a),d=$(".aj-selectcommentoner",a);c.val("").trigger("autosize.resize"),X.set("width",909),b.show();var e=X.sb;e||(e=new D({element:d,data:[{title:"同事",type:"p",list:H.p},{title:"部门",type:"g",list:H.g}],spZIndex:1e5,singleCked:!1,title:"添加抄送人或部门",autoCompleteTitle:"请输入姓名或拼音"}),X.sb=e,X.element.on("click",".close-btn",function(){X.hide()}),X.atInput=new C({element:c,withAt:!0}));var f=this.itemV,g=f.model,j=g.get("feedText"),k=g.get("feedID"),m=g.get("originData"),n=m.sender.name,o=m.plan.planType,p=h.getAvatarLink(m.sender.profileImage,2),q=m.sender.employeeID,r=l.unix(m.createTime).format("MMMDD日"),s=!0,t=$(".comment-feedcontent",a),u=$(".name",a),v=$(".name-img",a),w=$(".aj-ctime",a);j=i.delStrLink(j),t.html(j),u.html(n),v.attr("src",p),w.html(r),Y(k,q,o,s)}),X.element.on("click",".look-history",function(){var a=X.element,b=$(".dialog-right",a);b.is(":visible")?($(this).text("查看历史日志>>"),b.hide(),X.set("width",458)):($(this).text("收起历史日志<<"),X.set("width",909),b.show())}),X.element.on("click",".dialy-history i",function(){var a=X.element,b=$(".aj-hisplanel",a),c=($(".aj-histime",a),$(".dialy-history",a)),d=$("i",c),e=b.attr("feedid"),f=b.attr("employeeid"),g=b.attr("plantype"),h=(b.attr("hasforward"),!1),i=d.attr("class");"cur"!=i&&(h=!0,Y(e,f,g,h))}),X.element.on("click",".dialy-history b",function(){var a=X.element,b=$(".aj-hisplanel",a),c=($(".aj-histime",a),$(".dialy-history",a)),d=$("b",c),e=b.attr("feedid"),f=b.attr("employeeid"),g=b.attr("plantype"),h=(b.attr("hasbackward"),!1),i=d.attr("class");"cur"!=i&&(h=!1,Y(e,f,g,h))}),X.after("render",function(){h.placeholder($(".aj-commenton-replycontent",X.element));var a=new E({trigger:$(".change-user-l",X.element),data:[{title:"同事",type:"p",list:H.p}],singleCked:!0});a.on("select",function(b){var c,d=X.element,e=$(".aj-hisplanel",d),f=$(".user-info",d),g={};_.each(b,function(a){_.each(a,function(a){_.extend(g,{feedid:"0",employeeid:a.id,employeename:a.name})})}),e.attr(g),Y(g.feedid,g.employeeid,e.attr("plantype"),!0),c=h.getContactDataById(g.employeeid,"p"),f.html('<img src="'+c.profileImage+'" alt="" width="30" height="30" class="name-img"> <span class="name">'+c.name+"</span>"),a.hide(),a.unselect("all","all",!0)}),X.element.on("click",".change-user-l",function(b){a.show(),b.preventDefault()})});var Y=function(a,b,c,d){var e=X.element;h.api({url:"/Feed/GetSomeOnePlanWithForwardOrBackward",type:"get",data:{feedID:a,employeeID:b,planType:c,isForward:d},dataType:"json",success:function(a){var d=$(".aj-hisplanel",e),f=$(".aj-histime",e),g=$(".dialy-history",e),i=$("i",g),j=$("b",g),k=a.value,m="",n="",o="",p="",q=k.feedContent,r=k.report,s=k.planContent,t=k.feedID,u=k.planType,v=k.hasBackward,w=k.hasForward,x=k.createTime;if(v?j.removeClass("cur"):j.addClass("cur"),w?i.removeClass("cur"):i.addClass("cur"),a.success){switch(m=q||"<p>&nbsp;</p>",n=r||"",o=s||"",x=l.unix(x).format("MMMDD日 (dddd)"),u){case 0:p="planType为0";break;case 1:p='<p class="work-tit">今日工作总结</p><p>'+n+'</p><p>&nbsp;</p><p class="work-tit">明日工作计划</p><p>'+o+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+m+"</p>";break;case 2:p='<p class="work-tit">本周工作总结</p><p>'+n+'</p><p>&nbsp;</p><p class="work-tit">本周工作计划</p><p>'+o+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+m+"</p>";break;case 3:p='<p class="work-tit">本月工作总结</p><p>'+n+'</p><p>&nbsp;</p><p class="work-tit">本月工作计划</p><p>'+o+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+m+"</p>"}var y=k.commentContent,z="",A="",B="",C="",D="",E="",F="以下为日志点评人的点评";y?(B=h.getDateSummaryDesc(l.unix(k.replyTime),l.unix(a.serviceTime),1),D=y,C=k.leader.profileImage,A=k.leader.name,z='<dl class="comment-list fn-clear"><dt><a class="master-reply-face-l" href="javascript:void(0);"><a href="javascript:;"><img src = "'+h.getAvatarLink(C,"3")+'" / ></a></a></dt><dd><a href="javascript:;">'+A+"</a>："+D+" ("+B+"，点评)</dd></dl>",E='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-tit">'+F+'</div><div class="RC-feed">'+z+"</div></div>"):E="",d.html(p+E),f.text(x),d.attr({feedid:t,hasbackward:v,hasforward:w,employeeid:b,plantype:c}),0==k.createTime&&d.html('<div class="list-empty-tip" style="display: block;"><img src="../../html/fs/assets/images/clear.gif" alt="loading" class="icon-empty">&nbsp;&nbsp;<span class="empty-text">暂无记录</span></div>')}}})},Z=function(a,b){var c="g"==b?H.g:H.p;return _.find(c,function(b){return b.id==a})},ab=function(a,b){var c="g"==b?H.g:H.p;return _.find(c,function(b){return b.name==a})},bb=function(a,b){var c,d,e=H.g,f=b.getSelectedData(),g=f.p||[],h=f.g||[],i=!1;return d=_.find(e,function(b){return b.name==a?!0:void 0}),d?_.find(h,function(b){return c=Z(b,"g"),c.name==a?i=!0:void 0}):(_.find(g,function(b){return c=Z(b,"p"),c.name==a?i=!0:void 0}),i||_.find(h,function(b){return c=Z(b,"g"),c&&_.contains(ab(a,"p").groupIDs,c.id)?i=!0:void 0})),i},cb=function(a){return h.getAtFromInput(a)},db=function(a,b){var c=[],d=[],e=[],f=[],g=$(a);return g.each(function(){c=c.concat(cb(this))}),c.length>0&&(d=_.filter(c,function(a){return eb(a)?!0:(e.push(a),!1)}),_.each(d,function(a){bb(a,b)||f.push(a)})),f=_.map(f,function(a){var b,c="g";return b=ab(a,"g"),b||(b=ab(a,"p"),c="p"),_.extend({type:c},b)}),{noExist:e,noInclude:f,validAtContent:d}},eb=function(a){var b,c=H.p,d=H.g;return b=_.find(c,function(b){return b.name==a?!0:void 0}),b||(b=_.find(d,function(b){return b.name==a?!0:void 0})),!!b},fb=function(a,b,c){var d=db(a,b),e=(d.noExist,d.noInclude);d.validAtContent;var f,g=[],i=[],j=[],k=[];return _.some(b.g,function(a){return"999999"==a})?(c(),void 0):(e.length>0?(_.each(e,function(a){"p"==a.type?_.some(j,function(b){return b.id==a.id})||j.push(a):_.some(k,function(b){return b.id==a.id})||k.push(a)}),j.length>0&&(g.push(j.length+"人"),i=i.concat(_.map(j,function(a){return a.name}))),k.length>0&&(g.push(k.length+"部门"),i=i.concat(_.map(k,function(a){return a.name}))),g.length>0?(g="（共"+g.join("，")+"）",i=i.join("、")):(g="",i=""),f="您通过@提到当中 "+i+g+"不在您选择的范围中，是否要将这些人和部门包含在发布的范围当中",h.confirm(f,"提示",function(){c()})):c(),void 0)};X.element.on("click",".commentonsend-btn",function(){var a=X.itemV,b=X.sb,c=X.element,d=a.model,e=$(".aj-commenton-replycontent",c),f=$(".aj-issend",c),g=$(".commenton-select",c),i=d.get("feedID"),j=e.val(),k=g.val(),l=f.is(":checked");j||(j=$("option:selected",g).text());var m="";j.length>2e3?(m=j.length-2e3,h.alert("发送内容不超过2000字，目前已超出"+m+"个字")):gb(i,j,k,b,l)}),X.after("hide",function(){var a=X.element,b=$(".aj-commenton-replycontent",a),c=$(".commenton-select",a);c.val(3),X.sb.removeAllItem(),b.val(""),$(".aj-hisplanel",a).html('<div class="hisplanel-loading-icon"></div>')});var gb=function(a,b,c,d,e){var f=X.element,g=$(".aj-commenton-replycontent",f);fb(g,d,function(){var i=d.getSelectedData(),j=i.p||[],k=i.g||[],l="";_.each(j,function(a){_.each(H.p,function(b){b.id==a&&(l+="@"+b.name+" ")})}),_.each(k,function(a){_.each(H.g,function(b){b.id==a&&(l+="@"+b.name+" ")})}),h.api({url:"/FeedPlan/ApproverComment ",type:"post",data:{feedID:a,replyContent:b+" "+l,rate:Number(c),atEmployeeIDs:j,isSendSms:e},dataType:"json",success:function(a){a.success&&(g.val(""),X.hide(),X.itemV.updateModel())}},{submitSelector:$(".commentonsend-btn",f)})})},hb=new k({width:"370",zIndex:1002,content:A.filter(".place-on-file-box").html(),className:"common-style-richard fs-feed-comment-dialog"});hb.element.on("click",".close-btn",function(){hb.hide()}),hb.after("show",function(){var a=hb.element,b=(hb.itemV,hb.thisTags),c="",d=$(".aj-mytagnames",a),e=$(".tagnamesel",a);e.val(b);var f=e.val(),g=f.split(" ");h.api({url:"/FeedArchive/GetMyFeedArchiveTags",type:"get",data:{},dataType:"json",success:function(a){_.each(a.value,function(a){var b=a.tagName,d='<a href="#" class="place-tap">',e="</a>";if(b)for(var f in g)g[f]==b&&(d='<a href="#" class="place-tap cur">');else c="";c+=d+b+e}),d.html("").append(c)}})}),hb.after("hide",function(){var a=hb.element;$(".tagnamesel",a),hb.thisTags=""}),hb.element.on("click",".aj-mytagnames a",function(){var a=hb.element,b=$(".tagnamesel",a),c=$.trim(b.val()),d=c.split(" "),e=d.length,f="";return f=c?" "+$(this).text():$(this).text(),3>e&&"place-tap cur"!=$(this).attr("class")&&(b.val(c+f),$(this).addClass("cur")),!1}),hb.element.on("keydown",".tagnamesel",function(a){if(!$.browser.chrome||!P){var b=this.element,c=$(".tagnamesel",b),d=c.val(),e=$.trim(d),f=e.split(" ").join(" ").split(" "),g=[];if(f=_.filter(f,function(a){return""!=a}),a=a?a:window.event,32==a.keyCode&&f.length>=3)return c.val(e),!1;if(46!=a.keyCode&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)for(var h in f){var i=12;/[\u4e00-\u9fa5]+/.test(f[h])&&(i=6),f[h].length>i&&(g=f[h].substr(0,i),f[h]=g,c.val(f.join(" ")))}13==a.keyCode}}),hb.element.on("keyup",".tagnamesel",function(a){if(!$.browser.chrome||!P){var b=this.element,c=$(".tagnamesel",b),d=c.val(),e=$.trim(d),f=e.split(" "),g=[];if(f=_.filter(f,function(a){return""!=a}),a=a?a:window.event,32==a.keyCode&&f.length>=3)return c.val(e),!1;if(46!=a.keyCode&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)for(var h in f){var i=12;/[\u4e00-\u9fa5]+/.test(f[h])&&(i=6),f[h].length>i&&(g=f[h].substr(0,i),f[h]=g,c.val(f.join(" ")))}}}),$.browser.chrome&&hb.element.on("compositionstart",function(){P=!0}).on("compositionend",function(){P=!1}),hb.element.on("click",".aj-pof-btn",function(){var a=hb.element,b=$(".tagnamesel",a),c=b.val().split(" "),d=hb.itemV,e=d.model,f=e.get("feedID"),g=e.get("feedType");Q(b)&&ib(f,g,c)});var ib=function(a,b,c){var d=hb.element,e=$(".tagnamesel",d),f=hb.itemV,g=f.model,i=g.get("archiveData"),j=g.get("originData");j.feedID,h.api({url:"/FeedArchive/SaveFeedArchive",type:"post",data:{feedID:a,feedType:b,tagNames:c},dataType:"json",success:function(a){if(a.success){var b=new k({width:"",closeTpl:"",content:'<div class="fs-successtip"><img src="../../html/fs/assets/images/success.gif" width="50" height="50" /> 归档成功</div>',className:"common-style-richard fs-feed-comment-dialog"}).render();b.show(),setTimeout(function(){b.hide()},1500),e.val(""),hb.hide(),f.reRenderArchive(p.renderArchiveBar({archiveTime:i.archiveTime,tags:_.map(c,function(a){return{tagName:a}})},{serviceTime:j.serviceTime}));var d=f.$el,g=$(".aj-placeonfile",d);g.text("取消归档").attr("class","aj-unplaceonfile aj-feed-fn-com-btn")}}},{submitSelector:$(".aj-pof-btn",d)})},jb=new k({width:"500",content:A.filter(".forward-box").html(),className:"common-style-richard fs-feed-comment-dialog",zIndex:1001}),kb=function(){var a,b,c,d=I.employeeID;a=jb.element,c=$(".fwd-title",a),b=$(".aj-forwarder",a);var e=h.excludeContactData([d],"p"),f=new D({element:b,data:[{title:"同事",type:"p",list:e}],singleCked:!1,title:"添加转发人",autoCompleteTitle:"请输入姓名或拼音"}),g=new C({element:c,withAt:!0});$(".close-btn",jb.element).click(function(){jb.hide()}),jb.sb=f,jb.atInput=g,c.val("")};jb.element.on("click",".fwdsend-btn",function(){var a=jb.sb,b=this.element,c=($(".is-important",b),$(".fwd-title",b)),d=a.getSelectedData(),e=d.p||[],f=jb.itemV,g=f.model,i=g.get("feedID"),j=c.val(),k=0,l=0,m=[],n=!1;return _.each(e,function(b){var c=a.getItemData(b,"p");j+="@"+c.name+" "}),0==e.length?($(".input-tip",a.element).click(),!1):(Q(c)&&0!=e.length&&(j.length>2e3?h.alert("请控制输入在2000字内"):lb(i,j,k,l,m,n)),void 0)}),jb.after("show",function(){jb.sb||kb(),$(".fwd-title",this.element).trigger("autosize.resize")}),jb.after("hide",function(){var a=jb.element,b=$(".fwd-title",a);jb.sb.removeAllItem(),b.val("").trigger("autosize.resize")});var lb=function(a,b,c,d,e,f){h.api({url:"/Feed/SendFeedReplyForTransmit",type:"post",data:{feedID:a,replyContent:b,replyToReplyID:c,replyToEmployeeID:d,fileInfos:e,isSendSms:f},dataType:"json",success:function(a){var b=jb.element,c=($(".is-important",b),$(".ped-title",b));a.success&&(jb.hide(),c.val(""),jb.sb.removeAllItem(),jb.itemV.addReplyCountPlusOne(),jb.itemV.updateModel())}},{submitSelector:$(".fwdsend-btn",jb.element)})},mb=new k({width:"500",content:A.filter(".pending-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),nb=function(){var a,b,c;a=mb.element,b=$(".aj-peder",a),c=$(".ped-title",a);var d=new D({element:b,data:[{title:"同事",type:"p",list:H.p}],singleCked:!1,title:"选择同事",autoCompleteTitle:"请输入姓名或拼音"}),e=new C({element:c});$(".close-btn",mb.element).click(function(){mb.hide()}),mb.sb=d,mb.atInput=e};mb.after("show",function(){mb.sb||nb();var a,b,c=this.itemV,d=c.model,e=this.element,f=mb.sb,g=$(".ped-feedtype",e),h=$(".ped-feedContent",e),j=$(".ped-title",e),k=d.get("feedTypeDescription"),l=d.get("originData"),m=l.feedContent,n="",o="",p="",q=l.plan||null;_.each(m,function(a){n+=a.text}),q?(a=q.reportContent||"",b=q.planContent||"",_.each(a,function(a){o+=a.text}),_.each(b,function(a){p+=a.text}),n=o+" "+p+" "+n):(n=n.replace(/<br\/>/g," "),n=n.replace(/\n+/g," "));var r=i.cutStrForNum(n,20).toString();g.html(k),h.html(r),j.val(r).trigger("autosize.resize"),f.addItem(I)}),mb.after("hide",function(){var a=mb.element,b=$(".ped-title",a),c=$(".is-important",a);mb.sb.removeAllItem(),b.val("").trigger("autosize.resize"),c.prop("checked",!1)}),mb.element.on("click",".ped-feedContent",function(){var a=mb.element,b=$(".ped-title",a),c=$(this).text();return b.val(c),!1}),mb.element.on("click",".pedsend-btn",function(){var a=mb.sb,b=mb.element,c=$(".is-important",b),d=$(".ped-title",b),e=c.is(":checked"),f=a.getSelectedData(),g=f.p||[],i=mb.itemV,j=i.model,k=j.get("feedID"),l=g,m=j.get("feedType"),n=d.val(),o=e;0==g.length?h.alert("请选择待办范围"):Q(d)&&ob(k,l,n,m,o)});var ob=function(a,b,c,d,e){var f=mb.itemV,g=f.options.worktodoCb;return c.length>1e3?(h.alert("请控制输入在1000字内"),!1):(h.api({url:"/Worktodolist/AddWorkToDoList",type:"post",data:{feedID:a,feedType:d,employeeIDs:b,title:c,isImportant:e},dataType:"json",success:function(a){var b=mb.element,c=$(".ped-title",b);a.success&&(mb.hide(),c.val(""),mb.sb.removeAllItem(),g&&g.call(f,a))}},{submitSelector:$(".pedsend-btn",mb.element)}),void 0)};new k({width:"580",content:A.filter(".apprhis-box").html(),className:"common-style-richard fs-feed-comment-dialog"});var pb=k.extend({attrs:{hasMask:!0,width:594,height:600,itemV:null,content:A.filter(".approve-history-tpl").html(),className:"common-style-richard feed-approve-history-dialog",successCb:e.EMPTY_FN,zIndex:99},render:function(){var a=pb.superclass.render.apply(this,arguments);return this._initFeedList(),a},_initFeedList:function(){var b=this,c=a("./feed-list"),d=this.element,e=$(".feed-list",d);$(".feed-list-pagination",d),this.feedList=new c({element:e,pagSelector:!1,withLazyload:!1,withAvatar:!1,listPath:"/FeedApprove/GetSomeoneApproveHistroy",defaultRequestData:function(){var a=b.get("itemV"),c=a.model,d=c.get("originData");return{employeeID:d.employeeID,feedID:d.feedID}}})},load:function(){this.feedList.load()},reload:function(){this.feedList.reload()},show:function(){var a=pb.superclass.show.apply(this,arguments),b=this.element,c=$(".user-name",b),d=this.get("itemV"),e=d.model;return c.text(e.get("originData").sender.name),a}}),qb=new pb,rb=k.extend({attrs:{itemV:null,content:A.filter(".swr-undone-tpl").html(),className:"common-style-richard feed-swr-undone-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".swr-undone-input",c);return 0==b.replyContent.length&&(h.showInputError(d),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".swr-undone-input",e),g=$(".is-send-sms",e);return a.feedID=d.feedID,a.replyContent=_.str.trim(f.val()),a.operationType=2,a.isSendSms=g.prop("checked"),a.rate=0,a.atEmployeeIDs=[],a},_renderCpt:function(){var a=this.element,b=$(".swr-undone-input",a),c=new C({element:b,withAt:!0});this.atInput=c},clearForm:function(){var a=this.element,b=$(".swr-undone-input",a),c=$(".is-send-sms",a);b.val(""),c.prop("checked",!1)},hide:function(){var a=rb.superclass.hide.apply(this,arguments);return this.clearForm(),a},render:function(){var a=rb.superclass.render.apply(this,arguments);return this._renderCpt(),a},_submit:function(a){var b=this,c=this.getRequestData(),d=this.get("itemV"),e=d.$el,f=e.data("fsReply"),g=this.element,i=$(".swr-undone-input",g);this.isValid()&&(i.val().length>2e3?h.alert("请控制输入在2000字内"):h.api({type:"post",data:c,url:"/FeedWork/AssignerSendFeedWorkReply",success:function(a){a.success&&(b.hide(),b.clearForm(),f.addNewReply(a.value),b.get("successCb").call(b,a,c),d.updateModel())}})),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()},destroy:function(){var a;return this.atInput&&this.atInput.destroy(),a=rb.superclass.destroy.apply(this,arguments)}}),sb=new rb,tb=k.extend({attrs:{itemV:null,content:A.filter(".swr-done-tpl").html(),className:"common-style-richard feed-swr-done-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=k.superclass.render.apply(this,arguments);return this._renderCpt(),a},show:function(){var a=this.element,b=$(".swr-done-input",a),c=$(".rate-wrapper select",a),d=tb.superclass.show.apply(this,arguments);return b.trigger("autosize.resize"),c.val(3),d},hide:function(){var a=tb.superclass.hide.apply(this,arguments);return this.clearForm(),a},_renderCpt:function(){var a=this.element,b=$(".copyto-sb",a),c=$(".media",a),d=$(".swr-done-input",a),e=new C({element:d}),f=new D({element:b,data:[{title:"同事",type:"p",list:H.p}],title:"添加抄送人",acInitData:h.getPublishRange("work"),singleCked:!1,autoCompleteTitle:"请输入姓名或拼音"}),g=new B({element:c,action:["at"],actionOpts:{at:{inputSelector:d}}});b.data("sb",f),this.media=g,this.atInput=e},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".swr-done-input",c);return 0==b.replyContent.length&&(h.showInputError(d),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".swr-done-input",e),g=$(".rate",e),i=$(".copyto-sb",e),j=$(".is-send-sms",e),k="",l=i.data("sb"),m=l.getSelectedData(),n=m.p||[];return _.each(n,function(a){k+="@"+h.getContactDataById(a,"p").name+" "}),a.feedID=d.feedID,a.replyContent=_.str.trim(f.val())+" "+k,a.operationType=4,a.isSendSms=j.prop("checked"),a.rate=g.val(),a.atEmployeeIDs=m.p||[],a},clearForm:function(){var a=this.element,b=$(".copyto-sb",a),c=$(".swr-done-input",a),d=$(".is-send-sms",a),e=b.data("sb");e.removeAllItem(),c.val(""),d.prop("checked",!1)},_submit:function(a){var b=this,c=this.getRequestData(),d=this.get("itemV"),e=d.$el,f=e.data("fsReply"),g=this.element,i=new RegExp("^\\s*$"),j=$(".swr-done-input",g),k=j.val();k=_.str.trim(k),i.test(k)&&j.val(""),this.isValid()&&(j.val().length>2e3?h.alert("请控制输入在2000字内"):Q(j)&&h.api({type:"post",data:c,url:"/FeedWork/AssignerSendFeedWorkReply",success:function(a){a.success&&(b.hide(),b.clearForm(),f.addNewReply(a.value),d.updateModel(function(){$(".aj-Reply",e).click()}),b.get("successCb").call(b,a,c))}})),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()},destroy:function(){var a;return this.media&&this.media.destroy(),this.media=null,this.atInput&&this.atInput.destroy(),this.atInput=null,a=k.superclass.destroy.apply(this,arguments)}}),ub=new tb;c=k.extend({attrs:{width:675,itemV:null,content:A.filter(".swr-cancel-tpl").html(),className:"common-style-richard feed-swr-cancel-dialog",successCb:function(a,b){var c=this.get("itemV"),d=c.options;d.delegateOtherCb&&d.delegateOtherCb.call(c,a,b)}},events:{"click .sms-warn-radio input":"_smsWarnCounts","click .f-sub":"_submit","click .f-cancel":"_cancel"},_smsWarnCounts:function(a){var b=this.element,c=$(a.currentTarget).val(),d=$(".sms-warn-item",b),e=0;switch(parseInt(c)){case 1:d.hide(),e=0;break;case 2:d.hide(),d.eq(0).show(),e=1;break;case 3:d.show(),d.eq(2).hide(),e=2;break;case 4:d.show(),e=3}this.smsWarnCountsVal=e},show:function(){var a=c.superclass.show.apply(this,arguments),b=this.element,d=$(".swr-cancel-input",b);$(".sms-warn-radio",b);var e=this.get("itemV"),f=e.model,g=f.get("originData"),h=g.feedContent,i="";return _.each(h,function(a){i+=a.text}),d.val(i),this._renderCopyto(),this._renderWorkto(),a},hide:function(){var a=c.superclass.hide.apply(this,arguments);return this.clearForm(),a},render:function(){var a=c.superclass.render.apply(this,arguments);return this._renderMedia(),this._renderCpt(),this._renderSmsDataTime(),a},_renderCpt:function(){var a=this.element,b=$(".swr-cancel-input",a),c=$(".setother-selectdata",a),d=$(".setother-selecttime",a),e=new G({element:c,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),f=new F({element:d,placeholder:"选择时间"}),g=new C({element:b,withAt:!0});e.on("change",function(){""==f.getValue()&&f.selector.select(0)}),this.setotherSelectData=e,this.setotherSelectTime=f,this.atInput=g},_renderSmsDataTime:function(){var a=this.element,b=$(".sms-one-selectdata",a),c=$(".sms-one-selecttime",a),d=$(".sms-two-selectdata",a),e=$(".sms-two-selecttime",a),f=$(".sms-three-selectdata",a),g=$(".sms-three-selecttime",a),h=new G({element:b,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),i=new F({element:c,placeholder:"选择时间"}),j=new G({element:d,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),k=new F({element:e,placeholder:"选择时间"}),l=new G({element:f,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),m=new F({element:g,placeholder:"选择时间"});h.on("change",function(){""==i.getValue()&&i.selector.select(0)}),j.on("change",function(){""==k.getValue()&&k.selector.select(0)}),l.on("change",function(){""==m.getValue()&&m.selector.select(0)}),this.smsOneData=h,this.smsOneTime=i,this.smsTwoData=j,this.smsTwoTime=k,this.smsThreeData=l,this.smsThreeTime=m},_renderMedia:function(){var a=this.element,b=$(".swr-cancel-input-media",a),c=$(".swr-cancel-input",a);new B({element:b,action:["at","topic"],actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:H.p},{title:"部门",type:"g",list:H.g}]}},topic:{inputSelector:c}}})},_renderCopyto:function(){var a=this.element,b=$(".copyto-sb",a),c=this.get("itemV"),d=c.model,e=d.get("originData"),f=e.feedRangeEntities,g={id:e.work.executer.employeeID,name:"sb",type:"p"},i=new D({element:b,data:[{title:"同事",type:"p",list:H.p},{title:"部门",type:"g",list:H.g}],title:"选择发送范围",singleCked:!1,acInitData:h.getPublishRange("work"),autoCompleteTitle:"请输入部门或同事的姓名或拼音"});b.data("sb",i),_.each(f,function(a){var b=a.isCircle;b=b?"g":"p",g={id:a.dataID,name:a.name,type:b},i.addItem(g)})},_renderWorkto:function(){var a=this.element,b=$(".workto-sb",a),c=this.get("itemV"),d=c.model,e=d.get("originData"),f={id:e.work.executer.employeeID,name:e.work.executer.name,type:"p"},g=I.employeeID,i=h.excludeContactData([g],"p"),j=new D({element:b,data:[{title:"同事",type:"p",list:i}],title:"选择指令执行人（一个）",acInitData:h.getPublishDefaultUser("workExecuters"),singleCked:!0,autoCompleteTitle:"请输入姓名或拼音"});b.data("sb",j),j.addItem(f)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".swr-cancel-input-wrapper",c),e=$(".setother-selectdata input",c),f=$(".swr-cancel-input",c),g=$(".sms-one-selectdata input",c),i=$(".sms-two-selectdata input",c),j=$(".sms-three-selectdata input",c);return 0==b.replyContent.length&&(h.showInputError(d),h.showInputError(f),a=!1),b.deadline||(h.showInputError(e),a=!1),1==this.smsWarnCountsVal&&""==g.val()&&(h.showInputError(g),a=!1),2==this.smsWarnCountsVal&&(""==g.val()&&(h.showInputError(g),a=!1),""==i.val()&&(h.showInputError(i),a=!1)),3==this.smsWarnCountsVal&&(""==g.val()&&(h.showInputError(g),a=!1),""==i.val()&&(h.showInputError(i),a=!1),""==j.val()&&(h.showInputError(j),a=!1)),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".swr-cancel-input",e),g=$(".sms-warn-radio",e),h=$("input:checked",g).val(),i=($(".rate",e),$(".workto-sb",e)),j=$(".copyto-sb",e),k=$(".is-send-sms",e),m=j.data("sb"),n=m.getSelectedData(),o=i.data("sb"),p=o.getSelectedData(),q=this.setotherSelectData.getValue(),r=this.setotherSelectTime.getValue(),s=this.smsOneData.getValue(),t=this.smsOneTime.getValue(),u=this.smsTwoData.getValue(),v=this.smsTwoTime.getValue(),w=this.smsThreeData.getValue(),x=this.smsThreeTime.getValue(),y=[],z={value:1,value1:l(s+" "+t,"YYYYMMDD HH:mm").unix()},A={value:2,value1:l(u+" "+v,"YYYYMMDD HH:mm").unix()},B={value:3,value1:l(w+" "+x,"YYYYMMDD HH:mm").unix()};return s||(z={}),u||(A={}),w||(B={}),y.push(z,A,B),a.feedID=d.feedID,a.replyContent="取消该指令",a.feedContent=_.str.trim(f.val()),a.circleIDs=n.g||[],a.employeeIDs=n.p||[],a.assignerID=d.sender.employeeID,a.executerID=parseInt(p.p)||[],a.deadline=q.length>0?l(q+" "+r,"YYYYMMDD HH:mm").unix():"",a.smsRemindType=parseInt(h),a.smsRemindTimes=y,a.isSendSms=k.prop("checked"),a},clearForm:function(){var a=this.element,b=$(".swr-cancel-input",a),c=$(".sms-warn-radio input:radio",a),d=$(".sms-warn-item",a),e=$(".setother-selectdata input",a),f=$(".setother-selecttime input",a),g=$(".is-send-sms",a);b.val(""),e.val(""),f.val(""),g.prop("checked",!1),c.prop("checked",!1).eq(0).prop("checked",!0),d.hide(),d.find("input").val("")},_submit:function(a){var b=this,c=this.getRequestData(),d=this.get("itemV");d.$el;var e=this.isValid(),f=this.element,g=$(".swr-cancel-input",f);e&&(g.val().length>2e3?h.alert("请控制输入在2000字内"):h.api({type:"post",data:c,url:"/FeedWork/ChangeOtherSendFeedWork",success:function(a){a.success&&(b.hide(),b.clearForm(),d.updateModel(),b.get("successCb").call(b,a,c))}})),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()}});var vb=new c,wb=k.extend({attrs:{itemV:null,content:A.filter(".rwr-normal-tpl").html(),className:"common-style-richard feed-rwr-normal-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=k.superclass.render.apply(this,arguments);return this._initAtInput(),this._renderMedia(),a},_initAtInput:function(){var a=this.element,b=$(".rwr-normal-input",a);new C({element:b}),b.val("").trigger("autosize.resize")},_renderMedia:function(){var a=this.element,b=$(".media",a),c=$(".rwr-normal-input",a),d=new B({element:b,limitUploadSingle:!0,action:["h5imgupload","h5attachupload","at"],actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:H.p},{title:"部门",type:"g",list:H.g}]}},h5imgupload:{limitUploadSingle:!1}}});b.data("media",d)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".rwr-normal-input",c);return 0==b.replyContent.length&&(h.showInputError(d.closest(".rwr-normal-input-wrapper")),a=!1),b.replyContent.length>2e3&&(h.alert("请控制输入在2000字内"),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".rwr-normal-input",e),g=$(".media",e),h=$(".is-send-sms",e),i=g.data("media");a.feedID=d.feedID,a.replyToReplyID=0,a.replyToEmployeeID=0,a.replyContent=_.str.trim(f.val()),a.fileInfos=[];var j=i.getUploadValue();return _.each(j,function(b){"img"==b.uploadType?a.fileInfos.push({value:2,value1:b.pathName,value2:b.size,value3:b.name}):"attach"==b.uploadType&&a.fileInfos.push({value:3,value1:b.pathName,value2:b.size,value3:b.name})}),a.isSendSms=h.prop("checked"),a},clearForm:function(){var a=this.element,b=$(".rwr-normal-input",a),c=$(".is-send-sms",a),d=$(".media",a),e=d.data("media");b.val("").trigger("autosize.resize"),c.prop("checked",!1),e.resetAll(),e.enableAction("h5imgupload"),e.enableAction("h5attachupload")},_submit:function(a){var b,c=this,d=this.element,e=$(".media",d),f=e.data("media"),g=$(a.currentTarget),i=this.get("itemV"),j=i.$el,k=j.data("fsReply");this.isValid()&&f.send(function(a){b=c.getRequestData(),h.api({type:"post",data:b,url:"/Feed/SendFeedReply",success:function(d){d.success&&(c.hide(),k.addNewReply(d.value),c.get("successCb").call(c,d,b),c.clearForm()),a()
}},{submitSelector:g})},d),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()},show:function(){var a,b=this.get("itemV"),c=b.model;return a=wb.superclass.show.apply(this,arguments),$(".user-name",this.element).text(c.get("originData").sender.name),a}}),xb=new wb,yb=k.extend({attrs:{itemV:null,content:A.filter(".rwr-complete-tpl").html(),className:"common-style-richard feed-rwr-complete-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=k.superclass.render.apply(this,arguments);return this._initAtInput(),this._renderMedia(),a},_initAtInput:function(){var a=this.element,b=$(".rwr-complete-input",a);new C({element:b})},_renderMedia:function(){var a=this.element,b=$(".media",a),c=$(".rwr-complete-input",a),d=new B({element:b,action:["h5imgupload","h5attachupload","at"],actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:H.p},{title:"部门",type:"g",list:H.g}]}}}});b.data("media",d)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".rwr-complete-input",c);return 0==b.replyContent.length&&(h.showInputError(d.closest(".rwr-complete-input-wrapper")),a=!1),b.replyContent.length>2e3&&(h.alert("请控制输入在2000字内"),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".rwr-complete-input",e),g=$(".media",e),h=$(".is-send-sms",e),i=g.data("media");a.feedID=d.feedID,a.replyContent=_.str.trim(f.val()),a.operationType=1;var j=i.getUploadValue();return a.fileInfos=[],_.each(j,function(b){"img"==b.uploadType?a.fileInfos.push({value:2,value1:b.pathName,value2:b.size,value3:b.name}):"attach"==b.uploadType&&a.fileInfos.push({value:3,value1:b.pathName,value2:b.size,value3:b.name})}),a.isSendSms=h.prop("checked"),a},clearForm:function(){var a=this.element,b=$(".rwr-complete-input",a),c=$(".is-send-sms",a),d=$(".media",a),e=d.data("media");b.val("").trigger("autosize.resize"),c.prop("checked",!1),e.resetAll()},_submit:function(a){var b,c=this,d=this.element,e=$(".media",d),f=$(a.currentTarget),g=e.data("media"),i=this.get("itemV"),j=i.$el;j.data("fsReply"),$(".con",j),this.isValid()&&g.send(function(a){b=c.getRequestData(),h.api({type:"post",data:b,url:"/FeedWork/ExecuterSendFeedWorkReply",success:function(b){b.success&&(i.updateModel(),c.hide(),c.clearForm()),a()}},{submitSelector:f})},d),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()}}),zb=new yb,Ab=k.extend({attrs:{width:787,height:600,itemV:null,content:A.filter(".print-preview-tpl").html(),className:"common-style-richard feed-print-preview-dialog",successCb:e.EMPTY_FN,zIndex:1e4},events:{"click .f-sub":"_print","click .f-cancel":"_cancel"},render:function(){var a=Ab.superclass.render.apply(this,arguments);return a},_initIframe:function(){var a,b=this.element,c=$(".ui-dialog-body",b),d=$(".preview-mask",c),e=this.get("itemV"),f=e.model;return a=$('<iframe frameborder="0" scrolling="no" src="'+R+f.get("feedID")+'/isprint-1" class="preview-ifr" width="787" height="500" />'),a.appendTo(c),a.get(0).contentWindow.printModelCb=function(){d.hide()},a},show:function(){var a=Ab.superclass.show.apply(this,arguments),b=this.element,c=$(".ui-dialog-body",b),d=$(".preview-mask",c),e=$(".preview-ifr",b),f=this.get("itemV"),g=f.model;return 0==e.length?this._initIframe():e.attr("src",R+g.get("feedID")+"/isprint-1"),d.show(),a},hide:function(){var a=Ab.superclass.hide.apply(this,arguments),b=this.element,c=($(".ui-dialog-body",b),$(".preview-ifr",b));return c.length>0&&c.attr("src",R+0+"/isprint-1"),a},_print:function(){var a=this.element,b=$(".preview-ifr",a);b.get(0).contentWindow.focus(),b.get(0).contentWindow.print()},_cancel:function(){this.hide()}}),Bb=new Ab,Cb=k.extend({attrs:{width:420,hasMask:!1,content:A.filter(".feedlocationfn-equipment-tpl").html(),className:"common-style-richard feedlocationfn-equipment-dialog"},events:{click:"_stopBubbling","click .equipment-tit-account":"_tabAccount","click .equipment-tit-equipment":"_tabEquipment","change .equipment-select-btn":"_pageSelect","click .equipment-btn-l":"_pageBtnLeft","click .equipment-btn-r":"_pageBtnRight"},render:function(){var a=this,b=Cb.superclass.render.apply(this,arguments);return h.regGlobalClick(this.element,function(){a.hide()}),b},hide:function(){var a=Ab.superclass.hide.apply(this,arguments),b=this.element;return $(".equipment-tit-equipment",b).removeClass("cur"),$(".equipment-tit-account",b).addClass("cur"),$(".equipment-listwarp",b).html(""),a},_stopBubbling:function(a){a.stopPropagation()},_pageBtnLeft:function(a){var b=$(a.currentTarget),c=$(".equipment-pagewarp",this.element),d=c.attr("type"),e=c.attr("pagenumber");return b.is(".disable")?!1:(e--,1==d?this._accountAjax(e):this._equipmentAjax(e),void 0)},_pageBtnRight:function(a){var b=$(a.currentTarget),c=$(".equipment-pagewarp",this.element),d=c.attr("type"),e=c.attr("pagenumber");return b.is(".disable")?!1:(e++,1==d?this._accountAjax(e):this._equipmentAjax(e),void 0)},_pageSelect:function(a){var b=$(a.currentTarget),c=b.val(),d=$(".equipment-pagewarp",this.element),e=d.attr("type");1==e?this._accountAjax(c):this._equipmentAjax(c)},_tabAccount:function(a){var b=$(a.currentTarget),c=$(".equipment-titwarp",this.element);$("a",c).removeClass("cur"),b.addClass("cur"),this._accountAjax(1)},_tabEquipment:function(a){var b=$(a.currentTarget),c=$(".equipment-titwarp",this.element);$("a",c).removeClass("cur"),b.addClass("cur"),this._equipmentAjax(1)},_createItem:function(a,b){var c=a.country,d=a.province,e=a.city,f=a.district,g=a.street,i=a.streetNumber,j=c+d+e+f+g+i,k=a.employee.name,m=h.getAvatarLink(a.employee.profileImage,"3"),n=a.token,o="设备号："+n+" ";1==b&&(o="");var p=l.unix(a.createTime),q=l.unix(this.serviceTime),r=h.getDateSummaryDesc(p,q,1),s='<div class="equipment-listitem fn-clear"> <div class="equipment-listitem-l"> <img src="'+m+'" alt="" class="equipment-listitem-l-img"></div> <div class="equipment-listitem-r"> <div class="equipment-listitem-r-top">'+k+"："+j+'</div> <div class="equipment-listitem-r-bottom">'+o+r+"</div> </div> </div>";return $(s)},_accountAjax:function(a){var b=this,c=this.itemV,d=c.model,e=d.get("originData"),f=e.employeeID,g=this.element,i=$(".equipment-topinfo",g),j=$(".employee-name-info",g),k=$(".equipment-listwarp",g),l=$(".equipment-select-btn",g),m=$(".equipment-pagewarp",g),n=$(".equipment-btn-l",m),o=$(".equipment-btn-r",m);this.serviceTime=e.serviceTime,m.attr("type","1"),h.api({url:"/Location/GetLocationInfosInOneEmployee",type:"get",dataType:"json",data:{employeeID:f,pageSize:10,pageNumber:a},success:function(a){var c,d=a.value,e=d.tokenCount,f=d.locationTokens,g=d.totalCount,h=d.pageNumber,p=parseInt(g/10),q="";if(p>0)for(var r=1;p>=r;r++)q+='<option value ="'+r+'">第'+r+"页</option>";else q='<option value ="1">第1页</option>';l.html(q),l.val(h),c=f.length>0?f[0].employee.name:"",a.success&&(i.html('<span class="ml10">该帐号共使用<b class="red">'+e+"</b>个设备进行过签到（最近30次）</span>"),j.text("帐号："+c),k.empty(),_.each(f,function(a){var c=b._createItem(a,0);c.appendTo(k)}),m.attr("pagenumber",h),1>=h?n.addClass("disable"):n.removeClass("disable"),h>=p?o.addClass("disable"):o.removeClass("disable"))}})},_equipmentAjax:function(a){var b=this,c=this.element,d=this.itemV,e=d.model,f=e.get("originData"),g=f.feedID,i=$(".equipment-topinfo",c);$(".topinfo-cont",i);var j=$(".employee-name-info",c),k=$(".equipment-listwarp",c),l=$(".equipment-select-btn",c),m=$(".equipment-pagewarp",c),n=$(".equipment-btn-l",m),o=$(".equipment-btn-r",m);m.attr("type","2"),h.api({url:"/Location/GetLocationInfosInOneToken",type:"get",dataType:"json",data:{feedID:g,pageSize:10,pageNumber:a},success:function(a){if(a.success){var c=a.value;c.tokenCount;var d=c.locationTokens,e=c.employeeCount,f=c.token,g=c.totalCount,h=c.pageNumber,p=parseInt(g/10),q="",r="";if(e>1&&(q="，可能异常"),p>0)for(var s=1;p>=s;s++)r+='<option value ="'+s+'">第'+s+"页</option>";else r='<option value ="1">第1页</option>';l.html(r),l.val(h),e>1&&(e='<b class="red">'+e+"</b>"),a.success&&(j.text("设备ID："+f),i.html('<span class="ml10">共'+e+"人通过该设备进行了签到（最近30次）"+q+"</span>"),k.empty(),_.each(d,function(a){var c=b._createItem(a,1);c.appendTo(k)}),m.attr("pagenumber",h),1>=h?n.addClass("disable"):n.removeClass("disable"),h>=p?o.addClass("disable"):o.removeClass("disable"))}}})},show:function(){var a=Cb.superclass.show.apply(this,arguments),b=this.element,c=$(".equipment-arrow",b),d=this.up;return d?c.addClass("up"):c.removeClass("up"),this._accountAjax(1),a},_cancel:function(){this.hide()}}),Db=new Cb,Eb=_.template(A.filter(".feed-list-share").html()),Fb=_.template(A.filter(".feed-list-crm").html()),Gb=_.template(A.filter(".feed-list-schedule").html()),Hb=_.template(A.filter(".feed-list-schedule-tip").html()),Ib=_.template(A.filter(".feed-list-voteitem").html()),Jb=_.template(A.filter(".feed-list-announce").html()),Kb=_.template(A.filter(".feed-list-announce-page").html()),Lb=_.template(A.filter(".feed-list-plan").html()),Mb=_.template(A.filter(".feed-list-worknotice").html()),Nb=_.template(A.filter(".feed-list-work").html()),Ob=_.template(A.filter(".feed-list-approve").html()),Pb=_.template(A.filter(".feed-list-approve-print").html()),Qb=_.template(A.filter(".feed-list-myremind").html()),Rb=Backbone.View.extend({tagName:"div",className:"list-item fn-clear card-border-rad",events:{"click .aj-myremind-delete":"delRemindFeed","click .crm-contactslist-item-btn":"showContactsDialog","mouseenter .work-notice-status-btn":"enterWorkNotice","mouseleave .work-notice-status-btn":"leaveWorkNotice","click .aj-confirmworknotice-btn":"confirmWorkNotice","click .istimeshow":"istimeshow","mouseenter .islike":"enterIsLike","mouseleave .islike":"leaveIsLike","click .aj-commenton":"commen","click .aj-commenton-btn":"commenbtn","click .item-func .more":"funcmore","click .item-func .feed-remind-btn":"funcFeedRemind","click .item-func .feed-remind-btn .feed-remind-btn-item":"funcFeedRemindItem","click .feed-content-visible-h":"fcVisibleH","click .feed-topreply-content-visible-h":"fctrVisibleH","click .ar-modfiy":"modfiypof","click .aj-pending":"ped","click .aj-delete":"showDel","click .aj-schedule-delete":"showScheduleDelBtn","click .submit-cancelschedule":"submitcancelschedule","click .cancelmenu-box .f-cancel":"cancel","click .aj-unplaceonfile":"showunpof","click .aj-open-vote-btn":"openvotebtn","click .aj-close-vote-btn":"closevotebtn","click .aj-sendvote-btn":"sendvotebtn","click .aj-seevote-btn":"seevotebtn","click .aj-backvote-btn":"backvotebtn","click .aj-seemore-info-btn":"seemoreinfobtn","click .group":"groupbtn","click .schedulesgroup":"groupbtn","click .msmremaindcount":"msmremaindcount","click .receiptalertlist":"receiptalertlist","click .aj-receipt-fn":"sendReceiptAJAX","click .item-media .feed-img-item":"_previewImg","click .item-media .feed-attach .attach-preview-l":"_previewAttach","click .item-media .feed-attach .attach-play-l":"_playAttach","click .printer":"_printFeed","click .feed-location-fn-map,.googlemap-jpg":"_showFeedLocation","click .aj-feed-fn-com-btn":"feedFnComBtns"},delRemindFeed:function(a){var b=$(a.currentTarget),c=b.closest(".fs-feed-item");h.confirm("确定要删除此条提醒吗？","删除确认",function(){h.api({url:"/TimingMessage/DeleteTimingMessageRemaind",type:"post",dataType:"json",data:{timingMessageRemaindIDs:b.data("listid")},success:function(a){a.success&&(h.remind(2,"删除成功"),c.slideUp(300))}})})},enterWorkNotice:function(a){var b=$(a.currentTarget),c=b.find(".work-notice-status-tip");$(".work-notice-status-tip").hide(),c.show(),$(".reply-input").blur(),clearTimeout(this.likeTimer)},leaveWorkNotice:function(a){var b=$(a.currentTarget),c=b.find(".work-notice-status-tip");this.likeTimer=setTimeout(function(){c.hide()},200)},confirmWorkNotice:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".item-face",d).attr("feedid");this.options;var f=this.model.get("originData");f.receipt,h.api({url:"/FeedWorkNotice/ConfirmWorkNotice",type:"post",dataType:"json",data:{feedID:e},success:function(a){a.success&&b.updateModel()}})},funcFeedRemindItem:function(a){var b=$(a.currentTarget),c=b.data("value"),d=this,f=d.model;this.element;var j,k,l=f.get("originData"),m=l.feedContent,n="",o="",p="",q=l.plan||null;_.each(m,function(a){n+=a.text}),q?(j=q.reportContent||"",k=q.planContent||"",_.each(j,function(a){o+=a.text}),_.each(k,function(a){p+=a.text}),n=o+" "+p+" "+n):(n=n.replace(/<br\/>/g," "),n=n.replace(/\n+/g," "));var r=i.cutStrForNum(n,199).toString(),s={employeeID:l.employeeID,employeeName:l.sender.name,feedID:l.feedID,msgType:h.getRemindType(l.feedType),content:r,feedTypeName:h.getFeedTypeName(l.feedType)};998==c?O.show(s):h.api({url:"/TimingMessage/AddTimingMessageRemaind",type:"post",dataType:"json",data:{remindType:1==c?2:3==c?3:4,remindTime:0,message:s.content,subType:s.msgType,dataID:s.feedID,employeeIDs:e.util.getCurrentEmp().id+""},success:function(a){if(a.success){h.remind(2,"提醒设置成功。");var b=$(".feed-remind-wrapper");b[0]&&$(".remind-count-num",b).html(a.value.timingMessageRemaindOfToday),g.trigger("addremindsuccess")}}})},funcFeedRemind:function(a){var b=$(a.currentTarget),c=b.closest(".handle"),d=$(".remind-more-menu",c);return d.is(":visible")?d.hide():($(".handle .more-menu").hide(),d.show()),$(".more-menu").hide(),$(".fs-tip").hide(),!1},showContactsDialog:function(a){var b=$(a.currentTarget),c=b.data("id");S.show({contactID:c})},feedFnComBtns:function(a){var b,c,d=$(a.currentTarget),e=d.closest(".fs-list-item"),f=this;if(d.is(".aj-Reply")&&this.reply(a),d.is(".replies-btn")&&this.keyReply(a),d.is(".aj-cc")&&this.cc(a),d.is(".aj-cc-add")){if(e=d.closest(".reply-cc"),b=$(".aj-selectccer .input-tip",e),c=$(".fs-contact-bar-list",e),!c.html())return b.click(),!1;this.ccadd(a)}if(d.is(".undone-btn")&&this._showSwrUndoneDialog(a),d.is(".done-btn")&&this._showSwrDoneDialog(a),d.is(".cancel-btn")&&this._showSwrCancelDialog(a),d.is(".normal-btn")&&this._showRwrNormalDialog(a),d.is(".complete-btn")&&this._showRwrCompleteDialog(a),d.is(".aj-approbtn")&&($(".detail-islike-list-warp",this.$el).hide(),$(".islike-btn",f.$el).removeClass("fl-common-up-arrow"),this.approbtn(a)),d.is(".aj-appr-history")&&this._showApproveHisDialog(a),d.is(".aj-modifyapproval")&&this.modifyapprer(a),d.is(".aj-modifyapprer")){if(e=d.closest(".reply-modifyapprer"),b=$(".aj-selectapprer .input-tip",e),c=$(".fs-contact-bar-list",e),!c.html())return b.click(),!1;this.sendmodifyapprer(a)}return d.is(".islike-btn")&&this.sendIsLike(a),d.is(".feed-location-fn-equipment")?(this.feedLocationFnEquipment(a),!1):(d.is(".feedlist-open-ecrypt")&&this.openEcrypt(a),d.is(".print-del-pic-ico")&&this.printdelpic(a),d.is(".aj-attention")&&this.att(a),d.is(".aj-placeonfile")&&this.pof(a),d.is(".unpof-bt")&&this.unpofbt(a),d.is(".aj-unattention")&&this.showunatt(a),d.is(".aj-forward")&&this.fwd(),void 0)},printdelpic:function(a){var b=$(a.currentTarget),c=b.closest(".print-img-warp");c.hide()},openEcrypt:function(a){var b=$(a.currentTarget),c=this.model,d=c.get("originData"),e=b.closest(".list-item"),f=$(".contnet-isencrypted",e),g=$(".isencrypted-tit",f).text(),h=$(".info-all-contnet",e),i=$(".printer",e),j='<div class="info-all-contnet-unlocktit"><img src="../../html/fs/assets/images/lock_open.png" alt=""/>'+g+"</div>",k=$(".item-face",e).attr("feedid"),l=this.feedReply;m.showFeedPwdValid(function(a){a.success&&(f.hide(),h.before(j),h.show(),i.show(),(2==d.feedType||3==d.feedType||4==d.feedType)&&d.replies.length>0&&(l&&l.show(),l.switchReplyState("important",!0)))},function(){},{feedID:k})},_showFeedLocation:function(a){var b=this.model,c=b.get("feedLocation");N.fixLocation(c),a.preventDefault()},renderFeedAudio:function(){var a,b,c=this.$el,d=this.model,e=d.get("originData"),f=e.audio,g=$(".audio-btn",c);f&&(a=f.attachPath,a=h.getFileNamePath(a)+".mp3",a=h.getDfLink(a,f.attachName,!1),b=f.attachSize,this.audioPlayer=new u({element:g,audioSrc:a,length:b,themeStyle:4}),this.compStore.push(this.audioPlayer))},feedLocationFnEquipment:function(a){var b=$(a.currentTarget);Db.itemV=this,Db.up=!1;var c=b.offset().top,d=$(document).scrollTop(),e=275,f=280;return e>c-d&&(f=-30,Db.up=!0),Db.set("align",{selfXY:[320,f],baseElement:b,baseXY:[0,0]}),Db.show(),!1},sendReceiptAJAX:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".item-face",d).attr("feedid"),f=this.options,g=this.model.get("originData"),i=g.receipt;h.api({url:"/FeedExtend/SendReceipt",type:"post",dataType:"json",data:{feedID:e},success:function(a){a.success&&(c.text("已回执"),c.addClass("disable"),b._updateReceiptData(i.receiptedCount+1),f.receiptCb&&f.receiptCb.call(b,a,{feedID:e}))}})},istimeshow:function(){var a=this.$el,b=this,c=$(".istimeshow",a),d=this.model,e=d.get("feedID"),f=c.text();"显示"==f?U.show():h.api({url:"/FeedAnnounce/SetAnnounceIsShow ",type:"post",data:{feedID:e,isShow:!1,showtimeDataType:0,time:0},dataType:"json",success:function(a){a.success&&b.updateModel()}}),U.itemV=this},leaveIsLike:function(){var a=this.$el,b=function(){$(".islike-tip",a).hide()};this.likeTimer=setTimeout(b,200)},enterIsLike:function(a){var b=$(a.currentTarget),c=this.$el,d=$(".islike-tip",b),e=this.options.likeStyle,f=$(".islike",c),g=$(".islike-more",f),h=this.model,i=h.get("originData");if(i.feedID,2!=e){var j=$(".js-empids",f);j.length>5?(j.show().eq(3).nextAll().hide(),g.show()):(g.hide(),j.show()),d.show(),clearTimeout(this.likeTimer)}},sendIsLike:function(a){var b=$(a.currentTarget),c=this,d=this.model,e=this.$el,f=this.options.likeStyle,g=$(".islike",e),i=$(".islike-tip",g);$(".js-empids",g);var j=$(".islike-btn",g);$(".likecount",g);var k=$(".likecountnum",g);$(".islike-more",g),k.text()||0;var l=d.get("originData"),m=l.feedID,n=!0,o=g.is(".cur");I.employeeID,I.name,I.profileImage,o?(n=!1,g.removeClass("cur"),j.attr("title","赞")):(n=!0,g.addClass("cur"),j.attr("title","取消赞")),h.api({url:"/FeedExtend/SetFeedLike",type:"post",data:{feedID:m,isLike:n},dataType:"json",success:function(d){d.success&&(2==f?($(".fs-list-item .item-func a",e).removeClass("fl-common-up-arrow"),b.addClass("fl-common-up-arrow"),c.islikelistbtn(a)):c.renderIslikeList(b,i))}})},renderIslikeList:function(a,b){var c=this.$el,d=b,e=this.model,f=e.get("originData"),g=f.feedID,i=$(".islike",c),j=$(".likecount",c);h.api({url:"/FeedExtend/GetFeedLikersOfFeedID",type:"get",data:{feedID:g,pageSize:99999,pageNumber:1},dataType:"json",success:function(a){var b=a.value.likers,e=b.length,f="",k="";if(a.success)if(e>0){var l;_.each(b,function(a){var b=a.name,c=h.getAvatarLink(a.profileImage,2),d=a.employeeID;k+='<a href="#profile/=/empid-'+d+'" title="'+b+'" class="js-empids"><img alt="'+b+'" src="'+c+'"></a>'}),j.html('<span class="likecountnum">('+a.value.totalCount+")</span>").show(),b.length>5?(f='<a href="#stream/showfeed/=/id-'+g+'/open-like" title="更多" class="islike-more"></a>',l=200):(f='<a href="#stream/showfeed/=/id-'+g+'/open-like" title="更多" class="islike-more hide"></a>',l=40*b.length),i.children().is(".islike-tip")?($(".islike-tip",c).html('<div class="toparrow"> <em>◆</em> <span>◆</span> </div>'+k+f),$(".islike-tip",c).width(l)):i.append('<div class="islike-tip" style="display:block;width: '+l+'px"><div class="toparrow"> <em>◆</em> <span>◆</span> </div>'+k+f+"</div>");var m=$(".islike-more",i),n=$(".js-empids",i);n.length>5?(n.show().eq(3).nextAll().hide(),m.show()):(m.hide(),n.show()),d.show()}else j.html("").hide(),d.remove()}})},islikelistbtn:function(){var a=this.$el,b=this.model,c=b.get("originData"),d=c.feedID,e=$(".replay-section",a),f=$(".detail-islike-list-warp",a),g=$(".likecount",a),i=$(".feed-reply",a),j="",k="";i.hide(),h.api({url:"/FeedExtend/GetFeedLikersOfFeedID",type:"get",data:{feedID:d,pageSize:99999,pageNumber:1},dataType:"json",success:function(b){var c=b.value.likers,d=c.length;d>0?(_.each(c,function(a){var b=a.name,c=h.getAvatarLink(a.profileImage,2),d=a.employeeID;k+='<a href="#profile/=/empid-'+d+'" class="js-empids" title="'+b+'"><img alt="'+b+'" src="'+c+'"></a>'}),j='<div class="list-repeat"><div class="feedlike-list fn-clear">'+k+"</div></div>",g.html('<span class="likecountnum">('+b.value.totalCount+")</span>")):(j='<div class="list-repeat"><div style="display: block;" class="list-empty-tip"><img class="icon-empty" alt="loading" src="../../html/fs/assets/images/clear.gif">&nbsp;&nbsp;<span class="empty-text">该信息没有被赞过</span></div></div>',g.html("")),f.html(j).show(),$(".islike-btn",a).addClass("fl-common-up-arrow"),e.hide(),$(".reply-commen",e).hide()}})},_printFeed:function(a){Bb.set("itemV",this),Bb.show(),a.preventDefault()},receiptalertlist:function(a){var b=this.$el,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".item-face",d).attr("feedid"),f=this.model,g=f.get("originData"),i=g.serviceTime;$(".more-menu",d).hide();var j=$(".fs-tip");return j.is(":visible")?j.hide():h.showTip({baseElement:c,afterShow:function(a){var c=this.element;c.html("正在努力的请求数据中……"),h.api({url:"/Feed/GetFeedReceiptRangesByFeedID",type:"get",data:{feedID:e},dataType:"json",success:function(d){if(d.success){var e=d.value,f=0,g="",j="",k="",m="",n=0,o="",p=0,q=e.length,r="";_.each(e,function(a){var b=a.employee;b&&(f=b.employeeID,g=b.name,j=h.getAvatarLink(a.employee.profileImage,"3"),k=a.isSendReceipt,n=a.receiptTime,m=a.source,n=l.unix(n),n=h.getDateSummaryDesc(n,l.unix(i),2),m=h.getSourceNameFromCode(m),k?(k="已回执",r="，"+n+"，通过"+m,p++):(k="未回执",r=""),o+='<div class="sms-isread-items fn-clear"> <a href="#profile/=/empid-'+f+'" class="profileimage"><img src="'+j+'" /></a> <a href="#profile/=/empid-'+f+'" class="name" style="min-width:60px;">'+g+'</a> <span class="isread-receipt">'+k+r+"</span></div>")}),b.find(".receiptalertlist").html("需"+q+"人回执，已回执"+p+"人"),o='<div class="sms-isread-tpl"><div class="sms-isread-warp">'+o+'</div><div class="sms-isread-countman">共<span class="num">'+e.length+"</span>人</div> </div>",c.html(o).show(),a()}}})}}),!1},msmremaindcount:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid");return h.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),h.api({url:"/Feed/GetFeedSMSRangesByFeedID",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",g="",i="",j="",k="";_.each(d,function(a){e=a.employee.employeeID,f=a.employee.name,g=h.getAvatarLink(a.employee.profileImage,"3"),i=a.infoType,j=a.source,i=i?"已读":"未读",j=h.getSourceNameFromCode(j),k+='<div class="sms-isread-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+g+'" alt="" ></a> <a href="#profile/=/empid-'+e+'" class="name">'+f+'</a> <span class="isread">'+i+"，通过"+j+"</span> </div>"}),k='<div class="sms-isread-tpl"><div class="sms-isread-warp">'+k+'</div><div class="sms-isread-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(k),a()}}})}}),!1},groupbtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid");return h.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),h.api({url:"/Account/GetHistoryFeedRangeEmployeeInfos",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e="";_.each(d,function(a){var b=a.employee.employeeID,c=a.employee.name,d=h.getAvatarLink(a.employee.profileImage,"2"),f=a.infoType;f=1==f?"新增":"",e+='<div class="share-group-items fn-clear"> <a href="#profile/=/empid-'+b+'" class="profileimage"><img src="'+d+'" alt="" ></a> <a href="#profile/=/empid-'+b+'" class="name">'+c+'</a> <span class="infotype">'+f+"</span> </div>"}),e='<div class="share-group-tpl"><div class="share-group-warp">'+e+'</div><div class="share-group-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(e),a()}}})}}),!1},schedulesgroupbtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid");return h.showTip({baseElement:b,afterShow:function(a){var b=this.element;h.api({url:"/Account/GetHistoryFeedRangeEmployeeInfos",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",g="",i="";_.each(d,function(a){e=a.employeeID,f=a.name,g=h.getAvatarLink(a.profileImage,"3"),i+='<div class="share-group-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+g+'" alt="" ></a> <a href="#profile/=/empid-'+e+'" class="name">'+f+"</a> </div>"}),i='<div class="share-group-tpl"><div class="share-group-warp">'+i+'</div><div class="share-group-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(i),a()}}})}}),!1},_previewImg:function(a){var b,c=this.model,d=c.get("originData"),e=this,f=[],g=$(a.currentTarget),h=g.closest(".img-num").index();$(".show-slide-up-tip-warp").hide(),b=d.pictures,this.isCrm?(_.each(b,function(a,b){f[b]={source:e.options.soure,refId:d.feedID||0,previewPath:a.attachPath+"2",originPath:a.attachPath+"1",thumbPath:a.attachPath+"3",createTime:a.createTime,fileName:a.attachName,fileSize:a.attachSize}}),J.preview({type:"img",data:f,refId:d.feedID,belongToType:"qx",activeIndex:h})):(_.each(b,function(a,b){f[b]={source:1,refId:d.feedID||0,previewPath:a.attachPath+"2",originPath:a.attachPath+"1",thumbPath:a.attachPath+"3",createTime:a.createTime,fileName:a.attachName,fileSize:a.attachSize}}),J.preview({type:"img",data:f,refId:d.feedID,belongToType:"feed",activeIndex:h}))},_previewAttach:function(a){var b,c,d=$(a.currentTarget),e=d.closest(".netdiskfile"),f=this.model,g=f.get("originData"),h=g.files,i=$(a.currentTarget),j=i.closest("dl"),k=j.attr("attachid");e.length>0?(b=g.feedNDFiles,c=_.find(b,function(a){return a.ndFileID==k})):c=_.find(h,function(a){return a.attachID==k}),L.readFile({fileId:c.attachID||c.ndFileID,fileName:c.attachName,filePath:c.attachPath}),a.preventDefault()},_playAttach:function(a){var b,c,d=$(a.currentTarget),f=d.closest(".netdiskfile"),g=this.model,i=g.get("originData"),j=i.files,k=$(a.currentTarget),l=k.closest("dl"),m=l.attr("attachid");f.length>0?(b=i.feedNDFiles,c=_.find(b,function(a){return a.ndFileID==m})):c=_.find(j,function(a){return a.attachID==m}),J.preview({type:"audio",data:[{previewPath:e.BLANK_IMG,originPath:c.attachPath,thumbPath:e.BLANK_IMG,createTime:c.createTime,fileName:c.attachName,fileSize:c.attachSize,fileId:c.attachID||c.ndFileID,employeeName:i.sender.name}],refId:i.feedID,belongToType:h.getAttachSourceName(c.source)}),a.preventDefault()},getVoteEls:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=b.closest(".item-vote"),e=$(".vote-main",d),f=$(".vote-inlet",d),g=$(".aj-cantsee-con",e),h=$(".aj-status-def",e),i=$(".aj-seevote-btn",e),j=$(".aj-status-vote",e),k=$(".downloadresult",d),l=$(".aj-status-result",e),m=$(".item-face",c).attr("feedid"),n=$(".tit",e),o=$(".seleinfo",e),p=$(".tit",f),q=$(".time",e),r=$(".selecter",e),s=$(".result-table",e),t=$(".status-table",e);return{defEl:h,cantseeEl:g,statusEl:j,resultEl:l,downloadresultEl:k,feedId:m,inletEl:f,seleinfoEl:o,timeEl:q,titleEl:n,mainEl:e,selecterEl:r,resultTableEl:s,statusTableEl:t,seevoteBtnEl:i,inletTitEl:p}},seemoreinfobtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=b.closest("tr"),e=$(".selertitle",d),f=e.attr("voteoptionid"),g=$(".item-face",c).attr("feedid");return h.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),h.api({url:"/FeedExtend/GetVoteEmployees",type:"get",data:{feedID:g,voteOptionID:f},dataType:"json",success:function(c){if(c.success){var d=c.value,e="";_.each(d,function(a){var b=a.employeeID,c=a.employee.name,d=h.getAvatarLink(a.employee.profileImage,"3"),f=a.voteTime;f=l.unix(f).format("MMMDD日 HH:mm"),e+='<div class="sms-isread-items fn-clear"> <a href="#profile/=/empid-'+b+'" class="profileimage"><img src="'+d+'" alt="" ></a> <a href="#profile/=/empid-'+b+'" class="name">'+c+'</a> <span class="isread">'+f+"</span> </div>"}),e='<div class="sms-isread-tpl"><div class="sms-isread-warp" style="width:220px">'+e+'</div><div class="sms-isread-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(e),a()}}})}}),!1},sendvotebtn:function(a){var b=this,c=this.getVoteEls(a),d=[],e=$("input:checked",c.selecterEl),f=this.$el,g=this.model,i=g.get("originData"),j=i.receipt;return e.each(function(a){d[a]=$(this).val()}),d.length>0?h.api({url:"/FeedExtend/SubmitVote",type:"post",data:{feedID:c.feedId,voteOptionIDs:d},success:function(a){a.success&&(j&&1==j.myReceiptStatus?h.api({url:"/FeedExtend/SendReceipt",type:"post",dataType:"json",data:{feedID:c.feedId},success:function(a){a.success&&b.updateModel(function(){$(".aj-open-vote-btn",f).click()})}}):b.updateModel(function(){$(".aj-open-vote-btn",f).click()}))}}):(W.rendered||W.render(),W.show(),$(".close-btn",W.element).click(function(){W.hide()})),!1},backvotebtn:function(a){var b=this.getVoteEls(a);b.statusEl.hide(),b.defEl.show(),b.resultEl.hide()},seevotebtn:function(a){var b=this.getVoteEls(a),c=b.mainEl.data("canViewResult");return b.defEl.hide(),b.timeEl.show(),c?(b.statusEl.show(),b.cantseeEl.hide()):(b.cantseeEl.show(),b.resultEl.hide()),!1},openvotebtn:function(a){var b=this.getVoteEls(a);h.api({url:"/Feedextend/GetVoteItemByID",type:"get",data:{feedID:b.feedId},success:function(a){var c=a.value;if(c){var d=c.title||"",e=c.canVote,f=c.canViewResult,g=c.voteCount,h="最多选择"+g+"项",j=Number(c.voteEmpCount),k=c.isAnoymouse,m=l.unix(c.deadline).format("MMMDD日 HH:mm:ss"),n=c.hVoteOptions,o=[" green"," red"," orange"," pink"," blue"],p="",q="",r="",s="checkbox",t="";b.mainEl.data("canViewResult",f)}t=j>0?j+"人已投票，":"",m=k?"提示：匿名投票，"+t+"截止时间"+m+"。":"提示："+t+"截止时间"+m+"。",1==g&&(s="radio");var u="";_.each(n,function(a,b){var d=a.optionTitle,e=a.voteOptionID,f="aj-seemore-info-btn",g=Number(a.selectedCount);u=c.isAnoymouse||0==g?"":'<div class="seemore"> <span><a href="javascript:void(0);" class="'+f+'">查看详情</a></span> <div class="seemore-info"></div> </div>',r=Math.round(100*(g/j)),0==g&&(r=0),b>o.length-1&&(b%=o.length),p+='<label> <input type="'+s+'" value="'+e+'" name="voteinput">'+d+"</label>",q+='<tr><td width="180"><span class="schedulebar'+o[b]+'"><span class="othervotebar aj-barwidth" style="width:'+r+'%"></span></span></td><td width="210"><span class="selertitle" voteoptionid="'+e+'">'+d+'</span></td><td width="100"><span class="num">'+g+"&nbsp;&nbsp;("+r+'%)</span></td> <td align="right" width="100">'+u+"</td> </tr>"}),a.success&&(b.titleEl.text(d),b.seleinfoEl.text(h),b.timeEl.text(m),b.selecterEl.html(p),b.resultTableEl.html(q),b.statusTableEl.html(q),b.mainEl.show(),b.inletEl.hide(),b.seevoteBtnEl.hide(),e?(b.statusEl.hide(),b.defEl.show(),b.resultEl.hide()):(b.statusEl.hide(),b.defEl.hide(),b.resultEl.show()),k&&b.downloadresultEl.hide(),f?b.seevoteBtnEl.show():(b.cantseeEl.show(),b.seevoteBtnEl.hide(),b.resultEl.hide(),b.timeEl.hide(),e&&b.cantseeEl.hide()),0==c.voteEmpCount&&b.seevoteBtnEl.hide(),i.checkboxIsoverstep(b.defEl,g,function(){V.rendered||(V.render(),$(".close-btn",V.element).click(function(){V.hide()})),V.voteCountNum=g,V.show()}))}})},closevotebtn:function(a){var b=this.getVoteEls(a),c=$(a.currentTarget),d=c.closest(".item-vote"),e=$(".vote-inlet",d),f=$(".vote-main",d);e.show(),b.cantseeEl.hide(),f.hide()},modifyapprerSelectBar:function(){var a,b=this.modifyapprer.element,c=$(".aj-selectapprer",b),d=this.model,e=d.get("originData"),f=e.approve,g=f.senderID;a=_.reject(H.p,function(a){return a.id==g});var h=new D({element:c,data:[{title:"同事",type:"p",list:a}],singleCked:!0,title:"选择审批人(一个)",autoCompleteTitle:"请输入姓名或拼音"});this.modifyapprerSb=h},sendmodifyapprer:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".item-face",d).attr("feedid"),f=$(".is-sendapper",d),g=f.is(":checked"),i=$(".replay-section",d),j=$(".reply-modifyapprer",i),k=this.modifyapprerSb,l=k.getSelectedData(),m=l.p||[];m=Number(m[0]),m&&h.api({url:"/FeedApprove/ToNextApprover",type:"post",data:{feedID:e,approverID:m,isSendSms:g},success:function(a){a.success&&(j.hide(),b.updateModel())
}})},modifyapprer:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".replay-section",c),e=$(".feed-reply",c),f=$(".reply-modifyapprer",d);e.hide();var g='<div class="list-repeat reply-modifyapprer"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td colspan="2"><div class="aj-selectapprer selectapprer">选择审批人（一个）</div></td></tr><tr><td><span class="label-for fn-hide"><input name="" class="is-sendapper" type="checkbox" style="vertical-align:middle;margin-right:4px;" value=""/><label>立即发送短信息到审批人的手机上</label></span></td><td align="right"><button type="submit" class="button-green place-btn aj-modifyapprer aj-feed-fn-com-btn" style="vertical-align:middle;">修改审批人</button></td></tr></table></div></div>';f.is(":visible")?(f.hide(),b.removeClass("fl-common-up-arrow")):(d.html(g).show(),$(".detail-islike-list-warp",c).hide(),this.modifyapprerSelectBar(),f.show(),$(".fs-list-item .item-func a",c).removeClass("fl-common-up-arrow"),$(".fs-list-item .item-func .islike-btn",c).removeClass("fl-common-up-arrow"),b.addClass("fl-common-up-arrow"))},ccSelectBar:function(){var a=this.ccSelectBar.element,b=$(".aj-selectccer",a),c=new D({element:b,data:[{title:"同事",type:"p",list:H.p}],singleCked:!1,title:"添加抄送人（一个或多个）",autoCompleteTitle:"请输入姓名或拼音"});this.ccSelectBarsb=c,this.compStore.push(c)},cc:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".replay-section",c),e=$(".feed-reply",c),f=$(".reply-cc",d);e.hide();var g='<div class="list-repeat reply-cc"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td><div class="aj-selectccer">添加抄送人</div></td></tr><tr><td align="right"><button type="submit" class="aj-feed-fn-com-btn button-green place-btn aj-cc-add marg10" style="vertical-align:middle;">添加抄送人</button></td></tr></table></div></div>';f.is(":visible")?(f.hide(),b.removeClass("fl-common-up-arrow")):(d.html(g).show(),f.show(),$(".fs-list-item .item-func a",c).removeClass("fl-common-up-arrow"),$(".fs-list-item .item-func .islike-btn",c).removeClass("fl-common-up-arrow"),b.addClass("fl-common-up-arrow"),this.ccSelectBar())},ccadd:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".replay-section",d),f=$(".item-face",d).attr("feedid"),g=$(".reply-cc",e),i=this.ccSelectBarsb,j=i.getSelectedData(),k=j.p||[],l="";_.each(k,function(a){l+="@"+h.getContactDataById(a,"p").name+" "}),h.api({url:"/FeedApprove/SenderAddAtEmployees",type:"post",data:{feedID:f,employeeAtNames:l,employeeIDs:k},success:function(a){a.success&&(b.updateModel(),g.hide())}})},_updateReceiptData:function(a){var b,c,d=this.$el,e=$(".receiptbtn",d),f=$(".receiptfnwarp",d),g=this.model,h=g.get("originData"),i=h.receipt,j="";0==a?e.removeClass("disable").text("立即回执"):e.addClass("disable").text("已回执"),i.isSendSms&&(j="已发短信，"),c='<a href="#" class="receiptalertlist alertlistbtn">需'+i.requireReceiptCount+"人回执，"+j+"已回执"+a+"人</a>",g.set({receiptfn:b,receiptRemaind:c,receiptedCount:a},{silent:!0}),f.html(c)},keyReply:function(a){var b=this.$el,c=this.model;c.get("originData"),c.get("feedID");var d=$(a.currentTarget),e=$(".feed-reply",b),f=$(".replay-section",b),g=this.feedReply.getReplyState();$(".fs-list-item .item-func a",b).removeClass("fl-common-up-arrow"),d.addClass("fl-common-up-arrow"),"plain"==g?this.feedReply.switchReplyState("important"):e.is(":visible")?(d.removeClass("fl-common-up-arrow"),e.hide()):(this.feedReply.switchReplyState("important"),d.addClass("fl-common-up-arrow"),e.show()),3==c.get("feedType")&&this.workReplyInit(a),f.hide()},reply:function(a){var b=this.$el,c=this.model,d=$(".feed-reply",b);$(a.currentTarget);var e=this.feedReply.getReplyState(),f=$(".replay-section",b);$(".fs-list-item .item-func a",b).removeClass("fl-common-up-arrow"),$(".fs-list-item .islike-btn",b).removeClass("fl-common-up-arrow"),$(".replay-section",b).children().hide(),$(".reply-cc",b).hide(),$(".reply-modifyapprer",b).hide(),"important"==e?(this.feedReply.switchReplyState("plain"),3==c.get("feedType")&&this.workReplyInit(a)):d.is(":visible")?(f.hide(),this.feedReply.hide()):(this.feedReply.show(),$(".detail-islike-list-warp",b).hide(),this.feedReply.refreshList(),3==c.get("feedType")&&this.workReplyInit(a))},approbtn:function(a){var b=this.$el,c=$(a.currentTarget),d=this.model,e=$(".replay-section",b),f=$(".feed-reply",b),g=this.feedReply.getReplyState();this.approveV||(this.approveV=new j.ApproveV({model:d,itemV:this,feedReply:this.feedReply})),c.hasClass("fl-common-up-arrow")?(e.hide(),f.hide(),this.feedReply.hide(),c.removeClass("fl-common-up-arrow")):(e.html(this.approveV.el),$(".fs-list-item .item-func a",b).removeClass("fl-common-up-arrow"),$(".fs-list-item .islike-btn",b).removeClass("fl-common-up-arrow"),c.addClass("fl-common-up-arrow"),e.show(),f.show(),this.feedReply.show(),"important"==g?this.feedReply.switchReplyState("plain"):this.feedReply.refreshList(),c.addClass("fl-common-up-arrow")),this.feedReply.set("showMainInput",!1)},workReplyInit:function(){var a=this.$el,b=this.model,c=$(".replay-section",a),d=b.get("originData");d.work,this.commandV?this.commandV.setComStatus():(this.commandV=new j.CommandV({model:this.model,itemV:this,feedReply:this.feedReply}),c.html(this.commandV.el))},commen:function(a){var b=this;$(".detail-islike-list-warp",this.$el).hide(),$(".islike-btn",b.$el).removeClass("fl-common-up-arrow");var c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".replay-section",d),f=$(".feed-reply",d),g=this.model,h=g.get("originData");g.get("feedID"),this.options;var i=h.replyCount,j=$(".reply-commen",e),k='<div class="list-repeat reply-commen"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td width="70">选择操作：</td><td><button type="submit" class="button-green place-btn aj-commenton-btn">点评日志</button></td></tr></table></div></div>';e.show(),f.show(),e.children().is(".reply-commen")?j.is(":visible")?(j.hide(),f.hide(),e.hide(),c.removeClass("fl-common-up-arrow"),this.feedReply.hide()):(j.show(),f.show(),e.show(),$(".fs-list-item .item-func a",d).removeClass("fl-common-up-arrow"),$(".fs-list-item .islike-btn",d).removeClass("fl-common-up-arrow"),c.addClass("fl-common-up-arrow"),this.feedReply.show(),this.feedReply.refreshList()):(e.empty().append(k),this.feedReply.show(),this.feedReply.switchReplyState("plain"),this.feedReply.set("showMainInput",!1),$(".fs-list-item .item-func a",d).removeClass("fl-common-up-arrow"),$(".fs-list-item .islike-btn",d).removeClass("fl-common-up-arrow"),c.addClass("fl-common-up-arrow"),0===i&&this.showCommentDialog(!0)),e.addClass("commen-replay-section")},_showSwrUndoneDialog:function(){sb.set("itemV",this),sb.show()},_showSwrDoneDialog:function(){ub.set("itemV",this),ub.show()},_showSwrCancelDialog:function(){vb.set("itemV",this),vb.show()},_showRwrNormalDialog:function(){xb.set("itemV",this),xb.show()},_showRwrCompleteDialog:function(){zb.set("itemV",this),zb.show()},_showApproveHisDialog:function(){qb.set("itemV",this),qb.show(),qb.reload()},funcmore:function(a){var b=$(a.currentTarget),c=b.closest(".handle"),d=$(".more-menu",c);return d.is(":visible")?d.hide():($(".handle .more-menu").hide(),d.show()),$(".remind-more-menu").hide(),$(".fs-tip").hide(),!1},fctrVisibleH:function(a){var b=$(a.currentTarget),c=b.closest(".comment-list"),d=this.model,e=d.get("feedFormatContents"),f=b.data("index"),g=e[f].leftHtml,h=$(".feed-topreply-summary-text",c),i=$(".feed-left-text",c),j=$(".feed-topreply-content-visible-h",c),k=$(".feed-content-ellipsis",c);0==i.length?(i=$('<span class="feed-left-text">'+g+"</span>"),i.insertAfter(h),j.text("收起正文"),k.hide()):i.is(":visible")?(i.hide(),j.text("展开正文（共"+e[f].feedWordNum+"个字）"),k.show()):(i.show(),j.text("收起正文"),k.hide()),a.preventDefault()},fcVisibleH:function(a){var b=this.model,c=b.get("feedFormatContent"),d=c.leftHtml,e=$(".item-text",this.$el),f=$(".feed-summary-text",e),g=$(".feed-left-text",e),h=$(".feed-content-visible-h",e),i=$(".feed-content-ellipsis",e);0==g.length?(g=$('<span class="feed-left-text">'+d+"</span>"),g.insertAfter(f),h.text("收起正文"),i.hide()):g.is(":visible")?(g.hide(),h.text("展开正文（共"+c.feedWordNum+"个字）"),i.show()):(g.show(),h.text("收起正文"),i.hide()),a.preventDefault()},addReplyCountPlusOne:function(){var a=$(".aj-Reply",this.$el),b=$(".num",a);b.length>0?b.text(parseInt(b.text())+1):a.html('回复(<span class="num">1</span>)')},commenbtn:function(){X.itemV=this,X.rendered||X.render(),X.show()},showCommentDialog:function(a){var b,c,d=X.element;this.commenbtn(),b=$(".dialog-right",d),c=$(".look-history",d),a?(c.text("收起历史日志<<"),X.set("width",909),b.show()):(c.text("查看历史日志>>"),X.set("width",458),b.hide())},pof:function(a){$(a.currentTarget),hb.rendered||hb.render(),hb.itemV=this,hb.show()},modfiypof:function(a){var b=$(a.currentTarget),c=b.closest(".archive-remind"),d=$(".ar-tip a",c),e="";d.each(function(a){e+=d.eq(a).text()+" "}),hb.rendered||hb.render(),this.model,hb.itemV=this,hb.thisTags=e,hb.show()},showScheduleDelBtn:function(a){var b=this,c=$(a.currentTarget),d=this.model,e=d.get("originData"),f=e.sender.employeeID,g=h.getContactData().u.id,j=e.schedule.relateEmployees.length,k='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>确定删除这条日程吗</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';this.cTipEl=$(".show-slide-up-tip-warp"),g==f&&j>1?h.confirm("该日程共有"+j+"位参与者，删除日程将会删除所有参与者的日程，是否继续？","确认删除",function(){b.submitcancelschedule(a)}):0==this.cTipEl.length?this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:175,height:99,template:k,top:15,callback:function(){b.submitcancelschedule(a)}}):(this.cTipEl.remove(),this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:175,height:99,template:k,top:15,callback:function(){b.submitcancelschedule(a)}}))},showunpof:function(a){var b=this,c=$(a.currentTarget),d='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>确定要取消归档这条信息吗</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';this.cTipEl=$(".show-slide-up-tip-warp"),0==this.cTipEl.length?this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:210,height:99,template:d,top:50,callback:function(){b.unpofbt(a)}}):(this.cTipEl.remove(),this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:210,height:99,template:d,top:50,callback:function(){b.unpofbt(a)}}))},unpofbt:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid"),e=this.options.withArchive;h.api({type:"post",data:{feedID:Number(d)},url:"/FeedArchive/CancelFeedArchive",success:function(a){if(e&&c.slideUp(250),a.success){var b=$(".aj-unplaceonfile",c);b.text("归档").attr("class","aj-placeonfile aj-feed-fn-com-btn");var d=new k({width:"",closeTpl:"",visibleWithAnimate:!0,content:'<div class="fs-successtip"><img src="../../html/fs/assets/images/success.gif" width="50" height="50" /> 取消归档成功</div>',className:"common-style-richard fs-feed-comment-dialog"}).render();d.show(),setTimeout(function(){d.hide()},1500)}}})},unattbt:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".myatt",d),f=$(".follow-action-h",d),g=$(".item-face",d).attr("feedid"),i=this.options.withFollowTime;h.api({url:"/Feed/CancelFeedFollow",type:"post",data:{feedID:g},success:function(c){if(c.success)if(i&&d.slideUp(250),b.cancel(a),1==e.length)b.remove();else{var g=new k({width:"",closeTpl:"",content:'<div class="fs-successtip"><img src="../../html/fs/assets/images/success.gif" width="50" height="50" /> 取消关注成功</div>',className:"common-style-richard fs-feed-comment-dialog"}).render();g.show(),setTimeout(function(){g.hide()},1500),f.addClass("aj-attention").removeClass("aj-unattention").text("关注")}}})},att:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".follow-action-h",c),e=$(".item-face",c).attr("feedid");h.api({url:"/Feed/AddFeedFollow",type:"post",data:{feedID:e},dataType:"json",success:function(a){a.success&&(i.showAlertDialog("关注成功"),d.addClass("aj-unattention").removeClass("aj-attention").text("取消关注"))}})},showunatt:function(a){var b=this,c=$(a.currentTarget),d='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>确定要取消关注这条信息吗</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';this.cTipEl=$(".show-slide-up-tip-warp"),0==this.cTipEl.length?this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:210,height:99,template:d,top:50,callback:function(){b.unattbt(a)}}):(this.cTipEl.remove(),this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:210,height:99,template:d,top:50,callback:function(){b.unattbt(a)}}))},fwd:function(){jb.itemV=this,jb.rendered?jb.show():jb.render().show()},ped:function(){mb.itemV=this,mb.rendered?mb.show():mb.render().show()},showDel:function(a){var b,c=$(a.currentTarget),d=this.model,e=d.get("originData"),f=this,g=e.feedType,h="",j=35,k=221;switch(this.cTipEl=$(".show-slide-up-tip-warp"),g){case 101:case 1001:case 1:h="确定删除这条信息吗(信息仅限24小时内可以删除)",b=this.del;break;case 2:h="确定删除这条日志吗（日志点评人点评后不能删除）",b=this.submitcancelplan;break;case 3:h="确定取消这条指令吗",b=this.submitcancelwork,k=175;break;case 4:h="确定取消这条审批吗",b=this.submitcancelappr,j=60,k=175;break;case 5:h="确定删除这条销售记录吗",b=this.del,j=60,k=175}var l='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>'+h+'</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';0==this.cTipEl.length?this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:k,height:99,template:l,top:j,callback:function(){b.call(f,a)}}):(this.cTipEl.remove(),this.cTip=new i.showSlideUpTip({element:c,autohide:!1,width:k,height:99,template:l,top:j,callback:function(){b.call(f,a)}}))},cancel:function(a){var b=$(a.currentTarget),c=b.closest(".handle"),d=$(".cancelmenu-box",c);d.animate({top:"120"},400)},del:function(a){var b=this,c=this.options,d=$(a.currentTarget),e=d.closest(".list-item"),f=$(".item-face",e).attr("feedid");h.api({url:"/Feed/DeleteFeedByID",type:"post",data:{feedID:f},success:function(a){a.success&&e.slideUp(250,function(){b.destroy(),c.deleteCb&&c.deleteCb.call(b,a,{feedID:f})})}})},submitcancelplan:function(a){var b=this,c=this.options,d=$(a.currentTarget),e=d.closest(".list-item"),f=$(".item-face",e).attr("feedid");h.api({url:"/FeedPlan/DeleteFeedPlanByID",type:"post",data:{feedID:f},success:function(a){a.success&&e.slideUp(250,function(){b.destroy(),c.deleteCb&&c.deleteCb.call(b,a,{feedID:f})})}})},submitcancelwork:function(a){var b=this,c=I.employeeID,d=this.model,e=d.get("originData"),f=$(a.currentTarget),g=f.closest(".list-item"),i=f.closest(".handle"),j=e.work.executer.employeeID,k=($(".cancelmenu-box",i),$(".item-face",g).attr("feedid")),l="/FeedWork/AssignerSendFeedWorkReply",m={feedID:k,replyContent:"取消该指令",operationType:3,fileInfos:[],rate:0,isSendSms:!1,atEmployeeIDs:[]};j==c&&(l="/FeedWork/ExecuterSendFeedWorkReply",m={feedID:k,replyContent:"取消该指令",operationType:3,fileInfos:[],isSendSms:!1}),h.api({url:l,type:"post",data:m,success:function(a){a.success&&b.updateModel()}})},submitcancelappr:function(a){var b=this,c=this.model,d=c.get("originData"),e=$(a.currentTarget),g=e.closest(".list-item"),i=e.closest(".handle"),j=d.approve.sender.employeeID;$(".cancelmenu-box",i);var k=this.options.likeStyle,l=this.options,m=$(".item-face",g).attr("feedid");h.api({url:"/FeedApprove/ApproverSendFeedReply",type:"post",data:{feedID:m,replyContent:"取消该审批",operationType:3,replyToReplyID:0,replyToEmployeeID:0,isSendSms:!1},success:function(a){a.success&&(I.employeeID==j?(b.updateModel(),l.deleteCb&&l.deleteCb.call(b,a,{feedID:m})):2==k?f.navRouter.navigate("#stream",{trigger:!0}):g.slideUp(250))}})},submitcancelschedule:function(a){var b,c=this,d=this.model,e=d.get("originData"),f=(e.schedule,e.sender.employeeID),g=this.options,i=$(a.currentTarget),j=i.closest(".list-item"),k=i.closest(".handle");$(".cancelmenu-box",k);var l=$(".item-face",j).attr("feedid");b=f==I.id?"/Feed/DeleteFeedByID":"/Schedule/CancelSchedule",h.api({url:b,type:"post",data:{feedID:l},success:function(a){a.success&&j.slideUp(250,function(){c.destroy(),g.deleteCb&&g.deleteCb.call(c,a,{feedID:l})})}})},updateModel:function(a){var b=this,c=this.model,d=this.$el,e=$(".feed-reply",d).is(":visible");h.api({url:"/Feed/GetFeedByFeedID",type:"get",data:{feedID:c.get("feedID")},success:function(c){var f=new z;c.success&&(b.model.set(f.parse(c)[0],{silent:!0}),b.render(),e&&($(".aj-Reply",d).length>0&&$(".aj-Reply",d).click(),$(".aj-approval",d).length>0&&$(".aj-approval",d).click()),a&&a.call(b,c))}},{mask:d,maskCls:"fs-feed-mask"})},initialize:function(){this.compStore=[];var a=this.model.get("feedType"),b=this.model.get("schedule");this.model.get("timingMessageRemainds");var c=this.model.get("voteItem"),d=this.model.get("announcement");switch(this.isCrm=!1,a){case 151:this.template=Qb;break;case 1:this.template=Eb,b&&(this.template=1==this.options.scheduleStyle?Gb:Hb),c&&(this.template=Ib),d&&(1==this.options.noticeStyle?this.template=Jb:2==this.options.noticeStyle&&(this.template=Kb));break;case 5:this.isCrm=!0,this.template=Fb,b&&(this.template=1==this.options.scheduleStyle?Gb:Hb),c&&(this.template=Ib),d&&(1==this.options.noticeStyle?this.template=Jb:2==this.options.noticeStyle&&(this.template=Kb));break;case 2003:this.template=Mb;break;case 2:this.template=Lb;break;case 3:this.template=Nb;break;case 4:1==this.options.detailStyle?this.template=Ob:2==this.options.detailStyle&&(this.template=Pb);break;default:this.template=Fb}this.listenTo(this.model,"change",this.render)},render:function(){var a=this.model,b=a.get("originData"),c=this.$el;this.$el.addClass("fs-feed-item"),this.empty(),this.$el.html(this.template(this.model.toJSON())),this.options.withArchive?($(".archive-remind",this.$el).show(),$(".aj-placeonfile",this.$el).text("取消归档").attr("class","aj-unplaceonfile")):$(".archive-remind",this.$el).hide(),this.options.withFollowTime?$(".followtimeinfo",this.$el).show():$(".followtimeinfo",this.$el).hide(),this.options.withShowBoteFeed&&a.get("voteItem")&&$(".aj-open-vote-btn",this.$el).click(),this.options.withAvatar===!1&&($(".item-face",this.$el).hide(),$(".item-detail",this.$el).css({"margin-left":"0px"}));var d=$(".item-func",this.$el);this.options.withActionBtn===!1&&($(".handle",d).hide(),$('<div class="action-btn-summary"><a href="#stream/showfeed/=/id-'+b.feedID+'" class="to-detail-l">点击查看原文>></a></div>').appendTo(d));var f,g,i,j,k,m,n,o,p,q=this.model.get("schedule"),r=h.getContactData().u.id;q&&(f=this.options.scheduleStyle,g=b.feedRangeDescription,i=$(".schedulesgroup a",c),j=b.schedule.startTime,p=$(".rc-time",c),3==f&&(i.text(g),p.text(l.unix(j).format("HH:mm")),k=q.relateEmployees,o=k.length,_.each(k,function(a){var b=a.employeeID,c=a.name;a.profileImage,n+=c+"，",1==o?(m=n.substr(0,n.length-1),b==r&&i.text("个人日程")):i.text("参与者共"+o+"人")})));var s=0,t=0;return 2==this.options.detailStyle?h.api({url:"/Feed/GetFeedReplysByFeedID",type:"get",dataType:"json",data:{lastFeedReplyID:s,maxID:t,feedID:b.feedID,pageNumber:1,pageSize:100},success:function(a){var b=a.value,c=$(".fs-list-item"),d=$(".printreplys",c),f="";_.each(b.items,function(a){var c=a.replyContent,g=a.pictures,i="",j="",k="",m=h.getDateSummaryDesc(l.unix(a.createTime),l.unix(a.serviceTime),1);k=a.sourceDescription?1==a.source?"":"，来自"+h.getSourceNameFromCode(a.source):"",_.each(c,function(a){i+=a.text}),_.each(g,function(a){j+='<span class="print-img-warp"><img src="'+e.API_PATH+"/df/get?id="+a.attachPath+'1.jpg" alt="" class="print-pictures"><img src="../../html/fs/assets/images/print-del-pic-ico.gif" title="不打印该图" class="print-del-pic-ico aj-feed-fn-com-btn" /></span>'}),f='<div class="printreplys-item"><div class="printreplys-item-txt"><i>'+a.sender.name+"</i>："+i+"("+m+k+')</div><div class="printreplys-item-media">'+j+"</div></div>",b.items.length>1&&d.append(f)})}}):151!=this.model.get("feedType")&&this.setFeedReply(),this.renderFeedAudio(),this},setFeedReply:function(){var a=this,b=this.model,c=b.get("originData"),d=this.options,e=this.$el,f=$(".feed-reply",e),g=$(".replies-btn",e),h=$(".aj-Reply",e),i=$(".aj-commenton",e),k=$(".aj-approbtn",e),l=$(".replay-section",e),m="",n=a.options.fbrType||0;f.wrap('<div class="feed-reply-wrapper"></div>');var o=new w({element:f,isCrm:this.isCrm,feedData:{feedID:c.feedID,fbrType:n,feedType:c.feedType,replies:c.replies,employeeID:c.employeeID,work:c.work,approve:c.approve},parentNode:f.closest(".feed-reply-wrapper"),showMainInput:!0});if(2==c.feedType||3==c.feedType||4==c.feedType){if(c.replies.length>0){switch(o.render(),o.set("showMainInput",!1),o.switchReplyState("important",!0),c.feedType){case 2:m="以下为日志点评人的点评：";break;case 3:m="以下为指令关键节点的回复：";break;case 4:m="以下为审批人的批复意见：";break;default:m=""}o.set("title",m)}else o.hide();c.isEncrypted&&o.hide(),4==c.feedType&&(this.ApproveV=new j.ApproveV({model:b,itemV:a,feedReply:o}),l.html(this.ApproveV.el))}else o.hide();o.on("replycount",function(a,b){var c;c=0==a?"":"("+a+")","plain"==b?(h.text("回复"+c),i.text("点评"+c),k.text("批复"+c),h.is(".rc")&&h.text("同事回复"+c)):g.text("关键回复"+c)}),o.on("replystate",function(a){$(".fs-list-item .item-func a",e).removeClass("fl-common-up-arrow"),"plain"==a?h.addClass("fl-common-up-arrow"):g.addClass("fl-common-up-arrow")}),o.on("hide",function(){$(".fs-list-item .item-func a",e).removeClass("fl-common-up-arrow")}),o.on("show",function(){var b=a.feedReply.getReplyState();"plain"==b?h.addClass("fl-common-up-arrow"):g.addClass("fl-common-up-arrow")}),o.on("addatrange",function(a){var b,c,d=a.rangeNames,f=_.groupBy(d,function(a){return a.value?"circle":"employee"}),g=[],h=[];b=f.circle?f.circle.length:0,c=f.employee?f.employee.length:0,h=h.concat(_.map(f.employee,function(a){return a.value2})),h=h.concat(_.map(f.circle,function(a){return a.value2})),b>0&&(1==b?g.push(f.circle[0].value2):g.push(b+"个部门")),c>0&&(1==c?g.push(f.employee[0].value2):g.push(c+"个同事")),b+c>0&&$(".item-info .group a,.item-info .schedulesgroup a",e).html(g.join("，")).attr("title",h.join("，"))}),o.on("reply",function(b,e){if(b.success){var f=c.receipt;f&&1==f.myReceiptStatus&&(a._updateReceiptData(f.receiptedCount+1),d.receiptCb&&d.receiptCb.call(a,b,{feedID:e.feedID}))}}),this.feedReply=o},reRenderArchive:function(a){var b=this.$el,c=$(".archive-remind",b);c.replaceWith(a)},empty:function(){var a=this.model,b=a.get("feedID");$(".show-slide-up-tip-warp").remove(),this.$el.removeData(),_.each(this.compStore,function(a){a.destroy&&a.destroy()}),this.audioRendered&&"flash"===this.audioRendered&&s.removeSWF("audio-flash-player-"+b),this.compStore=[]},destroy:function(){this.empty(),this.approveV&&this.approveV.destroy(),this.approveV=null,this.feedReply&&this.feedReply.destroy(),this.remove()}});b.itemV=Rb});