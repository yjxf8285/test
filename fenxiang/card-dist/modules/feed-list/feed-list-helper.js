/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/feed-list/feed-list-helper",["util","moment"],function(a,b,c){var d={},e=a("util"),f=a("moment");_.extend(d,{feedContentFormat_helper:function(a){var b,c=a.text,d=a.type;switch(d){case 1:b='<span class="highlight">'+c+"</span>";break;case 2:b='<a href="'+c+'" target="_blank">'+c+"</a>";break;case 3:b='<a href="#stream/showtopic/=/name-'+encodeURIComponent(a.dataTitle)+'">'+c+"</a>";break;case 4:b='<a class="at-link-name" href="#circles/atcircle/=/cid-'+a.dataID+'">'+c+"</a>";break;case 5:b='<a class="at-link-name" href="#profile/=/empid-'+a.dataID+'">'+c+"</a>";break;default:b=c}return b=b.replace(/[\n\r]/g,"<br/>")},feedContentFormat_:function(a,b){var c,e,f=b.feedType,g="",h="",i=0,j=function(b){var c=b.text,e=b.type;0!=e?(i+=c.length,a>=i?g+=d.feedContentFormat_helper(b):h+=d.feedContentFormat_helper(b)):_.each(c.split(""),function(b){i+=1,b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;"),b=b.replace(/[\n\r]/g,"<br/>"),b=b.replace(new RegExp(" ","g"),"&nbsp;"),a>=i?g+=b:h+=b})},k=function(a){var b;switch(a){case 1:b=["今日","明日"];break;case 2:b=["本周","下周"];break;case 3:b=["本月","下月"];break;default:b=["",""]}return b};return b.replyContent?_.each(b.replyContent,function(a){j(a)}):2==f?(c=b.plan.planType,e=k(c),g+='<span class="feed-content-title">'+e[0]+"工作总结</span><br/>",_.each(b.plan.reportContent,function(a){j(a)}),a>=i?g+='<br/><br/><span class="feed-content-title">'+e[1]+"工作计划</span><br/>":h+='<br/><br/><span class="feed-content-title">'+e[1]+"工作计划</span><br/>",_.each(b.plan.planContent,function(a){j(a)}),a>=i?g+='<br/><br/><span class="feed-content-title">工作心得体会</span><br/>':h+='<br/><br/><span class="feed-content-title">工作心得体会</span><br/>',_.each(b.feedContent,function(a){j(a)})):_.each(b.feedContent,function(a){j(a)}),{summaryHtml:g,leftHtml:h,feedWordNum:i}},feedContentFormat:function(a){var b="";return a=[].concat(a),_.each(a,function(a){var c=a.type,d="";switch(c){case 1:d+='<span class="highlight">'+a.text+"</span>";break;case 2:d+='<a href="'+a.text+'" target="_blank">'+a.text+"</a>";break;case 3:d+='<a href="#stream/showtopic/=/name-'+encodeURIComponent(a.dataTitle)+'">'+a.text+"</a>";break;case 4:d+='<a href="#circles/atcircle/=/cid-'+a.dataID+'">'+a.text+"</a>";break;case 5:d+='<a class="at-link-name" href="#profile/=/empid-'+a.dataID+'">'+a.text+"</a>";break;default:d+=a.text}d=d.replace(/[\n\r]/g,"<br/>"),b+=d}),b},picturesFormat:function(a){var b,c,d={},f="",a=[].concat(a),g=a.length,h=a[0];if(0==g&&(d.feedPic=""),1==g&&(d.feedPic='<div class="feed-img-only"><div class="img-num"><img class="feed-img-item" src="'+e.getDfLink(h.attachPath+"3",h.attachName,!1,"jpg")+'"/></div></div>'),b=g-9,c='<div class="img-num"><div class="feed-img-item more-link">更多'+b+"张</div></div>",g>1&&10>=g&&(_.each(a,function(a){f+='<div class="img-warp img-num"><img class="feed-img-item" src="'+e.getDfLink(a.attachPath+"3",a.attachName,!1,"jpg")+'"/></div>'}),d.feedPic='<div class="feed-img-many fn-clear">'+f+"</div>"),g>10){for(var i=0;8>=i;i++)f+='<div class="img-warp img-num"><img class="feed-img-item" src="'+e.getDfLink(a[i].attachPath+"3",a[i].attachName,!1,"jpg")+'"/></div>';d.feedPic='<div class="feed-img-many fn-clear">'+f+c+"</div>"}return d},filesFormat:function(a,b){var c,d={},f="",g=!1,h=[],i=[],j=[];a=[].concat(a),_.each(a,function(a){g=a.canPreview,a.name=a.attachName,c=g?'<a href="#" class="attach-preview-l v">预览</a>':"",a.feedFiles='<dl attachid="'+a.attachID+'"><dt><img src="'+FS.ASSETS_PATH+"/images/file/"+e.getFileType({name:a.attachName},!0)+'.png" alt=""></dt><dd><p>'+a.attachName+"("+e.getFileSize(a.attachSize)+')</p><p><a href="'+e.getDfLink(a.attachPath,a.attachName,!0)+'" class="d" title="'+a.name+'" target="_blank">下载</a> '+c+"</p></dd></dl>",f+=a.feedFiles,h.push(a.attachPath),j.push(a.attachID),i.push(encodeURIComponent(a.attachName))}),h.join("|"),j.join("|"),i.join("|");var k,l=b.GetBatchFilesSource||1;k=b.feedReplyID?FS.API_PATH+"/df/GetBatchFiles1?dataID="+(b&&b.feedReplyID)+"&source=2":FS.API_PATH+"/df/GetBatchFiles1?dataID="+(b&&b.feedID)+"&source="+l;var m='<a href="'+k+'" class="downall-btn" title="打包下载"></a>';return d.feedFiles=a.length>0?a.length>1?'<div class="feed-files feed-attach fn-clear">'+m+f+"</div>":'<div class="feed-files feed-attach fn-clear">'+f+"</div>":"",d},renderArchiveBar:function(a,b){var c,d,g,h,i=a,j=b.receipt,k="",l="mr76";return i?(l=j?0===j.myReceiptStatus?"":"mr76":"",c=i.archiveTime,d=e.getDateSummaryDesc(f.unix(c),f.unix(b.serviceTime),1),g="",_.each(i.tags,function(a){g+='<span class="ar-tip"><a href="javascript:void(0);">'+a.tagName+"</a></span>"}),h='<div class="archive-remind '+l+'"><span class="ar-time">归档于：'+d+'</span><span class="ar-tit">标签：</span>'+g+'<span class="ar-modfiy"><a href="javascript:void(0);">修改</a></span></div>',k=h):k="",k}}),c.exports=d});