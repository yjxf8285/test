/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/fs-worktodo/fs-worktodo",["util","dialog","./fs-worktodo.html","modules/publish/publish"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=a("util"),g=a("dialog"),h=a("./fs-worktodo.html"),i=a("modules/publish/publish"),j=$(h),k=f.getContactData(),l=k.u,m=i.selectBar,n=i.atInput,o=g.extend({attrs:{className:"fs-worktodo-new-dialog",content:j.filter(".add-worktodo-tpl").html(),successCb:d.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},_renderCpt:function(){var a=this.element,b=$(".worktodo-range",a),c=new m({element:b,data:[{title:"同事",type:"p",list:k.p}],title:"选择同事",autoCompleteTitle:"请输入同事的名称或拼音",defaultSelectedData:[{id:l.id,type:"p"}]}),d=$(".worktodo-title",a),e=new n({element:d});this.sb=c,this.atInput=e},render:function(){var a=o.superclass.render.apply(this,arguments);return this._renderCpt(),a},show:function(){var a=o.superclass.show.apply(this,arguments);return a},hide:function(){var a=o.superclass.hide.apply(this,arguments);return this._clear(),a},getRequestData:function(){var a=this.element,b=$(".worktodo-title",a),c=$(".is-important",a),d=this.sb,e={},f=d.getSelectedData();return e.title=_.str.trim(b.val()),e.employeeIDs=f.p||[],e.feedID=0,e.isImportant=c.prop("checked"),e.feedType=0,e},isValid:function(){var a=this.element,b=$(".worktodo-title",a),c=this.sb,d=this.getRequestData(),e=!0;return 0==d.employeeIDs.length&&($(".input-tip",c.element).click(),e=!1),0==d.title.length&&(f.showInputError(b),e=!1),d.title.length>1e3&&(f.alert("内容不超过1000字"),e=!1),e},_clear:function(){var a=this.element,b=$(".worktodo-title",a),c=$(".is-important",a),d=this.sb;d.removeAllItem(),d.addItem({id:l.id,name:l.name,type:"p"}),b.val("").trigger("autosize.resize"),c.prop("checked",!1)},_submit:function(a){var b=this,c=this.getRequestData(),d=$(a.currentTarget);this.isValid()?f.api({data:c,url:"/worktodolist/addWorkToDoList",success:function(a){a.success&&(b.get("successCb").apply(b,[a,c]),b.hide())}},{submitSelector:d}):a.stopPropagation()},_cancel:function(){this.hide()},destroy:function(){var a;return this.sb&&this.sb.destroy(),this.atInput&&this.atInput.destroy(),a=o.superclass.destroy.apply(this,arguments)}});_.extend(b,{NewWorktodoDialog:o})});