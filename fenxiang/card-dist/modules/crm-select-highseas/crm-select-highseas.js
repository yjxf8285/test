/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-select-highseas/crm-select-highseas",["dialog","util","uilibs/pagination2","modules/crm-select-highseas/crm-select-highseas.html","modules/crm-highsea-editsetting/crm-highsea-editsetting"],function(a,b,c){var d=a("dialog"),e=a("util"),f=a("uilibs/pagination2"),g=a("modules/crm-select-highseas/crm-select-highseas.html"),h=a("modules/crm-highsea-editsetting/crm-highsea-editsetting"),i=d.extend({attrs:{title:"选择公海",url:"/HighSeas/GetAllHighSeas/",content:g,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",width:790,height:600,currentHighSeaID:0,hasCreate:!0,createDialog:null,created:!1,id:0},setup:function(){var a=i.superclass.setup.apply(this,arguments);return a},render:function(){var a=i.superclass.render.apply(this,arguments);return this._initCreateDialog(),this._initOthers(),a},hide:function(){var a=i.superclass.hide.apply(this,arguments);return this.get("created")&&this.trigger("created"),a},show:function(a){var b=i.superclass.show.apply(this,arguments);return this.set("created",!1),this.set("id",a),this._getData(a),b},reset:function(){},events:{"click .crm-select-highsea":"_submit","click .crm-select-highseas-button-create":"_create","click .crm-select-highseas-button-cancel":"_cancel"},_initOthers:function(){this.get("title")&&$(".crm-select-highseas-title").text(this.get("title")),this.get("hasCreate")?$(".crm-select-highseas-button-create",this.element).show():$(".crm-select-highseas-button-create",this.element).hide()},_initCreateDialog:function(){var a=this,b=new h;b.on("addSuccess",function(){a.set("created",!0),a._getData(a.get("id"))}),this.set("createDialog",b)},_getData:function(a){var b=this;e.api({url:this.get("url"),type:"get",dataType:"json",data:{},success:function(c){c.success&&b._getColleagueHtml(c.value.highSeas,a)}})},_getColleagueHtml:function(a,b){var c="";return a?(_.each(a,function(a){b!=a.highSeasID&&(c+="<div class = 'crm-select-highsea fn-left fn-clear' data-value = '"+a.highSeasID+"' data-name ='"+a.name+"'>",c+="<div class = 'crm-select-highsea-name' title = '"+a.name+"'>"+a.name+"</div>",c+="<div class = 'crm-select-highsea-customer-number'>共有"+a.customerCount+"个客户</div></div>")}),$(".crm-select-highseas-result-container",this.element).html(c),void 0):c},_submit:function(a){var b=$(a.currentTarget),c={id:b.attr("data-value"),name:b.attr("data-name")};this.trigger("selected",c),this.hide()},_create:function(){this.get("createDialog").show()},_cancel:function(){this.hide()},destroy:function(){var a;return a=f.superclass.destroy.apply(this,arguments),this.element.empty(),a}});c.exports=i});