/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-file-dialog/crm-file-dialog",["dialog","util","modules/crm-file-dialog/crm-file-dialog.html","modules/crm-tag-dialog/crm-tag-dialog"],function(a,b,c){var d=window,e=d.FS,f=a("dialog"),g=a("util"),h=a("modules/crm-file-dialog/crm-file-dialog.html"),i=a("modules/crm-tag-dialog/crm-tag-dialog"),j=f.extend({attrs:{content:h,width:500,size:0,number:0,status:"hide",tag:"",tagStr:"",closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",fbrType:0,dataID:0,cancel:!0},setup:function(){var a=j.superclass.setup.apply(this,arguments);return this._init(),this._initEvents(),a},render:function(){var a=j.superclass.render.apply(this,arguments);return a},hide:function(){var a=j.superclass.hide.apply(this,arguments),b=this.get("cancel");return 1==b&&this.trigger("cancel"),this.reset(),a},show:function(){var a=j.superclass.show.apply(this,arguments);return this.set("sttaus","show"),"undefined"==typeof Worker&&$(".crm-file-dialog-button-upload",this.element).hide(),a},events:{"click .crm-file-dialog-button-upload":"_fileSelect","click .crm-file-dialog-file-delete":"_delete","click .crm-file-dialog-button-tag":"_showTagDialog","click .crm-file-dialog-button-ok":"_submit","click .crm-file-dialog-button-cancel":"_cancel","mouseover .crm-file-dialog-file-tr":"_mouseover","mouseout .crm-file-dialog-file-tr":"_mouseout"},_init:function(){var a=new i({});this.set("tag",a)},_initEvents:function(){var a=this,b=this.get("tag");b.on("submit",function(b){a.set("tagStr",b),$(".crm-file-dialog-tags",a.element).text(b),$(".crm-file-dialog-tags",a.element).attr("title",b)})},_fileSelect:function(){this.trigger("fileSelect")},_delete:function(a){var b=$(a.currentTarget),c=b.attr("fileId"),d=b.attr("filePath"),e=b.attr("fileSize");if(b&&c){$("[fileId="+c+"tr]").remove(),$(".crm-file-dialog-file-delete",this.element).length<1&&$(".crm-file-dialog-button-ok",this.element).addClass("button-disable");var f=this.get("size");f-=e,$(".crm-file-dialog-file-size",this.element).text(g.getFileSize(f)),this.set("size",f);var h=this.get("number");h-=1,$(".crm-file-dialog-file-num",this.element).text(h),this.set("number",h),this.trigger("delete",c,d)}},_showTagDialog:function(){var a=this.get("fbrType"),b=this.get("dataID"),c={};a&&b&&(c={fbrType:a,dataID:b}),this.get("tag").willShow(c)},add:function(a,b){var c=this,d="";if(a){var f="";b&&(f=b);var h=this.get("number"),i=this.get("size");d+="<tr fileId = '"+a.id+"tr' class = 'crm-file-dialog-file-tr'><td><img src='"+e.BLANK_IMG+"' alt='icon' class='crm-file-dialog-image fs-attach-"+g.getFileType({name:a.name},!0)+"-small-icon file-icon fn-left'/><div class ='crm-file-dialog-file-name fn-left fn-text-overflow' title = '"+a.name+"'>"+a.name+"</div></td>",d+="<td>"+g.getFileType(a,!0).toUpperCase()+"</td>",d+="<td>"+g.getFileSize(a.size)+"</td>",d+="<td><a fileId = '"+a.id+"' filePath = '"+f+"' fileSize='"+a.size+"' class = 'crm-file-dialog-file-delete'>删除</a></td></tr>",setTimeout(function(){$(".crm-file-dialog-file-body",c.element).append(d)},50),h+=1,i+=a.size,this.set("number",h),this.set("size",i),$(".crm-file-dialog-file-num",this.element).text(h),$(".crm-file-dialog-file-size",this.element).text(g.getFileSize(i)),$(".crm-file-dialog-button-ok",this.element).hasClass("button-disable")&&$(".crm-file-dialog-button-ok",this.element).removeClass("button-disable")}},reset:function(){$(".crm-file-dialog-file-body",this.element).empty(),$(".crm-file-dialog-tags",self.element).text(""),this.set("status","hide"),this.set("number",0),this.set("size",0),this.set("tagStr",""),this.set("cancel",!0)},_cancel:function(){this.hide()},_mouseover:function(a){var b=$(a.currentTarget);b&&b.addClass("crm-file-dialog-file-tr-active")},_mouseout:function(a){var b=$(a.currentTarget);b&&b.removeClass("crm-file-dialog-file-tr-active")},_submit:function(){if(!$(".crm-file-dialog-button-ok",this.element).hasClass("button-disable")){var a=this.get("tagStr");this.trigger("submit",a),this.set("cancel",!1),this.hide()}},destroy:function(){var a=j.superclass.destroy.apply(this,arguments);return a}});c.exports=j});