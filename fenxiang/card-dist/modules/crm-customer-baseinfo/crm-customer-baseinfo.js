/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-customer-baseinfo/crm-customer-baseinfo",["modules/crm-customer-baseinfo/crm-customer-baseinfo.html","dialog","util","moment"],function(a,b,c){var d=window,e=d.FS,f=e.tpl;f.store,f.list;var g=a("modules/crm-customer-baseinfo/crm-customer-baseinfo.html");a("dialog");var h=a("util"),i=a("moment"),j=Backbone.View.extend({tagName:"div",className:"customer-basic-module",template:_.template($(g).filter(".crm-customer-baseinfo-template").html()),options:{warpEl:null,customerData:null},events:{},initialize:function(){this.loadData()},render:function(){this.refresh()},refresh:function(){var a=this.$el,b=this,c=this.v.options.customerData.value.FCustomer,d=this.template;a.html(d({fullName:c.fullName,name:c.name,customerNo:c.fCustomerNo,address:c.address,webSite:c.webSite,introduction:c.introduction,ownerName:c.owner.name,createTime:i.unix(c.createTime).format("YYYY年MM月DD日 HH:mm"),lastChangedTime:i.unix(c.lastChangedTime).format("YYYY年MM月DD日 HH:mm"),value:{tags:[]}}));var e=$(".customer-baseinfo-tag-ul",a),f=[];_.map(c.fBusinessTagRelations,function(a){f.push('<li class="fn-clear"><div class="input-tip">'),f.push(a.fBusinessTagName),f.push('</div><div class="input-wrapper">'),f.push(a.fBusinessTagOptionName),f.push("</div></li>")}),e.html(f.join(""));var g=$(".customer-define-field-tag-ul",a),h=[];c.userDefineFieldDataList&&c.userDefineFieldDataList.textList&&_.map(c.userDefineFieldDataList.textList,function(a){""!=a.value&&(h.push('<li class="fn-clear"><div class="input-tip">'),h.push(a.fieldDescription),h.push('</div><div class="textarea-wrapper">'),h.push(a.value),h.push("</div></li>"))}),c.userDefineFieldDataList&&c.userDefineFieldDataList.dateList&&_.map(c.userDefineFieldDataList.dateList,function(a){a.value>0&&(h.push('<li class="fn-clear"><div class="input-tip">'),h.push(a.fieldDescription),h.push('</div><div class="input-wrapper">'),h.push(i.unix(a.value).format("YYYY年MM月DD日")),h.push("</div></li>"))}),c.userDefineFieldDataList&&c.userDefineFieldDataList.numList&&_.map(c.userDefineFieldDataList.numList,function(a){h.push('<li class="fn-clear"><div class="input-tip">'),h.push(a.fieldDescription),h.push('</div><div class="input-wrapper">'),h.push(a.value),h.push("</div></li>")}),h.length>0?(g.show(),g.html(h.join(""))):g.hide(),this.options.warpEl.html(a),a.find(".edit-customer").bind("click",function(){b._editCustomer()})},loadData:function(){var a=this,b=this.options.customerData.value.FCustomer.customerID;h.api({url:"/FCustomer/GetFCustomerDetailByID",type:"get",dataType:"json",data:{customerID:b,attachNum:6},success:function(b){b.success&&(a.responseData=b,a.render())}})},_editCustomer:function(){this.v._editCustomer()}});c.exports=j});