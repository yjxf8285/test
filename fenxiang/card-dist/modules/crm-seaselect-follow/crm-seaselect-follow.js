/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-seaselect-follow/crm-seaselect-follow",["dialog","util","uilibs/pagination2","modules/crm-seaselect-follow/crm-seaselect-follow.html"],function(a,b,c){var d=a("dialog"),e=a("util"),f=a("uilibs/pagination2"),g=a("modules/crm-seaselect-follow/crm-seaselect-follow.html"),h=d.extend({_data:[],attrs:{title:"选择跟进人",content:g,hasDeptTree:!1,hasWorkLeaveBtn:!1,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",width:1080,height:695,condition:{},needToRest:!1,defaultCondition:{queryType:0,isFirstChar:!1,keyword:"",circleID:-1,exceptEmployeeIDs:"",isStop:!1,pageSize:20,pageNumber:1},result:[]},setup:function(){var a=h.superclass.setup.apply(this,arguments),b=e.deepClone(this.get("defaultCondition"));return this.set("condition",b),a},render:function(){var a=h.superclass.render.apply(this,arguments);return this._initOthers(),a},hide:function(){var a=h.superclass.hide.apply(this,arguments);return this.reset(),a},show:function(a){this._data=a||this.get("data");var b=h.superclass.show.apply(this,arguments);return this._getData(this.get("condition")),b},reset:function(){this._unselectAll(),$(".fs-col-select-search-input",this.element).val("");var a=e.deepClone(this.get("defaultCondition"));this.set("condition",a)},events:{"click .fs-col-select-unselect-all":"_unselectAll","click .fs-col-select-search-button":"_onButtonClick","keydown .fs-col-select-search-input":"_onButtonKeydown","change .fs-col-select-search-input":"_inputChange","click .fs-col-select-button-group1":"_onWorkingButtonClick","mouseover .fs-col-select-button-group1":"_onButtonGroupMouseOver","mouseout .fs-col-select-button-group1":"_onButtonGroupMouseOut","click .fs-col-select-button-group2":"_onLeaveButtonClick","mouseover .fs-col-select-button-group2":"_onButtonGroupMouseOver","mouseout .fs-col-select-button-group2":"_onButtonGroupMouseOut","click .fs-col-select-colleague":"_onColleageClick","mouseover .fs-col-select-colleague":"_onColleageMouseOver","mouseout .fs-col-select-colleague":"_onColleageMouseOut","click .fs-col-select-button-ok":"_submit","click .fs-col-select-button-cancel":"_cancel"},_initOthers:function(){this.get("hasWorkLeaveBtn")&&($(".fs-col-select-button-group-box",this.element).show(),$(".fs-col-select-search-box",this.element).css("width",748),$(".fs-col-select-search-input",this.element).css("width",676)),$(".fs-col-multiselect-info-container",this.element).hide(),$(".fs-col-select-button-ok",this.element).hide(),this.get("defaultCondition").isStop?($(".fs-col-select-button-group2",this.element).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group1",this.element).removeClass("fs-col-select-button-group-selected")):($(".fs-col-select-button-group1",this.element).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group2",this.element).removeClass("fs-col-select-button-group-selected")),this.get("title")&&$(".fs-col-select-title").text(this.get("title"));var a=this;a.pagination=new f({element:$(".fs-col-select-result-pagination",a.element),pageSize:20,totalSize:0,activePageNumber:1}),a.pagination.on("page",function(b){var c=a.get("condition");c.pageNumber=b,a.set("condition",c),a._getData(c)})},_getData:function(a){this._getColleagueHtml(a)},filterData:function(a){var b=[],a=$.trim(a).toLowerCase();return a?(_.each(this._data,function(c){c.employee&&(c.employee.name.indexOf(a)>=0||c.employee.spell.toLowerCase().indexOf(a)>=0)&&b.push(c)}),b):this._data},_getColleagueHtml:function(a){var b=this.filterData(a.keyword||"",a.pageNumber||1),c="",d=this;if(b.length){var f=b.length,g=(a.pageNumber-1)*a.pageSize,h=g+a.pageSize;f>=0&&this.pagination.setTotalSize(f),$(".fs-col-select-result-container",this.element).empty(),_.each(b,function(a,b){b>=g&&h>b&&(c+="<div class = 'fs-col-select-colleague fn-left fn-clear' data-value = '"+a.employeeID+"' data-name ='"+a.employee.name+"' data-profileImage = '"+a.employee.profileImage+"'>",c+="<img src ='"+e.getAvatarLink(a.employee.profileImage,1)+"' class = 'fs-col-select-colleague-img' data-value = '"+a.employeeID+"' data-name ='"+a.employee.name+"' data-profileImage = '"+a.employee.profileImage+"' />"+(a.employee.department?"<span class='e-name'>"+a.employee.name+"</span><span class='e-department'>"+a.employee.department+"</span>":"&nbsp;&nbsp;"+a.employee.name)+"</div>")})}$(".fs-col-select-result-container",this.element).html(c),$(".fs-col-select-result-box",this.element).show(),$(".fs-col-select-result-selected-box",this.element).hide(),d.set("needToRest",!1)},_unselectAll:function(){var a=this.get("result");$(".fs-col-multiselect-info",this.element).hasClass("fs-col-multiselect-info-active")&&($(".fs-col-multiselect-info",this.element).addClass("fs-col-multiselect-info-disable"),$(".fs-col-multiselect-info",this.element).removeClass("fs-col-multiselect-info-active")),$(".fs-col-multiselect-number",this.element).text(0),_.each(a,function(a){$("[data-value="+a.employeeID+"]",$(".fs-col-select-result-box",this.element)).removeClass("fs-col-select-colleague-selected")}),this.set("result",[]),this._toSelecting(),$(".fs-col-select-result-selected-box",this.element).empty()},_toSelecting:function(){this.get("needToRest")&&(this.set("needToRest",!1),$(".fs-col-select-search-box",this.element).css("width",$(".fs-col-select-search-box",this.element).width()+103),$(".fs-col-select-search-input",this.element).css("width",$(".fs-col-select-search-input",this.element).width()+103),$(".fs-col-select-result-selected-box",this.element).hide(),$(".fs-col-select-result-box",this.element).show())},_onButtonClick:function(){var a=this.get("condition"),b=$.trim($(".fs-col-select-search-input",this.element).val());b>200&&(b=b.substr(0,200)),a.keyword=b,a.pageNumber=1,this.set("condition",a),this._getData(a)},_onButtonKeydown:function(a){var b=$(a.currentTarget),c=b.val();c.length>200&&b.val(c.substr(0,200));var d=a.which;13==d&&(this._onButtonClick(),a.preventDefault())},_inputChange:function(a){var b=$(a.currentTarget),c=b.val();c.length>200&&b.val(c.substr(0,200))},_onWorkingButtonClick:function(a){var b=this.get("condition");b.isStop&&(b.isStop=!1,$(a.currentTarget).hasClass("fs-col-select-button-group-selected")||$(a.currentTarget).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group2",this.element).hasClass("fs-col-select-button-group-selected")&&$(".fs-col-select-button-group2").removeClass("fs-col-select-button-group-selected"),this.set("condition",b),this._getData(b))},_onLeaveButtonClick:function(a){var b=this.get("condition");b.isStop||(b.isStop=!0,$(a.currentTarget).hasClass("fs-col-select-button-group-selected")||$(a.currentTarget).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group1",this.element).hasClass("fs-col-select-button-group-selected")&&$(".fs-col-select-button-group1").removeClass("fs-col-select-button-group-selected"),this.set("condition",b),this._getData(b))},_onButtonGroupMouseOver:function(a){$(a.currentTarget).hasClass("fs-col-select-button-group-active")||$(a.currentTarget).addClass("fs-col-select-button-group-active")},_onButtonGroupMouseOut:function(a){$(a.currentTarget).hasClass("fs-col-select-button-group-active")&&$(a.currentTarget).removeClass("fs-col-select-button-group-active")},_onColleageClick:function(a){var b=this.get("result");b.push({employeeID:$(a.currentTarget).attr("data-value"),name:$(a.currentTarget).attr("data-name"),profileImage:$(a.currentTarget).attr("data-profileImage")}),this.set("result",b),this._submit(a)},_onColleageMouseOver:function(a){!$(a.currentTarget).hasClass("fs-col-select-colleague-active")&&$(a.currentTarget).hasClass("fs-col-select-colleague")&&$(a.currentTarget).addClass("fs-col-select-colleague-active")},_onColleageMouseOut:function(a){$(a.currentTarget).hasClass("fs-col-select-colleague-active")&&$(a.currentTarget).removeClass("fs-col-select-colleague-active")},_submit:function(){this.trigger("selected",this.get("result")[0]),this.hide()},_cancel:function(){this.hide()},destroy:function(){var a;return a=f.superclass.destroy.apply(this,arguments),this.reset(),a}});c.exports=h});