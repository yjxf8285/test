/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-publish/crm-publish",["widget","modules/crm-publish/crm-publish.html","util","modules/fs-qx/fs-qx-helper","modules/crm-select-contacts/crm-select-contacts","modules/publish/publish-helper","moment","nprogress","events","filter","dialog","uilibs/tabs","scrollbar","modules/publish/publish"],function(a,b,c){var d=window,e=d.FS,f=a("widget"),g=a("modules/crm-publish/crm-publish.html"),h=a("util"),i=a("modules/fs-qx/fs-qx-helper"),j=i.Uploader,k=a("modules/crm-select-contacts/crm-select-contacts"),l=a("modules/publish/publish-helper"),m=l.DateSelect,n=a("moment"),o=a("nprogress"),p=a("events"),q=a("filter"),r=a("dialog"),s=a("uilibs/tabs"),t=a("scrollbar"),u=a("modules/publish/publish"),v=u.timeSelect,w=h.getContactData(),x=r.extend({attrs:{content:$(g).filter(".topic-dialog-tpl").html(),className:"fs-publish-topic-dialog",width:240,height:412,hasMask:!1,listPath:"/Topic/GetRecentlySendAndNewTopics"},events:{"mouseenter .topic-item":"_enterTopicItem","mouseleave .topic-item":"_leaveTopicItem","click .topic-item":"_clickTopicItem","click .insert-topic-btn":"_clickInsertBtn","click .f-cancel":"hide"},setup:function(){var a=x.superclass.setup.apply(this,arguments);return a},render:function(){var a=x.superclass.render.apply(this,arguments);return this._renderList(),a},_enterTopicItem:function(a){var b=$(a.target);b.addClass("state-hover")},_leaveTopicItem:function(a){var b=$(a.target);b.removeClass("state-hover")},_clickTopicItem:function(a){var b=$(a.target),c=b.attr("keyid"),d=this.getItemData(c);this.trigger("itemclick",d)},_clickInsertBtn:function(){this.trigger("inserttopic")},_renderList:function(){var a=this,b=this.get("listPath");h.api({url:b,type:"get",success:function(b){var c,d=[];b.success&&(c=b.value,_.each(c,function(a,b){var c="recentlyTopics"==b?"常用话题":"最新话题",e=[];_.each(a,function(a){a=_.str.trim(a),_.some(e,function(b){return b.name==a})||e.push({name:a})}),d.push({title:c,list:e,key:b})}),a.dataStore=d,a._createListHtml(d))}})},_createListHtml:function(a){var b=this.element,c=$(".cate-list",b),d="";_.each(a,function(a,b){var c=a.title,e=a.list,f="";d+='<li class="cate-item"><div class="cate-title">'+c+'</div><ul class="topic-list">',_.each(e,function(a,c){f+='<li class="topic-item" keyid="'+b+"-"+c+'">'+a.name+"</li>"}),d+=f+"</ul><li>"}),c.html(d)},getItemData:function(a){var b=a.split("-"),c=this.dataStore;return c[b[0]].list[b[1]]}}),y=function(a){a=_.extend({trigger:null,singleCked:!1,zIndex:2e5,data:[{title:"标题 A",type:"a",sortType:"letter",list:[{name:"测试",id:"test",spell:"test"},{name:"测试a",id:"test2",spell:"aest"},{name:"测试b-1",id:"test3",spell:"best"},{name:"测试b-2",id:"test4",spell:"best"}]},{title:"标题 B",type:"b",unitSuffix:"位同事",list:[{name:"测试A",id:"test1",spell:"aest"}]},{title:"标题 B",type:"c",list:[{name:"测试b",id:"test1",spell:"best"}]}]},a||{});var b='<div class="fs-contact-letter-nav fn-clear"></div><div class="fs-contact-list-wrapper"><ul class="fs-contact-list"></ul></div>',c="",d="";_.each(a.data,function(){c+='<li class="ui-tab-item" data-role="trigger"></li>',d+='<div data-role="panel" class="ui-tab-panel fn-clear">'+b+"</div>"});var e=$(a.trigger),f=new r(_.extend({hasMask:!1,width:280,height:415,className:"fs-contact-dialog",content:'<div class="fs-contact-content"><div class="fs-contact-tabs ui-tab"><ul class="ui-switchable-nav ui-tab-items" data-role="nav">'+c+'</ul><div class="ui-switchable-content">'+d+"</div></div>"+'<div class="fs-contact-bbar fn-clear"><div class="fs-contact-summary">共有<span class="num">0</span>位同事</div><div class="fs-contact-action"><button class="fs-contact-close-btn button-cancel">关闭</button></div></div>'+"</div>",align:{selfXY:["right",0],baseElement:e,baseXY:[e.width(),e.height()]},zIndex:a.zIndex},a.dialogOpts||{})).render(),g=new s(_.extend({element:$(".fs-contact-tabs",f.element),triggers:$(".ui-tab-item",f.element),panels:$(".ui-tab-panel",f.element),activeIndex:0,triggerType:"click",withTabEffect:!1},a.tabOpts||{})).render();this.opts=a,this.dialog=f,this.tab=g,y.ins.push(this),this.init(),$(".fs-contact-list-wrapper",f.element).each(function(){new t({element:$(this)})})};_.extend(y.prototype,{init:function(){var a=this,b=this.opts,c=b.data;_.each(c,function(b,c){a.updateTab(b,c)}),this.bindEvents()},isVisible:function(){var a=this.dialog;return a.element.is(":visible")},updateData:function(a){var b=this;_.each(a,function(a,c){b.updateTab(a,c)})},updateTab:function(a,b){var c=a.title,d=a.type;a.list;var e=(this.dialog,this.tab),f=e.get("triggers").eq(b),g=e.get("panels").eq(b);f.html('<a href="javascript:;">'+c+"</a>"),g.attr("emptype",d),this.doTabPanel(g,a)},doTabPanel:function(a,b){var c,d,e,f,g=$(a),c=$(".fs-contact-letter-nav",g),h=$(".fs-contact-list",g),i="",j=b.list,k=b.sortType||"letter",l=b.unitSuffix||"位同事";for(c.html('<ul class="list-0"></ul><ul class="list-1"></ul>'),d=65;77>=d;d++)i+="<li>"+String.fromCharCode(d)+"</li>";for($(".list-0",c).html(i),i="",d=78;90>=d;d++)i+="<li>"+String.fromCharCode(d)+"</li>";$(".list-1",c).html(i),c=$("li",c),i="","letter"==k?(e=this.groupByLetter(j),f=_.sortBy(_.keys(e),function(a){return a}),_.each(f,function(a){var b=e[a],d=b.length,f="";i+='<li><div class="index-box fn-clear"><div class="index-keyword">'+a+'</div><div class="item-length">'+d+'项</div></div><ul class="fs-contact-view">',_.each(b,function(a){f+='<li class="fs-contact-item" itemid="'+a.id+'">'+a.name+"</li>"}),i+=f+"</ul></li>",c.each(function(){var b=$(this),c=b.text();c==a&&b.addClass("fs-contact-letter-selected")})}),h.html(i)):"origin"==k&&(i+='<ul class="fs-contact-view">',_.each(j,function(a){i+='<li class="fs-contact-item" itemid="'+a.id+'">'+a.name+"</li>"}),i+="</ul>",h.html(i)),g.data("unitSuffix",l),this.updateSummary()},show:function(a){var b=this.opts,c=b.dialogOpts||{},d=$(this.opts.trigger);this.dialog.set("align",_.extend({selfXY:["right",0],baseElement:d,baseXY:[d.width(),d.height()]},c.align||{})),this.dialog.show(),a!==!1&&this.trigger("show")},hide:function(a){this.dialog.hide(),a!==!1&&this.trigger("hide")},groupByLetter:function(a){var b=[];return b=_.groupBy(a,function(a){return a.spell.slice(0,1).toUpperCase()})},updateSummary:function(){var a=this.tab,b=this.dialog,c=b.element,d=a.get("panels").eq(a.get("activeIndex")),e=$(".fs-contact-item",d),f=e.filter(".fs-contact-item-selected"),g=$(".fs-contact-summary",c),h=d.data("unitSuffix");f.length>0?g.html("已选中"+f.length+"/"+e.length):g.html("共有"+e.length+h)},select:function(a,b,c){var d,e=this.opts,f=this.tab,g=f.element,h=f.get("panels"),i={};a=[].concat(a),"all"==b?(d=$(".fs-contact-item",g),h.each(function(){var a=$(this),b=a.attr("emptype");i[b]=[]})):(d=$(".fs-contact-item",$('[emptype="'+b+'"]',g)),i[h.filter('[emptype="'+b+'"]').attr("emptype")]=[]),"all"==a[0]?(d.addClass("fs-contact-item-selected"),d.each(function(){var a=$(this),b=a.closest(".ui-tab-panel"),c=a.attr("itemid"),d=b.attr("emptype");i[d].push({name:a.text(),id:c})})):_.each(a,function(a){var b=d.filter('[itemid="'+a+'"]');b.addClass("fs-contact-item-selected"),b.each(function(){var a=$(this),b=a.closest(".ui-tab-panel"),c=a.attr("itemid"),d=b.attr("emptype");i[d].push({name:a.text(),id:c})})}),e.singleCked&&this.hide(),c||this.trigger("select",i)},unselect:function(a,b,c){var d,e=this.tab,f=e.element,g=e.get("panels"),h={};a=[].concat(a),"all"==b?(d=$(".fs-contact-item",f),g.each(function(){var a=$(this),b=a.attr("emptype");h[b]=[]})):(d=$(".fs-contact-item",$('[emptype="'+b+'"]',f)),h[b]=[]),"all"==a[0]?(d.removeClass("fs-contact-item-selected"),d.each(function(){var a=$(this),b=a.closest(".ui-tab-panel"),c=a.attr("itemid"),d=b.attr("emptype");h[d].push({name:a.text(),id:c})})):_.each(a,function(a){var b=d.filter('[itemid="'+a+'"]');b.removeClass("fs-contact-item-selected"),b.each(function(){var a=$(this),b=a.closest(".ui-tab-panel"),c=a.attr("itemid"),d=b.attr("emptype");h[d].push({name:a.text(),id:c})})}),c||this.trigger("unselect",h)},bindEvents:function(){var a=this,b=this.tab,c=b.element,d=this.dialog,e=d.element,f=this.opts,g=$(f.trigger);c.on("click",".fs-contact-item",function(){var b=$(this),c=b.closest(".ui-tab-panel"),d=b.attr("itemid"),e=c.attr("emptype");b.hasClass("fs-contact-item-selected")?a.unselect(d,e):(f.singleCked&&a.unselect("all","all"),a.select(d,e)),a.updateSummary()}),b.on("switched",function(c){var d=b.get("panels").eq(c),e=$(".fs-contact-list-wrapper",d);a.updateSummary(),e.data("ins").update()}),d.after("show",function(){var a=this.element,b=$(".fs-contact-list-wrapper",a);b.data("ins").update()}),e.click(function(a){a.stopPropagation()}),e.on("click",".fs-contact-close-btn",function(){a.hide()}).on("click",".ui-dialog-close",function(){a.trigger("hide")}),c.on("click",".fs-contact-letter-selected",function(){var a,b=$(this),c=b.text(),d=b.closest(".ui-tab-panel").find(".fs-contact-list-wrapper"),e=$(".fs-contact-list",d);$("li",e).each(function(){var b=$(this),d=$(".index-keyword",b);return d.text()==c?(a=b,!1):void 0}),a&&d.data("ins").update(a.position().top)}),g.click(function(b){_.each(_.filter(y.ins,function(b){return b!==a}),function(a){a.hide()}),a.dialog.element.is(":visible")?a.hide():a.show(),a.updateSummary(),b.preventDefault()}),h.regGlobalClick(this.dialog.element,function(b){var c=$(b.target);g.length>0&&!$.contains(g[0],c[0])&&g[0]!==c[0]&&a.dialog.element.is(":visible")&&a.hide()})},destroy:function(){var a=this,b=this.opts;this.dialog.destroy(),this.tab.destroy(),this.off(),$(b.trigger).unbind("click"),y.ins=_.filter(y.ins,function(b){return b!==a})}}),y.ins=[],p.mixTo(y);var z=f.extend({attrs:{element:null,title:"",placeholder:"发布新建销售记录...",type:"event",isContact:!1,attachUploader:null,attachNumber:0,attachSize:0,pictureNumber:0,pictureSize:0,files:[],flashFiles:[],activeUploader:"attach",contactsDialog:null,contacts:[],startDate:null,alarmDate:null,contactData:h.getContactData(!0),condition:{},suportH5:!0,eventCondition:{associationContactIDs:"",fileInfos:[],isAllDayEvent:!1,startTime:0,remindType:1,remindTime:0,isSentSms:!1,feedContent:"",parentFeedID:0,listTagOptionID:[],fbrType:0,customerID:0,contactIDs:0},feedCondition:{fileInfos:[],feedContent:"",fbrType:0,dataID:0},display:["time","contact","picture","attach","tag"]},events:{"click .crm-publish-button-ok":"_publish","click .crm-publish-button-cancel":"_cancel","click .crm-publish-operation div":"_showOperation","mousedown .crm-publish-content":"_active","mouseover .crm-publish-operation-event-tag":"_tagMouseover","mouseout .crm-publish-operation-event-tag":"_tagMouseout","mouseover .crm-publish-operation-attach-box":"_attachMouseover","mouseout .crm-publish-operation-attach-box":"_attachMouseout","mouseover .crm-publish-operation-picture-box":"_pictureMouseover","mouseout .crm-publish-operation-picture-box":"_pictureMouseout","mouseover .crm-publish-operation-contact-box":"_contactMouseover","mouseout .crm-publish-operation-contact-box":"_contactMouseout","click .crm-publish-operation-tag-option-item":"_optionClick","click .crm-publish-operation-picture-add":"_pictureUpload","click .crm-publish-operation-picture-close":"_pictureDelete","click .crm-publish-operation-attach-add":"_attachUpload","click .crm-publish-operation-attach-close":"_attachDelete","click .crm-publish-operation-contact-add":"_showContactDialog","click .crm-publish-operation-contact-close":"_contactDelete","propertychange .crm-publish-content":"_contentChange","input .crm-publish-content":"_contentChange","keyup .crm-publish-content":"_contentChange","blur .crm-publish-content":"_contentChange"},setup:function(){var a=z.superclass.render.apply(this,arguments);return this._init(),a},render:function(){var a=z.superclass.render.apply(this,arguments);return a},atGetDefaultSpData:function(){var a,b=h.getContactData(!0),c=[],d=b.p,e=b.g,f=h.getPersonalConfig("lastAtData");return _.each(f,function(a){var b=h.getContactDataById(a.dataID,a.isCircle?"g":"p");b&&c.push({name:b.name,id:b.id,spell:b.spell})}),c=_.reject(c,function(a){return 999999==a.id}),e=_.reject(e,function(a){return 999999==a.id}),a=[{title:"常用",type:"mix",sortType:"origin",list:c},{title:"同事",unitSuffix:"位同事",type:"p",list:d},{title:"部门",unitSuffix:"个部门",type:"g",list:e}]},_showOperation:function(a){var b=$(a.currentTarget),c=b.attr("name"),d=$(".crm-publish-operation-active",this.element);if(d.length>0){var e=d.attr("name");d.removeClass("crm-publish-operation-active"),$(".crm-publish-operation-"+e+"-container",this.element).hide()}b.addClass("crm-publish-operation-active"),"tag"==c&&$(".crm-publish-operation-"+c+"-container",this.element).css({left:19,top:-1}),"attach"==c&&this.set("activeUploader","attach"),"picture"==c&&this.set("activeUploader","picture"),"attach"==c||"picture"==c?$(".crm-publish-operation-attach-div object",this.element).show():$(".crm-publish-operation-attach-div object",this.element).hide(),$(".crm-publish-operation-"+c+"-container",this.element).show(),this.get("suportH5")||(("attach"==c||"picture"==c)&&this._setFileInputPosition(),"attach"==c&&this.get("attachUploader").core.core.setFileTypes("*.*","文件"),"picture"==c&&this.get("attachUploader").core.core.setFileTypes("*.jpg;*.gif;*.jpeg;*.png","图片"))},_setFileInputPosition:function(){var a=this.get("activeUploader"),b=$(".crm-publish-operation-attach-div",this.element);if(this.get("suportH5"))return b.hide(),void 0;var c=$(".crm-publish-operation-attach-div object",this.element),d=$(".crm-publish-operation-"+a+"-add",this.elment).last();$(".crm-publish-operation-picture-operation",this.element),b.show(),c.css({width:d.width(),height:d.height(),left:d.position().left,top:d.position().top})},_tagMouseover:function(a){var b=$(a.currentTarget),c=$(".crm-publish-operation-tag-container",this.element),d=b.attr("data-fBusinessTagID"),e=b.position().top,f=$(".crm-publish-operation-tag-"+d,this.element);f.show();var g=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;$(window).height()<b.offset().top-g+f.height()&&(e=b.offset().top-c.offset().top-f.height()+23,b.offset().top-$(".bd").offset().top<f.height()&&(e=0-(c.offset().top-$(".bd").offset().top))),f.css({left:b.position().left+200,top:e})},_tagMouseout:function(a){var b=$(a.currentTarget),c=b.attr("data-fBusinessTagID");$(".crm-publish-operation-tag-"+c,this.element).hide()},_attachMouseover:function(a){var b=$(a.currentTarget);$(".crm-publish-operation-attach-close",b).show()},_attachMouseout:function(a){var b=$(a.currentTarget);$(".crm-publish-operation-attach-close",b).hide()},_pictureMouseover:function(a){var b=$(a.currentTarget),c=$(".crm-publish-operation-picture-close",b);c.css({top:b.position().top+10,left:b.position().left+122}),c.show()},_pictureMouseout:function(a){var b=$(a.currentTarget);$(".crm-publish-operation-picture-close",b).hide()},_contactMouseover:function(a){var b=$(a.currentTarget),c=$(".crm-publish-operation-contact-close",b);c.css({top:b.position().top+10,left:b.position().left+122}),c.show()},_contactMouseout:function(a){var b=$(a.currentTarget);$(".crm-publish-operation-contact-close",b).hide()},_publish:function(a){var b=$(a.currentTarget);b.hasClass("crm-publish-button-disable")||this._startUpload()},_cancel:function(){$(".crm-publish-content",this.element).val(""),$(".crm-publish-content",this.element).removeClass("crm-publish-content-active").css("height",""),$(".crm-publish-button-ok",this.element).addClass("crm-publish-button-disable"),$(".crm-publish-operation",this.element).hide(),$(".crm-publish-foot",this.element).hide(),$(".crm-publish-operation-active",this.element).removeClass("crm-publish-operation-active"),h.mnSetter($(".crm-publish-operation-time-alarm-select",this.element),1),$(".crm-publish-operation-time-alarm-date",this.element).hide(),$(".crm-publish-operation-time-alarm-time",this.element).hide(),$(".crm-publish-operation-time-alarm-minute",this.element).hide(),$(".crm-publish-operation-time-alarm-info",this.element).hide(),$(".crm-publish-operation-time",this.element).removeClass("crm-publish-operation-time-selected"),$(".crm-publish-operation-time-container",this.element).hide(),this.set("contacts",[]),$(".crm-publish-operation-contact-list",self.element).empty(),$(".crm-publish-operation-contact",this.element).removeClass("crm-publish-operation-contact-selected"),$(".crm-publish-operation-contact-num",this.element).hide(),$(".crm-publish-operation-contact-container",this.element).hide(),this.set("attachNumber",0),this.set("attachSize",0),$(".crm-publish-operation-attach-list",self.element).empty(),$(".crm-publish-operation-attach",this.element).removeClass("crm-publish-operation-attach-selected"),$(".crm-publish-operation-attach-num",this.element).hide(),$(".crm-publish-operation-attach-info",this.element).hide(),$(".crm-publish-operation-attach-container",this.element).hide(),this.set("pictureNumber",0),this.set("pictureSize",0),this.get("startDate").clear(),this.get("ts").clear(),$(".crm-publish-operation-picture-list",self.element).empty(),$(".crm-publish-operation-picture",this.element).removeClass("crm-publish-operation-picture-selected"),$(".crm-publish-operation-picture-num",this.element).hide(),$(".crm-publish-operation-picture-info",this.element).hide(),$(".crm-publish-operation-picture-container",this.element).hide(),$(".crm-publish-operation-tag",this.element).removeClass("crm-publish-operation-tag-selected"),$(".crm-publish-operation-tag-container",this.element).hide(),$(".crm-publish-operation-event-tag-selected",this.element).removeClass("crm-publish-operation-event-tag-selected"),$(".mn-selected.crm-publish-operation-tag-option-radio",this.element).removeClass("mn-selected"),$("span[data-isDefault='true']",this.element).addClass("mn-selected"),this.get("files").length>0&&this.get("attachUploader").removeAllFile();var a=this.get("condition");a.fileInfos=[],a.feedContent="",this.set("condition",a),this.set("files",[]),$(".crm-publish-operation-attach-div",this.element).hide()},_contentChange:function(){$.trim($(".crm-publish-content",this.element).val()).length>0?$(".crm-publish-button-ok",this.element).removeClass("crm-publish-button-disable"):$(".crm-publish-button-ok",this.element).addClass("crm-publish-button-disable")},_active:function(){var a=$(".crm-publish-content",this.element);a.hasClass("crm-publish-content-active")||(a.addClass("crm-publish-content-active"),$(".crm-publish-operation",this.element).show(),$(".crm-publish-foot",this.element).show())},_optionClick:function(a){var b=$(a.currentTarget),c=$(".mn-radio-item",b);c.hasClass("mn-selected")||($(".mn-selected",b.parent()).removeClass("mn-selected"),c.addClass("mn-selected"),"true"==b.attr("data-isDefault")?b.parent().parent().parent().removeClass("crm-publish-operation-event-tag-selected"):b.parent().parent().parent().addClass("crm-publish-operation-event-tag-selected"),$(".crm-publish-operation-event-tag-selected",this.element).length>0?$(".crm-publish-operation-tag",this.element).addClass("crm-publish-operation-tag-selected"):$(".crm-publish-operation-tag",this.element).removeClass("crm-publish-operation-tag-selected"))},_attachUpload:function(){this.set("activeUploader","attach");var a=$(".crm-publish-operation-attach-input",this.element);a.attr("accept","*/*"),this.get("suportH5")?(a.parent().show(),a.show().click().hide(),a.parent().hide()):h.alert("当前浏览器不能满足html5版的上传功能，请尝试其他浏览器")},_pictureUpload:function(){this.set("activeUploader","picture");var a=$(".crm-publish-operation-attach-input",this.element);a.attr("accept","image/*"),this.get("suportH5")?(a.parent().show(),a.show().click().hide(),a.parent().hide()):h.alert("当前浏览器不能满足html5版的上传功能，请尝试其他浏览器")},_init:function(){"undefined"==typeof Worker&&this.set("suportH5",!1),this._initOthers(),this._initTags(),this._initAttachUploader(),this._initContactDialog(),this._initStartDate(),this._initAlarmDate(),this._initTime(),this._initAt(),this._initTopic(),this._initEvents()},_initTopic:function(){var a=this,b=this.element,c=$(".crm-publish-operation-topic",b),d=(this.opts,$(".crm-publish-content",b)),f=new x(_.extend({trigger:c,align:{selfXY:[0,0],baseElement:c,baseXY:[-227,22]},listPath:"/Topic/GetRecentlySendAndNewTopics"},{})).render();f.on("itemclick",function(b){var c=d.filter(".fs-publish-topic-focus");0==c.length&&(c=d.eq(0)),h.appendInput(c.get(0),"#"+b.name+"# "),a._contentChange(),c.keyup(),f.hide()}),f.on("inserttopic",function(){var b,c=d.filter(".fs-publish-topic-focus").get(0)||d.eq(0).get(0);h.appendInput(c,"#请输入话题（最多10个字符，不能有空格）# "),a._contentChange(),$(c).trigger("autosize.resize"),b=h.getCursorPosition(c),$(c).keyup(),f.hide(),b.start=b.start-22,b.end=b.end-2,h.setCursorPosition(c,b)}),d.change(function(){d.trigger("autosize.resize")}),d.focus(function(){d.removeClass("fs-publish-topic-focus"),$(this).addClass("fs-publish-topic-focus")});var g;h.asyncOrder(["jslibs/jquery.atwho.js","jslibs/jquery.atwho.custom.js"],function(){q.stringMatch,f.dataStore,d.atwho("#",{data:"/Topic/Get10Topics",insertSeparator:!1,emptyTipTpl:"没有搜索到话题",withEmptyTip:!1,callbacks:{remote_filter:function(a,b,c){var d=$("#at-view .at-view-title"),f=$("#at-view .loading-mask");return 0==f.length&&(f=$('<div class="loading-mask"><img src="'+e.BLANK_IMG+'" class="loading-img" alt="loading" /></div>'),f.prependTo("#at-view")),0==d.length&&(d=$('<h3 class="at-view-title"></h3>'),d.prependTo("#at-view")),0==_.str.trim(a.q).length?(d.hide(),f.hide(),c([]),void 0):(f.show(),clearTimeout(g),g=setTimeout(function(){return h.api({url:b,type:"get",data:{keyword:a.q},success:function(a){var b;a.success?(b=a.value||[],d.text("#相似话题#").show(),f.hide(),b=_.map(b,function(a){return{name:a}}),c(b)):(d.hide(),f.hide(),c([]))}})},80),void 0)},matcher:function(a,b){var c,d,e,f=this.$inputor.val(),g=f.slice(b.length,b.length+1),h=b.split(/\n/),i=0;e=new RegExp(a+"([^\\s|^#]*)$","gi"),c=e.exec(b),h=h[h.length-1].split("");for(var j=0,k=h.length;k>j;j++)"#"==h[j]&&i++;return d=null,1==i%2&&"#"==g&&c&&(d=c[2]?c[2]:c[1]),d},sorter:function(a,b){return b}}})}),f.element.on("click",function(a){a.stopPropagation()}),h.regGlobalClick(f.element,function(a){var b=$(a.target);c[0]===b[0]||$.contains(c[0],b[0])||f.element.is(":visible")&&f.hide()}),this.topicDialog=f},_initAt:function(){var a=this,b=this.element,c=(this.opts,this.atGetDefaultSpData()),d=$(".crm-publish-content",b);h.asyncOrder(["jslibs/jquery.atwho.js","jslibs/jquery.atwho.custom.js"],function(){q.stringMatch,d.atwho("@",{data:w.p.concat(_.reject(w.g,function(a){return 999999==a.id})),callbacks:{filter:function(b,c){var d,f,g=q.stringMatch,h=q.startsWith,i=[],j=a.atGetDefaultSpData(),k=$("#at-view .at-view-title"),l=$("#at-view .loading-mask");return 0==l.length&&(l=$('<div class="loading-mask"><img src="'+e.BLANK_IMG+'" class="loading-img" alt="loading" /></div>'),l.prependTo("#at-view")),0==k.length&&(k=$('<h3 class="at-view-title"></h3>'),k.prependTo("#at-view")),l.hide(),0==_.str.trim(b).length?(i=j[0].list.slice(0),i.length>0?k.text("选择最近@提到的或直接输入").show():k.hide()):(d=g.apply(this,[c,b,{key:"name"}]),f=h.apply(this,[c,b.toLowerCase(),{key:"spell"}]),_.each(f,function(a){_.find(d,function(b){return b.id==a.id})||i.push(a)}),i=i.concat(d),i.length>0?k.text("选择名称或轻敲空格完成输入").show():k.hide()),i},matcher:function(a,b){var c,d,e;return e=new RegExp(a+"([a-zA-Z0-9_\\u4e00-\\u9fa5]*)$","gi"),c=e.exec(b),d=null,c&&(d=c[2]?c[2]:c[1]),d},sorter:function(a,b){return b}}}).addClass("fs-publish-input")});var f,g=$(".crm-publish-operation-at",this.element),d=$(".crm-publish-content");this.atSelectPanel||(f=new y(_.extend({trigger:g,singleCked:!1,data:c},{})),f.on("select",function(b){var c=d.filter(".fs-publish-at-focus").get(0)||d.eq(0).get(0);_.each(b,function(b){h.appendInput(c,"@"+b[0].name+" "),a._contentChange()}),$(c).trigger("autosize.resize"),f.unselect("all","all")}),this.atSelectPanel=f),d.focus(function(){d.removeClass("fs-publish-at-focus"),$(this).addClass("fs-publish-at-focus")}),d.change(function(){d.trigger("autosize.resize")})},_initOthers:function(){this.element.html(g),_.each(this.get("display"),function(a){$(".crm-publish-operation-"+a,this.element).show()}),$(".crm-publish-title",this.element).text(this.get("title")),$(".crm-publish-content",this.element).attr("placeholder",this.get("placeholder"));var a=_.extend(this.get(this.get("type")+"Condition"),this.get("condition"));this.set("condition",a),l.AdjustTextAreaSize({element:$(".crm-publish-content",this.element)})},_initTags:function(){var a=h.getTagsByType(h.CONSTANT.TAG_TYPE.EVENT),b="";_.each(a,function(a){var c="",d=!1;_.each(a.options,function(a){a.isDefault?(d=!0,c+="<li class='crm-publish-operation-tag-option-item' data-isDefault = true ><span class='mn-radio-item mn-selected crm-publish-operation-tag-option-radio' data-isDefault = true data-fBusinessTagID = "+a.fBusinessTagID+" data-fBusinessTagOptionID = "+a.fBusinessTagOptionID+"></span><span class='crm-publish-operation-tag-option-name fn-text-overflow' title='"+a.name+"'>"+a.name+"</span><span class = 'crm-publish-operation-tag-option-default fn-right'>默认</span></li>"):c+="<li class='crm-publish-operation-tag-option-item' data-isDefault = false ><span class='mn-radio-item crm-publish-operation-tag-option-radio' data-isDefault = false data-fBusinessTagID = "+a.fBusinessTagID+" data-fBusinessTagOptionID = "+a.fBusinessTagOptionID+"></span><span class='crm-publish-operation-tag-option-name fn-text-overflow' title='"+a.name+"'>"+a.name+"</span></li>"}),d||(c="<li class='crm-publish-operation-tag-option-item' data-isDefault = true><span class='mn-radio-item mn-selected crm-publish-operation-tag-option-radio' data-isDefault = true data-fBusinessTagOptionID = 0></span><span class='crm-publish-operation-tag-option-name fn-text-overflow'>无</span></li>"+c),c="<div class = 'mn-radio-box crm-publish-operation-tag-option crm-publish-operation-tag-"+a.fBusinessTagID+" fn-hide''><ul>"+c,c+="</ul></div>",b+="<li class='crm-publish-operation-event-tag' data-fBusinessTagID = "+a.fBusinessTagID+"><span class='crm-publish-operation-event-tag-name fn-text-overflow' title = '"+a.name+"'>"+a.name+"</span><span class='crm-publish-operation-event-tag-icon'>></span>"+c+"</li>"}),$(".crm-publish-operation-tag-container ul",this.element).html(b)},_initEvents:function(){var a=this;$(document).on("click",function(a){$(a.target).is(".crm-publish-operation-tag")||$(a.target).is(".crm-publish-operation-tag-container")||$(a.target).is(".crm-publish-operation-event-tag")||$(a.target).is(".crm-publish-operation-event-tag-icon")||$(a.target).is(".crm-publish-operation-tag-option")||$(a.target).is(".crm-publish-operation-tag-option-item")||$(a.target).is(".crm-publish-operation-tag-option-radio")||$(a.target).is(".crm-publish-operation-tag-option-name")||$(a.target).is(".crm-publish-operation-tag-option-default")||($(".crm-publish-operation-tag",this.element).removeClass("crm-publish-operation-active"),$(".crm-publish-operation-tag-container",this.element).hide())}),h.mnEvent($(".crm-publish-operation-time-alarm-select",this.element),"change",function(b){$(".crm-publish-operation-time",a.element).addClass("crm-publish-operation-time-selected"),1==b&&($(".crm-publish-operation-time-alarm-info",a.element).hide(),$(".crm-publish-operation-time",a.element).removeClass("crm-publish-operation-time-selected")),a.showRemindTime(b);var c=a.get("condition");c.remindType=b,a.set("condition",c)})},showRemindTime:function(a){var b=this;if(1==a)return $(".crm-publish-operation-time-alarm-info",b.element).hide(),$(".crm-publish-operation-time",b.element).removeClass("crm-publish-operation-time-selected"),void 0;var c=n();if(c=b._getStartDate()){switch($(".crm-publish-operation-time-alarm-info",b.element).show(),a){case 3:c=c.add("minutes",-5);break;case 4:c=c.add("minutes",-15);break;case 5:c=c.add("minutes",-30);break;case 6:c=c.add("hours",-1);break;case 7:c=c.add("hours",-2);break;case 8:c=c.add("hours",-6);break;case 9:c=c.add("days",-1);break;case 10:c=c.add("days",-2)}$(".crm-publish-operation-time-alarm-info-datetime",b.element).text(c.format("YYYY年MM月DD日 HH:mm"))}},_initAttachUploader:function(){var a=this,b=new j({element:$(".crm-publish-operation-attach-input",this.element),h5Opts:{multiple:!0,accept:"*/*",filter:function(b){var c=a.get("activeUploader"),d="attach";return"picture"==c&&(d="img"),a.uploadFilter(b,d)}},flashOpts:{file_types:"*.*",file_types_description:"所有文件",button_width:61,button_height:20},onSuccess:function(b,c){var d=a.get("condition"),e=JSON.parse(c).value,f=a.get("files");if(a.get("suportH5")){var g=_.find(f,function(a){return a.id==b.id});d.fileInfos.push({value:g.type,value1:e.filePath,value2:b.size,value3:b.name})}else{var i=a.get("activeUploader"),j=a.get("attachUploader"),k=a.get("flashFiles"),k=_.filter(k,function(a){return a.id!=b.id}),l=2;"attach"==i&&(l=3,a._addAttach(b,e.filePath)),"picture"==i&&a._addPicture(b,e.filePath),d.fileInfos.push({value:l,value1:e.filePath,value2:b.size,value3:b.name}),j.removeFile(b.id,!1),k.length>0?j.startUpload():h.hideMask(),a.set("flashFiles",k),a.set("attachUploader",j)}a.set("condition",d)},onProgress:function(){},onFailure:function(){o.done()},onSelect:function(b){var c=a.get("activeUploader");if(a.get("suportH5"))"attach"==c&&a._addAttach(b),"picture"==c&&a._addPicture(b);else{var d="attach";"picture"==c&&(d="img");var e=a.uploadFilter([b],d),f=a.get("flashFiles");_.each(e,function(b){0==f.length&&(h.showMask(),a.get("attachUploader").startUpload()),f.push(b)}),a.set("flashFiles",f)}},onComplete:function(){a.get("suportH5")&&a._send()}});this.set("attachUploader",b)},uploadFilter:function(a,b){a=[].concat(a);var c,d=[],e=this.get("files"),f={img:2,attach:3},g=this.get("contactData").u.uploadFileSizeLimit;return _.each(a,function(a){a.size<1024*1024*g&&a.size>0&&(_.find(e,function(c){return c.name==a.name&&f[b]==c.type})||("img"==b&&"jpg"==h.getFileType(a)&&d.push(a),"attach"==b&&d.push(a)))}),d.length<a.length&&("img"==b?c="选择的文件类型必须为jpg、gif、jpeg或png，大小不能超过"+g+"MB且文件名不能相同，内容不能为空。本次添加了"+d.length+"个文件。":"attach"==b&&(c="选择的文件大小不能超过"+g+"MB且文件名不能相同，内容不能为空。本次添加了"+d.length+"个文件。"),h.alert(c)),d},_initContactDialog:function(){var a=this,b=this.get("condition").customerID;if(b){var c=new k({title:"选择联系人",url:"/Contact/GetContactsByCustomerID/",type:"modify",defaultCondition:{customerID:b}});c.on("selected",function(b){a._addContact(b)}),this.set("contactsDialog",c)}},_addAttach:function(a,b){var c=this,d="",f="";if(b&&(f=b),a){var g=this.get("attachNumber"),i=this.get("attachSize"),j=this.get("files");j.push({id:a.id,type:3,name:a.name}),this.set("files",j),d+="<div  class = 'crm-publish-operation-attach-box fn-left fn-clear'>",d+="<img title = '"+a.name+"' src='"+e.BLANK_IMG+"' alt='icon' class='crm-publish-operation-attach-image fs-attach-"+h.getFileType({name:a.name},!0)+"-small-icon file-icon fn-left'/>",d+="<div class = 'crm-publish-operation-attach-name fn-left fn-clear fn-text-overflow' title = '"+a.name+"'>"+a.name+"</div><div fileId = '"+a.id+"' fileSize = '"+a.size+"' filePath = '"+f+"' class='crm-publish-operation-attach-close fn-hide fn-right'>x</div></div>",setTimeout(function(){$(".crm-publish-operation-attach-list",c.element).append(d),c.get("suportH5")||c._setFileInputPosition()},50),g+=1,i+=a.size,this.set("attachNumber",g),this.set("attachSize",i),$(".crm-publish-operation-attach-num",this.element).text(g),$(".crm-publish-operation-attach-number",this.element).text(g),$(".crm-publish-operation-attach-size",this.element).text(h.getFileSize(i)),1==g&&($(".crm-publish-operation-attach",this.element).addClass("crm-publish-operation-attach-selected"),$(".crm-publish-operation-attach-info",this.element).show(),$(".crm-publish-operation-attach-num",this.element).show())}},_attachDelete:function(a){var b=$(a.currentTarget),c=b.attr("fileId"),d=b.attr("fileSize"),e=this.get("attachNumber"),f=this.get("attachSize"),g=this.get("files");if(g=_.filter(g,function(a){return a.id!=c}),!this.get("suportH5")){var i=this.get("condition"),j=i.fileInfos,k=b.attr("filePath");k&&(j=_.filter(j,function(a){return a.value1!=k
}),i.fileInfos=j,this.set("condition",i))}this.set("files",g),e-=1,f-=d,this.set("attachNumber",e),this.set("attachSize",f),this.get("attachUploader").removeFile(c),b.parent().remove(),$(".crm-publish-operation-attach-num",this.element).text(e),$(".crm-publish-operation-attach-number",this.element).text(e),$(".crm-publish-operation-attach-size",this.element).text(h.getFileSize(f)),0==e&&($(".crm-publish-operation-attach",this.element).removeClass("crm-publish-operation-attach-selected"),$(".crm-publish-operation-attach-info",this.element).hide(),$(".crm-publish-operation-attach-num",this.element).hide()),this.get("suportH5")||this._setFileInputPosition()},_initStartDate:function(){var a=this,b=new m({element:$(".crm-publish-operation-time-start-date",this.element),placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）",isCRM:!0}),c=this.get("condition");b.on("change",function(){a.showRemindTime(c.remindType)}),this.set("startDate",b)},_initAlarmDate:function(){var a=new m({element:$(".crm-publish-operation-time-alarm-date",this.element),placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）",isCRM:!0});a.setValue(n()),this.set("alarmDate",a)},_initTime:function(){var a=this,b=$(".crm-publish-operation-time-start-time",this.element);ts=new v({element:b}),this.set("ts",ts),this.get("startDate").on("change",function(){""==ts.getValue()&&a.get("startDate").getValue()&&ts.selector.select(0)}),ts.on("change",function(){var b=a.get("condition");a.showRemindTime(b.remindType)})},_addPicture:function(a,b){var c=this,d="",f="",g="";if(b&&(f=b),a){!this.get("suportH5")&&b&&(g=e.API_PATH+"/df/getTempImg?id="+b);var i=this.get("pictureNumber"),j=this.get("pictureSize"),k=this.get("files");if(k.push({id:a.id,type:2,name:a.name}),this.set("files",k),d+="<div class = 'crm-publish-operation-picture-box fn-left fn-clear'>",d+="<img fileId = 'img_"+a.id+"' class = 'crm-publish-operation-picture-image' src = '"+g+"' />",d+="<div fileId = '"+a.id+"' fileSize = '"+a.size+"' filePath = '"+f+"' class='crm-publish-operation-picture-close fn-hide fn-right'>x</div></div>",this.get("suportH5")){var l=new FileReader;l.onload=function(b){var d=new Image;d.src=b.target.result,d.onload=function(){var d=$("[fileId=img_"+a.id+"]",c.element);d.attr("src",b.target.result);var e=c._clacImgZoomParam(139,103,d.width(),d.height());d.css({height:e.height,width:e.width})}},l.readAsDataURL(a)}$(".crm-publish-operation-picture-list",c.element).append(d),c.get("suportH5")||c._setFileInputPosition(),i+=1,j+=a.size,this.set("pictureNumber",i),this.set("pictureSize",j),$(".crm-publish-operation-picture-num",this.element).text(i),$(".crm-publish-operation-picture-number",this.element).text(i),$(".crm-publish-operation-picture-size",this.element).text(h.getFileSize(j)),1==i&&($(".crm-publish-operation-picture",this.element).addClass("crm-publish-operation-picture-selected"),$(".crm-publish-operation-picture-info",this.element).show(),$(".crm-publish-operation-picture-num",this.element).show())}},_clacImgZoomParam:function(a,b,c,d){var e={top:0,left:0,width:c,height:d};return(c>a||d>b)&&(rateWidth=c/a,rateHeight=d/b,rateWidth>rateHeight?(e.width=a,e.height=Math.round(d/rateWidth)):(e.width=Math.round(c/rateHeight),e.height=b)),e.left=Math.round((a-e.width)/2),e.top=Math.round((b-e.height)/2),e},_pictureDelete:function(a){var b=$(a.currentTarget),c=b.attr("fileId"),d=b.attr("fileSize"),e=this.get("pictureNumber"),f=this.get("pictureSize"),g=this.get("files");if(g=_.filter(g,function(a){return a.id!=c}),this.set("files",g),!this.get("suportH5")){var i=this.get("condition"),j=i.fileInfos,k=b.attr("filePath");k&&(j=_.filter(j,function(a){return a.value1!=k}),i.fileInfos=j,this.set("condition",i))}e-=1,f-=d,this.set("pictureNumber",e),this.set("pictureSize",f),this.get("attachUploader").removeFile(c),b.parent().remove(),$(".crm-publish-operation-picture-num",this.element).text(e),$(".crm-publish-operation-picture-number",this.element).text(e),$(".crm-publish-operation-picture-size",this.element).text(h.getFileSize(f)),0==e&&($(".crm-publish-operation-picture",this.element).removeClass("crm-publish-operation-picture-selected"),$(".crm-publish-operation-picture-info",this.element).hide(),$(".crm-publish-operation-picture-num",this.element).hide()),this.get("suportH5")||this._setFileInputPosition()},_showContactDialog:function(){this.get("contactsDialog").show(this.get("contacts"))},_addContact:function(a){var b="";_.each(a,function(a){b+="<div class = 'crm-publish-operation-contact-box fn-left fn-clear'>",b+="<img src ='"+h.getAvatarLink(a.picturePath,"2")+"' class = 'crm-publish-operation-contact-img'/>",b+="<div class = 'crm-publish-operation-contact-info'><div class = 'crm-publish-operation-contact-name fn-text-overflow' title = '"+a.name+"'>"+a.name+"</div>",b+="<div class = 'crm-publish-operation-contact-department fn-text-overflow' title = '"+a.post+"&nbsp;"+a.department+"'>"+a.post+"&nbsp;"+a.department+"</div></div>",b+="<div class = 'crm-publish-operation-contact-company fn-clear fn-text-overflow' title = '"+a.company+"'>"+a.company+"</div>",b+="<div contactID = '"+a.contactID+"' class='crm-publish-operation-contact-close fn-hide fn-right'>x</div></div>"}),$(".crm-publish-operation-contact-list",self.element).html(b),this.set("contacts",a),$(".crm-publish-operation-contact-num",this.element).text(a.length),a.length>0&&($(".crm-publish-operation-contact",this.element).addClass("crm-publish-operation-contact-selected"),$(".crm-publish-operation-contact-num",this.element).show())},_contactDelete:function(a){var b=$(a.currentTarget),c=b.attr("contactID"),d=this.get("contacts");d=_.filter(d,function(a){return a.contactID!=c}),this.set("contacts",d),b.parent().remove(),$(".crm-publish-operation-contact-num",this.element).text(d.length),0==d.length&&($(".crm-publish-operation-contact",this.element).removeClass("crm-publish-operation-contact-selected"),$(".crm-publish-operation-contact-num",this.element).hide())},_getHourOption:function(a){var b=n().hour(),c=[{text:"00点",value:0,selected:a&&0==b},{text:"01点",value:1,selected:a&&1==b},{text:"02点",value:2,selected:a&&2==b},{text:"03点",value:3,selected:a&&3==b},{text:"04点",value:4,selected:a&&4==b},{text:"05点",value:5,selected:a&&5==b},{text:"06点",value:6,selected:a&&6==b},{text:"07点",value:7,selected:a&&7==b},{text:"08点",value:8,selected:a&&8==b},{text:"09点",value:9,selected:a&&9==b},{text:"10点",value:10,selected:a&&10==b},{text:"11点",value:11,selected:a&&11==b},{text:"12点",value:12,selected:a&&12==b},{text:"13点",value:13,selected:a&&13==b},{text:"14点",value:14,selected:a&&14==b},{text:"15点",value:15,selected:a&&15==b},{text:"16点",value:16,selected:a&&16==b},{text:"17点",value:17,selected:a&&17==b},{text:"18点",value:18,selected:a&&18==b},{text:"19点",value:19,selected:a&&19==b},{text:"20点",value:20,selected:a&&20==b},{text:"21点",value:21,selected:a&&21==b},{text:"22点",value:22,selected:a&&22==b},{text:"23点",value:23,selected:a&&23==b},{text:"24点",value:24,selected:a&&24==b}];return c},_getMinuteOption:function(a){var b=n().minute(),c=[{text:"00分",value:0,selected:a&&b>=0&&10>b},{text:"10分",value:10,selected:a&&b>=10&&20>b},{text:"20分",value:20,selected:a&&b>=20&&30>b},{text:"30分",value:30,selected:a&&b>=30&&40>b},{text:"40分",value:40,selected:a&&b>=40&&50>b},{text:"50分",value:50,selected:a&&b>=50}];return c},_startUpload:function(){var a=this,b=this.get("condition"),c=this.get("pictureNumber"),d=this.get("attachNumber");if(void 0!=b.startTime&&(b.startTime=this._getStartDateTime()),b.remindType&&1!=b.remindType&&!b.startTime)return h.alert("请选择开始时间"),void 0;if($(".crm-publish-button-ok",a.element).addClass("crm-publish-button-disable"),void 0!=b.associationContactIDs)if(this.get("isContact"))b.associationContactIDs=b.contactIDs;else{var e=[];_.each(this.get("contacts"),function(a){e.push(a.contactID)}),b.associationContactIDs=e.join(",")}void 0!=b.listTagOptionID&&(b.listTagOptionID=this._getTagOption()),b.feedContent=$(".crm-publish-content",this.element).val(),c+d>0&&this.get("suportH5")?(this.get("attachUploader").startUpload(),o.start()):this._send(),this.set("condition",b)},_send:function(){var a=this,b=this.get("type"),c="/Event/AddEvent";"feed"==b&&(c="/CrmFeed/SendCrmFeed");var d=this.get("customerInfo");if(d){var e=h.getCustomerConfig()||[],f=d.customerID,g=_.find(e,function(a){return a.customerID==f});g||e.unshift(d),e.length>50&&(e=e.slice(0,50)),h.setCustomerConfig(e)}var i=this.get("contactInfo");if(i){var j=h.getContactsConfig()||[],f=i.contactID,g=_.find(j,function(a){return a.contactID==f});g||j.unshift(i),j.length>50&&(j=j.slice(0,50)),h.setContactsConfig(j)}h.api({url:c,type:"post",dataType:"json",data:this.get("condition"),success:function(b){return b.success?(o.done(),h.remind(2,"记录发布成功"),a._cancel(),a.trigger("post",b.value),void 0):(""==$.trim($(".crm-publish-content",this.element).val())?$(".crm-publish-button-ok",this.element).addClass("crm-publish-button-disable"):$(".crm-publish-button-ok",this.element).removeClass("crm-publish-button-disable"),void 0)},error:function(){o.done()}})},_getStartDateTime:function(){this.get("condition");var a=this._getStartDate();return a?a._d.getTime()/1e3:0},_getAlarmDateTime:function(){return this._getStartDateTime()},_getStartDate:function(){var a=this.get("startDate"),b=this.get("ts"),c=a.getValue(),d=b.getValue();return c&&d?n(c+" "+d,"YYYY-MM-DD HH:mm:ss"):0},_getTagOption:function(){var a=$(".mn-selected.crm-publish-operation-tag-option-radio",this.element);return result=[],_.each(a,function(a){var b=$(a).attr("data-fBusinessTagID"),c=$(a).attr("data-fBusinessTagOptionID"),d=$(a).attr("data-isDefault");"false"==d&&result.push(b+","+c)}),result},destroy:function(){this._cancel(),this.get("startDate")&&this.get("startDate").destroy(),this.get("alarmDate")&&this.get("alarmDate").destroy(),this.get("ts")&&this.get("ts").destroy(),this.topicDialog&&this.topicDialog.destroy(),this.atSelectPanel&&this.atSelectPanel.destroy(),this.get("contactsDialog")&&this.get("contactsDialog").destroy();var a=z.superclass.destroy.apply(this,arguments);return a}});c.exports=z});