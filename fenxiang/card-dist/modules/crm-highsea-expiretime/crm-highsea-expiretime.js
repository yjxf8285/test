/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-highsea-expiretime/crm-highsea-expiretime",["dialog","util","modules/crm-highsea-expiretime/crm-highsea-expiretime.html","modules/publish/publish-helper","moment"],function(a,b,c){var d=a("dialog");a("util");var e=a("modules/crm-highsea-expiretime/crm-highsea-expiretime.html"),f=a("modules/publish/publish-helper"),g=f.DateSelect;a("moment");var h=d.extend({attrs:{content:e,width:455,attachId:0,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",attachName:""},setup:function(){var a=h.superclass.setup.apply(this,arguments);return a},render:function(){var a=h.superclass.render.apply(this,arguments),b=this.element;return this.time=new g({element:$(".crm-highsea-expiretime-settime",b),placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）",isCRM:!0}),a},hide:function(){var a=h.superclass.hide.apply(this,arguments);return this.reset(),a},show:function(a,b){var c=h.superclass.show.apply(this,arguments);this.element;var d=this;return d.set("originTime",a),d.set("days",b),d.setComent(),c},setComent:function(){var a=this,b=a.get("originTime"),c=a.get("days"),d="(余"+c+"天)",e=$(".crm-highsea-expiretime-content b",this.element);e.text(d),a.time.on("change",function(){var b=1e3*a.time.getTime(),d=a.get("originTime"),f=a._getDay(d,b);f=Math.floor(f)+c,e.text("(余"+f+"天)")}),a.time.setValue(b)},_getDay:function(a,b){return a=new Date(a),a.setHours(0),a.setMinutes(0),a.setSeconds(0),b=new Date(b),b.setHours(0),b.setMinutes(0),b.setSeconds(0),Math.floor((b.getTime()-a.getTime())/864e5)},events:{"click .crm-highsea-expiretime-button-ok":"_submit","click .crm-highsea-expiretime-button-cancel":"_cancel"},reset:function(){},_cancel:function(){this.hide()},_submit:function(){var a=this.time.getTime();this.trigger("submit",a),this.hide()},destroy:function(){var a=Rename.superclass.destroy.apply(this,arguments);return a}});c.exports=h});