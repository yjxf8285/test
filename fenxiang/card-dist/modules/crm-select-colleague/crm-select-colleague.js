/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-select-colleague/crm-select-colleague",["dialog","util","uilibs/pagination2","modules/crm-select-colleague/crm-select-colleague.html"],function(a,b,c){var d=a("dialog"),e=a("util"),f=a("uilibs/pagination2"),g=a("modules/crm-select-colleague/crm-select-colleague.html"),h=d.extend({attrs:{title:"选择同事",content:g,isMultiSelect:!1,hasDeptTree:!1,hasWorkLeaveBtn:!1,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",width:1080,height:695,condition:{},needToRest:!1,defaultCondition:{queryType:0,isFirstChar:!1,keyword:"",circleID:-1,exceptEmployeeIDs:"",isStop:!1,pageSize:20,pageNumber:1},result:[]},setup:function(){var a=h.superclass.setup.apply(this,arguments),b=e.deepClone(this.get("defaultCondition"));return this.set("condition",b),a},render:function(){var a=h.superclass.render.apply(this,arguments);return this._initOthers(),a},hide:function(){var a=h.superclass.hide.apply(this,arguments);return this.reset(),a},show:function(a){var b=h.superclass.show.apply(this,arguments);if(a){var c=this.get("condition");_.extend(c,a),this.set("condition",c)}return this._getData(this.get("condition")),b},reset:function(a){a||this._unselectAll(),$(".fs-col-select-search-input",this.element).val(""),$(".fs-col-select-unselect-all",this.element).hide();var b=e.deepClone(this.get("defaultCondition"));this.set("condition",b),this.pagination&&this.pagination.reset()},events:{"click .fs-col-multiselect-info":"_showSelected","click button.fs-col-select-unselect-all":"_unselectAll","click .fs-col-select-search-button":"_onButtonClick","keydown .fs-col-select-search-input":"_onButtonKeydown","change .fs-col-select-search-input":"_inputChange","click .fs-col-select-button-group1":"_onWorkingButtonClick","mouseover .fs-col-select-button-group1":"_onButtonGroupMouseOver","mouseout .fs-col-select-button-group1":"_onButtonGroupMouseOut","click .fs-col-select-button-group2":"_onLeaveButtonClick","mouseover .fs-col-select-button-group2":"_onButtonGroupMouseOver","mouseout .fs-col-select-button-group2":"_onButtonGroupMouseOut","click .fs-col-select-colleague":"_onColleageClick","mouseover .fs-col-select-colleague":"_onColleageMouseOver","mouseout .fs-col-select-colleague":"_onColleageMouseOut","click .fs-col-select-button-ok":"_submit","click .fs-col-select-button-cancel":"_cancel"},_initOthers:function(){this.get("hasWorkLeaveBtn")&&($(".fs-col-select-button-group-box",this.element).show(),$(".fs-col-select-search-box",this.element).css("width",748),$(".fs-col-select-search-input",this.element).css("width",676)),this.get("isMultiSelect")?($(".fs-col-multiselect-info-container",this.element).show(),$(".fs-col-select-button-ok",this.element).show()):($(".fs-col-multiselect-info-container",this.element).hide(),$(".fs-col-select-button-ok",this.element).hide()),this.get("defaultCondition").isStop?($(".fs-col-select-button-group2",this.element).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group1",this.element).removeClass("fs-col-select-button-group-selected")):($(".fs-col-select-button-group1",this.element).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group2",this.element).removeClass("fs-col-select-button-group-selected")),this.get("title")&&$(".fs-col-select-title",this.element).text(this.get("title"));var a=this;a.pagination=new f({element:$(".fs-col-select-result-pagination",a.element),pageSize:a.get("condition").pageSize,totalSize:0,activePageNumber:1}),a.pagination.on("page",function(b){var c=a.get("condition");c.pageNumber=b,a.set("condition",c),a._getData(c)})},_getData:function(a){var b=this;e.api({url:"/Employee/GetEmployeesForSearch",type:"get",dataType:"json",data:a,success:function(a){a.success&&b._getColleagueHtml(a.value.employees,a.value.totalCount)}})},_getColleagueHtml:function(a,b){var c="",d=this;return a?(b>=0&&this.pagination.setTotalSize(b),$(".fs-col-select-result-container",this.element).empty(),_.each(a,function(a){var b=d.get("result"),f=_.find(b,function(b){return b.employeeID==a.employeeID});c+=f?"<div class = 'fs-col-select-colleague fs-col-select-colleague-selected fn-left fn-clear' data-value = '"+a.employeeID+"' data-name ='"+a.name+"' data-profileImage = '"+a.profileImage+"'>":"<div class = 'fs-col-select-colleague fn-left fn-clear' data-value = '"+a.employeeID+"' data-name ='"+a.name+"' data-profileImage = '"+a.profileImage+"'>",c+="<img src ='"+e.getAvatarLink(a.profileImage,1)+"' class = 'fs-col-select-colleague-img' data-value = '"+a.employeeID+"' data-name ='"+a.name+"' data-profileImage = '"+a.profileImage+"' />&nbsp;&nbsp;"+a.name+"</div>"}),$(".fs-col-select-result-container",this.element).html(c),$(".fs-col-select-result-box",this.element).show(),$(".fs-col-select-result-selected-box",this.element).hide(),d.set("needToRest",!1),void 0):c},_showSelected:function(a){$(a.currentTarget).hasClass("fs-col-multiselect-info-disable")||this.get("needToRest")||(this.set("needToRest",!0),$(".fs-col-select-search-box",this.element).css("width",$(".fs-col-select-search-box",this.element).width()-103),$(".fs-col-select-search-input",this.element).css("width",$(".fs-col-select-search-input",this.element).width()-103).val(""),$(".fs-col-select-unselect-all",this.element).show(),$(".fs-col-select-result-box",this.element).hide(),$(".fs-col-select-result-selected-box",this.element).show())},_unselectAll:function(){var a=this.get("result");$(".fs-col-multiselect-info",this.element).hasClass("fs-col-multiselect-info-active")&&($(".fs-col-multiselect-info",this.element).addClass("fs-col-multiselect-info-disable"),$(".fs-col-multiselect-info",this.element).removeClass("fs-col-multiselect-info-active")),$(".fs-col-multiselect-number",this.element).text(0),_.each(a,function(a){$("[data-value="+a.employeeID+"]",$(".fs-col-select-result-box",this.element)).removeClass("fs-col-select-colleague-selected")}),this.set("result",[]),this._toSelecting(),$(".fs-col-select-result-selected-box",this.element).empty();var b=this.get("condition")||{};b.keyword=$.trim($(".fs-col-select-search-input",this.element).val())||"",b.pageNumber=1,this.set("condition",b),this._getData(b)},_toSelecting:function(){this.get("needToRest")&&(this.set("needToRest",!1),$(".fs-col-select-search-box",this.element).css("width",$(".fs-col-select-search-box",this.element).width()+103),$(".fs-col-select-search-input",this.element).css("width",$(".fs-col-select-search-input",this.element).width()+103),$(".fs-col-select-unselect-all",this.element).hide(),$(".fs-col-select-result-selected-box",this.element).hide(),$(".fs-col-select-result-box",this.element).show())},_onButtonClick:function(){var a=this.get("condition"),b=$.trim($(".fs-col-select-search-input",this.element).val());b>200&&(b=b.substr(0,200)),a.keyword=b,this.set("condition",a),this._getData(a)},_onButtonKeydown:function(a){var b=$(a.currentTarget),c=b.val();c.length>200&&b.val(c.substr(0,200));var d=a.which;13==d&&(this._onButtonClick(),a.preventDefault())},_inputChange:function(a){var b=$(a.currentTarget),c=b.val();c.length>200&&b.val(c.substr(0,200))},_onWorkingButtonClick:function(a){var b=this.get("condition");b.isStop&&(b.isStop=!1,$(a.currentTarget).hasClass("fs-col-select-button-group-selected")||$(a.currentTarget).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group2",this.element).hasClass("fs-col-select-button-group-selected")&&$(".fs-col-select-button-group2").removeClass("fs-col-select-button-group-selected"),this.set("condition",b),this._getData(b))},_onLeaveButtonClick:function(a){var b=this.get("condition");b.isStop||(b.isStop=!0,$(a.currentTarget).hasClass("fs-col-select-button-group-selected")||$(a.currentTarget).addClass("fs-col-select-button-group-selected"),$(".fs-col-select-button-group1",this.element).hasClass("fs-col-select-button-group-selected")&&$(".fs-col-select-button-group1").removeClass("fs-col-select-button-group-selected"),this.set("condition",b),this._getData(b))},_onButtonGroupMouseOver:function(a){$(a.currentTarget).hasClass("fs-col-select-button-group-active")||$(a.currentTarget).addClass("fs-col-select-button-group-active")},_onButtonGroupMouseOut:function(a){$(a.currentTarget).hasClass("fs-col-select-button-group-active")&&$(a.currentTarget).removeClass("fs-col-select-button-group-active")},_onColleageClick:function(a){var b=this.get("isMultiSelect"),c=this.get("result");b?this._multiSelect(a):(c.push({employeeID:$(a.currentTarget).attr("data-value"),name:$(a.currentTarget).attr("data-name"),profileImage:$(a.currentTarget).attr("data-profileImage")}),this.set("result",c),this._submit(a))},_multiSelect:function(a){var b=this.get("result");$(a.currentTarget).hasClass("fs-col-select-colleague-selected")?($(a.currentTarget).removeClass("fs-col-select-colleague-selected"),b=_.filter(b,function(b){return b.employeeID!=$(a.currentTarget).attr("data-value")}),$("[data-value="+$(a.currentTarget).attr("data-value")+"]",$(".fs-col-select-result-selected-box",this.element)).remove(),$("[data-value="+$(a.currentTarget).attr("data-value")+"]",$(".fs-col-select-result-box",this.element)).removeClass("fs-col-select-colleague-selected")):($(a.currentTarget).addClass("fs-col-select-colleague-selected"),b.push({employeeID:$(a.currentTarget).attr("data-value"),name:$(a.currentTarget).attr("data-name"),profileImage:$(a.currentTarget).attr("data-profileImage")}),$(".fs-col-select-result-selected-box",this.element).append($(a.currentTarget).clone(!0))),this.set("result",b),b.length>0&&$(".fs-col-multiselect-info",this.element).hasClass("fs-col-multiselect-info-disable")&&($(".fs-col-multiselect-info",this.element).removeClass("fs-col-multiselect-info-disable"),$(".fs-col-multiselect-info",this.element).addClass("fs-col-multiselect-info-active")),b.length<=0&&$(".fs-col-multiselect-info",this.element).hasClass("fs-col-multiselect-info-active")&&($(".fs-col-multiselect-info",this.element).addClass("fs-col-multiselect-info-disable"),$(".fs-col-multiselect-info",this.element).removeClass("fs-col-multiselect-info-active"),this._toSelecting()),$(".fs-col-multiselect-number",this.element).text(b.length)},_onColleageMouseOver:function(a){!$(a.currentTarget).hasClass("fs-col-select-colleague-active")&&$(a.currentTarget).hasClass("fs-col-select-colleague")&&$(a.currentTarget).addClass("fs-col-select-colleague-active")},_onColleageMouseOut:function(a){$(a.currentTarget).hasClass("fs-col-select-colleague-active")&&$(a.currentTarget).removeClass("fs-col-select-colleague-active")},_submit:function(){this.get("isMultiSelect")?this.trigger("selected",this.get("result")):this.trigger("selected",this.get("result")[0]),this.hide()},_cancel:function(){this.hide()},destroy:function(){var a;return this.reset(!0),a=h.superclass.destroy.apply(this,arguments)}});c.exports=h});