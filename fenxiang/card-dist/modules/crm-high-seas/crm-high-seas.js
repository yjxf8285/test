/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-high-seas/crm-high-seas",["widget","modules/crm-high-seas/crm-high-seas.html","modules/crm-highsea-editsetting/crm-highsea-editsetting","util"],function(a,b,c){var d=window,e=d.FS;navTpl=e.tpl;var f=a("widget"),g=a("modules/crm-high-seas/crm-high-seas.html"),h=a("modules/crm-highsea-editsetting/crm-highsea-editsetting"),i=a("util"),j=f.extend({attrs:{api:"/HighSeas/GetAllHighSeas",type:"all",navClass:".nav-highseas",condition:{},canCreate:!0,createDialog:null,url:"#crmsettings/highseas/"},events:{"click .crm-high-seas-create":"_create","click .crm-high-seas-container-ul li":"_showList"},setup:function(){var a=j.superclass.render.apply(this,arguments);return this._init(),a},_init:function(){$(this.element).html(g),this._getData(this.get("condition")),i.regGlobalClick($(".crm-high-seas-container",this.element)),this._initCreateDialog()},_initEvent:function(){var a=this;$(document).on("click",function(b){$(b.target).is(".crm-high-seas-create")||$(b.target).is(".crm-high-seas-to-list")||$(b.target).is(a.get("navClass"))||$(".crm-high-seas-container",$(a.element)).hide()})},_initCreateDialog:function(){var a=this,b=new h;b.on("addSuccess",function(b){a.refresh(),navTpl.navRouter.navigate("#crmsettings/highseas/=/param-"+encodeURIComponent(JSON.stringify(b)),{trigger:!0})}),this.set("createDialog",b)},_create:function(){this.get("createDialog").show()},_getData:function(a){var b=this;i.api({url:this.get("api"),type:"get",dataType:"json",data:a,success:function(a){a.success&&b._generateHtml(a.value.highSeas)}})},_generateHtml:function(a){var b=this,c="",d=i.getTplQueryParams2(),e=0;if(d&&(e=d.id),a.length<1?$(".crm-no-high-seas",this.element).show():$(".crm-no-high-seas",this.element).hide(),_.each(a,function(a){var d="";e==a.highSeasID&&(d="crm-high-seas-active");var f={id:a.highSeasID,name:a.name},g=encodeURIComponent(JSON.stringify(f));c+="<li class = "+d+"><a class = 'crm-high-seas-to-list' href = "+b.get("url")+"=/param-"+g+" data-value = '"+a.highSeasID+"'><div class = 'crm-high-seas-to-list-font fn-text-overflow' title = '"+a.name+"'>"+a.name+"</div></a></li>"}),$(".crm-high-seas-container-ul",$(this.element)).html(c),this.get("canCreate")&&$(".crm-high-seas-create-ul",this.element).length<1){var f="<ul class = 'crm-high-seas-create-ul'><li><a class = 'crm-high-seas-create'>新建公海...</a></li></ul>";$(".crm-high-seas-container",$(this.element)).append(f)}},_showList:function(a){var b=$(a.currentTarget);$(".crm-high-seas-active",$(this.element)).removeClass("crm-high-seas-active"),b.addClass("crm-high-seas-active"),$(".crm-high-seas-container",$(this.element)).hide()},show:function(a){var b=i.getTplQueryParams2(),c=0;b&&(c=b.id),$(".crm-high-seas-active a",this.element).attr("data-value")!=c&&$(".crm-high-seas-active",this.element).removeClass("crm-high-seas-active");var d=$(a.currentTarget);$(".crm-high-seas-container",$(this.element)).css({left:d.offset().left+d.width()+1,top:d.offset().top-1}),$(".crm-high-seas-container",$(this.element)).toggle()},hide:function(){$(".crm-high-seas-container",$(this.element)).hide()},refresh:function(){this._getData(this.get("condition"))},destroy:function(){var a=j.superclass.render.apply(this,arguments);return a}});c.exports=j});