/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-customer-opportunity/crm-customer-opportunity",["modules/crm-customer-opportunity/crm-customer-opportunity.html","dialog","util","moment"],function(a,b,c){var d=window,e=d.FS,f=e.tpl;f.store,f.list;var g=a("modules/crm-customer-opportunity/crm-customer-opportunity.html");a("dialog");var h=a("util"),i=a("moment"),j=Backbone.View.extend({tagName:"div",className:"customer-basic-module",template:_.template($(g).filter(".crm-customer-baseinfo-template").html()),options:{warpEl:null,customerData:null},initialize:function(){this.loadData()},render:function(){var a=this.$el,b=this.options.customerData.value.FCustomer,c=this.template;a.html(c({fullName:b.fullName,name:b.name,address:b.address,webSite:b.webSite,introduction:b.introduction,ownerName:b.owner.name,createTime:i.unix(b.createTime).format("YYYY年MM月DD日 HH:mm"),lastChangedTime:i.unix(b.lastChangedTime).format("YYYY年MM月DD日 HH:mm"),value:{tags:[]}}));var d=$(".customer-baseinfo-tag-ul",a),e=[];_.map(b.fBusinessTagRelations,function(a){e.push('<li class="fn-clear"><div class="input-tip">'),e.push(a.fBusinessTagName),e.push('</div><div class="input-wrapper">'),e.push(a.fBusinessTagOptionName),e.push("</div></li>")}),d.html(e.join("")),this.options.warpEl.html(a)},refresh:function(){var a=this.$el,b=this.v.options.customerData.value.fCustomer,c=this.template;a.html(c({fullName:b.fullName,name:b.name,address:b.address,webSite:b.webSite,introduction:b.introduction,ownerName:b.owner.name,createTime:i.unix(b.createTime).format("YYYY年MM月DD日 HH:mm"),lastChangedTime:i.unix(b.lastChangedTime).format("YYYY年MM月DD日 HH:mm"),value:{tags:[]}}));var d=$(".customer-baseinfo-tag-ul",a),e=[];_.map(b.fBusinessTagRelations,function(a){e.push('<li class="fn-clear"><div class="input-tip">'),e.push(a.fBusinessTagName),e.push('</div><div class="input-wrapper">'),e.push(a.fBusinessTagOptionName),e.push("</div></li>")}),d.html(e.join(""))},loadData:function(){var a=this,b=this.options.customerData.value.FCustomer.customerID;h.api({url:"/FCustomer/GetFCustomerDetailByID",type:"get",dataType:"json",data:{customerID:b,attachNum:6},success:function(b){b.success&&(a.responseData=b,a.render())}})},setCrmAttachment:function(){$(".crm-attachment-simple-warp",this.$el),this.responseData.value.feedAttachEntitys}});c.exports=j});