/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-select-filterbar/crm-select-filterbar - 单选版本",["./crm-select-filterbar.html","./crm-select-filterbar.css"],function(a,b,c){var d=a("./crm-select-filterbar.html");a("./crm-select-filterbar.css");var e=Backbone.View.extend({warpEl:null,tagName:"div",className:"crm-select-filterbar",template:_.template($(d).filter(".select-filterbar-template").html()),events:{"click .row-option":"rowOption","click .more-rows-btn":"moreRows","click .more-option-btn":"moreOption","click .del-btn":"delOption","click .clear-option-btn":"clearOption"},initialize:function(){this.render()},render:function(){var a=this.$el,b=this.template,c=this.options.data||null,d={title:this.options.title||"",tags:c};return a.html(b(this.formatData(d))),this.options.warpEl.html(a),this.reSet(),this},formatData:function(a){var b={};return _.extend(b,a||{}),b.results=a.results||"",b},reSet:function(){var a=this.$el;this.options.data.length;var b=$(".select-filterbar-bd",a),c=$(".rows",b),d=$(".row-option-warp",c),e=$(".more-rows",b),f=c.length,g=$(".isselect-rows",a),h=$(".isselect-rows .select-option-warp",a);h.html(""),g.hide(),e.children().text("更多筛选条件").removeClass("up"),c.show(),d.each(function(){var a=$(this).height();a>20&&($(this).addClass("minidisplay"),$(this).find(".more-option-btn").text("展开").show().removeClass("up"))}),f>this.options.defLine?(e.show(),c.eq(this.options.defLine-1).nextAll().hide()):c.last().addClass("noborder")},moreOption:function(a){this.$el;var b=$(a.currentTarget),c=b.closest(".row-option-warp");"收起"==b.text()?(b.text("展开").removeClass("up"),c.addClass("minidisplay")):(c.removeClass("minidisplay"),b.text("收起").addClass("up"))},moreRows:function(a){var b=this.$el,c=$(a.currentTarget);this.options.rowslen;var d=$(".select-filterbar-bd",b),e=$(".rows",d);$(".row-option-warp",e);var f=$(".isselect-rows",b),g=$(".select-option",f);"收起"==c.text()?(c.text("更多筛选条件").removeClass("up"),e.eq(this.options.defLine-1).nextAll().hide()):(e.eq(this.options.defLine-1).nextAll().show(),c.text("收起").addClass("up")),e.each(function(){var a=$(this).data("tagid"),b=this;g.each(function(){var c=$(this).data("tagid");c==a&&$(b).hide()})})},rowOption:function(a){var b=this.$el,c=$(a.currentTarget),d=c.closest(".rows"),e=$(".row-tit",d),f=$(".isselect-rows",b),g=$(".select-filterbar-bd",b);$(".more-rows",g),$(".rows",g);var h=$(".isselect-rows .select-option-warp",b),i='<div class="select-option" href="javascript:;" data-tagid="'+d.data("tagid")+'" data-optionid="'+c.data("optionid")+'"> '+e.text()+'：<span class="orange">'+c.text()+'<span class="del-btn"> ×</span></span> </div>';h.append(i),f.show(),d.hide(),this.submit()},clearOption:function(){var a=this.$el,b=$(".isselect-rows",a),c=$(".isselect-rows .select-option-warp",a);c.html(""),b.hide(),this.reSet(),this.options.v.refresh({listTagOptionID:""})},delOption:function(a){var b=this.$el,c=$(a.currentTarget),d=c.closest(".select-option"),e=$(".isselect-rows",b),f=$(".isselect-rows .select-option-warp",b),g=$(".select-filterbar-bd",b),h=$(".rows",g),i=d.data("tagid");h.each(function(){var a=$(this).data("tagid");i==a&&$(this).show()}),d.remove(),""==f.html()&&e.hide(),this.submit()},submit:function(){var a=this.$el,b=$(".isselect-rows",a),c=$(".select-option",b),d=[];c.each(function(){var a=$(this).data("tagid"),b=$(this).data("optionid");d.push(a+","+b)});var e=d.join("_");this.options.v.refresh({listTagOptionID:e})}});c.exports=e});