/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-select-filterbar/crm-select-filterbar",["./crm-select-filterbar.html","./crm-select-filterbar.css"],function(a,b,c){var d=a("./crm-select-filterbar.html");a("./crm-select-filterbar.css");var e=Backbone.View.extend({warpEl:null,tagName:"div",className:"crm-select-filterbar",template:_.template($(d).filter(".select-filterbar-template").html()),events:{"click .mn-checkbox-item":"rowOption","click .more-rows-btn":"moreRows","click .more-option-btn":"moreOption","click .clear-all-btn":"clearOption"},initialize:function(){this.render()},render:function(){var a=this.$el,b=this.template,c=this.options.data||null,d={title:this.options.title||"",tags:c};return a.html(b(this.formatData(d))),this.options.warpEl.html(a),this.reSet(),this},formatData:function(a){var b={};return _.extend(b,a||{}),b.results=a.results||"",b},reSet:function(){var a=this.$el;this.options.data.length;var b=$(".select-filterbar-bd",a),c=$(".rows",b),d=$(".row-option-warp",c),e=$(".more-rows",b),f=c.length,g=$(".select-filterbar-bd",a),h=$(".mn-checkbox-item",g);h.removeClass("mn-selected"),e.children().text("更多筛选条件").removeClass("up"),$(".clear-all-btn",a).hide(),d.each(function(){var a=$(this).height();a>26&&($(this).addClass("minidisplay"),$(this).find(".more-option-btn").text("展开").show().removeClass("up"))}),f>this.options.defLine?(e.show(),c.eq(this.options.defLine-1).nextAll().hide()):c.last().addClass("noborder")},moreOption:function(a){var b=this.$el,c=$(a.currentTarget),d=c.closest(".row-option-warp"),e=$(".select-filterbar-bd",b);$(".mn-checkbox-item",e),"收起"==c.text()?(c.text("展开").removeClass("up"),d.addClass("minidisplay")):(d.removeClass("minidisplay"),c.text("收起").addClass("up"));var f=navigator.appVersion,g=-1!=f.search(/MSIE 7/i);g&&$("body").hide().show()},moreRows:function(a){var b=this.$el,c=$(a.currentTarget);this.options.rowslen;var d=$(".select-filterbar-bd",b),e=$(".rows",d);"收起"==c.text()?(c.text("更多筛选条件").removeClass("up"),e.eq(this.options.defLine-1).nextAll().hide()):(e.eq(this.options.defLine-1).nextAll().show(),c.text("收起").addClass("up"))},clearOption:function(){var a=this.$el,b=$(".select-filterbar-bd",a),c=$(".mn-checkbox-item",b),d=$(".clear-all-btn",a);c.removeClass("mn-selected"),d.hide(),this.options.v.options.data.listTagOptionID="",this.submit()},rowOption:function(a){var b=this;_.delay(function(){b.submit(a)},2)},submit:function(){var a=this.$el,b=$(".select-filterbar-bd",a),c=$(".clear-all-btn",a),d=$(".mn-checkbox-box",b),e=$(".crm-list-header-search .ui-search-field"),f=[];d.each(function(){var a=$(this),b=a.find(".mn-checkbox-item").is(".mn-selected");b&&f.push(a.find(".mn-checkbox-item").data("value"))}),f.length>0?c.show():c.hide(),this.options.v.refresh({keyword:e.val(),listTagOptionID:f.join("_")})}});c.exports=e});