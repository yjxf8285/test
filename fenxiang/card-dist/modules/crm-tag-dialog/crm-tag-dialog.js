/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-tag-dialog/crm-tag-dialog",["dialog","util","modules/crm-tag-dialog/crm-tag-dialog.html"],function(a,b,c){var d=a("dialog"),e=a("util"),f=a("modules/crm-tag-dialog/crm-tag-dialog.html"),g=d.extend({attrs:{content:f,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>",width:392,myTags:["测试","真的","还有一个","另外一个"]},setup:function(){var a=g.superclass.setup.apply(this,arguments);return a},render:function(){var a=g.superclass.render.apply(this,arguments);return a},hide:function(){var a=g.superclass.hide.apply(this,arguments);return this.reset(),a},show:function(){var a=g.superclass.show.apply(this,arguments);return a},willShow:function(a){this._getMyTags(a)},events:{"click .crm-tag-dialog-button-ok":"_submit","click .crm-tag-dialog-button-cancel":"_cancel","click .crm-tag-dialog-my-tag":"_toInput","keyup .crm-tag-dialog-input":"_keyup","keydown .crm-tag-dialog-input":"_keydown"},_keyup:function(a){var b=this.element,c=$(".crm-tag-dialog-input",b),d=c.val(),e=$.trim(d),f=e.split(" "),g=[];if(f=_.filter(f,function(a){return""!=a}),a=a?a:window.event,32==a.keyCode&&f.length>=3)return c.val(e),!1;if(46!=a.keyCode&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)for(var h in f){var i=12;/[\u4e00-\u9fa5]+/.test(f[h])&&(i=6),f[h].length>i&&(g=f[h].substr(0,i),f[h]=g,c.val(f.join(" ")))}return 13==a.keyCode?(this._submit(),void 0):(this._setDisableByInput(),void 0)},_keydown:function(a){var b=this.element,c=$(".crm-tag-dialog-input",b),d=c.val(),e=$.trim(d),f=e.split(" ").join(" ").split(" "),g=[];if(f=_.filter(f,function(a){return""!=a}),a=a?a:window.event,32==a.keyCode&&f.length>=3)return c.val(e),!1;if(46!=a.keyCode&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)for(var h in f){var i=12;/[\u4e00-\u9fa5]+/.test(f[h])&&(i=6),f[h].length>i&&(g=f[h].substr(0,i),f[h]=g,c.val(f.join(" ")))}return 13==a.keyCode?(this._submit(),void 0):(this._setDisableByInput(),void 0)},_toInput:function(a){var b=$(a.currentTarget);if(b&&!b.hasClass("crm-tag-dialog-my-tag-disable")&&this._canInput()){var c=this.element,d=$.trim($(".crm-tag-dialog-input",c).val());d+=" "+b.text(),$(".crm-tag-dialog-input",c).val(d),this._canInput()?b.addClass("crm-tag-dialog-my-tag-disable"):this._setAllTagDisable()}},reset:function(){$(".crm-tag-dialog-input").val("")},_cancel:function(){this.hide()},_submit:function(){var a=$(".crm-tag-dialog-input",this.element).val();return a?(this.trigger("submit",a),this.hide(),void 0):(e.showInputError($(".crm-tag-dialog-input",this.element)),void 0)},_canInput:function(){var a=this.element,b=$.trim($(".crm-tag-dialog-input",a).val());return tagArray=b.split(" "),tagArray.length>2?!1:!0},_setAllTagDisable:function(){_.each($(".crm-tag-dialog-my-tag",this.element),function(a){$(a).hasClass("crm-tag-dialog-my-tag-disable")||$(a).addClass("crm-tag-dialog-my-tag-disable")})},_setDisableByInput:function(){var a=this.element,b=$.trim($(".crm-tag-dialog-input",a).val());tagArray=b.split(" "),_.each($(".crm-tag-dialog-my-tag",this.element),function(a){_.contains(tagArray,$(a).text())?$(a).addClass("crm-tag-dialog-my-tag-disable"):$(a).removeClass("crm-tag-dialog-my-tag-disable")})},_getMyTags:function(a){var b=this;e.api({url:"/CrmAttach/GetCrmAttachFileTags",type:"get",dataType:"json",data:a,success:function(a){if(a.success){b.show();var c=a.value.tags;b.set("myTags",c),b._myTagHtml()}}})},_myTagHtml:function(){var a=this.get("myTags"),b=$(".crm-tag-dialog-my-tags",this.element),c="";return!a||a.length<1?(b.empty(),void 0):(_.each(a,function(a){c+="<div class = 'crm-tag-dialog-my-tags-box fn-left fn-clear'><a class = 'crm-tag-dialog-my-tag' data-value = '"+a.value+"'>"+a.value+"</a></div>"}),b.html(c),void 0)},destroy:function(){var a=g.superclass.destroy.apply(this,arguments);return a}});c.exports=g});