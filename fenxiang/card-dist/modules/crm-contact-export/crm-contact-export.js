/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("modules/crm-contact-export/crm-contact-export",["dialog","util","modules/crm-contact-export/crm-contact-export.html","modules/crm-select-colleague/crm-select-colleague","moment"],function(a,b,c){var d=a("dialog"),e=window,f=e.FS,g=a("util"),h=a("modules/crm-contact-export/crm-contact-export.html"),i=a("modules/crm-select-colleague/crm-select-colleague"),j=a("moment"),k=d.extend({attrs:{content:h,isAll:!1,width:480,title:"",selectColleague:null,belongTo:0,closeTpl:"<div class = 'crm-ui-dialog-close'>×</div>"},setup:function(){var a=k.superclass.setup.apply(this,arguments);return a},render:function(){var a=k.superclass.render.apply(this,arguments);return this._init(),a},_init:function(){this.get("isAll")?$(".crm-contact-export-is-all",this.element).show():$(".crm-contact-export-is-all",this.element).hide(),this._initSelectColleague()},_initSelectColleague:function(){var a=this,b=new i({isMultiSelect:!1,hasWorkLeaveBtn:!1,title:"选择归属人"});b.on("selected",function(b){a._onColleagueSelect(b)}),a.set("selectColleague",b)},hide:function(){var a=k.superclass.hide.apply(this,arguments);return this.reset(),a},show:function(a){var b=k.superclass.show.apply(this,arguments);return this.set("optionsData",a),b},events:{"click .crm-isfirstchar-chekbox":"_isfirstcharChekbox","click .crm-contact-export-button-select":"_colleagueSelect","click .crm-contact-export-button-clear":"_colleagueClear","click .crm-contact-export-button-export":"_export"},_isfirstcharChekbox:function(){var a=$(".crm-isfirstchar-chekbox",this.element),b=$(".crm-contact-export-isfirstchar-warp",this.element),c=$(".crm-contact-export-keyword-warp",this.element);g.mnGetter(a),a.find(".mn-checkbox-item").is(".mn-selected")?(c.show(),b.hide()):(c.hide(),b.show())},_colleagueSelect:function(){this.get("selectColleague").show()},_onColleagueSelect:function(a){a&&($(".crm-contact-export-belong-to",this.element).text(a.name),this.set("belongTo",a.employeeID),$(".crm-contact-export-button-clear",this.element).show())},_colleagueClear:function(){$(".crm-contact-export-belong-to",this.element).text(""),this.set("belongTo",0),$(".crm-contact-export-button-clear",this.element).hide()},_export:function(){var a=$(".crm-isfirstchar-chekbox",this.element),b=this;this.get("belongTo");var c=encodeURI("我的联系人"),d=this.get("optionsData"),e=g.mnGetter(a),h="";e.length>0?(e=!0,h=g.mnGetter($(".isfirstchar-select-list",this.element))):(e=!1,h=$(".crm-contact-export-keyword-input",this.element).val());var i,k="/Contact/ExportUserContactsExcel",l=$(".states-select-list","#contacts-contact"),m=g.mnGetter(l);null===m&&(m=-1),this.get("isAll")?(c=encodeURI("全部联系人"),i={employeeID:this.get("belongTo"),keyword:h,isFirstChar:e,createCustomerFlag:g.mnGetter($(".crm-contact-export-customer",this.element)),isDeleted:g.mnGetter($(".crm-contact-export-status",this.element))},k="/Contact/ExportAllContactsExcel"):(c=encodeURI("我的联系人"),k="/Contact/ExportUserContactsExcel",i={keyword:h,employeeID:d.employeeID,sortType:d.sortType,isContainSubordinate:d.isContainSubordinate,isFirstChar:e,createCustomer:d.createCustomer,source:d.source,startDate:0,endDate:0,listTagOptionID:[]}),g.api({url:k,type:"post",dataType:"json",data:i,timeout:12e4,success:function(a){if(a.success){var d=a.serviceTime,e=j.unix(d).format("YYYYMMDDHHmm");$(".crm-contact-export-download",b.element).attr("href",f.API_PATH+"/DF/GetTemp?id="+a.value+"&name="+e+"_"+c+".xls&isAttachment=true").show()}}},{submitSelector:$(".crm-contact-export-button-export",this.element)})},reset:function(){$(".crm-contact-export-belong-to",this.element).text(""),this.set("belongTo",0),$(".crm-contact-export-button-clear",this.element).hide(),$(".crm-contact-export-download",this.element).hide(),this.get("isAll")&&(g.mnSetter($(".crm-contact-export-customer",this.element),-1),g.mnSetter($(".crm-contact-export-status",this.element),-1)),$(".crm-contact-export-keyword-input",this.element).val(""),g.mnSetter($(".crm-isfirstchar-chekbox",this.element),[]),g.mnSetter($(".isfirstchar-select-list",this.element),"A"),$(".crm-contact-export-isfirstchar-warp",this.element).hide(),$(".crm-contact-export-keyword-warp",this.element).show()},destroy:function(){var a=k.superclass.destroy.apply(this,arguments);return a}});c.exports=k});