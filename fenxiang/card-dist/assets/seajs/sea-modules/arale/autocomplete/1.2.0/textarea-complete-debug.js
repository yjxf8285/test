/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define("arale/autocomplete/1.2.0/textarea-complete-debug",["$-debug","lepture/selection/0.9.0/selection-debug","./autocomplete-debug","arale/overlay/1.0.1/overlay-debug","arale/position/1.0.0/position-debug","arale/iframe-shim/1.0.1/iframe-shim-debug","arale/widget/1.0.3/widget-debug","arale/base/1.0.1/base-debug","arale/class/1.0.0/class-debug","arale/events/1.0.0/events-debug","arale/widget/1.0.3/templatable-debug","gallery/handlebars/1.0.0/handlebars-debug","./data-source-debug","./filter-debug","./autocomplete-debug.tpl"],function(a,b,c){var d=a("$-debug"),e=a("lepture/selection/0.9.0/selection-debug"),f=a("./autocomplete-debug"),g=f.extend({attrs:{cursor:!1},setup:function(){g.superclass.setup.call(this),this.sel=e(this.get("trigger"));var a=this.get("inputFilter"),b=this;this.set("inputFilter",function(c){var d=c.substring(0,b.sel.cursor()[1]);return a.call(b,d)}),this.get("cursor")&&(this.mirror=h.init(this.get("trigger")),this.dataSource.before("getData",function(){b.mirror.setContent(b.get("inputValue"),b.queryValue,b.sel.cursor())}))},_keyUp:function(a){this.get("visible")&&(a.preventDefault(),this.get("data").length&&this._step(-1))},_keyDown:function(a){this.get("visible")&&(a.preventDefault(),this.get("data").length&&this._step(1))},_keyEnter:function(a){this.get("visible")&&(this.currentItem?(a.preventDefault(),a.stopImmediatePropagation(),this.selectItem()):this.hide())},show:function(){var a=this.get("cursor");if(a){if(d.isArray(a))var b=a;else var b=[0,0];var c=this.mirror.getFlagRect(),e=this.get("align");e.baseXY=[c.left+b[0],c.bottom+b[1]],e.selfXY=[0,0],this.set("align",e)}g.superclass.show.call(this)},selectItem:function(){this.hide();var a=this.currentItem,b=this.get("selectedIndex"),c=this.get("data")[b];if(a){var d=a.attr("data-value"),e=this.sel.cursor()[1],f=e-this.queryValue.length;this.sel.cursor(f,e).text("").append(d,"right");var g=this.get("trigger").val();this.set("inputValue",g),this.mirror&&this.mirror.setContent(g,"",this.sel.cursor()),this.trigger("itemSelect",c),this._clear()}}}),h={mirror:null,css:["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX"],init:function(a){a=d(a);var b={position:"absolute",left:-9999,top:0,zIndex:-2e4,"white-space":"pre-wrap"};return d.each(this.css,function(c,d){return b[d]=a.css(d)}),this.mirror=d("<div><span></span></div>").css(b).insertAfter(a),this},setContent:function(a,b,c){var d=b?c[1]-b.length:c[1],e=c[1],f=["<span>",a.substring(0,d),"</span>",'<span id="flag">',b||"","</span>","<span>",a.substring(e),"</span>"].join("");return this.mirror.html(f),this},getFlagRect:function(){var a,b,c;return c=this.mirror.find("span#flag"),a=c.position(),b={left:a.left,right:c.width()+a.left,top:a.top,bottom:c.height()+a.top}}};c.exports=g}),define("arale/autocomplete/1.2.0/data-source-debug",["arale/base/1.0.1/base-debug","arale/class/1.0.0/class-debug","arale/events/1.0.0/events-debug","$-debug"],function(a,b,c){function d(a){return"[object String]"===Object.prototype.toString.call(a)}function e(a){return a.replace(/^([a-z])/,function(a,b){return b.toUpperCase()})}var f=a("arale/base/1.0.1/base-debug"),g=a("$-debug"),h=f.extend({attrs:{source:null,type:"array"},initialize:function(a){h.superclass.initialize.call(this,a),this.id=0,this.callbacks=[];var b=this.get("source");if(d(b))this.set("type","url");else if(g.isArray(b))this.set("type","array");else if(g.isPlainObject(b))this.set("type","object");else{if(!g.isFunction(b))throw new Error("Source Type Error");this.set("type","function")}},getData:function(a){return this["_get"+e(this.get("type")||"")+"Data"](a)},abort:function(){this.callbacks=[]},_done:function(a){this.trigger("data",a)},_getUrlData:function(a){var b,c=this,d={query:a?encodeURIComponent(a):"",timestamp:(new Date).getTime()},e=this.get("source").replace(/{{(.*?)}}/g,function(a,b){return d[b]}),f="callback_"+this.id++;this.callbacks.push(f),b=/^(https?:\/\/)/.test(e)?{dataType:"jsonp"}:{dataType:"json"},g.ajax(e,b).success(function(a){g.inArray(f,c.callbacks)>-1&&(delete c.callbacks[f],c._done(a))}).error(function(){g.inArray(f,c.callbacks)>-1&&(delete c.callbacks[f],c._done({}))})},_getArrayData:function(){var a=this.get("source");return this._done(a),a},_getObjectData:function(){var a=this.get("source");return this._done(a),a},_getFunctionData:function(a){function b(a){c._done(a)}var c=this,d=this.get("source"),e=d.call(this,a,b);e&&this._done(e)}});c.exports=h}),define("arale/autocomplete/1.2.0/filter-debug",["$-debug"],function(a,b,c){function d(a,b){if(g.isPlainObject(a)){var c=b&&b.key||"value";return a[c]||""}return a}function e(a,b){for(var c=[],d=a.split(""),e=0,f=b.split(""),g=0,h=d.length;h>g;g++){var i=d[g];if(i==f[e]){if(e===f.length-1){c.push([g-f.length+1,g+1]),e=0;continue}e++}else e=0}return c}function f(a){return(a||"").replace(i,"\\$1")}var g=a("$-debug"),h={"default":function(a,b,c){var e=[];return g.each(a,function(a,b){var f={},h=d(b,c);g.isPlainObject(b)&&(f=g.extend({},b)),f.matchKey=h,e.push(f)}),e},startsWith:function(a,b,c){var e=[],h=b.length,i=new RegExp("^"+f(b));return h?(g.each(a,function(a,b){var f={},j=d(b,c);g.isPlainObject(b)&&(f=g.extend({},b)),i.test(j)&&(f.matchKey=j,h>0&&(f.highlightIndex=[[0,h]]),e.push(f))}),e):[]},stringMatch:function(a,b,c){b=b||"";var f=[],h=b.length;return h?(g.each(a,function(a,h){var i={},j=d(h,c);g.isPlainObject(h)&&(i=g.extend({},h)),j.indexOf(b)>-1&&(i.matchKey=j,i.highlightIndex=e(j,b),f.push(i))}),f):[]}};c.exports=h;var i=/(\[|\[|\]|\^|\$|\||\(|\)|\{|\}|\+|\*|\?)/g}),define("arale/autocomplete/1.2.0/autocomplete-debug.tpl",[],'<div class="{{classPrefix}}">\n    <ul class="{{classPrefix}}-ctn" data-role="items">\n        {{#each items}}\n            <li data-role="item" class="{{../classPrefix}}-item" data-value="{{matchKey}}">{{highlightItem ../classPrefix matchKey}}</li>\n        {{/each}}\n    </ul>\n</div>\n');