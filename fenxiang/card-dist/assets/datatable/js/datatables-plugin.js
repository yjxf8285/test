/**
 * 纷享资源脚本
 * @Author: 纷享网页前端部
 * @Date: 2014-11-03
 */
define(function(){$.fn.dataTableExt.oApi.fnReloadAjax=function(a,b,c,d){if(void 0!==b&&null!==b&&(a.sAjaxSource=b),a.oFeatures.bServerSide)return this.fnDraw(),void 0;this.oApi._fnProcessingDisplay(a,!0);var e=this,f=a._iDisplayStart,g=[];this.oApi._fnServerParams(a,g),a.fnServerData.call(a.oInstance,a.sAjaxSource,g,function(b){e.oApi._fnClearTable(a);for(var g=""!==a.sAjaxDataProp?e.oApi._fnGetObjectDataFn(a.sAjaxDataProp)(b):b,h=0;h<g.length;h++)e.oApi._fnAddData(a,g[h]);a.aiDisplay=a.aiDisplayMaster.slice(),e.fnDraw(),d===!0&&(a._iDisplayStart=f,e.oApi._fnCalculateEnd(a),e.fnDraw(!1)),e.oApi._fnProcessingDisplay(a,!1),"function"==typeof c&&null!==c&&c(a)},a)},function(a,b,c){function d(a){for(var b=[],c=0,d=a.length;d>c;c++)b[a[c]]=c;return b}function e(a,b,c){var d=a.splice(b,1)[0];a.splice(c,0,d)}function f(a,b,c){for(var d=[],e=0,f=a.childNodes.length;f>e;e++)1==a.childNodes[e].nodeType&&d.push(a.childNodes[e]);var g=d[b];null!==c?a.insertBefore(g,d[c]):a.appendChild(g)}a.fn.dataTableExt.oApi.fnColReorder=function(b,c,g){var h,i,j,k,l,m,n=b.aoColumns.length;if(c!=g){if(0>c||c>=n)return this.oApi._fnLog(b,1,"ColReorder 'from' index is out of bounds: "+c),void 0;if(0>g||g>=n)return this.oApi._fnLog(b,1,"ColReorder 'to' index is out of bounds: "+g),void 0;var o=[];for(h=0,i=n;i>h;h++)o[h]=h;e(o,c,g);var p=d(o);for(h=0,i=b.aaSorting.length;i>h;h++)b.aaSorting[h][0]=p[b.aaSorting[h][0]];if(null!==b.aaSortingFixed)for(h=0,i=b.aaSortingFixed.length;i>h;h++)b.aaSortingFixed[h][0]=p[b.aaSortingFixed[h][0]];for(h=0,i=n;i>h;h++)for(m=b.aoColumns[h],j=0,k=m.aDataSort.length;k>j;j++)m.aDataSort[j]=p[m.aDataSort[j]];for(h=0,i=n;i>h;h++)m=b.aoColumns[h],"number"==typeof m.mData&&(m.mData=p[m.mData],m.fnGetData=b.oApi._fnGetObjectDataFn(m.mData),m.fnSetData=b.oApi._fnSetObjectDataFn(m.mData));if(b.aoColumns[c].bVisible){var q=this.oApi._fnColumnIndexToVisible(b,c),r=null;for(h=c>g?g:g+1;null===r&&n>h;)r=this.oApi._fnColumnIndexToVisible(b,h),h++;for(l=b.nTHead.getElementsByTagName("tr"),h=0,i=l.length;i>h;h++)f(l[h],q,r);if(null!==b.nTFoot)for(l=b.nTFoot.getElementsByTagName("tr"),h=0,i=l.length;i>h;h++)f(l[h],q,r);for(h=0,i=b.aoData.length;i>h;h++)null!==b.aoData[h].nTr&&f(b.aoData[h].nTr,q,r)}for(e(b.aoColumns,c,g),e(b.aoPreSearchCols,c,g),h=0,i=b.aoData.length;i>h;h++)a.isArray(b.aoData[h]._aData)&&e(b.aoData[h]._aData,c,g),e(b.aoData[h]._anHidden,c,g);for(h=0,i=b.aoHeader.length;i>h;h++)e(b.aoHeader[h],c,g);if(null!==b.aoFooter)for(h=0,i=b.aoFooter.length;i>h;h++)e(b.aoFooter[h],c,g);for(h=0,i=n;i>h;h++)b.aoColumns[h].aDataSort=[h],b.aoColumns[h]._ColReorder_iOrigCol=h,a(b.aoColumns[h].nTh).unbind("click"),this.oApi._fnSortAttachListener(b,b.aoColumns[h].nTh,h);"undefined"!=typeof ColVis&&ColVis.fnRebuild(b.oInstance),a(b.oInstance).trigger("column-reorder",[b,{iFrom:c,iTo:g,aiInvertMapping:p}]),"undefined"!=typeof b.oInstance._oPluginFixedHeader&&b.oInstance._oPluginFixedHeader.fnUpdate()}},ColReorder=function(a,b){return this.CLASS&&"ColReorder"==this.CLASS||alert("Warning: ColReorder must be initialised with the keyword 'new'"),"undefined"==typeof b&&(b={}),this.s={dt:null,init:b,allowReorder:!0,allowResize:!0,fixed:0,dropCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]},this.dom={drag:null,resize:null,pointer:null},this.table_size=-1,this.s.dt=a.oInstance.fnSettings(),this._fnConstruct(),a.oApi._fnCallbackReg(a,"aoDestroyCallback",jQuery.proxy(this._fnDestroy,this),"ColReorder"),ColReorder.aoInstances.push(this),this},ColReorder.prototype={fnReset:function(){for(var a=[],b=0,c=this.s.dt.aoColumns.length;c>b;b++)a.push(this.s.dt.aoColumns[b]._ColReorder_iOrigCol);this._fnOrderColumns(a)},_fnConstruct:function(){var a,b,c=this;for("undefined"!=typeof this.s.init.allowReorder&&(this.s.allowReorder=this.s.init.allowReorder),"undefined"!=typeof this.s.init.allowResize&&(this.s.allowResize=this.s.init.allowResize),"undefined"!=typeof this.s.init.iFixedColumns&&(this.s.fixed=this.s.init.iFixedColumns),"undefined"!=typeof this.s.init.fnReorderCallback&&(this.s.dropCallback=this.s.init.fnReorderCallback),a=0,b=this.s.dt.aoColumns.length;b>a;a++)a>this.s.fixed-1&&this._fnMouseListener(a,this.s.dt.aoColumns[a].nTh),this.s.dt.aoColumns[a]._ColReorder_iOrigCol=a;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(a,b){c._fnStateSave.call(c,b)},"ColReorder_State");var e=null;if("undefined"!=typeof this.s.init.aiOrder&&(e=this.s.init.aiOrder.slice()),this.s.dt.oLoadedState&&"undefined"!=typeof this.s.dt.oLoadedState.ColReorder&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length&&(e=this.s.dt.oLoadedState.ColReorder),e)if(c.s.dt._bInitComplete){var f=d(e);c._fnOrderColumns.call(c,f)}else{var g=!1;this.s.dt.aoDrawCallback.push({fn:function(){if(!c.s.dt._bInitComplete&&!g){g=!0;var a=d(e);c._fnOrderColumns.call(c,a)}},sName:"ColReorder_Pre"})}},_fnOrderColumns:function(b){if(b.length!=this.s.dt.aoColumns.length)return this.s.dt.oInstance.oApi._fnLog(oDTSettings,1,"ColReorder - array reorder does not match known number of columns. Skipping."),void 0;for(var c=0,d=b.length;d>c;c++){var f=a.inArray(c,b);c!=f&&(e(b,f,c),this.s.dt.oInstance.fnColReorder(f,c))}(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing(),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt)},_fnStateSave:function(b){var c,d,e,f=this.s.dt;for(c=0;c<b.aaSorting.length;c++)b.aaSorting[c][0]=f.aoColumns[b.aaSorting[c][0]]._ColReorder_iOrigCol;for(aSearchCopy=a.extend(!0,[],b.aoSearchCols),b.ColReorder=[],c=0,d=f.aoColumns.length;d>c;c++)e=f.aoColumns[c]._ColReorder_iOrigCol,b.aoSearchCols[e]=aSearchCopy[c],b.abVisCols[e]=f.aoColumns[c].bVisible,b.ColReorder.push(e)},_fnMouseListener:function(b,c){var d=this;a(c).unbind("mousemove.ColReorder"),a(c).unbind("mousedown.ColReorder"),this.s.allowResize&&a(c).bind("mousemove.ColReorder",function(b){if(null===d.dom.drag&&null===d.dom.resize){var c="TH"==b.target.nodeName?b.target:a(b.target).parents("TH")[0],e=a(c).offset(),f=a(c).innerWidth();Math.abs(b.pageX-Math.round(e.left+f))<=11?a(c).css({cursor:"col-resize"}):a(c).css({cursor:"pointer"})}}),a(c).bind("mousedown.ColReorder",function(a){return d._fnMouseDown.call(d,a,c,b),!1})},_fnMouseDown:function(b,d,e){var f=this,g=this.s.dt.aoColumns;if("col-resize"==a(d).css("cursor")){this.s.mouse.startX=b.pageX,this.s.mouse.startWidth=a(d).width(),this.s.mouse.resizeElem=a(d);var h=a(d).next();this.s.mouse.nextStartWidth=a(h).width(),f.dom.resize=!0,this.s.dt.aoColumns[e].bSortable=!1,this.s.dt.oFeatures.bAutoWidth=!1}else if(this.s.allowReorder){f.dom.resize=null;var i="TH"==b.target.nodeName?b.target:a(b.target).parents("TH")[0],j=a(i).offset();this.s.mouse.startX=b.pageX,this.s.mouse.startY=b.pageY,this.s.mouse.offsetX=b.pageX-j.left,this.s.mouse.offsetY=b.pageY-j.top,this.s.mouse.target=d,this.s.mouse.targetIndex=a("th",d.parentNode).index(d),this.s.mouse.fromIndex=this.s.dt.oInstance.oApi._fnVisibleToColumnIndex(this.s.dt,this.s.mouse.targetIndex),this.s.aoTargets.splice(0,this.s.aoTargets.length),this.s.aoTargets.push({x:a(this.s.dt.nTable).offset().left,to:0});for(var k=0,e=0,l=g.length;l>e;e++)e!=this.s.mouse.fromIndex&&k++,g[e].bVisible&&this.s.aoTargets.push({x:a(g[e].nTh).offset().left+a(g[e].nTh).outerWidth(),to:k});0!==this.s.fixed&&this.s.aoTargets.splice(0,this.s.fixed)}a(c).bind("mousemove.ColReorder",function(a){f._fnMouseMove.call(f,a,e)}),a(c).bind("mouseup.ColReorder",function(a){setTimeout(function(){f._fnMouseUp.call(f,a,e)},10)})},_fnMouseMove:function(b,c){var d;if(d=""===this.s.dt.oInit.sScrollX?!1:!0,this.table_size<0&&d&&void 0!=a("div.dataTables_scrollHead",this.s.dt.nTableWrapper)&&a("div.dataTables_scrollHead",this.s.dt.nTableWrapper).length>0&&(this.table_size=a(a("div.dataTables_scrollHead",this.s.dt.nTableWrapper)[0].childNodes[0].childNodes[0]).width()),this.dom.resize){var e=this.s.mouse.resizeElem,f=a(e).next(),g=b.pageX-this.s.mouse.startX;0==g||d||a(f).width(this.s.mouse.nextStartWidth-g),a(e).width(this.s.mouse.startWidth+g),d&&void 0!=a("div.dataTables_scrollHead",this.s.dt.nTableWrapper)&&a("div.dataTables_scrollHead",this.s.dt.nTableWrapper).length>0&&a(a("div.dataTables_scrollHead",this.s.dt.nTableWrapper)[0].childNodes[0].childNodes[0]).width(this.table_size+g);var h;if(null!=a("div.dataTables_scrollBody")&&a("div.dataTables_scrollBody").length>0){var i;for(h=-1,i=-1;i<this.s.dt.aoColumns.length-1&&i!=c;i++)this.s.dt.aoColumns[i+1].bVisible&&h++;tableScroller=a("div.dataTables_scrollBody",this.s.dt.nTableWrapper)[0],scrollingTableHead=a(tableScroller)[0].childNodes[0].childNodes[0].childNodes[0],0==g||d||a(a(scrollingTableHead)[0].childNodes[h+1]).width(this.s.mouse.nextStartWidth-g),a(a(scrollingTableHead)[0].childNodes[h]).width(this.s.mouse.startWidth+g),d&&a(a(tableScroller)[0].childNodes[0]).width(this.table_size+g)}}else if(this.s.allowReorder){if(null===this.dom.drag){if(Math.pow(Math.pow(b.pageX-this.s.mouse.startX,2)+Math.pow(b.pageY-this.s.mouse.startY,2),.5)<5)return;this._fnCreateDragNode()}this.dom.drag.style.left=b.pageX-this.s.mouse.offsetX+"px",this.dom.drag.style.top=b.pageY-this.s.mouse.offsetY+"px";for(var j=!1,k=1,l=this.s.aoTargets.length;l>k;k++)if(b.pageX<this.s.aoTargets[k-1].x+(this.s.aoTargets[k].x-this.s.aoTargets[k-1].x)/2){this.dom.pointer.style.left=this.s.aoTargets[k-1].x+"px",this.s.mouse.toIndex=this.s.aoTargets[k-1].to,j=!0;break}j||(this.dom.pointer.style.left=this.s.aoTargets[this.s.aoTargets.length-1].x+"px",this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to)}},_fnMouseUp:function(b,d){if(a(c).unbind("mousemove.ColReorder"),a(c).unbind("mouseup.ColReorder"),null!==this.dom.drag)c.body.removeChild(this.dom.drag),c.body.removeChild(this.dom.pointer),this.dom.drag=null,this.dom.pointer=null,this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing(),null!==this.s.dropCallback&&this.s.dropCallback.call(this),this._fnConstruct(),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt);else if(null!==this.dom.resize){var e,f,g,h,i;if(this.s.dt.aoColumns[d].bSortable=!0,this.s.dt.aoColumns[d].sWidth=a(this.s.mouse.resizeElem).innerWidth()+"px",i=""===this.s.dt.oInit.sScrollX?!1:!0,!i){for(g=d+1;g<this.s.dt.aoColumns.length&&!this.s.dt.aoColumns[g].bVisible;g++);for(h=d-1;h>=0&&!this.s.dt.aoColumns[h].bVisible;h--);if(this.s.dt.aoColumns.length>g)this.s.dt.aoColumns[g].sWidth=a(this.s.mouse.resizeElem).next().innerWidth()+"px";else for(f=this.s.mouse.resizeElem,e=h;e>0;e--)this.s.dt.aoColumns[e].bVisible&&(f=a(f).prev(),this.s.dt.aoColumns[e].sWidth=a(f).innerWidth()+"px")}i&&void 0!=a("div.dataTables_scrollHead",this.s.dt.nTableWrapper)&&a("div.dataTables_scrollHead",this.s.dt.nTableWrapper).length>0&&(this.table_size=a(a("div.dataTables_scrollHead",this.s.dt.nTableWrapper)[0].childNodes[0].childNodes[0]).width()),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt)}this.dom.resize=null},_fnCreateDragNode:function(){var b=this;for(this.dom.drag=a(this.s.dt.nTHead.parentNode).clone(!0)[0],this.dom.drag.className+=" DTCR_clonedTable";this.dom.drag.getElementsByTagName("caption").length>0;)this.dom.drag.removeChild(this.dom.drag.getElementsByTagName("caption")[0]);for(;this.dom.drag.getElementsByTagName("tbody").length>0;)this.dom.drag.removeChild(this.dom.drag.getElementsByTagName("tbody")[0]);for(;this.dom.drag.getElementsByTagName("tfoot").length>0;)this.dom.drag.removeChild(this.dom.drag.getElementsByTagName("tfoot")[0]);a("thead tr:eq(0)",this.dom.drag).each(function(){a("th:not(:eq("+b.s.mouse.targetIndex+"))",this).remove()}),a("tr",this.dom.drag).height(a("tr:eq(0)",b.s.dt.nTHead).height()),a("thead tr:gt(0)",this.dom.drag).remove(),a("thead th:eq(0)",this.dom.drag).each(function(){this.style.width=a("th:eq("+b.s.mouse.targetIndex+")",b.s.dt.nTHead).width()+"px"}),this.dom.drag.style.position="absolute",this.dom.drag.style.zIndex=1200,this.dom.drag.style.top="0px",this.dom.drag.style.left="0px",this.dom.drag.style.width=a("th:eq("+b.s.mouse.targetIndex+")",b.s.dt.nTHead).outerWidth()+"px",this.dom.pointer=c.createElement("div"),this.dom.pointer.className="DTCR_pointer",this.dom.pointer.style.position="absolute",""===this.s.dt.oScroll.sX&&""===this.s.dt.oScroll.sY?(this.dom.pointer.style.top=a(this.s.dt.nTable).offset().top+"px",this.dom.pointer.style.height=a(this.s.dt.nTable).height()+"px"):(this.dom.pointer.style.top=a("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top+"px",this.dom.pointer.style.height=a("div.dataTables_scroll",this.s.dt.nTableWrapper).height()+"px"),c.body.appendChild(this.dom.pointer),c.body.appendChild(this.dom.drag)},_fnDestroy:function(){for(var b=0,c=ColReorder.aoInstances.length;c>b;b++)if(ColReorder.aoInstances[b]===this){ColReorder.aoInstances.splice(b,1);break}a(this.s.dt.nTHead).find("*").unbind(".ColReorder"),this.s.dt.oInstance._oPluginColReorder=null,this.s=null}},ColReorder.aoInstances=[],ColReorder.fnReset=function(a){for(var b=0,c=ColReorder.aoInstances.length;c>b;b++)ColReorder.aoInstances[b].s.dt.oInstance==a&&ColReorder.aoInstances[b].fnReset()},ColReorder.prototype.CLASS="ColReorder",ColReorder.VERSION="1.0.7",ColReorder.prototype.VERSION=ColReorder.VERSION,"function"==typeof a.fn.dataTable&&"function"==typeof a.fn.dataTableExt.fnVersionCheck&&a.fn.dataTableExt.fnVersionCheck("1.9.3")?a.fn.dataTableExt.aoFeatures.push({fnInit:function(a){var b=a.oInstance;if("undefined"==typeof b._oPluginColReorder){var c="undefined"!=typeof a.oInit.oColReorder?a.oInit.oColReorder:{};b._oPluginColReorder=new ColReorder(a,c)}else b.oApi._fnLog(a,1,"ColReorder attempted to initialise twice. Ignoring second");return null},cFeature:"R",sFeature:"ColReorder"}):alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download")}(jQuery,window,document)});