define("uilibs/currency-input",["widget"],function(a,b,c){var d=a("widget"),e=d.extend({attrs:{element:null,name:"",id:"",required:!1,value:0},events:{"mousedown .crm-currency-mask":"_readyToInput","keyup .crm-currency-input":"_onKeyUp","keydown .crm-currency-input":"_onKeyDown","blur .crm-currency-input":"_onSubmit","focus .crm-currency-input":"_onFocus"},setup:function(){var a=e.superclass.setup.apply(this,arguments);return this._getHtml(),a},render:function(){var a=e.superclass.setup.apply(this,arguments);return a},destroy:function(){var a;return a=e.superclass.destroy.apply(this,arguments)},_readyToInput:function(){$(".crm-currency-mask",this.element).hide(),$(".crm-currency-input",this.element).show(),$(".crm-currency-input",this.element).val(),setTimeout(function(){$(".crm-currency-input",this.element).focus()},100)},_onKeyUp:function(){var a=$(".crm-currency-input",this.element).val();if(this.set("value",a),!a)return $(".crm-currency-display").hide(),void 0;var b=/^([0-9]\d{0,15})+\.{0,1}[0-9]{0,2}$/;if(!b.test(a))return $(".crm-currency-input",this.element).val(a.substr(0,a.length-1)),!1;var c=_.str.numberFormat(parseFloat(a),2);$(".crm-currency-display").text(c),this._showInfo()},_onKeyDown:function(a){if(a){var b=a.which,c=[110,96,97,98,99,100,101,102,103,104,105,48,49,50,51,52,53,54,55,56,57,190,8,37,39];if(!_.contains(c,b))return a.preventDefault(),void 0;var d=$(".crm-currency-input",this.element).val(),e=d.split(".")[0];if(e.length>=15&&8!=b&&39!=b&&37!=b)return a.preventDefault(),void 0}},_onFocus:function(){var a=$(".crm-currency-input",this.element).val();0==a&&$(".crm-currency-input",this.element).val("")},_showInfo:function(){var a=$(".crm-currency-input",this.element).offset(),b=$(".crm-currency-input",this.element).height();$(".crm-currency-display").css({left:a.left-11,top:a.top+b+11}),$(".crm-currency-display").show()},_onSubmit:function(){var a=$(".crm-currency-input",this.element).val()||0;if(this.isValid()){var b=_.str.numberFormat(parseFloat(a),2);$(".crm-currency-mask",this.element).text(b),$(".crm-currency-mask",this.element).hasClass("crm-currency-done")||$(".crm-currency-mask",this.element).addClass("crm-currency-done"),$(".crm-currency-mask",this.element).show(),$(".crm-currency-input",this.element).hide(),$(".crm-currency-display").hide()}},_getHtml:function(){var a="",b=this.get("name"),c=this.get("id");return a+=c?"<div class = 'crm-currency-input-container'><input value='0' placeholder = '请填写金额' name = '"+b+"' id = '"+c+"' class = 'crm-currency-input fn-hide' />":"<div class = 'crm-currency-input-container'><input value='0' placeholder = '请填写金额' name = '"+b+"' class = 'crm-currency-input fn-hide' />",a+="<div class = 'crm-currency-mask'>0.00</div></div>",this.element.html(a),$(".crm-currency-display").length<1&&$("body").append("<div class = 'crm-currency-display fn-hide'></div>"),a},val:function(){return this.isValid()?parseFloat($(".crm-currency-input",this.element).val()||0):-1},setValue:function(a){$(".crm-currency-input",this.element).val(a),this.set("value",a);var b=_.str.numberFormat(parseFloat(a),2);$(".crm-currency-display").text(b),$(".crm-currency-mask",this.element).text(b),$(".crm-currency-mask",this.element).hasClass("crm-currency-done")||$(".crm-currency-mask",this.element).addClass("crm-currency-done"),$(".crm-currency-mask",this.element).show(),$(".crm-currency-input",this.element).hide(),$(".crm-currency-display").hide()},reset:function(){$(".crm-currency-input",this.element).val("0"),this.set("value",0),$(".crm-currency-display").text("0.00"),$(".crm-currency-mask",this.element).text("0.00"),$(".crm-currency-mask",this.element).hasClass("crm-currency-done")&&$(".crm-currency-mask",this.element).removeClass("crm-currency-done"),$(".crm-currency-mask",this.element).show(),$(".crm-currency-input",this.element).hide(),$(".crm-currency-display").hide()},isValid:function(){var a=$(".crm-currency-input",this.element).val();if(""==a)return!0;if(!a&&this.get("required"))return $(".crm-currency-display").text("请填写金额"),!1;var b=/^(([1-9]\d{0,15})|0)(\.\d{1,2})?$/;return b.test(a)?!0:($(".crm-currency-display").text("请正确填写金额"),!1)}});c.exports=e});