define("uilibs/chart/bubblechart",["raphael","./chart-helper"],function(a){var b=a("raphael");a("./chart-helper");var c=function(){this._init_.apply(this,arguments)};return c.prototype={_init_:function(a){a=a||{},this.opts=a,this.element=$(a.element),a.autoRender&&this.render()},render:function(a){this.element;var a=this.info=a||this.opts.info,c=this.paper=b(this.element[0],this.info.width,this.info.height);this.svgelement={};var d=a.yAxis.max||100;d=Math.ceil(d/a.yAxis.linenum)*a.yAxis.linenum,a.yAxis.max=d;var e=a.fontsize=13,f=a.leftgutter=function(){var b=c.transNumber(d||100);b=a.yAxis.label?a.yAxis.label(b):b;var f=c.text(-1e4,-1e4,b).attr("font-size",e).hide(),g=f.getBBox().width;return f.remove(),g+10}(),g=a.X=(a.width-f-a.rightgutter)/a.xAxis.label.length,h=(a.mx=(a.width-f-a.rightgutter)/(a.xAxis.end-a.xAxis.start),a.my=(a.height-a.topgutter-a.bottomgutter)/d),i=a.ly=d/a.yAxis.linenum;a.Y=h*i,a.tip&&(a.tip=_.template(a.tip)),a.xline=f+(a.width-f-a.rightgutter)/2,a.yline=a.topgutter+(a.height-a.topgutter-a.bottomgutter)/2,c.drawCoord(a.leftgutter-1,a.height-a.bottomgutter-.5,a.width-a.leftgutter-a.rightgutter,a.height-a.topgutter-a.bottomgutter,a.xAxis.label.length,a.yAxis.linenum);for(var j=0;j<a.xAxis.label.length;j++)c.text(a.leftgutter+g*(j+.5),a.height-a.bottomgutter+14,a.xAxis.label[j]).attr({fill:"#444","font-size":a.fontsize});for(var k=0;k<a.yAxis.linenum+1;k++){var l=c.transNumber(Math.round(a.ly*k));l=a.yAxis.label?a.yAxis.label(l):l,c.text(a.leftgutter-9,a.height-a.bottomgutter-a.Y*k,l).attr({"text-anchor":"end",fill:"#444","font-size":a.fontsize})}this.update(a.series)},update:function(a){var b=this,c=this.paper,d=this.svgelement;d.eveEle=c.set();for(var e=0;e<a.length;e++)if(a[e]){var f,g,h={name:a[e].name};switch(a[e].type){case"normal":f=a[e].data;for(var i=0;i<f.length;i++)g=_.extend({},f[i][3],h),d.eveEle.push(b._drawbubble(f[i][0],f[i][1],a[e].color,f[i][2],!1,g));break;case"num":f=a[e].data;for(var i=0;i<f.length;i++)g=_.extend({},f[i][3],h),d.eveEle.push(b._drawbubble(f[i][0],f[i][1],a[e].color,!1,f[i][2],g))}}b._addEvent()},_drawbubble:function(a,b,c,d,e,f){c=c||"#ff9600",d=d||10;var g=this.paper,h=this.info;if(!(a<h.xAxis.start||a>h.xAxis.end)){var i=h.leftgutter+(a-h.xAxis.start)*h.mx,j=h.height-h.bottomgutter-b*h.my,k=g.circle(i,j,d).attr({fill:c,stroke:"none"}),l=k;if(e!==!1){g.text(i,j,e).attr({fill:"#fff"});var m=g.circle(i,j,d).attr({fill:"#fff",stroke:"none",opacity:0});m.toFront(),l=m,f.num=e,l.data("info",h.tip(f))}else f.num=0,l.data("info",h.tip(f));return l}},_addEvent:function(){var a=this,b=a.paper,c=a.svgelement.eveEle,d=this.info;a.svgelement.tip=b.popup(100,200,"hello i am popup\n this is secondline\n this is thirdline","left-top","start").hide(),c.forEach(function(b){b.hover(function(){clearTimeout(a.svgelement.tip.timeVector);var c=this.attr("cx"),e=this.attr("cy"),f=["left","top"];c<d.xline?f[0]="right":c==d.xline&&(f[0]="middle"),e<d.yline?f[1]="bottom":e==d.xline&&"middle"==f[1],f=f.join("-"),a.svgelement.tip.show().ltranslate(c,e,b.data("info"),f)},function(){a.svgelement.tip.timeVector=setTimeout(function(){a.svgelement.tip.hide()},200)})})},destory:function(){this.paper&&this.paper.remove()}},c});