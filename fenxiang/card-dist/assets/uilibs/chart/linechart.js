define("uilibs/chart/linechart",["raphael","./chart-helper"],function(a){var b=a("raphael");a("./chart-helper");var c=function(){this._init_.apply(this,arguments)};return c.prototype={_init_:function(a){a=a||{},this.opts=a,this.element=$(a.element),a.autoRender&&this.render()},render:function(a){this.element,this.info=a||this.opts.info,this.paper=b(this.element[0],a.width,a.height),this.svgelement={},this.svgelement.AXIS=this.paper.set(),this.svgelement.MAP=this.paper.set();var c=this.paper,d=this.svgelement,a=this.info,e=a.fontsize=13,f=a.yAxis.max||100;f=Math.ceil(f/a.yAxis.linenum)*a.yAxis.linenum;var g=a.leftgutter=function(){var a=c.transNumber(f||100),b=c.text(-1e4,-1e4,a).attr("font-size",e).hide(),d=b.getBBox().width;return b.remove(),d+10}(),h=a.X=(a.width-g)/a.xAxis.length,i=a.my=(a.height-a.topgutter-a.bottomgutter)/f,j=a.ly=f/a.yAxis.linenum;a.Y=i*j,a.max=f,a.template=_.template(a.template);var k=c.drawCoord(a.leftgutter-1,a.height-a.bottomgutter-.5,a.width-a.leftgutter,a.height-a.topgutter-a.bottomgutter,a.xAxis.length,a.yAxis.linenum);d.AXIS.push(k),d.AXIS.title=c.text(a.width/2,a.topgutter/2,a.title).attr({"text-anchor":"middle","font-size":e});for(var l=0;l<a.xAxis.length;l++)d.AXIS.push(c.text(a.leftgutter+h*(l+.5),a.height-a.bottomgutter+14,a.xAxis[l]).attr({fill:"#444","font-size":a.fontsize}));for(var m=0;m<a.yAxis.linenum+1;m++){var n=c.transNumber(a.ly*m);d.AXIS.push(c.text(a.leftgutter-9,a.height-a.bottomgutter-a.Y*m,n).attr({"text-anchor":"end",fill:"#444","font-size":a.fontsize}))}this.update(a.series)},update:function(a){for(var b=(this.paper,this.info),c=0;c<a.length;c++)switch(a[c].type){case"line":this._drawLine(a[c].data,a[c].color);break;case"cube":this._drawRect(a[c].data,a[c].color,a[c].width);break;case"dbcube":this._drawMrect(a[c].data,a[c].color,a[c].lcolor)}this._drawAlpha(),(1==b.legend||"undefined"==typeof b.legend)&&this._drawLegend(),this._addEvent()},_drawLine:function(a,b){b=b||"#00bde5";for(var c=this.paper,d=(this.svgelement,this.info),e=[],f=c.set(),g=0;g<d.xAxis.length;g++){var h=Math.round(d.height-d.bottomgutter-d.my*a[g]),i=Math.round(d.leftgutter+d.X*(g+.5));e.push([i,h]),f.push(c.circle(i,h,3).attr({fill:"#eee",stroke:b,"stroke-width":2}))}c.line(e).attr({stroke:b,"stroke-width":2}).toFront(),f.toFront()},_drawRect:function(a,b,c){var d=this.paper,e=(this.svgelement,this.info);b=b||"#ff9600",c=c||e.X/2;for(var f=d.set(),g=0;g<e.xAxis.length;g++)if(0!==a[g]){var h=e.leftgutter+e.X*g+(e.X-c)/2,i=Math.round(e.height-e.bottomgutter-e.my*a[g]),j=a[g]*e.my;f.push(d.rect(h,i,c,j).attr({stroke:"none",fill:b}))}f.toFront()},_drawMrect:function(a,b,c){b=b||"#ccc",c=c||"#ff9600";for(var d=this.paper,e=(this.svgelement,this.info),f=d.set(),g=d.set(),h=0;h<e.xAxis.length;h++){var i=Math.round(e.height-e.bottomgutter-e.my*a[h][0]);yb=Math.round(e.height-e.bottomgutter-e.my*a[h][1]);var j=d.rect(e.leftgutter+e.X*(h+.25),i,e.X/2,a[h][0]*e.my).attr({stroke:"none",fill:b}),k=d.rect(e.leftgutter+e.X*(h+.25),yb,e.X/2,a[h][1]*e.my).attr({stroke:"none",fill:c});f.push(j),g.push(k)}f.toFront(),g.toFront()},_drawAlpha:function(){var a=this,b=this.paper,c=this.svgelement,d=this.info;c.eveEle=b.set(),c.eveLine=b.set();var e=b.set();b.set(),this.svgelement.AXIS.title;for(var f=0;f<d.xAxis.length;f++){var g=Math.round(d.leftgutter+d.X*(f+.5));c.eveLine.push(b.line([[Math.round(g),d.height-d.bottomgutter],[Math.round(g),d.topgutter]]).attr({"stroke-width":1,stroke:"#888"}).hide()),c.eveEle.push(b.rect(d.leftgutter+d.X*f,d.topgutter,d.X,d.height-d.bottomgutter-d.topgutter).attr({stroke:"none",fill:"green",opacity:0}));var h=c.eveEle[c.eveEle.length-1];h.data("info",d.template(a._getTittle(f)))}e.toFront()},_drawLegend:function(){for(var a,b,c,d=this.paper,e=(this.svgelement,this.info),f=e.series,g=0,h=e.height-e.bottomgutter*(1/3),i=d.set(),j=0;j<f.length;j++){switch(f[j].type){case"line":a=d.path(["m",g,h,"l",10,0]).attr({stroke:f[j].color,"stroke-width":2}),b=d.text(g,h,f[j].name).attr({"font-size":e.fontsize}),c=b.getBBox().width,b.attr({x:g+c/2+14,y:h,fill:"#666"}),g=g+c+32;break;case"cube":a=d.rect(g,h-5,10,10).attr({fill:f[j].color,stroke:"none"}),b=d.text(g,h,f[j].name).attr({"font-size":e.fontsize}),c=b.getBBox().width,b.attr({x:g+c/2+14,y:h,fill:"#666"}),g=g+c+32;break;case"dbcube":}i.push(a).push(b)}var k=(e.width-e.leftgutter-i.getBBox().width)/2;i.transform("t"+(e.leftgutter+k)+",0")},_addEvent:function(){var a=this.info,b=this.svgelement.eveEle,c=this.svgelement.eveLine,d=this.svgelement.AXIS.title;b.forEach(function(b,e){b.hover(function(){d.attr("text",this.data("info")),c[e].show()},function(){d.attr("text",a.title),c[e].hide()})})},__addEvent:function(){this.info;var a=this.svgelement.eveEle;this.svgelement.AXIS.title,a.forEach()},_getTittle:function(a){var b=this.info,c=b.series,d={};d.num=a+1;for(var e=0;e<c.length;e++)d[c[e].mark]=c[e].data[a];return d},destory:function(){this.paper&&this.paper.remove()}},c});