define("uilibs/chart/funnelchart_a",["raphael","./chart-helper"],function(a){var b=a("raphael");a("./chart-helper");var c=function(){this._init_.apply(this,arguments)};return c.prototype={_init_:function(a){this.opts=a,this.element=$(a.element),this.opts.autoRender&&this.render()},render:function(a){var c=this.element;this.svgelement={};var a=this.info=a||this.opts.info;a.fontsize=13;var d=this._trans(this.info.series),e=d.data,f=d.angle,g=a.width-a.rightpadding,h=g*Math.tan(f)/2;if(a.height){var i=a.toppadding+a.bottompadding+h;a.height<i?a.height=i:a.toppadding=a.toppadding+(a.height-i)/2}else a.height=a.toppadding+a.bottompadding+h;for(var j,k=0,l=a.toppadding,m=this.paper=b(c[0],a.width,a.height),n=g,o=0;o<e.length;o++)if(o!==e.length-1){var p=e[o][1]/d.total*h,q=p/Math.tan(f);j=m.path(["M",k,l,"L",k+n,l,"L",k+n-q,l+p,"L",k+q,l+p,"L",k,l]).attr({stroke:"#fff",fill:e[o][2]}),function(){var b=Math.round(k+n-q/2)+4.5,c=Math.round(l+p/2)+.5,d=1.06*g,e=c,f=m.transNum(a.series.data[o][1],2);f=a.series.label?a.series.label(f):f,m.path(["M",b,c,"L",d,e]).attr({stroke:"#888"}),m.text(d+4,e,a.series.data[o][0]).attr({"text-anchor":"start",fill:"#888","font-size":a.fontsize}),m.text(a.width-4,e,f).attr({"text-anchor":"end",fill:"#222","font-size":a.fontsize})}(),k+=q,l+=p,n-=2*q}else{var p=e[o][1]/d.total*h,j=m.path(["M",k,l,"L",k+n,l,"L",k+n,l+p,"L",k,l+p,"L",k,l]).attr({stroke:"#fff",fill:e[o][2]});!function(){var b=Math.round(k+n)+4.5,c=Math.round(l+p/2)+.5,d=1.06*g,e=c,f=m.transNum(a.series.data[o][1],2);f=a.series.label?a.series.label(f):f,m.path(["M",b,c,"L",d,e]).attr({stroke:"#888"}),m.text(d+4,e,a.series.data[o][0]).attr({"text-anchor":"start",fill:"#888","font-size":a.fontsize}),m.text(a.width,e,f).attr({"text-anchor":"end",fill:"#222","font-size":a.fontsize})}()}},_trans:function(a){var a=JSON.parse(JSON.stringify(a)),b=.1;if(0==a.data.length)throw new Error("漏斗数据为空");for(var c=0,d=0;d<a.data.length;d++)c+=a.data[d][1];0==c&&(c=100,b=1/a.data.length);for(var e=c*b,f=0,d=0;d<a.data.length;d++)a.data[d][1]<e&&(a.data[d][1]=e),f+=a.data[d][1];return a.total=f,a.angle=Math.atan(b/(e/f)*Math.sqrt(3)),a},destory:function(){this.paper&&this.paper.remove()}},c});