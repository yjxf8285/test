define("uilibs/dnd",["$","base"],function(a,b,c){function d(a){switch(a.type){case"mousedown":1===a.which&&(e({target:a.target,pageX:a.pageX,pageY:a.pageY}),q===!0&&a.preventDefault());break;case"mousemove":q===!0&&f(),null!==r&&(g({pageX:a.pageX,pageY:a.pageY}),h(),a.preventDefault());break;case"mouseup":null!==r?(r.css("cursor","default"),r.focus(),r=null,i(),j(),v.trigger("dragend",v.get("element"),s),v=null,s=null):q===!0&&(v.get("proxy").remove(),q=!1,v=null);break;case"keydown":null!==r&&27===a.which&&(r.css("cursor","default"),r.focus(),r=null,j(!0),v.trigger("dragend",v.get("element"),s),v=null,s=null)}}function e(a){var b,c=null,d=null,e=null,f=m(a.target).parents().toArray();f.unshift(a.target),m.each(f,function(a,b){if(void 0!==m(b).data("dnd")){if(e=m(b).data("dnd"),e===!0)e=new l(b,m(b).data("config"));else if(e===!1)e=null;else{if(!(isNaN(parseInt(e))===!1&&parseInt(e)>0))return!0;e=p[parseInt(e)]}return!1}}),null!==e&&e.get("disabled")!==!0&&(v=e,c=v.get("element"),b=v.get("drag"),(a.target===b[0]||0!=m(a.target).closest(".draggable").length)&&(d=v.get("proxy"),d.css({position:"absolute",margin:0,left:0,top:0,visibility:"hidden"}),d.appendTo(c.parent()),d.data("originx",d.offset().left),d.data("originy",d.offset().top),d.css({left:c.offset().left-d.data("originx"),top:c.offset().top-d.data("originy"),width:c.css("width")}),t=a.pageX-c.offset().left,u=a.pageY-c.offset().top,q=!0))}function f(){var a=v.get("element"),b=v.get("proxy"),c=v.get("visible"),d=v.get("dragCursor"),e=v.get("zIndex");c!==!0&&a.css("visibility","hidden"),b.css({"z-index":e,visibility:"visible",cursor:d}),b.focus(),w={},q=!1,r=b,v.trigger("dragstart",w,r,s)}function g(a){var b=v.get("containment"),c=v.get("axis"),d=a.pageX-t,e=a.pageY-u,f=r.data("originx"),g=r.data("originy"),h=b.offset();(void 0===h||null===h)&&(h={left:0,top:0}),"y"!==c&&(d>=h.left&&d+r.outerWidth()<=h.left+b.outerWidth()?r.css("left",d-f):d<=h.left?r.css("left",h.left-f):r.css("left",h.left+b.outerWidth()-r.outerWidth()-f)),"x"!==c&&(e>=h.top&&e+r.outerHeight()<=h.top+b.outerHeight()?r.css("top",e-g):e<=h.top?r.css("top",h.top-g):r.css("top",h.top+b.outerHeight()-r.outerHeight()-g)),v.trigger("drag",r,s)}function h(){var a=(v.get("element"),v.get("drop")),b=v.get("dragCursor"),c=v.get("dropCursor"),d=r.offset().left+t,e=r.offset().top+u;null!==a&&(null===s?m.each(a,function(a,b){return k(b,d,e)===!0?(r.css("cursor",c),r.focus(),s=m(b),v.trigger("dragenter",r,s),!1):void 0}):k(s,d,e)===!1?(r.css("cursor",b),r.focus(),v.trigger("dragleave",r,s),s=null):v.trigger("dragover",r,s))}function i(){var a=v.get("element"),b=v.get("proxy"),c=v.get("revert"),d=b.data("originx"),e=b.data("originy");null!==s&&(k(s,b)===!1&&c===!1&&(b.css("left",s.offset().left+(s.outerWidth()-b.outerWidth())/2-d),b.css("top",s.offset().top+(s.outerHeight()-b.outerHeight())/2-e)),v.trigger("drop",w,a,s))}function j(a){var b=v.get("element"),c=v.get("proxy"),d=v.get("drop"),e=v.get("revert"),f=v.get("revertDuration"),g=v.get("visible"),h=c.offset().left-b.offset().left,i=c.offset().top-b.offset().top,j=c.data("originx"),k=c.data("originy");e===!0||a===!0||null===s&&null!==d?(b.attr("style",b.data("style")),g===!1&&b.css("visibility","hidden"),c.animate({left:b.offset().left-j,top:b.offset().top-k},f,function(){b.css("visibility",""),c.remove()})):("relative"===b.css("position")?(h=(isNaN(parseInt(b.css("left")))?0:parseInt(b.css("left")))+h,i=(isNaN(parseInt(b.css("top")))?0:parseInt(b.css("top")))+i):"absolute"===b.css("position")?(h=c.offset().left,i=c.offset().top):b.css("position","relative"),g===!1?(b.css({left:h,top:i,visibility:""}),c.remove()):b.animate({left:h,top:i},f,function(){c.remove()}))}function k(a,b,c){var d=m(a).offset();return null===d&&(d={left:0,top:0}),2===arguments.length?d.left<=m(b).offset().left&&d.left+m(a).outerWidth()>=m(b).offset().left+m(b).outerWidth()&&d.top<=m(b).offset().top&&d.top+m(a).outerHeight()>=m(b).offset().top+m(b).outerHeight():3===arguments.length?d.left<=b&&d.left+m(a).outerWidth()>=b&&d.top<=c&&d.top+m(a).outerHeight()>=c:void 0}var l=null,m=a("$"),n=a("base"),o=0,p=[],q=!1,r=null,s=null,t=0,u=0,v=null,w={};l=n.extend({attrs:{element:{value:null,readOnly:!0,getter:function(a){return m(a).eq(0)}},containment:{value:document,getter:function(a){return m(a).eq(0)}},proxy:{value:null,getter:function(a){return null===a?null:m(a).eq(0)},setter:function(a){return null===a?this.get("element").clone():a}},drag:{value:null,getter:function(a){return null===a?null:m(a).eq(0)},setter:function(a){return null===a?this.get("element"):a}},drop:{value:null,getter:function(a){return null===a?null:m(a)}},disabled:!1,visible:!1,axis:!1,revert:!1,revertDuration:500,dragCursor:"move",dropCursor:"copy",zIndex:9999},initialize:function(a,b){var c,d=null;(0===m(a).length||1!==m(a).get(0).nodeType)&&m.error("element error!"),b=m.extend({element:a},b),l.superclass.initialize.call(this,b),d=this.get("element"),null===this.get("proxy")&&this.set("proxy",d.clone()),c=this.get("drag"),c.addClass("draggable"),d.data("style",d.attr("style")||""),d.data("dnd",++o),p[o]=this},destroy:function(){var a;return this.get("drag").removeClass("draggable"),a=l.superclass.destroy.apply(this,arguments)}}),l.open=function(){m(document).on("mousedown mousemove mouseup keydown",d)},l.close=function(){m(document).off("mousedown mousemove mouseup keydown",d)},l.open(),c.exports=l});