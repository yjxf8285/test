define("uilibs/audio-player",["swfobject","assets/html/helper.html"],function(a,b,c){var d=window,e=d.FS,f=a("swfobject"),g=a("assets/html/helper.html"),h=0,i=e.ASSETS_PATH+"/sound/notification.mp3";e.ASSETS_PATH+"/sound/test.mp3";var j,k,l,m=[],n=$(g).filter(".audio-player-tpl-1").html(),o=_.template(n,{blankImage:e.BLANK_IMG}),p=$(g).filter(".audio-player-tpl-2").html(),q=$(g).filter(".audio-player-tpl-3").html(),r=$(g).filter(".audio-player-tpl-4").html();if(document.createElement("audio").canPlayType)k=document.createElement("audio"),k.src=i,k.setAttribute("controls","controls"),$(k).addClass("fn-hide-abs").appendTo("body"),j={core:k,audioType:"h5"};else{var s={data:e.ASSETS_PATH+"/dewplayer/dewplayer-vol.swf"},t={flashvars:"mp3="+i+"&javascript=on",wmode:"transparent"};$('<span class="fn-hide-abs"><span id="fs-audio-flash-player" class="fn-hide-abs"></span></span>').appendTo("body"),f.hasFlashPlayerVersion("9.0.0")?j={core:f.createSWF(s,t,"fs-audio-flash-player"),audioType:"flash"}:$("#fs-audio-flash-player").html("对不起，您的浏览器不支持录音播放。")}var u=function(a,b){b?_.some(m,function(c){return c.id==a?(c[b](),!0):void 0}):(b=a,_.each(m,function(a){a[b]()}))},v=function(a){m=_.reject(m,function(b){return b.id==a})},w=function(a){a=_.extend({themeStyle:1,element:null,audioSrc:"",length:0,defaultVolume:50},a||{}),this.element=$(a.element),this.opts=a,this._status="stop",this._volume=a.defaultVolume,this.id="fs-audio-shadow-player-"+h,h++,this.init()};_.extend(w.prototype,{init:function(){var a=this.element,b=this.opts;j&&(a.addClass("fs-audio"),1==b.themeStyle?(a.addClass("fs-audio-1"),a.html(o)):2==b.themeStyle?(a.addClass("fs-audio-2"),a.html(p)):3==b.themeStyle?(a.addClass("fs-audio-3"),a.html(q)):4==b.themeStyle&&(a.addClass("fs-audio-4"),a.html(r)),m.push(this),this._bindEvents(),this.stop())},_bindEvents:function(){var a=this,b=j.core,c=this.element,d=$(".mic-vol",c);c.on("click",".mc-play",function(){a.play()}).on("click",".mc-pause",function(){a.pause()}).on("click",".mic-vol",function(b){var c=$(b.currentTarget),e=d.index(c);e>0&&a.setVolume(16.67*e)});var e=function(){"playing"==a._status&&a._updateStatus("pausing")};"h5"==j.audioType?b.addEventListener("ended",e,!0):"flash"==j.audioType,this._playHandler=e},_updateStatus:function(a){var b=this.opts,c=b.themeStyle;this["_updateStatus"+c](a)},_updateStatus1:function(a){var b=this.element,c=$(".mic-content",b),d=$(".ctr-btn",b),e=this.opts;"playing"==a?(this._status="playing",c.html("正在播放...时长："+this._getFormatLength(e.length)),d.removeClass("mc-play").addClass("mc-pause")):("pausing"==a||"stopping"==a)&&(this._status="pausing",c.html("已停止，时长："+this._getFormatLength(e.length)),d.removeClass("mc-pause").addClass("mc-play"))},_updateStatus2:function(a){var b=this.element,c=$(".voice-green-wrapper",b),d=$(".ctr-btn",b);"playing"==a?(this._status="playing",c.addClass("vg-on"),d.removeClass("mc-play").addClass("mc-pause")):("pausing"==a||"stopping"==a)&&(this._status="pausing",c.removeClass("vg-on"),d.removeClass("mc-pause").addClass("mc-play"))},_updateStatus3:function(a){var b=this.element,c=$(".voice-grey-wrapper",b),d=$(".ctr-btn",b);"playing"==a?(this._status="playing",c.addClass("vy-on"),d.removeClass("mc-play").addClass("mc-pause")):("pausing"==a||"stopping"==a)&&(this._status="pausing",c.removeClass("vy-on"),d.removeClass("mc-pause").addClass("mc-play"))},_updateStatus4:function(a){var b=this.element,c=$(".player-icon",b),d=$(".audio-length",b),e=this.opts;"playing"==a?(this._status="playing",c.removeClass("mc-play").addClass("mc-pause")):("pausing"==a||"stopping"==a)&&(this._status="pausing",c.removeClass("mc-pause").addClass("mc-play")),d.text(e.length)},_getFormatLength:function(a){return[parseInt(a/60/60),parseInt(a/60%60),parseInt(a%60)].join(":").replace(/\b(\d)\b/g,"0$1")},flashReadyCb:function(a){var b=[].slice.call(arguments,1),c=j.core,d=0,e=setInterval(function(){c[a]||d>16?(clearInterval(e),c[a]&&c[a].apply(c,b)):d++},60)},play:function(){var a=this,b=j.core,c=this.opts,d=c.audioSrc,e=0;u("pause"),this._updateStatus("playing"),this.setVolume(this._volume),"h5"==j.audioType?(b.src=d,b.play()):"flash"==j.audioType&&(this.flashReadyCb("dewset",d),this.flashReadyCb("dewplay"),clearInterval(l),l=setInterval(function(){var d=b.dewgetpos();return c.length<=1?(clearInterval(l),void 0):((d>=1e3*c.length||e>c.length)&&(clearInterval(l),a._updateStatus("pausing")),e++,void 0)},1e3))},stop:function(){var a=j.core;if("h5"==j.audioType)try{a.currentTime=0,a.pause()}catch(b){}else"flash"==j.audioType&&this.flashReadyCb("dewstop");this._updateStatus("stopping")},pause:function(){var a=j.core;"h5"==j.audioType?a.pause():"flash"==j.audioType&&this.flashReadyCb("dewpause"),this._updateStatus("pausing")},setVolume:function(a){var b=j.core,c=j.audioType,d=this.element,e=$(".mic-vol",d),f=Math.ceil(a/16.67);e.removeClass("mic-aon"),f>0&&e.slice(0,f+1).addClass("mic-aon"),"h5"==c?b.volume=parseFloat(a/100):"flash"==c&&this.flashReadyCb("dewvolume",a),this._volume=a},destroy:function(){var a=this.element,b=j.core;a.removeClass("fs-audio fs-audio-1 fs-audio-2 fs-audio-3 fs-audio-4").empty(),"h5"==j.audioType?(b.removeEventListener("playing",this._playHandler,!0),this._playHandler=null):"flash"==j.audioType,v(this.id),this.element=null}}),c.exports=w});