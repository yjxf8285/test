define("uilibs/autocomplete",["autocomplete_core","filter","json"],function(a,b,c){function d(a){return"[object String]"===Object.prototype.toString.call(a)}function e(a,b){if(!a)return b;if($.isFunction(a))return a.call(this,b);if(d(a)){for(var c=a.split("."),e=b;c.length;){var f=c.shift();if(!e[f])break;e=e[f]}return e}return b}var f=a("autocomplete_core"),g=a("filter"),h=a("json"),i="ui-autocomplete",j=f.extend({attrs:{matchModel:"global"},events:{"click .ui-autocomplete-init .ui-autocomplete-item":"_selectInitItem"},setup:function(){var a=j.superclass.setup.apply(this,arguments);return this.bindEvents(),a},_initFilter:function(){var a=j.superclass._initFilter.apply(this,arguments);return"global"==this.get("matchModel")&&this.set("filter",{name:"stringMatch",func:g.stringMatch,options:{key:"value"}}),a},bindEvents:function(){var a=this,b=this.element,c=$("."+i+"-init",b);c.length>0&&this.get("trigger").focus(function(){0==$(this).val().length&&a._onRenderInputValue("")})},render:function(){var a=this.element,b=$("."+i+"-init",a),c=$("."+i+"-empty",a),d=j.superclass.render.apply(this,arguments);return b.length>0&&b.hide(),c.length>0&&c.hide(),d},_selectInitItem:function(a){var b=$(a.currentTarget),c=b.closest("."+i+"-item"),d=c.data("parseData"),e=c.data("originData"),f=c.data("eqFields"),g=this.dataSource,j=this,k=d(e);_.each(k,function(a){var b,c=g.getData();"no"==a.validity?(b=h.parse(h.stringify(a)),j.trigger("itemSelect",b),j._clear()):c&&(b="all"===f?_.find(c,function(b){return _.isEqual(b,a)}):_.find(c,function(b){var c=!0;return _.find(f,function(d){return b[d]!=a[d]?(c=!1,!0):void 0}),c}),b&&(j.trigger("itemSelect",b),j._clear()))}),this.hide(),a.preventDefault()},_onRenderInputValue:function(a){if(this._start&&a){var b=this.queryValue;this.queryValue=this.get("inputFilter").call(this,a),this.queryValue&&this.queryValue!==b&&(this.dataSource.abort(),this.dataSource.getData(this.queryValue))}else this.queryValue="";""!==a&&this.queryValue||(this.set("data",[]),this.switchTpl([])),delete this._start},_filterData:function(a){var b=this.get("filter"),c=this.get("locator");a=e(c,a),a=b.func.call(this,a,this.queryValue,b.options),this.set("data",a),this.switchTpl(a)},_onRenderData:function(a){this._clear(),this.model.items=a,this.renderPartial("[data-role=items]"),this.items=this.$("[data-role=items]").children(),this.currentItem=null,this.get("selectFirst")&&this.set("selectedIndex",0)},_createInitDataPanel:function(a){var b,c=this,d=this.element,e=$("."+i+"-init",d);e.length>0&&(b=$("."+i+"-init-panel",e),b.empty(),_.each(a,function(a){var d=$('<ul class="'+i+'-list-block"></ul>'),e=a.parseData,f=a.createHtml,g=a.eqFields||"all",h=a.store,j=a.renderCb;_.each(h,function(a){var b;b=f(a),b.data("originData",a),b.data("parseData",e),b.data("createHtml",f),b.data("eqFields",g),b.appendTo(d)}),d.appendTo(b),0==d.text().length&&d.hide(),j&&j.call(c,h,d)}))},_onRenderInitDataSource:function(a){this._createInitDataPanel(a)},switchTpl:function(a){var b=this.element,c=$("."+i+"-init",b),d=$("."+i+"-query",b),e=$("."+i+"-empty",b);this.queryValue,d.length>0?(this.queryValue?0==a.length?(c.hide(),d.hide(),e.show()):(c.hide(),d.show(),e.hide()):(c.show(),d.hide(),e.hide()),this.show()):this.queryValue&&0!=a.length?this.show():this.hide()}});c.exports=j});