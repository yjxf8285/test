/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("modules/feed-list/feed-list-v",["util","modules/feed-list/fl-util","dialog","moment","modules/publish/publish","modules/feed-list/feed-list.css","modules/feed-list/feed-list-m","modules/feed-list/feed-list-c","modules/fs-reply/fs-reply","modules/feed-list/feed-list-helper","modules/fs-attach/fs-attach-file-preview","modules/fs-attach/fs-attach-preview","swfobject","uilibs/audio-player","modules/fs-map/fs-map","modules/feed-list/feed-list.html","./feed-list","modules/feed-list/feed-list-v","modules/fs-lazyload/fs-lazyload","uilibs/pagination","spin"],function(a,b){var c,d=window,e=d.FS,f=e.tpl;f.store,f.event;var g=a("util"),h=a("modules/feed-list/fl-util"),i=a("dialog"),j=a("moment"),k=a("modules/publish/publish"),l=(a("modules/feed-list/feed-list.css"),a("modules/feed-list/feed-list-m")),m=a("modules/feed-list/feed-list-c"),n=a("modules/fs-reply/fs-reply"),o=a("modules/feed-list/feed-list-helper"),p=a("modules/fs-attach/fs-attach-file-preview"),q=a("modules/fs-attach/fs-attach-preview"),r=a("swfobject"),s=a("uilibs/audio-player"),t=a("modules/fs-map/fs-map");f=a("modules/feed-list/feed-list.html"),o.feedContentFormat;var u=(l.itemM,m.listC),v=$(f),w=k.mediaMaker,x=k.atInput,y=k.selectBar,z=k.selectPanel,A=k.timeSelect,B=k.dateSelect,C=g.getContactData(),D=C.u,E=(new q).render(),F=p.FileReader,G=new F,H=t.FsMapOverlay,I=new H,J=function(a){var b=a.val(),c=!0;return b=$.trim(b),""==b&&(g.showInputError(a),c=!1),c},K=e.BASE_PATH+"/H/Home/Index"+("development"==PUBLISH_MODEL?"2":"")+"?model=print#stream/showfeed/=/id-";$(document).click(function(){$(".item-func .more-menu").hide(),$(".item-vote .seemore-info").hide()});var L=i.extend({attrs:{width:380,content:v.filter(".announce-on-time-templet").html(),className:"common-style-richard announce-on-time"},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel","change .selectlist":"_selectlistChange"},_renderCpt:function(){var a=this.element,b=$(".selecttimediv",a),c=new B({element:b,placeholder:"选择日期"});this.ds=c},render:function(){var a=L.superclass.render.apply(this,arguments);return this._renderCpt(),a},_selectlistChange:function(){var a=this.element,b=$(".selectlist",a),c=b.val(),d=$(".selecttimediv",a);12==c?d.show():d.hide()},_settimeshow:function(){var a=this,b=M.itemV,c=b.model,d=this.element,e=$(".selectlist",d),f=e.val(),h=c.get("originData"),i=h.feedID,k=this.ds.getValue(!0);k=k?j(k).unix():0,g.api({url:"/FeedAnnounce/SetAnnounceIsShow ",type:"post",data:{feedID:i,isShow:!0,showtimeDataType:f,time:k},dataType:"json",success:function(c){c.success&&(a.hide(),a._clear(),b.updateModel())}})},_clear:function(){},_submit:function(){this._settimeshow(),this.hide()},_cancel:function(){this.hide()},destroy:function(){var a;return this.ds&&this.ds.destroy(),a=L.superclass.destroy.apply(this,arguments)}}),M=new L,N=new i({width:"380",content:'<div class="fs-feed-comment-dialog"><div class="working-content"> <h1 class="ui-dialog-title"> </h1> <div class="working-warp fn-clear"> <p style="font-size:14px;"> 最多可选择<span class="Overstepnum">0</span>项 </p> <p class="working-btnwarp"><span class="button-r"> <button type="submit" class="button-green place-btn close-btn">确定</button> </span> </p> </div> </div></div>',className:"common-style-richard fs-feed-voteOverstep-dialog"});N.after("show",function(){$(".fs-feed-comment-dialog .Overstepnum").text(N.voteCountNum)});var O=new i({width:"380",content:'<div class="fs-feed-comment-dialog"><div class="working-content"> <h1 class="ui-dialog-title"> </h1> <div class="working-warp fn-clear"> <p> 请选择投票选项 </p> <p class="working-btnwarp"><span class="button-r"> <button type="submit" class="button-green place-btn close-btn">确定</button> </span> </p> </div> </div></div>',className:"common-style-richard fs-vote-comment-dialog"}),P=new i({width:909,content:v.filter(".commenton-box").html(),className:"common-style-richard fs-feed-comment-dialog"});P.after("show",function(){var a=P.element,b=$(".dialog-right",a),c=$(".input-text",a),d=$(".aj-selectcommentoner",a);c.val("").trigger("autosize.resize"),P.set("width",909),b.show(),$(window).resize();var e=P.sb;e||(e=new y({element:d,data:[{title:"同事",type:"p",list:C.p}],singleCked:!1,title:"添加抄送人",autoCompleteTitle:"请输入姓名或拼音"}),P.sb=e,P.element.on("click",".close-btn",function(){P.hide()}),P.atInput=new x({element:c,withAt:!0}));var f=this.itemV,i=f.model,k=i.get("feedText"),l=i.get("feedID"),m=i.get("originData"),n=m.sender.name,o=m.plan.planType,p=g.getAvatarLink(m.sender.profileImage,2),q=m.sender.employeeID,r=j.unix(m.createTime).format("MMMDD日"),s=!0,t=$(".comment-feedcontent",a),u=$(".name",a),v=$(".name-img",a),w=$(".aj-ctime",a);k=h.delStrLink(k),t.html(k),u.html(n),v.attr("src",p),w.html(r),Q(l,q,o,s)}),P.element.on("click",".look-history",function(){var a=P.element,b=$(".dialog-right",a);b.is(":visible")?($(this).text("查看历史日志>>"),b.hide(),P.set("width",458),$(window).resize()):($(this).text("收起历史日志<<"),P.set("width",909),b.show(),$(window).resize())}),P.element.on("click",".dialy-history i",function(){var a=P.element,b=$(".aj-hisplanel",a),c=($(".aj-histime",a),$(".dialy-history",a)),d=$("i",c),e=b.attr("feedid"),f=b.attr("employeeid"),g=b.attr("plantype"),h=(b.attr("hasforward"),!1),i=d.attr("class");"cur"!=i&&(h=!0,Q(e,f,g,h))}),P.element.on("click",".dialy-history b",function(){var a=P.element,b=$(".aj-hisplanel",a),c=($(".aj-histime",a),$(".dialy-history",a)),d=$("b",c),e=b.attr("feedid"),f=b.attr("employeeid"),g=b.attr("plantype"),h=(b.attr("hasbackward"),!1),i=d.attr("class");"cur"!=i&&(h=!1,Q(e,f,g,h))}),P.after("render",function(){g.placeholder($(".aj-commenton-replycontent",P.element));var a=new z({trigger:$(".change-user-l",P.element),data:[{title:"同事",type:"p",list:C.p}],singleCked:!0});a.on("select",function(b){var c,d=P.element,e=$(".aj-hisplanel",d),f=$(".user-info",d),h={};_.each(b,function(a){_.each(a,function(a){_.extend(h,{feedid:"0",employeeid:a.id,employeename:a.name})})}),e.attr(h),Q(h.feedid,h.employeeid,e.attr("plantype"),!0),c=g.getContactDataById(h.employeeid,"p"),f.html('<img src="'+c.profileImage+'" alt="" width="30" height="30" class="name-img"> <span class="name">'+c.name+"</span>"),a.hide(),a.unselect("all","all",!0)}),P.element.on("click",".change-user-l",function(b){a.show(),b.preventDefault()})});var Q=function(a,b,c,d){var e=P.element;g.api({url:"/Feed/GetSomeOnePlanWithForwardOrBackward",type:"get",data:{feedID:a,employeeID:b,planType:c,isForward:d},dataType:"json",success:function(a){var d=$(".aj-hisplanel",e),f=$(".aj-histime",e),h=$(".dialy-history",e),i=$("i",h),k=$("b",h),l=a.value,m="",n="",o="",p="",q=l.feedContent,r=l.report,s=l.planContent,t=l.feedID,u=l.planType,v=l.hasBackward,w=l.hasForward,x=l.createTime;if(v?k.removeClass("cur"):k.addClass("cur"),w?i.removeClass("cur"):i.addClass("cur"),a.success){switch(m=q||"<p>&nbsp;</p>",n=r||"",o=s||"",x=j.unix(x).format("MMMDD日 (dddd)"),u){case 0:p="planType为0";break;case 1:p='<p class="work-tit">今日工作总结</p><p>'+n+'</p><p>&nbsp;</p><p class="work-tit">明日工作计划</p><p>'+o+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+m+"</p>";break;case 2:p='<p class="work-tit">本周工作总结</p><p>'+n+'</p><p>&nbsp;</p><p class="work-tit">本周工作计划</p><p>'+o+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+m+"</p>";break;case 3:p='<p class="work-tit">本月工作总结</p><p>'+n+'</p><p>&nbsp;</p><p class="work-tit">本月工作计划</p><p>'+o+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+m+"</p>"}var y=l.commentContent,z="",A="",B="",C="",D="",E="",F="以下为日志点评人的点评";y?(B=g.getDateSummaryDesc(j.unix(l.replyTime),j.unix(a.serviceTime),1),D=y,C=l.leader.profileImage,A=l.leader.name,z='<dl class="comment-list fn-clear"><dt><a class="master-reply-face-l" href="javascript:void(0);"><a href="javascript:;"><img src = "'+g.getAvatarLink(C,"3")+'" / ></a></a></dt><dd><a href="javascript:;">'+A+"</a>："+D+" ("+B+"，点评)</dd></dl>",E='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-tit">'+F+'</div><div class="RC-feed">'+z+"</div></div>"):E="",d.html(p+E),f.text(x),d.attr({feedid:t,hasbackward:v,hasforward:w,employeeid:b,plantype:c}),0==l.createTime&&d.html('<div class="list-empty-tip" style="display: block;"><img src="../../html/fs/assets/images/clear.gif" alt="loading" class="icon-empty">&nbsp;&nbsp;<span class="empty-text">暂无记录</span></div>')}}})};P.element.on("click",".commentonsend-btn",function(){var a=P.itemV,b=P.sb,c=P.element,d=a.model,e=$(".aj-commenton-replycontent",c),f=$(".aj-issend",c),h=$(".commenton-select",c),i=b.getSelectedData(),j=[],k=i.p||[],l=i.g||[];j=j.concat(k,l);var m=d.get("feedID"),n=e.val(),o=h.val(),p=j,q=f.is(":checked");n||(n=$("option:selected",h).text()),n.length>2e3?g.alert("请控制输入在2000字内"):R(m,n,o,p,q)}),P.after("hide",function(){var a=P.element,b=$(".aj-commenton-replycontent",a),c=$(".commenton-select",a);c.val(3),P.sb.removeAllItem(),b.val("")});var R=function(a,b,c,d,e){var f=P.itemV,h=(P.sb,P.element);f.model;var i=$(".aj-commenton-replycontent",h);$(".aj-issend",h),$(".commenton-select",h);var j="";_.each(d,function(a){_.each(C.p,function(b){b.id==a&&(j+="@"+b.name+" ")})}),g.api({url:"/FeedPlan/ApproverComment ",type:"post",data:{feedID:a,replyContent:b+" "+j,rate:Number(c),atEmployeeIDs:d,isSendSms:e},dataType:"json",success:function(a){a.success&&(i.val(""),P.hide(),P.itemV.updateModel())}},{submitSelector:$(".commentonsend-btn",h)})},S=new i({width:"370",content:v.filter(".place-on-file-box").html(),className:"common-style-richard fs-feed-comment-dialog"});S.element.on("click",".close-btn",function(){S.hide()}),S.after("show",function(){var a=S.element,b=(S.itemV,S.thisTags),c="",d=$(".aj-mytagnames",a),e=$(".tagnamesel",a);e.val(b);var f=e.val(),h=f.split(" ");g.api({url:"/FeedArchive/GetMyFeedArchiveTags",type:"get",data:{},dataType:"json",success:function(a){_.each(a.value,function(a){var b=a.tagName,d='<a href="#" class="place-tap">',e="</a>";if(b)for(var f in h)h[f]==b&&(d='<a href="#" class="place-tap cur">');else c="";c+=d+b+e}),d.html("").append(c)}})}),S.after("hide",function(){var a=S.element;$(".tagnamesel",a),S.thisTags=""}),S.element.on("click",".aj-mytagnames a",function(){var a=S.element,b=$(".tagnamesel",a),c=$.trim(b.val()),d=c.split(" "),e=d.length,f="";return f=c?" "+$(this).text():$(this).text(),3>e&&"place-tap cur"!=$(this).attr("class")&&(b.val(c+f),$(this).addClass("cur")),!1}),S.element.on("keydown",".tagnamesel",function(a){var b=S.element,c=$(".tagnamesel",b),d=c.val(),e=$.trim(d),f=e.split(" "),g=[],h=f.length;if(a=a?a:window.event,46!=a.keyCode&&8!=a.keyCode&&37!=a.keyCode&&39!=a.keyCode)for(var i in f)f[i].length>12&&(g=f[i].substr(0,f[i].length-1),f[i]=g,f=f.join(" "),c.val(f));if(32==a.keyCode){if(" "==d.slice(-1))return!1;for(var j in f)if(h>=3)return!1}}),S.element.on("keyup",".tagnamesel",function(){var a=S.element,b=$(".tagnamesel",a),c=$(".aj-mytagnames a",a),d=b.val();d=$.trim(d);var e=d.split(" ");for(var f in e)c.each(function(a){e[f]!=c.eq(a).text()&&c.eq(a).removeClass("cur")});for(var g in e)c.each(function(a){e[g]==c.eq(a).text()&&c.eq(a).addClass("cur")});return!1}),S.element.on("click",".aj-pof-btn",function(){var a=S.element,b=$(".tagnamesel",a),c=b.val().split(" "),d=S.itemV,e=d.model,f=e.get("feedID"),g=e.get("feedType");J(b)&&T(f,g,c)});var T=function(a,b,c){var d=S.element,e=$(".tagnamesel",d),f=S.itemV,h=f.model,j=h.get("archiveData"),k=h.get("originData");k.feedID,g.api({url:"/FeedArchive/SaveFeedArchive",type:"post",data:{feedID:a,feedType:b,tagNames:c},dataType:"json",success:function(a){if(a.success){var b=new i({width:"",closeTpl:"",content:'<div class="fs-successtip"><img src="../../html/fs/assets/images/success.gif" width="50" height="50" /> 归档成功</div>',className:"common-style-richard fs-feed-comment-dialog"}).render();b.show(),setTimeout(function(){b.hide()},1500),e.val(""),S.hide(),f.reRenderArchive(o.renderArchiveBar({archiveTime:j.archiveTime,tags:_.map(c,function(a){return{tagName:a}})},{serviceTime:k.serviceTime}));var d=f.$el,g=$(".aj-placeonfile",d);g.text("取消归档").attr("class","aj-unplaceonfile aj-feed-fn-com-btn")}}},{submitSelector:$(".aj-pof-btn",d)})},U=new i({width:"500",content:v.filter(".forward-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),V=function(){var a,b,c,d=D.employeeID;a=U.element,c=$(".fwd-title",a),b=$(".aj-forwarder",a);var e=g.excludeContactData([d],"p"),f=new y({element:b,data:[{title:"同事",type:"p",list:e}],singleCked:!1,title:"添加转发人",autoCompleteTitle:"请输入姓名或拼音"}),h=new x({element:c,withAt:!0});$(".close-btn",U.element).click(function(){U.hide()}),U.sb=f,U.atInput=h,c.val("")};U.element.on("click",".fwdsend-btn",function(){var a=U.sb,b=this.element,c=($(".is-important",b),$(".fwd-title",b)),d=a.getSelectedData(),e=d.p||[],f=U.itemV,h=f.model,i=h.get("feedID"),j=c.val(),k=0,l=0,m=[],n=!1;return _.each(e,function(b){var c=a.getItemData(b,"p");j+="@"+c.name+" "}),0==e.length?($(".input-tip",a.element).click(),!1):(J(c)&&0!=e.length&&(j.length>2e3?g.alert("请控制输入在2000字内"):W(i,j,k,l,m,n)),void 0)}),U.after("show",function(){U.sb||V(),$(".fwd-title",this.element).trigger("autosize.resize")}),U.after("hide",function(){var a=U.element,b=$(".fwd-title",a);U.sb.removeAllItem(),b.val("").trigger("autosize.resize")});var W=function(a,b,c,d,e,f){g.api({url:"/Feed/SendFeedReplyForTransmit",type:"post",data:{feedID:a,replyContent:b,replyToReplyID:c,replyToEmployeeID:d,fileInfos:e,isSendSms:f},dataType:"json",success:function(a){var b=U.element,c=($(".is-important",b),$(".ped-title",b));a.success&&(U.hide(),c.val(""),U.sb.removeAllItem(),U.itemV.addReplyCountPlusOne())}},{submitSelector:$(".fwdsend-btn",U.element)})},X=new i({width:"500",content:v.filter(".pending-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),Y=function(){var a,b,c;a=X.element,b=$(".aj-peder",a),c=$(".ped-title",a);var d=new y({element:b,data:[{title:"同事",type:"p",list:C.p}],singleCked:!1,title:"选择同事",autoCompleteTitle:"请输入姓名或拼音"}),e=new x({element:c});$(".close-btn",X.element).click(function(){X.hide()}),X.sb=d,X.atInput=e};X.after("show",function(){X.sb||Y();var a,b,c=this.itemV,d=c.model,e=this.element,f=X.sb,g=$(".ped-feedtype",e),i=$(".ped-feedContent",e),j=$(".ped-title",e),k=d.get("feedTypeDescription"),l=d.get("originData"),m=l.feedContent,n="",o="",p="",q=l.plan||null;_.each(m,function(a){n+=a.text}),q?(a=q.reportContent||"",b=q.planContent||"",_.each(a,function(a){o+=a.text}),_.each(b,function(a){p+=a.text}),n=o+" "+p+" "+n):(n=n.replace(/<br\/>/g," "),n=n.replace(/\n+/g," "));var r=h.cutStrForNum(n,20).toString();g.html(k),i.html(r),j.val(r).trigger("autosize.resize"),f.addItem(D)}),X.after("hide",function(){var a=X.element,b=$(".ped-title",a),c=$(".is-important",a);X.sb.removeAllItem(),b.val("").trigger("autosize.resize"),c.prop("checked",!1)}),X.element.on("click",".ped-feedContent",function(){var a=X.element,b=$(".ped-title",a),c=$(this).text();return b.val(c),!1}),X.element.on("click",".pedsend-btn",function(){var a=X.sb,b=X.element,c=$(".is-important",b),d=$(".ped-title",b),e=c.is(":checked"),f=a.getSelectedData(),g=f.p||[],h=X.itemV,i=h.model,j=i.get("feedID"),k=g,l=i.get("feedType"),m=d.val(),n=e;J(d)&&0!=g.length&&Z(j,k,m,l,n)});var Z=function(a,b,c,d,e){var f=X.itemV,h=f.options.worktodoCb;return c.length>1e3?(g.alert("请控制输入在1000字内"),!1):(g.api({url:"/Worktodolist/AddWorkToDoList",type:"post",data:{feedID:a,feedType:d,employeeIDs:b,title:c,isImportant:e},dataType:"json",success:function(a){var b=X.element,c=$(".ped-title",b);a.success&&(X.hide(),c.val(""),X.sb.removeAllItem(),h&&h.call(f,a))}},{submitSelector:$(".pedsend-btn",X.element)}),void 0)},ab=new i({width:"525",content:v.filter(".appryes-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),bb=function(){var a=ab.element,b=$(".appryes-apper",a),c=$(".appryes-ccer",a),d=new y({element:b,data:[{title:"同事",type:"p",list:[]}],singleCked:!0,title:"选择下一个审批人（一个）",acInitData:g.getPublishDefaultUser("approveApprovers"),autoCompleteTitle:"请输入姓名或拼音"}),e=new y({element:c,data:[{title:"同事",type:"p",list:[]}],singleCked:!1,title:"添加抄送人",autoCompleteTitle:"请输入姓名或拼音"});ab.atInput=new x({element:$(".appryes-content-input",a),withAt:!0}),$(".close-btn",ab.element).click(function(){ab.hide()}),ab.appersb=d,ab.ccersb=e};ab.after("show",function(){var a=g.getPublishDefaultUser("approveApprovers"),b=ab.itemV,c=b.model,d=c.get("originData"),e=D.employeeID,f=g.excludeContactData([e,d.sender.employeeID],"p"),h=[{title:"同事",type:"p",list:f}];ab.appersb||bb(),ab.appersb.updateData(h),ab.ccersb.updateData(h),a[0].store=_.reject(a[0].store,function(a){return a.id==d.employeeID}),ab.appersb.setAcInitData(a)}),ab.after("hide",function(){var a=ab.element,b=$(".appryes-content-input",a),c=$(".is-sendms",a);b.val("同意。").css({height:"90px"}),ab.appersb.removeAllItem(),ab.ccersb.removeAllItem(),c.prop("checked",!1)}),ab.element.on("click",".appryes-btn",function(){var a=ab.appersb,b=ab.ccersb,c=a.getSelectedData(),d=c.p||[],e=b.getSelectedData(),f=e.p||[],h=this.element,i=$(".is-sendms",h),j=$(".appryes-content-input",h),k=i.is(":checked"),l=j.val(),m=ab.itemV,n=m.model,o=n.get("feedID");d=Number(d[0]);var p=1,q="";_.each(f,function(a){q+="@"+g.getContactDataById(a,"p").name+" "}),q&&(l+=q),J(j)&&cb(o,l,d,p,f,k)});var cb=function(a,b,c,d,e,f){var h="/FeedApprove/ApproverSendFeedReply",i=ab.element,j=$(".appryes-content-input",i);c&&(h="/FeedApprove/AgreeToNextApprover"),g.api({url:h,type:"post",data:{feedID:a,replyContent:b,approverID:c,operationType:d,employeeIDs:e,isSendSms:f},dataType:"json",success:function(a){a.success&&(j.val("同意。"),ab.appersb.removeAllItem(),ab.ccersb.removeAllItem(),ab.hide(),ab.itemV.updateModel())}},{submitSelector:$(".appryes-btn",i)})},db=new i({width:"525",content:v.filter(".apprno-box").html(),className:"common-style-richard fs-feed-comment-dialog"});db.after("show",function(){var a=D.employeeID,b=db.itemV,c=b.model,d=c.get("originData"),e=g.excludeContactData([a,d.sender.employeeID],"p"),f=[{title:"同事",type:"p",list:e}];db.sb||eb(),db.sb.updateData(f)}),db.after("hide",function(){var a=db.element,b=$(".apprno-content-input",a),c=$(".is-sendms",a);b.val("不同意。").css({height:"90px"}),db.sb.removeAllItem(),c.prop("checked",!1)});var eb=function(){var a=db.element,b=$(".apprno-ccer",a),c=new y({element:b,data:[{title:"同事",type:"p",list:[]}],singleCked:!1,title:"添加抄送人",autoCompleteTitle:"请输入姓名或拼音"});db.atInput=new x({element:$(".apprno-content-input",a),withAt:!0}),$(".close-btn",db.element).click(function(){db.hide()}),db.sb=c};db.element.on("click",".apprno-btn",function(){var a=db.sb,b=a.getSelectedData(),c=b.p||[],d=db.element,e=$(".is-sendms",d),f=$(".apprno-content-input",d),h=e.is(":checked"),i=f.val(),j=db.itemV,k=j.model,l=k.get("feedID"),m=0,n=2,o="";_.each(c,function(a){o+="@"+g.getContactDataById(a,"p").name+" "}),o&&(i+=o),J(f)&&fb(l,i,m,n,c,h)});var fb=function(a,b,c,d,e,f){var h=db.element,i=$(".apprno-content-input",h);g.api({url:"/FeedApprove/ApproverSendFeedReply",type:"post",data:{feedID:a,replyContent:b,approverID:c,operationType:d,employeeIDs:e,isSendSms:f},dataType:"json",success:function(a){a.success&&(i.val("不同意。"),db.sb.removeAllItem(),db.hide(),db.itemV.updateModel())}},{submitSelector:$(".apprno-btn",h)})},gb=new i({width:"580",content:v.filter(".apprhis-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),hb=new i({width:"580",content:v.filter(".working-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),ib=new i({width:"580",content:v.filter(".workingfini-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),jb=new i({width:"580",content:v.filter(".workunfini-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),kb=new i({width:"580",content:v.filter(".workfini-box").html(),className:"common-style-richard fs-feed-comment-dialog"}),lb=i.extend({attrs:{itemV:null,content:v.filter(".swr-undone-tpl").html(),className:"common-style-richard feed-swr-undone-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".swr-undone-input",c);return 0==b.replyContent.length&&(g.showInputError(d),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".swr-undone-input",e),g=$(".is-send-sms",e);return a.feedID=d.feedID,a.replyContent=_.str.trim(f.val()),a.operationType=2,a.isSendSms=g.prop("checked"),a.rate=0,a.atEmployeeIDs=[],a},_renderCpt:function(){var a=this.element,b=$(".swr-undone-input",a),c=new x({element:b,withAt:!0});this.atInput=c},clearForm:function(){var a=this.element,b=$(".swr-undone-input",a),c=$(".is-send-sms",a);b.val(""),c.prop("checked",!1)},hide:function(){var a=lb.superclass.hide.apply(this,arguments);return this.clearForm(),a},render:function(){var a=lb.superclass.render.apply(this,arguments);return this._renderCpt(),a},_submit:function(a){var b=this,c=this.getRequestData(),d=this.get("itemV"),e=d.$el,f=e.data("fsReply"),h=this.element,i=$(".swr-undone-input",h);this.isValid()&&(i.val().length>2e3?g.alert("请控制输入在2000字内"):g.api({type:"post",data:c,url:"/FeedWork/AssignerSendFeedWorkReply",success:function(a){a.success&&(b.hide(),b.clearForm(),f.addNewReply(a.value),b.get("successCb").call(b,a,c),d.updateModel())}})),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()},destroy:function(){var a;return this.atInput&&this.atInput.destroy(),a=lb.superclass.destroy.apply(this,arguments)}}),mb=new lb,nb=i.extend({attrs:{itemV:null,content:v.filter(".swr-done-tpl").html(),className:"common-style-richard feed-swr-done-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=i.superclass.render.apply(this,arguments);return this._renderCpt(),a},show:function(){var a=this.element,b=$(".swr-done-input",a),c=$(".rate-wrapper select",a),d=nb.superclass.show.apply(this,arguments);return b.trigger("autosize.resize"),c.val(3),d},hide:function(){var a=nb.superclass.hide.apply(this,arguments);return this.clearForm(),a},_renderCpt:function(){var a=this.element,b=$(".copyto-sb",a),c=$(".media",a),d=$(".swr-done-input",a),e=new x({element:d}),f=new y({element:b,data:[{title:"同事",type:"p",list:C.p}],title:"添加抄送人",acInitData:g.getPublishRange("work"),singleCked:!1,autoCompleteTitle:"请输入姓名或拼音"}),h=new w({element:c,action:["at"],actionOpts:{at:{inputSelector:d}}});b.data("sb",f),this.media=h,this.atInput=e},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".swr-done-input",c);return 0==b.replyContent.length&&(g.showInputError(d),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".swr-done-input",e),h=$(".rate",e),i=$(".copyto-sb",e),j=$(".is-send-sms",e),k="",l=i.data("sb"),m=l.getSelectedData(),n=m.p||[];return _.each(n,function(a){k+="@"+g.getContactDataById(a,"p").name+" "}),a.feedID=d.feedID,a.replyContent=_.str.trim(f.val())+" "+k,a.operationType=4,a.isSendSms=j.prop("checked"),a.rate=h.val(),a.atEmployeeIDs=m.p||[],a},clearForm:function(){var a=this.element,b=$(".copyto-sb",a),c=$(".swr-done-input",a),d=$(".is-send-sms",a),e=b.data("sb");e.removeAllItem(),c.val(""),d.prop("checked",!1)},_submit:function(a){var b=this,c=this.getRequestData(),d=this.get("itemV"),e=d.$el,f=e.data("fsReply"),h=this.element,i=new RegExp("^s*$"),j=$(".swr-done-input",h),k=j.val();k=_.str.trim(k),i.test(k)&&j.val(""),this.isValid()&&(j.val().length>2e3?g.alert("请控制输入在2000字内"):J(j)&&g.api({type:"post",data:c,url:"/FeedWork/AssignerSendFeedWorkReply",success:function(a){a.success&&(b.hide(),b.clearForm(),f.addNewReply(a.value),d.updateModel(function(){$(".aj-Reply",e).click()}),b.get("successCb").call(b,a,c))}})),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()},destroy:function(){var a;return this.media&&this.media.destroy(),this.media=null,this.atInput&&this.atInput.destroy(),this.atInput=null,a=i.superclass.destroy.apply(this,arguments)}}),ob=new nb;c=i.extend({attrs:{width:675,itemV:null,content:v.filter(".swr-cancel-tpl").html(),className:"common-style-richard feed-swr-cancel-dialog",successCb:function(a,b){var c=this.get("itemV"),d=c.options;d.delegateOtherCb&&d.delegateOtherCb.call(c,a,b)}},events:{"click .sms-warn-radio input":"_smsWarnCounts","click .f-sub":"_submit","click .f-cancel":"_cancel"},_smsWarnCounts:function(a){var b=this.element,c=$(a.currentTarget).val(),d=$(".sms-warn-item",b),e=0;switch(parseInt(c)){case 1:d.hide(),e=0;break;case 2:d.hide(),d.eq(0).show(),e=1;break;case 3:d.show(),d.eq(2).hide(),e=2;break;case 4:d.show(),e=3}this.smsWarnCountsVal=e},show:function(){var a=c.superclass.show.apply(this,arguments),b=this.element,d=$(".swr-cancel-input",b);$(".sms-warn-radio",b);var e=this.get("itemV"),f=e.model,g=f.get("originData"),h=g.feedContent,i="";return _.each(h,function(a){i+=a.text}),d.val(i),this._renderCopyto(),this._renderWorkto(),a},hide:function(){var a=c.superclass.hide.apply(this,arguments);return this.clearForm(),a},render:function(){var a=c.superclass.render.apply(this,arguments);return this._renderMedia(),this._renderCpt(),this._renderSmsDataTime(),a},_renderCpt:function(){var a=this.element,b=$(".swr-cancel-input",a),c=$(".setother-selectdata",a),d=$(".setother-selecttime",a),e=new B({element:c,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),f=new A({element:d,placeholder:"选择时间"}),g=new x({element:b,withAt:!0});e.on("change",function(){""==f.getValue()&&f.selector.select(0)}),this.setotherSelectData=e,this.setotherSelectTime=f,this.atInput=g},_renderSmsDataTime:function(){var a=this.element,b=$(".sms-one-selectdata",a),c=$(".sms-one-selecttime",a),d=$(".sms-two-selectdata",a),e=$(".sms-two-selecttime",a),f=$(".sms-three-selectdata",a),g=$(".sms-three-selecttime",a),h=new B({element:b,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),i=new A({element:c,placeholder:"选择时间"}),j=new B({element:d,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),k=new A({element:e,placeholder:"选择时间"}),l=new B({element:f,placeholder:"选择日期",formatStr:"YYYY年MM月DD日（dddd）"}),m=new A({element:g,placeholder:"选择时间"});h.on("change",function(){""==i.getValue()&&i.selector.select(0)}),j.on("change",function(){""==k.getValue()&&k.selector.select(0)}),l.on("change",function(){""==m.getValue()&&m.selector.select(0)}),this.smsOneData=h,this.smsOneTime=i,this.smsTwoData=j,this.smsTwoTime=k,this.smsThreeData=l,this.smsThreeTime=m},_renderMedia:function(){var a=this.element,b=$(".swr-cancel-input-media",a),c=$(".swr-cancel-input",a);new w({element:b,action:["at","topic"],actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:C.p},{title:"部门",type:"g",list:C.g}]}},topic:{inputSelector:c}}})},_renderCopyto:function(){var a=this.element,b=$(".copyto-sb",a),c=this.get("itemV"),d=c.model,e=d.get("originData"),f=e.feedRangeEntities,h={id:e.work.executer.employeeID,name:"sb",type:"p"},i=new y({element:b,data:[{title:"同事",type:"p",list:C.p},{title:"部门",type:"g",list:C.g}],title:"选择发送范围",singleCked:!1,acInitData:g.getPublishRange("work"),autoCompleteTitle:"请输入部门或同事的姓名或拼音"});b.data("sb",i),_.each(f,function(a){var b=a.isCircle;b=b?"g":"p",h={id:a.dataID,name:a.name,type:b},i.addItem(h)})},_renderWorkto:function(){var a=this.element,b=$(".workto-sb",a),c=this.get("itemV"),d=c.model,e=d.get("originData"),f={id:e.work.executer.employeeID,name:e.work.executer.name,type:"p"},h=D.employeeID,i=g.excludeContactData([h],"p"),j=new y({element:b,data:[{title:"同事",type:"p",list:i}],title:"选择指令执行人（一个）",acInitData:g.getPublishDefaultUser("workExecuters"),singleCked:!0,autoCompleteTitle:"请输入姓名或拼音"});b.data("sb",j),j.addItem(f)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".swr-cancel-input-wrapper",c),e=$(".setother-selectdata input",c),f=$(".swr-cancel-input",c),h=$(".sms-one-selectdata input",c),i=$(".sms-two-selectdata input",c),j=$(".sms-three-selectdata input",c);return 0==b.replyContent.length&&(g.showInputError(d),g.showInputError(f),a=!1),b.deadline||(g.showInputError(e),a=!1),1==this.smsWarnCountsVal&&""==h.val()&&(g.showInputError(h),a=!1),2==this.smsWarnCountsVal&&(""==h.val()&&(g.showInputError(h),a=!1),""==i.val()&&(g.showInputError(i),a=!1)),3==this.smsWarnCountsVal&&(""==h.val()&&(g.showInputError(h),a=!1),""==i.val()&&(g.showInputError(i),a=!1),""==j.val()&&(g.showInputError(j),a=!1)),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".swr-cancel-input",e),g=$(".sms-warn-radio",e),h=$("input:checked",g).val(),i=($(".rate",e),$(".workto-sb",e)),k=$(".copyto-sb",e),l=$(".is-send-sms",e),m=k.data("sb"),n=m.getSelectedData(),o=i.data("sb"),p=o.getSelectedData(),q=this.setotherSelectData.getValue(),r=this.setotherSelectTime.getValue(),s=this.smsOneData.getValue(),t=this.smsOneTime.getValue(),u=this.smsTwoData.getValue(),v=this.smsTwoTime.getValue(),w=this.smsThreeData.getValue(),x=this.smsThreeTime.getValue(),y=[],z={value:1,value1:j(s+" "+t,"YYYYMMDD HH:mm").unix()},A={value:2,value1:j(u+" "+v,"YYYYMMDD HH:mm").unix()},B={value:3,value1:j(w+" "+x,"YYYYMMDD HH:mm").unix()};return s||(z={}),u||(A={}),w||(B={}),y.push(z,A,B),a.feedID=d.feedID,a.replyContent="取消该指令",a.feedContent=_.str.trim(f.val()),a.circleIDs=n.g||[],a.employeeIDs=n.p||[],a.assignerID=d.sender.employeeID,a.executerID=parseInt(p.p)||[],a.deadline=q.length>0?j(q+" "+r,"YYYYMMDD HH:mm").unix():"",a.smsRemindType=parseInt(h),a.smsRemindTimes=y,a.isSendSms=l.prop("checked"),a},clearForm:function(){var a=this.element,b=$(".swr-cancel-input",a),c=$(".sms-warn-radio input:radio",a),d=$(".sms-warn-item",a),e=$(".setother-selectdata input",a),f=$(".setother-selecttime input",a),g=$(".is-send-sms",a);b.val(""),e.val(""),f.val(""),g.prop("checked",!1),c.prop("checked",!1).eq(0).prop("checked",!0),d.hide(),d.find("input").val("")},_submit:function(a){var b=this,c=this.getRequestData(),d=this.get("itemV");d.$el;var e=this.isValid(),f=this.element,h=$(".swr-cancel-input",f);return e&&(h.val().length>2e3?g.alert("请控制输入在2000字内"):g.api({type:"post",data:c,url:"/FeedWork/ChangeOtherSendFeedWork",success:function(a){a.success&&(b.hide(),b.clearForm(),d.updateModel(),b.get("successCb").call(b,a,c))}})),!1},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()}});var pb=new c,qb=i.extend({attrs:{itemV:null,content:v.filter(".rwr-normal-tpl").html(),className:"common-style-richard feed-rwr-normal-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=i.superclass.render.apply(this,arguments);return this._initAtInput(),this._renderMedia(),a},_initAtInput:function(){var a=this.element,b=$(".rwr-normal-input",a);new x({element:b}),b.val("").trigger("autosize.resize")},_renderMedia:function(){var a=this.element,b=$(".media",a),c=$(".rwr-normal-input",a),d=new w({element:b,limitUploadSingle:!0,action:["h5imgupload","h5attachupload","at"],actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:C.p},{title:"部门",type:"g",list:C.g}]}},h5imgupload:{limitUploadSingle:!1}}});b.data("media",d)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".rwr-normal-input",c);return 0==b.replyContent.length&&(g.showInputError(d.closest(".rwr-normal-input-wrapper")),a=!1),b.replyContent.length>2e3&&(g.alert("请控制输入在2000字内"),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".rwr-normal-input",e),g=$(".media",e),h=$(".is-send-sms",e),i=g.data("media");a.feedID=d.feedID,a.replyToReplyID=0,a.replyToEmployeeID=0,a.replyContent=_.str.trim(f.val()),a.fileInfos=[];var j=i.getUploadValue();return _.each(j,function(b){"img"==b.uploadType?a.fileInfos.push({value:2,value1:b.pathName,value2:b.size,value3:b.name}):"attach"==b.uploadType&&a.fileInfos.push({value:3,value1:b.pathName,value2:b.size,value3:b.name})}),a.isSendSms=h.prop("checked"),a
},clearForm:function(){var a=this.element,b=$(".rwr-normal-input",a),c=$(".is-send-sms",a),d=$(".media",a),e=d.data("media");b.val("").trigger("autosize.resize"),c.prop("checked",!1),e.resetAll(),e.enableAction("h5imgupload"),e.enableAction("h5attachupload")},_submit:function(a){var b,c=this,d=this.element,e=$(".media",d),f=e.data("media"),h=$(a.currentTarget),i=this.get("itemV"),j=i.$el,k=j.data("fsReply");this.isValid()&&f.send(function(a){b=c.getRequestData(),g.api({type:"post",data:b,url:"/Feed/SendFeedReply",success:function(d){d.success&&(c.hide(),k.addNewReply(d.value),c.get("successCb").call(c,d,b),c.clearForm()),a()}},{submitSelector:h})},d),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()},show:function(){var a,b=this.get("itemV"),c=b.model;return a=qb.superclass.show.apply(this,arguments),$(".user-name",this.element).text(c.get("originData").sender.name),a}}),rb=new qb,sb=i.extend({attrs:{itemV:null,content:v.filter(".rwr-complete-tpl").html(),className:"common-style-richard feed-rwr-complete-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=i.superclass.render.apply(this,arguments);return this._initAtInput(),this._renderMedia(),a},_initAtInput:function(){var a=this.element,b=$(".rwr-complete-input",a);new x({element:b})},_renderMedia:function(){var a=this.element,b=$(".media",a),c=$(".rwr-complete-input",a),d=new w({element:b,action:["h5imgupload","h5attachupload","at"],actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:C.p},{title:"部门",type:"g",list:C.g}]}}}});b.data("media",d)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".rwr-complete-input",c);return 0==b.replyContent.length&&(g.showInputError(d.closest(".rwr-complete-input-wrapper")),a=!1),b.replyContent.length>2e3&&(g.alert("请控制输入在2000字内"),a=!1),a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".rwr-complete-input",e),g=$(".media",e),h=$(".is-send-sms",e),i=g.data("media");a.feedID=d.feedID,a.replyContent=_.str.trim(f.val()),a.operationType=1;var j=i.getUploadValue();return a.fileInfos=[],_.each(j,function(b){"img"==b.uploadType?a.fileInfos.push({value:2,value1:b.pathName,value2:b.size,value3:b.name}):"attach"==b.uploadType&&a.fileInfos.push({value:3,value1:b.pathName,value2:b.size,value3:b.name})}),a.isSendSms=h.prop("checked"),a},clearForm:function(){var a=this.element,b=$(".rwr-complete-input",a),c=$(".is-send-sms",a),d=$(".media",a),e=d.data("media");b.val("").trigger("autosize.resize"),c.prop("checked",!1),e.resetAll()},_submit:function(a){var b,c=this,d=this.element,e=$(".media",d),f=$(a.currentTarget),h=e.data("media"),i=this.get("itemV"),j=i.$el;j.data("fsReply"),$(".con",j),this.isValid()&&h.send(function(a){b=c.getRequestData(),g.api({type:"post",data:b,url:"/FeedWork/ExecuterSendFeedWorkReply",success:function(b){b.success&&(i.updateModel(),c.hide(),c.clearForm()),a()}},{submitSelector:f})},d),a.preventDefault()},_cancel:function(a){this.clearForm(),this.hide(),a.preventDefault()}}),tb=new sb,ub=i.extend({attrs:{itemV:null,content:v.filter(".sar-normal-tpl").html(),className:"common-style-richard feed-sar-normal-dialog",successCb:e.EMPTY_FN},events:{"click .f-sub":"_submit","click .f-cancel":"_cancel"},render:function(){var a=i.superclass.render.apply(this,arguments);return this._initAtInput(),this._renderMedia(),a},_initAtInput:function(){var a=this.element,b=$(".sar-normal-input",a);this.atInput=new x({element:b,withAt:!0})},_renderMedia:function(){var a=this.element,b=$(".media",a),c=$(".sar-normal-input",a),d=new w({element:b,action:["h5imgupload","h5attachupload","at"],limitUploadSingle:!0,actionOpts:{at:{inputSelector:c,spOpts:{data:[{title:"同事",type:"p",list:C.p},{title:"部门",type:"g",list:C.g}]}},h5imgupload:{limitUploadSingle:!1}}});b.data("media",d)},isValid:function(){var a=!0,b=this.getRequestData(),c=this.element,d=$(".sar-normal-input",c);return 0==b.replyContent.length?(g.showInputError(d.closest(".sar-normal-input-wrapper")),a=!1):b.replyContent.length>2e3?(g.alert("发送内容不超过2000字，目前已超出<em>"+(b.replyContent.length-2e3)+"</em>个字"),a=!1):a},getRequestData:function(){var a={},b=this.get("itemV"),c=b.model,d=c.get("originData"),e=this.element,f=$(".sar-normal-input",e),g=$(".media",e),h=$(".is-send-sms",e),i=g.data("media");a.feedID=d.feedID,a.replyToReplyID=0,a.replyToEmployeeID=0,a.replyContent=_.str.trim(f.val());var j=i.getUploadValue();return a.fileInfos=[],_.each(j,function(b){"img"==b.uploadType?a.fileInfos.push({value:2,value1:b.pathName,value2:b.size,value3:b.name}):"attach"==b.uploadType&&a.fileInfos.push({value:3,value1:b.pathName,value2:b.size,value3:b.name})}),a.isSendSms=h.prop("checked"),a},clearForm:function(){var a=this.element,b=$(".sar-normal-input",a),c=$(".is-send-sms",a),d=$(".media",a),e=d.data("media");b.val("").trigger("autosize.resize"),c.prop("checked",!1),e.resetAll()},_submit:function(a){var b,c=this,d=this.element,e=$(".media",d),f=e.data("media"),h=this.get("itemV"),i=h.$el,j=i.data("fsReply");this.isValid()&&f.send(function(a){b=c.getRequestData(),g.api({type:"post",data:b,url:"/FeedApprove/ApproverOnlySendFeedReply",success:function(d){d.success&&(c.hide(),j.addNewReply(d.value),c.get("successCb").call(c,d,b)),c.clearForm(),a()}})},d),a.preventDefault()},_cancel:function(a){this.hide(),a.preventDefault()},show:function(){var a,b=this.get("itemV"),c=b.model;return a=qb.superclass.show.apply(this,arguments),$(".user-name",this.element).text(c.get("originData").sender.name),a},hide:function(){var a;return a=qb.superclass.hide.apply(this,arguments),this.clearForm(),a}}),vb=new ub,wb=i.extend({attrs:{hasMask:!0,width:580,height:600,itemV:null,content:v.filter(".approve-history-tpl").html(),className:"common-style-richard feed-approve-history-dialog",successCb:e.EMPTY_FN},render:function(){var a=wb.superclass.render.apply(this,arguments);return this._initFeedList(),a},_initFeedList:function(){var b=this,c=a("./feed-list"),d=this.element,e=$(".feed-list",d);$(".feed-list-pagination",d),this.feedList=new c({element:e,pagSelector:!1,withLazyload:!1,withAvatar:!1,listPath:"/FeedApprove/GetSomeoneApproveHistroy",defaultRequestData:function(){var a=b.get("itemV"),c=a.model,d=c.get("originData");return{employeeID:d.employeeID,feedID:d.feedID}}})},load:function(){this.feedList.load(requestData)},reload:function(){this.feedList.reload()},show:function(){var a=wb.superclass.show.apply(this,arguments),b=this.element,c=$(".user-name",b),d=this.get("itemV"),e=d.model;return c.text(e.get("originData").sender.name),a}}),xb=new wb,yb=i.extend({attrs:{width:787,height:600,itemV:null,content:v.filter(".print-preview-tpl").html(),className:"common-style-richard feed-print-preview-dialog",successCb:e.EMPTY_FN,zIndex:1e3},events:{"click .f-sub":"_print","click .f-cancel":"_cancel"},render:function(){var a=yb.superclass.render.apply(this,arguments);return a},_initIframe:function(){var a,b=this.element,c=$(".ui-dialog-body",b),d=$(".preview-mask",c),e=this.get("itemV"),f=e.model;return a=$('<iframe frameborder="0" scrolling="no" src="'+K+f.get("feedID")+'/isprint-1" class="preview-ifr" width="787" height="500" />'),a.appendTo(c),a.get(0).contentWindow.printModelCb=function(){d.hide()},a},show:function(){var a=yb.superclass.show.apply(this,arguments),b=this.element,c=$(".ui-dialog-body",b),d=$(".preview-mask",c),e=$(".preview-ifr",b),f=this.get("itemV"),g=f.model;return 0==e.length?this._initIframe():e.attr("src",K+g.get("feedID")+"/isprint-1"),d.show(),a},hide:function(){var a=yb.superclass.hide.apply(this,arguments),b=this.element,c=($(".ui-dialog-body",b),$(".preview-ifr",b));return c.length>0&&c.attr("src",K+0+"/isprint-1"),a},_print:function(){var a=this.element,b=$(".preview-ifr",a);b.get(0).contentWindow.focus(),b.get(0).contentWindow.print()},_cancel:function(){this.hide()}}),zb=new yb,Ab=i.extend({attrs:{width:420,hasMask:!1,content:v.filter(".feedlocationfn-equipment-tpl").html(),className:"common-style-richard feedlocationfn-equipment-dialog"},events:{click:"_stopBubbling","click .equipment-tit-account":"_tabAccount","click .equipment-tit-equipment":"_tabEquipment","change .equipment-select-btn":"_pageSelect","click .equipment-btn-l":"_pageBtnLeft","click .equipment-btn-r":"_pageBtnRight"},render:function(){var a=this,b=Ab.superclass.render.apply(this,arguments);return g.regGlobalClick(this.element,function(){a.hide()}),b},hide:function(){var a=yb.superclass.hide.apply(this,arguments),b=this.element;return $(".equipment-tit-equipment",b).removeClass("cur"),$(".equipment-tit-account",b).addClass("cur"),$(".equipment-listwarp",b).html(""),a},_stopBubbling:function(a){a.stopPropagation()},_pageBtnLeft:function(a){var b=$(a.currentTarget),c=$(".equipment-pagewarp",this.element),d=c.attr("type"),e=c.attr("pagenumber");return b.is(".disable")?!1:(e--,1==d?this._accountAjax(e):this._equipmentAjax(e),void 0)},_pageBtnRight:function(a){var b=$(a.currentTarget),c=$(".equipment-pagewarp",this.element),d=c.attr("type"),e=c.attr("pagenumber");return b.is(".disable")?!1:(e++,1==d?this._accountAjax(e):this._equipmentAjax(e),void 0)},_pageSelect:function(a){var b=$(a.currentTarget),c=b.val(),d=$(".equipment-pagewarp",this.element),e=d.attr("type");1==e?this._accountAjax(c):this._equipmentAjax(c)},_tabAccount:function(a){var b=$(a.currentTarget),c=$(".equipment-titwarp",this.element);$("a",c).removeClass("cur"),b.addClass("cur"),this._accountAjax(1)},_tabEquipment:function(a){var b=$(a.currentTarget),c=$(".equipment-titwarp",this.element);$("a",c).removeClass("cur"),b.addClass("cur"),this._equipmentAjax(1)},_createItem:function(a,b){var c=a.country,d=a.province,e=a.city,f=a.district,h=a.street,i=a.streetNumber,k=c+d+e+f+h+i,l=a.employee.name,m=g.getAvatarLink(a.employee.profileImage,"3"),n=a.token,o="设备号："+n+" ";1==b&&(o="");var p=j.unix(a.createTime),q=j.unix(this.serviceTime),r=g.getDateSummaryDesc(p,q,1),s='<div class="equipment-listitem fn-clear"> <div class="equipment-listitem-l"> <img src="'+m+'" alt="" class="equipment-listitem-l-img"></div> <div class="equipment-listitem-r"> <div class="equipment-listitem-r-top">'+l+"："+k+'</div> <div class="equipment-listitem-r-bottom">'+o+r+"</div> </div> </div>";return $(s)},_accountAjax:function(a){var b=this,c=this.itemV,d=c.model,e=d.get("originData"),f=e.employeeID,h=this.element,i=$(".equipment-topinfo",h),j=$(".employee-name-info",h),k=$(".equipment-listwarp",h),l=$(".equipment-select-btn",h),m=$(".equipment-pagewarp",h),n=$(".equipment-btn-l",m),o=$(".equipment-btn-r",m);this.serviceTime=e.serviceTime,m.attr("type","1"),g.api({url:"/Location/GetLocationInfosInOneEmployee",type:"get",dataType:"json",data:{employeeID:f,pageSize:10,pageNumber:a},success:function(a){var c,d=a.value,e=d.tokenCount,f=d.locationTokens,g=d.totalCount,h=d.pageNumber,p=parseInt(g/10),q="";if(p>0)for(var r=1;p>=r;r++)q+='<option value ="'+r+'">第'+r+"页</option>";else q='<option value ="1">第1页</option>';l.html(q),l.val(h),c=f.length>0?f[0].employee.name:"",a.success&&(i.html('<span class="ml10">该帐号共使用<b class="red">'+e+"</b>个设备进行过签到（最近30次）</span>"),j.text("帐号："+c),k.empty(),_.each(f,function(a){var c=b._createItem(a,0);c.appendTo(k)}),m.attr("pagenumber",h),1>=h?n.addClass("disable"):n.removeClass("disable"),h>=p?o.addClass("disable"):o.removeClass("disable"))}})},_equipmentAjax:function(a){var b=this,c=this.element,d=this.itemV,e=d.model,f=e.get("originData"),h=f.feedID,i=$(".equipment-topinfo",c);$(".topinfo-cont",i);var j=$(".employee-name-info",c),k=$(".equipment-listwarp",c),l=$(".equipment-select-btn",c),m=$(".equipment-pagewarp",c),n=$(".equipment-btn-l",m),o=$(".equipment-btn-r",m);m.attr("type","2"),g.api({url:"/Location/GetLocationInfosInOneToken",type:"get",dataType:"json",data:{feedID:h,pageSize:10,pageNumber:a},success:function(a){if(a.success){var c=a.value;c.tokenCount;var d=c.locationTokens,e=c.employeeCount,f=c.token,g=c.totalCount,h=c.pageNumber,p=parseInt(g/10),q="",r="";if(e>1&&(q="，可能异常"),p>0)for(var s=1;p>=s;s++)r+='<option value ="'+s+'">第'+s+"页</option>";else r='<option value ="1">第1页</option>';l.html(r),l.val(h),e>1&&(e='<b class="red">'+e+"</b>"),a.success&&(j.text("设备ID："+f),i.html('<span class="ml10">共'+e+"人通过该设备进行了签到（最近30次）"+q+"</span>"),k.empty(),_.each(d,function(a){var c=b._createItem(a,1);c.appendTo(k)}),m.attr("pagenumber",h),1>=h?n.addClass("disable"):n.removeClass("disable"),h>=p?o.addClass("disable"):o.removeClass("disable"))}}})},show:function(){var a=Ab.superclass.show.apply(this,arguments),b=this.element,c=$(".equipment-arrow",b),d=this.up;return d?c.addClass("up"):c.removeClass("up"),this._accountAjax(1),a},_cancel:function(){this.hide()}}),Bb=new Ab,Cb=_.template(v.filter(".feed-list-share").html()),Db=_.template(v.filter(".feed-list-schedule").html()),Eb=_.template(v.filter(".feed-list-schedule-tip").html()),Fb=_.template(v.filter(".feed-list-voteitem").html()),Gb=_.template(v.filter(".feed-list-announce").html()),Hb=_.template(v.filter(".feed-list-announce-page").html()),Ib=_.template(v.filter(".feed-list-plan").html()),Jb=_.template(v.filter(".feed-list-work").html()),Kb=_.template(v.filter(".feed-list-approve").html()),Lb=_.template(v.filter(".feed-list-approve-print").html()),Mb=Backbone.View.extend({tagName:"div",className:"list-item fn-clear",events:{"click .istimeshow":"istimeshow","mouseenter .islike":"enterIsLike","mouseleave .islike":"leaveIsLike","click .aj-commenton":"commen","click .aj-commenton-btn":"commenbtn","click .item-func .more":"funcmore","click .feed-content-visible-h":"fcVisibleH","click .feed-topreply-content-visible-h":"fctrVisibleH","click .unatt-bt":"unattbt","click .ar-modfiy":"modfiypof","click .aj-pending":"ped","click .aj-delete":"showDel","click .aj-schedule-delete":"showScheduleDelBtn","click .submit-cancelschedule":"submitcancelschedule","click .cancelmenu-box .f-cancel":"cancel","click .aj-unplaceonfile":"showunpof","click .aj-open-vote-btn":"openvotebtn","click .aj-close-vote-btn":"closevotebtn","click .aj-sendvote-btn":"sendvotebtn","click .aj-seevote-btn":"seevotebtn","click .aj-backvote-btn":"backvotebtn","click .aj-seemore-info-btn":"seemoreinfobtn","click .group":"groupbtn","click .schedulesgroup":"groupbtn","click .msmremaindcount":"msmremaindcount","click .receiptalertlist":"receiptalertlist","click .aj-receipt-fn":"sendReceiptAJAX","click .item-media .feed-img":"_previewImg","click .item-media .feed-attach .attach-preview-l":"_previewAttach","click .item-media .feed-attach .attach-play-l":"_playAttach","click .printer":"_printFeed","click .feed-location-fn-map":"_showFeedLocation","click .aj-feed-fn-com-btn":"feedFnComBtns"},feedFnComBtns:function(a){var b,c,d=$(a.currentTarget),e=d.closest(".fs-list-item");if(d.is(".aj-appr-history")&&this._showApproveHisDialog(a),d.is(".aj-approval")&&this.approval(a),d.is(".aj-appr-yes")&&this.appryes(a),d.is(".aj-appr-no")&&this.apprno(a),d.is(".aj-Reply")&&this.reply(a),d.is(".aj-cc-add")){if(e=d.closest(".reply-cc"),b=$(".aj-selectccer .input-tip",e),c=$(".fs-contact-bar-list",e),!c.html())return b.click(),!1;this.ccadd(a)}if(d.is(".undone-btn")&&this._showSwrUndoneDialog(a),d.is(".done-btn")&&this._showSwrDoneDialog(a),d.is(".cancel-btn")&&this._showSwrCancelDialog(a),d.is(".normal-btn")&&this._showRwrNormalDialog(a),d.is(".complete-btn")&&this._showRwrCompleteDialog(a),d.is(".aj-appr-re")&&this._showSarNormalDialog(a),d.is(".open-replies-imgorfile")&&this.openRepliesImgorfile(a),d.is(".aj-cc")&&this.cc(a),d.is(".aj-sendwork")&&this.sendworkre(a),d.is(".aj-working-normal")&&this.workingnorm(a),d.is(".aj-working-finish")&&this.workingfini(a),d.is(".aj-work-unfinish")&&this.workunfini(a),d.is(".aj-work-finish")&&this.workfini(a),d.is(".aj-modifyapproval")&&this.modifyapprer(a),d.is(".aj-modifyapprer")){if(e=d.closest(".reply-modifyapprer"),b=$(".aj-selectapprer .input-tip",e),c=$(".fs-contact-bar-list",e),!c.html())return b.click(),!1;this.sendmodifyapprer(a)}return d.is(".islike-btn")&&this.sendIsLike(a),d.is(".feed-location-fn-equipment")?(this.feedLocationFnEquipment(a),!1):(d.is(".feed-audio-close-btn")&&this.audioCloseBtn(a),d.is(".feed-audio-open-btn")&&this.audioBtn(a),d.is(".feedlist-open-ecrypt")&&this.openEcrypt(a),d.is(".print-del-pic-ico")&&this.printdelpic(a),d.is(".aj-attention")&&this.att(a),d.is(".aj-placeonfile")&&this.pof(a),d.is(".unpof-bt")&&this.unpofbt(a),d.is(".aj-unattention")&&this.showunatt(a),d.is(".aj-forward")&&this.fwd(),void 0)},openRepliesImgorfile:function(a){var b=$(a.currentTarget),c=b.closest(".replies-imgorfile-warp"),d=$(".replies-imgorfile",c);b.hide(),d.show()},printdelpic:function(a){var b=$(a.currentTarget),c=b.closest(".print-img-warp");c.hide()},openEcrypt:function(a){var b=$(a.currentTarget),c=this.model;c.get("originData");var d=b.closest(".list-item"),e=$(".contnet-isencrypted",d),f=$(".isencrypted-tit",e).text(),g=$(".info-all-contnet",d),h=$(".printer",d),i='<div class="info-all-contnet-unlocktit"><img src="../../html/fs/assets/images/lock_open.png" alt=""/>'+f+"</div>",j=$(".item-face",d).attr("feedid");k.showFeedPwdValid(function(a){a.success&&(e.hide(),g.before(i),g.show(),h.show())},function(){},{feedID:j})},_showFeedLocation:function(a){var b=this.model,c=b.get("feedLocation");I.fixLocation(c),a.preventDefault()},audioCloseBtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".audio-btn",c),e=$(".audio-warp",c);e.hide(),d.show(),b.hasClass("important-reply-audio")?this.importantAudioPlayer&&this.importantAudioPlayer.stop():this.audioPlayer&&this.audioPlayer.stop()},audioBtn:function(a){var b=$(a.currentTarget),c=b.closest(".audio-el"),d=$(".audio-warp",c),e=this.model,f=e.get("originData");b.hide(),d.show();var g,h;b.hasClass("important-reply-audio")?(h=b.data("attachsize"),g=b.data("attachpath"),this.importantAudioPlayer||(this.importantAudioPlayer=new s({element:$(".audio-box",d),audioSrc:g,length:h}),this.compStore.push(this.importantAudioPlayer)),this.importantAudioPlayer.play()):(h=f.audio.attachSize,g=e.get("attachPath"),this.audioPlayer||(this.audioPlayer=new s({element:$(".audio-box",d),audioSrc:g,length:h}),this.compStore.push(this.audioPlayer)),this.audioPlayer.play())},feedLocationFnEquipment:function(a){var b=$(a.currentTarget);Bb.itemV=this,Bb.up=!1;var c=b.offset().top,d=$(document).scrollTop(),e=275,f=280;return e>c-d&&(f=-30,Bb.up=!0),Bb.set("align",{selfXY:[320,f],baseElement:b,baseXY:[0,0]}),Bb.show(),!1},sendReceiptAJAX:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".item-face",d).attr("feedid"),f=$(".handle .receiptfnwarp",d),h=this.options,i=this.model.get("originData"),j=i.receipt;g.api({url:"/FeedExtend/SendReceipt",type:"post",dataType:"json",data:{feedID:e},success:function(a){a.success&&(f.html('<a href="javascript:void(0);" class="disable"><img src="../../html/fs/assets/images/receipted.gif" alt="" class="vm">已回执</a><i class="S_txt3">|</i>'),b._updateReceiptData(j.receiptedCount+1),h.receiptCb&&h.receiptCb.call(b,a,{feedID:e}))}})},istimeshow:function(){var a=this.$el,b=this,c=$(".istimeshow",a),d=this.model,e=d.get("feedID"),f=c.text();"显示"==f?M.show():g.api({url:"/FeedAnnounce/SetAnnounceIsShow ",type:"post",data:{feedID:e,isShow:!1,showtimeDataType:0,time:0},dataType:"json",success:function(a){a.success&&b.updateModel()}}),M.itemV=this},leaveIsLike:function(){var a=this.$el,b=function(){$(".islike-tip",a).hide()};this.likeTimer=setTimeout(b,200)},enterIsLike:function(a){var b=$(a.currentTarget),c=this.$el,d=$(".islike-tip",b),e=this.options.likeStyle,f=$(".islike",c),g=$(".islike-more",f),h=this.model,i=h.get("originData");if(i.feedID,2!=e){var j=$(".js-empids",f);j.length>5?(j.show().eq(3).nextAll().hide(),g.show()):(g.hide(),j.show()),d.show(),clearTimeout(this.likeTimer)}},sendIsLike:function(a){var b=$(a.currentTarget),c=this,d=this.model,e=this.$el,f=this.options.likeStyle,h=$(".islike",e),i=$(".islike-tip",h);$(".js-empids",h);var j=$(".islike-btn",h);$(".likecount",h);var k=$(".likecountnum",h);$(".islike-more",h),k.text()||0;var l=d.get("originData"),m=l.feedID,n=!0,o=h.is(".cur");D.employeeID,D.name,D.profileImage,o?(n=!1,h.removeClass("cur"),j.attr("title","赞")):(n=!0,h.addClass("cur"),j.attr("title","取消赞")),g.api({url:"/FeedExtend/SetFeedLike",type:"post",data:{feedID:m,isLike:n},dataType:"json",success:function(d){d.success&&(2==f?($(".fs-list-item .item-func a",e).removeClass("fl-common-up-arrow"),b.addClass("fl-common-up-arrow"),c.islikelistbtn(a)):c.renderIslikeList(b,i))}})},renderIslikeList:function(a,b){var c=this.$el,d=b,e=this.model,f=e.get("originData"),h=f.feedID,i=$(".islike",c),j=$(".likecount",c);g.api({url:"/FeedExtend/GetFeedLikersOfFeedID",type:"get",data:{feedID:h,pageSize:50,pageNumber:1},dataType:"json",success:function(a){var b=a.value.likers,e=b.length,f="",k="";if(a.success)if(e>0){_.each(b,function(a){var b=a.name,c=g.getAvatarLink(a.profileImage,2),d=a.employeeID;k+='<a href="#profile/=/empid-'+d+'" title="'+b+'" class="js-empids"><img alt="'+b+'" src="'+c+'"></a>',j.html('<span class="likecountnum">('+e+")</span>")}),f=b.length>5?'<a href="#stream/showfeed/=/id-'+h+'/open-like" title="更多" class="islike-more"></a>':'<a href="#stream/showfeed/=/id-'+h+'/open-like" title="更多" class="islike-more hide"></a>',i.children().is(".islike-tip")?$(".islike-tip",c).html('<div class="toparrow"> <em>◆</em> <span>◆</span> </div>'+k+f):i.append('<div class="islike-tip" style="display:block"><div class="toparrow"> <em>◆</em> <span>◆</span> </div>'+k+f+"</div>");var l=$(".islike-more",i),m=$(".js-empids",i);m.length>5?(m.show().eq(3).nextAll().hide(),l.show()):(l.hide(),m.show()),d.show()}else j.html(""),d.remove()}})},islikelistbtn:function(){var a=this.$el,b=this.model,c=b.get("originData"),d=c.feedID,e=$(".replay-section",a),f=$(".likecount",a),h=$(".feed-reply",a),i="",j="";h.hide(),g.api({url:"/FeedExtend/GetFeedLikersOfFeedID",type:"get",data:{feedID:d,pageSize:50,pageNumber:1},dataType:"json",success:function(a){var b=a.value.likers,c=b.length;c>0?(_.each(b,function(a){var b=a.name,c=g.getAvatarLink(a.profileImage,2),d=a.employeeID;j+='<a href="#profile/=/empid-'+d+'" class="js-empids" title="'+b+'"><img alt="'+b+'" src="'+c+'"></a>'}),i='<div class="list-repeat"><div class="feedlike-list fn-clear">'+j+"</div></div>",f.html('<span class="likecountnum">('+c+")</span>")):(i='<div class="list-repeat"><div style="display: block;" class="list-empty-tip"><img class="icon-empty" alt="loading" src="../../html/fs/assets/images/clear.gif">&nbsp;&nbsp;<span class="empty-text">该信息没有被赞过</span></div></div>',f.html("")),e.html(i).show()}})},_printFeed:function(a){zb.set("itemV",this),zb.show(),a.preventDefault()},receiptalertlist:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid"),e=this.model,f=e.get("originData"),h=f.serviceTime;return $(".more-menu",c).hide(),g.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),g.api({url:"/Feed/GetFeedReceiptRangesByFeedID",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",i="",k="",l="",m=0,n="",o="";_.each(d,function(a){var b=a.employee;b&&(e=b.employeeID,f=b.name,i=g.getAvatarLink(a.employee.profileImage,"3"),k=a.isSendReceipt,m=a.receiptTime,l=a.source,m=j.unix(m),m=g.getDateSummaryDesc(m,j.unix(h),2),l=g.getSourceNameFromCode(l),k?(k="已回执",o="，"+m+"，通过"+l):(k="未回执",o=""),n+='<div class="sms-isread-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+i+'" /></a> <a href="#profile/=/empid-'+e+'" class="name" style="min-width:60px;">'+f+'</a> <span class="isread-receipt">'+k+o+"</span></div>")}),n='<div class="sms-isread-tpl"><div class="sms-isread-warp">'+n+'</div><div class="sms-isread-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(n).show(),a()}}})}}),!1},msmremaindcount:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid");return g.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),g.api({url:"/Feed/GetFeedSMSRangesByFeedID",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",h="",i="",j="",k="";_.each(d,function(a){e=a.employee.employeeID,f=a.employee.name,h=g.getAvatarLink(a.employee.profileImage,"3"),i=a.infoType,j=a.source,i=i?"已读":"未读",j=g.getSourceNameFromCode(j),k+='<div class="sms-isread-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+h+'" alt="" ></a> <a href="#profile/=/empid-'+e+'" class="name">'+f+'</a> <span class="isread">'+i+"，通过"+j+"</span> </div>"}),k='<div class="sms-isread-tpl"><div class="sms-isread-warp">'+k+'</div><div class="sms-isread-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(k),a()}}})}}),!1},groupbtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid");return g.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),g.api({url:"/Account/GetHistoryFeedRangeEmployeeInfos",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",h="",i="",j="";_.each(d,function(a){e=a.employee.employeeID,f=a.employee.name,h=g.getAvatarLink(a.employee.profileImage,"2"),j=a.infoType,j=1==j?"新增":"",i+='<div class="share-group-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+h+'" alt="" ></a> <a href="#profile/=/empid-'+e+'" class="name">'+f+'</a> <span class="infotype">'+j+"</span> </div>"}),i='<div class="share-group-tpl"><div class="share-group-warp">'+i+'</div><div class="share-group-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(i),a()}}})}}),!1},schedulesgroupbtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid");return g.showTip({baseElement:b,afterShow:function(a){var b=this.element;g.api({url:"/Account/GetHistoryFeedRangeEmployeeInfos",type:"get",data:{feedID:d},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",h="",i="";_.each(d,function(a){e=a.employeeID,f=a.name,h=g.getAvatarLink(a.profileImage,"3"),i+='<div class="share-group-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+h+'" alt="" ></a> <a href="#profile/=/empid-'+e+'" class="name">'+f+"</a> </div>"}),i='<div class="share-group-tpl"><div class="share-group-warp">'+i+'</div><div class="share-group-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(i),a()}}})}}),!1},_previewImg:function(a){var b,c,d=$(a.currentTarget).closest(".replies-imgorfile-warp"),e=this.model,f=e.get("originData"),g=[];$(".show-slide-up-tip-warp").hide(),d.length>0?(c=f.replies,_.each(c,function(a){var b=a.pictures;_.each(b,function(a){g.push({previewPath:a.attachPath+"2",originPath:a.attachPath+"1",thumbPath:a.attachPath+"3",createTime:a.createTime,fileName:a.attachName,fileSize:a.attachSize})})}),E.preview({type:"img",data:g,refId:f.feedID,belongToType:"reply"})):(b=f.pictures,_.each(b,function(a,b){g[b]={previewPath:a.attachPath+"2",originPath:a.attachPath+"1",thumbPath:a.attachPath+"3",createTime:a.createTime,fileName:a.attachName,fileSize:a.attachSize}}),E.preview({type:"img",data:g,refId:f.feedID,belongToType:"feed"}))},_previewAttach:function(a){var b,c,d,e=$(a.currentTarget),f=e.closest(".replies-imgorfile-warp"),g=e.closest(".netdiskfile"),h=this.model,i=h.get("originData"),j=i.files,k=$(a.currentTarget),l=k.closest("dl"),m=l.attr("attachid");f.length>0?(b=i.replies,_.some(b,function(a){var b=a.files;return d=_.find(b,function(a){return a.attachID==m}),d?!0:void 0})):g.length>0?(c=i.feedNDFiles,d=_.find(c,function(a){return a.ndFileID==m})):d=_.find(j,function(a){return a.attachID==m}),G.readFile({fileId:d.attachID||d.ndFileID,fileName:d.attachName,filePath:d.attachPath}),a.preventDefault()},_playAttach:function(a){var b,c,d,f=$(a.currentTarget),h=f.closest(".replies-imgorfile-warp"),i=f.closest(".netdiskfile"),j=this.model,k=j.get("originData"),l=k.files,m=$(a.currentTarget),n=m.closest("dl"),o=n.attr("attachid");h.length>0?(b=k.replies,_.some(b,function(a){var b=a.files;return d=_.find(b,function(a){return a.attachID==o}),d?!0:void 0})):i.length>0?(c=k.feedNDFiles,d=_.find(c,function(a){return a.ndFileID==o})):d=_.find(l,function(a){return a.attachID==o}),E.preview({type:"audio",data:[{previewPath:e.BLANK_IMG,originPath:d.attachPath,thumbPath:e.BLANK_IMG,createTime:d.createTime,fileName:d.attachName,fileSize:d.attachSize,fileId:d.attachID||d.ndFileID,employeeName:k.sender.name}],refId:k.feedID,belongToType:g.getAttachSourceName(d.source)}),a.preventDefault()},getVoteEls:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=b.closest(".item-vote"),e=$(".vote-main",d),f=$(".vote-inlet",d),g=$(".aj-cantsee-con",e),h=$(".aj-status-def",e),i=$(".aj-seevote-btn",e),j=$(".aj-status-vote",e),k=$(".downloadresult",d),l=$(".aj-status-result",e),m=$(".item-face",c).attr("feedid"),n=$(".tit",e),o=$(".seleinfo",e),p=$(".tit",f),q=$(".time",e),r=$(".selecter",e),s=$(".result-table",e),t=$(".status-table",e);return{defEl:h,cantseeEl:g,statusEl:j,resultEl:l,downloadresultEl:k,feedId:m,inletEl:f,seleinfoEl:o,timeEl:q,titleEl:n,mainEl:e,selecterEl:r,resultTableEl:s,statusTableEl:t,seevoteBtnEl:i,inletTitEl:p}},seemoreinfobtn:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=b.closest("tr"),e=$(".selertitle",d),f=e.attr("voteoptionid"),h=$(".item-face",c).attr("feedid");return g.showTip({baseElement:b,afterShow:function(a){var b=this.element;b.html("正在努力的请求数据中……"),g.api({url:"/FeedExtend/GetVoteEmployees",type:"get",data:{feedID:h,voteOptionID:f},dataType:"json",success:function(c){if(c.success){var d=c.value,e=0,f="",h="",i="",k="";_.each(d,function(a){e=a.employeeID,f=a.employee.name,h=g.getAvatarLink(a.employee.profileImage,"3"),i=a.voteTime,i=j.unix(i).format("MMMDD日 HH:mm"),k+='<div class="sms-isread-items fn-clear"> <a href="#profile/=/empid-'+e+'" class="profileimage"><img src="'+h+'" alt="" ></a> <a href="#profile/=/empid-'+e+'" class="name">'+f+'</a> <span class="isread">'+i+"</span> </div>"}),k='<div class="sms-isread-tpl"><div class="sms-isread-warp" style="width:220px">'+k+'</div><div class="sms-isread-countman">共<span class="num">'+d.length+"</span>人</div> </div>",b.html(k),a()}}})}}),!1},sendvotebtn:function(a){var b=this,c=this.getVoteEls(a),d=[],e=$("input:checked",c.selecterEl),f=this.$el,h=this.model,i=h.get("originData"),j=i.receipt;return e.each(function(a){d[a]=$(this).val()}),d.length>0?g.api({url:"/FeedExtend/SubmitVote",type:"post",data:{feedID:c.feedId,voteOptionIDs:d},success:function(a){a.success&&(j&&1==j.myReceiptStatus?g.api({url:"/FeedExtend/SendReceipt",type:"post",dataType:"json",data:{feedID:c.feedId},success:function(a){a.success&&b.updateModel(function(){$(".aj-open-vote-btn",f).click()})}}):b.updateModel(function(){$(".aj-open-vote-btn",f).click()}))}}):(O.rendered||O.render(),O.show(),$(".close-btn",O.element).click(function(){O.hide()})),!1},backvotebtn:function(a){var b=this.getVoteEls(a);b.statusEl.hide(),b.defEl.show(),b.resultEl.hide()},seevotebtn:function(a){var b=this.getVoteEls(a),c=b.mainEl.data("canViewResult");return b.defEl.hide(),b.timeEl.show(),c?(b.statusEl.show(),b.cantseeEl.hide()):(b.cantseeEl.show(),b.resultEl.hide()),!1},openvotebtn:function(a){var b=this.getVoteEls(a);g.api({url:"/Feedextend/GetVoteItemByID",type:"get",data:{feedID:b.feedId},success:function(a){var c=a.value;if(c){var d=c.title||"",e=c.canVote,f=c.canViewResult,g=c.voteCount,i="最多选择"+g+"项",k=Number(c.voteEmpCount),l=c.isAnoymouse,m=j.unix(c.deadline).format("MMMDD日 HH:mm:ss"),n=c.hVoteOptions,o=[" green"," red"," orange"," pink"," blue"],p="",q="",r="",s="checkbox",t="";b.mainEl.data("canViewResult",f)}t=k>0?k+"人已投票，":"",m=l?"提示：匿名投票，"+t+"截止时间"+m+"。":"提示："+t+"截止时间"+m+"。",1==g&&(s="radio");var u="";_.each(n,function(a,b){var d=a.optionTitle,e=a.voteOptionID,f="aj-seemore-info-btn",g=Number(a.selectedCount);
u=c.isAnoymouse||0==g?"":'<div class="seemore"> <span><a href="javascript:void(0);" class="'+f+'">查看详情</a></span> <div class="seemore-info"></div> </div>',r=Math.round(100*(g/k)),0==g&&(r=0),b>o.length-1&&(b%=o.length),p+='<label> <input type="'+s+'" value="'+e+'" name="voteinput">'+d+"</label>",q+='<tr> <td width="112" align="right"><span class="selertitle" voteoptionid="'+e+'">'+d+'</span></td> <td width="256"><span class="schedulebar'+o[b]+'"><span class="othervotebar aj-barwidth" style="width:'+r+'%"></span></span><span class="num">'+g+" ("+r+"%)</span></td> <td>"+u+"</td> </tr>"}),a.success&&(b.titleEl.text(d),b.seleinfoEl.text(i),b.timeEl.text(m),b.selecterEl.html(p),b.resultTableEl.html(q),b.statusTableEl.html(q),b.mainEl.show(),b.inletEl.hide(),b.seevoteBtnEl.hide(),e?(b.statusEl.hide(),b.defEl.show(),b.resultEl.hide()):(b.statusEl.hide(),b.defEl.hide(),b.resultEl.show()),l&&b.downloadresultEl.hide(),f?b.seevoteBtnEl.show():(b.cantseeEl.show(),b.seevoteBtnEl.hide(),b.resultEl.hide(),b.timeEl.hide(),e&&b.cantseeEl.hide()),0==c.voteEmpCount&&b.seevoteBtnEl.hide(),h.checkboxIsoverstep(b.defEl,g,function(){N.rendered||(N.render(),$(".close-btn",N.element).click(function(){N.hide()})),N.voteCountNum=g,N.show()}))}})},closevotebtn:function(a){var b=this.getVoteEls(a),c=$(a.currentTarget),d=c.closest(".item-vote"),e=$(".vote-inlet",d),f=$(".vote-main",d);e.show(),b.cantseeEl.hide(),f.hide()},workingre:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".replay-section",c),e=$(".reply-workingre",d),f='<div class="list-repeat reply-workingre"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tbody><tr><td width="70">回复指令：</td><td width="90"><button type="submit" class="button-green place-btn aj-working-normal aj-feed-fn-com-btn" style="vertical-align:middle;">普通回复</button></td><td><button type="submit" class="button-green place-btn aj-working-finish aj-feed-fn-com-btn" style="vertical-align:middle;">已完成，汇报结果</button></td></tr></tbody></table></div></div>';e.is(":visible")?e.hide():(d.html("").html(f),e.show())},sendworkre:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".replay-section",c),e=$(".reply-sendworkre",d),f='<div class="list-repeat reply-sendworkre"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tbody><tr><td width="70">确认结果：</td><td width="90"><button type="submit" class="button-green place-btn aj-work-unfinish aj-feed-fn-com-btn" style="padding:6px 15px;line-height:16px;">未完成<br/>继续执行</button></td><td><button type="submit" class="button-green place-btn aj-work-finish aj-feed-fn-com-btn"  style="padding:6px 15px;line-height:16px;">已完成<br/>点评结果</button></td></tr></tbody></table></div></div>';e.is(":visible")?e.hide():(d.html("").html(f),e.show())},workingnorm:function(){hb.rendered||(hb.render(),$(".close-btn",hb.element).click(function(){hb.hide()})),hb.show()},workingfini:function(){ib.rendered||(ib.render(),$(".close-btn",ib.element).click(function(){ib.hide()})),ib.show()},workunfini:function(){jb.rendered||(jb.render(),$(".close-btn",jb.element).click(function(){jb.hide()})),jb.show()},workfiniDialogRender:function(){var a,b;kb.render(),a=kb.element,b=$(".aj-addworker",a),new y({element:b,data:[{title:"同事",type:"p",list:C.p}],singleCked:!1,title:"添加抄送人",autoCompleteTitle:"请输入姓名或拼音"}),$(".close-btn",kb.element).click(function(){kb.hide()})},workfini:function(){kb.rendered||this.workfiniDialogRender(),kb.show()},modifyapprerSelectBar:function(){var a,b=this.modifyapprer.element,c=$(".aj-selectapprer",b),d=this.model,e=d.get("originData"),f=e.approve,g=f.senderID;a=_.reject(C.p,function(a){return a.id==g});var h=new y({element:c,data:[{title:"同事",type:"p",list:a}],singleCked:!0,title:"选择审批人(一个)",autoCompleteTitle:"请输入姓名或拼音"});this.modifyapprerSb=h},sendmodifyapprer:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".item-face",d).attr("feedid"),f=$(".is-sendapper",d),h=f.is(":checked"),i=$(".replay-section",d),j=$(".reply-modifyapprer",i),k=this.modifyapprerSb,l=k.getSelectedData(),m=l.p||[];m=Number(m[0]),m&&g.api({url:"/FeedApprove/ToNextApprover",type:"post",data:{feedID:e,approverID:m,isSendSms:h},success:function(a){a.success&&(j.hide(),b.updateModel())}})},modifyapprer:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".replay-section",c),e=$(".feed-reply",c),f=$(".reply-modifyapprer",d);e.hide();var g='<div class="list-repeat reply-modifyapprer"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td colspan="2"><div class="aj-selectapprer selectapprer">选择审批人（一个）</div></td></tr><tr><td><span class="label-for fn-hide"><input name="" class="is-sendapper" type="checkbox" style="vertical-align:middle;margin-right:4px;" value=""/><label>立即发送短信息到审批人的手机上</label></span></td><td align="right"><button type="submit" class="button-green place-btn aj-modifyapprer aj-feed-fn-com-btn" style="vertical-align:middle;">修改审批人</button></td></tr></table></div></div>';f.is(":visible")?(f.hide(),b.removeClass("fl-common-up-arrow")):(d.html(g).show(),this.modifyapprerSelectBar(),f.show(),$(".fs-list-item .item-func a",c).removeClass("fl-common-up-arrow"),$(".fs-list-item .item-func .islike-btn",c).removeClass("fl-common-up-arrow"),b.addClass("fl-common-up-arrow"))},ccSelectBar:function(){var a=this.ccSelectBar.element,b=$(".aj-selectccer",a),c=new y({element:b,data:[{title:"同事",type:"p",list:C.p}],singleCked:!1,title:"添加抄送人（一个或多个）",autoCompleteTitle:"请输入姓名或拼音"});this.ccSelectBarsb=c,this.compStore.push(c)},cc:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".replay-section",c),e=$(".feed-reply",c),f=$(".reply-cc",d);e.hide();var g='<div class="list-repeat reply-cc"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td><div class="aj-selectccer">添加抄送人</div></td></tr><tr><td align="right"><button type="submit" class="aj-feed-fn-com-btn button-green place-btn aj-cc-add marg10" style="vertical-align:middle;">添加抄送人</button></td></tr></table></div></div>';f.is(":visible")?(f.hide(),b.removeClass("fl-common-up-arrow")):(d.html(g).show(),f.show(),$(".fs-list-item .item-func a",c).removeClass("fl-common-up-arrow"),$(".fs-list-item .item-func .islike-btn",c).removeClass("fl-common-up-arrow"),b.addClass("fl-common-up-arrow"),this.ccSelectBar())},ccadd:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".replay-section",d),f=$(".item-face",d).attr("feedid"),h=$(".reply-cc",e),i=this.ccSelectBarsb,j=i.getSelectedData(),k=j.p||[],l="";_.each(k,function(a){l+="@"+g.getContactDataById(a,"p").name+" "}),g.api({url:"/FeedApprove/SenderAddAtEmployees",type:"post",data:{feedID:f,employeeAtNames:l,employeeIDs:k},success:function(a){a.success&&(b.updateModel(),h.hide())}})},approval:function(a){var b,c,d=this,e=this.$el,f=this.model,g=f.get("originData"),h=this.options,i=$(a.currentTarget),j=i.closest(".list-item"),k=$(".feed-reply",j),l=_.extend({listPath:"/Feed/GetFeedReplysByFeedID",withPagination:!0},h.replyListOpts),m=!!this.options.replyWithMedia;$(".fs-list-item .item-func a",j).removeClass("fl-common-up-arrow"),j.data("fsReply")||(c=D.id==g.sender.employeeID?!0:!1,b=new n({trigger:i,triggerText:"批复",element:k,bbarTpl:'<span class="fs-reply-send-sms label-for fn-hide"><input type="checkbox" name="send_sms" class="is-send-sms" '+(c?'disabled="disabled"':"")+' /> <label>推送短信给：<em class="user-name">'+g.sender.name+"</em></label></span>",defaultRequestData:function(){return{feedID:f.get("feedID")}},replyDefaultRequestData:function(){var a=0,b=0,c=f.get("feedType");return 3==c?(a=g.sender.employeeID,b=g.work.executerID):4==c&&(a=g.sender.employeeID,b=g.approve.currentApproverID),{feedType:c,replyToReplyID:0,replyToEmployeeID:0,feedSenderID:a,feedReceiverID:b,isSendSms:$(".is-send-sms",k).prop("checked")}},detailDefaultRequestData:function(){return{feedType:f.get("feedType"),feedID:g.feedID}},replyCb:function(a){a.success&&(h.reloadAfterReply?d.updateModel():($(".is-send-sms",k).prop("checked",!1),a.success&&this.get("listOpts")&&this.addNewReply(a.value)))},withMedia:m,listOpts:l}),b.show(),this.compStore.push(b),j.data("fsReply",b),this.approveReplyInit(),b.on("addatrange",function(a){var b,c,d=a.rangeNames,f=_.groupBy(d,function(a){return a.value?"circle":"employee"}),g=[],h=[];b=f.circle?f.circle.length:0,c=f.employee?f.employee.length:0,h=h.concat(_.map(f.employee,function(a){return a.value2})),h=h.concat(_.map(f.circle,function(a){return a.value2})),b>0&&(1==b?g.push(f.circle[0].value2):g.push(b+"个部门")),c>0&&(1==c?g.push(f.employee[0].value2):g.push(c+"个同事")),b+c>0&&$(".item-info .group a,.item-info .schedulesgroup a",e).html(g.join("，")).attr("title",h.join("，"))})),k.is(":visible")?i.addClass("fl-common-up-arrow"):i.removeClass("fl-common-up-arrow")},approveReplyInit:function(){var a=this.$el,b=(this.model,a.data("fsReply")),c=b.element,d=$(".fs-reply-submit-box",c),e=$('<div class="sar-action-tbar"></div>'),f='<div class="list-repeat reply-approval"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td width="65">批复意见：</td><td width="68"><button type="submit" class="button-green place-btn aj-appr-yes aj-feed-fn-com-btn" style="vertical-align:middle;">同意</button></td><td width="82"><button type="submit" class="button-green place-btn aj-appr-no aj-feed-fn-com-btn" style="vertical-align:middle;">不同意</button></td><td width="70"><button type="submit" class="aj-feed-fn-com-btn button-green place-btn aj-appr-re" style="vertical-align:middle;">复议</button></td><td><a href="javascript:void(0);" class="aj-feed-fn-com-btn aj-appr-history">查看历史</a></td></tr></table></div>';e.html(f),e.insertAfter(d),d.hide()},appryes:function(){ab.itemV=this,ab.rendered||ab.render(),ab.show()},apprno:function(){db.itemV=this,db.rendered||db.render(),db.show()},apprrehistory:function(){gb.itemV=this,gb.rendered||gb.render(),gb.show()},_updateReceiptData:function(a){var b,c,d=this.$el,f=$(".receiptfnBtnwarp",d),g=$(".receiptfnwarp",d),h=this.model,i=h.get("originData"),j=i.receipt,k="";b=0==a?'<a href="javascript:void(0);" class="aj-receipt-fn">回执</a><i class="S_txt3">|</i>':'<a href="javascript:void(0);" class="disable"><img src="'+e.ASSETS_PATH+'/images/receipted.gif" alt="" class="vm">已回执</a><i class="S_txt3">|</i>',j.isSendSms&&(k="已发短信，"),c='<a href="#" class="receiptalertlist alertlistbtn">需要'+j.requireReceiptCount+"人回执，"+k+"已回执"+a+"人</a>",h.set({receiptfn:b,receiptRemaind:c,receiptedCount:a},{silent:!0}),f.html(b),g.html(c)},reply:function(a){var b=this,c=this.$el,d=this.model,e=d.get("originData"),f=d.get("feedID"),g=this.options,h=$(a.currentTarget),i=h.closest(".list-item"),j=$(".replay-section",i),k=$(".commen-replay-section",i),l=($(".aj-Reply",i),$(".feed-reply",i));$(".feed-reply",l);var m,o,p=_.extend({listPath:"/Feed/GetFeedReplysByFeedID",withPagination:!0},g.replyListOpts),q=!!this.options.replyWithMedia,r=h.closest(".item-func"),s=r.siblings(".feed-reply");$(".show-slide-up-tip-warp").hide(),j.hide(),k.show(),i.data("fsReply")||(o=D.id==e.sender.employeeID?!0:!1,m=new n({feedID:457,trigger:h,element:l,bbarTpl:'<span class="fs-reply-send-sms label-for fn-hide"><input type="checkbox" name="send_sms" class="is-send-sms" '+(o?'disabled="disabled"':"")+' /> <label>推送短信给：<em class="user-name">'+d.get("senderNameNoLink")+"</em></label></span>",defaultRequestData:function(){return{feedID:f}},replyDefaultRequestData:function(){var a=0,b=0,c=d.get("feedType");return 3==c?(a=e.sender.employeeID,b=e.work.executerID):4==c&&(a=e.sender.employeeID,b=e.approve.currentApproverID),{feedType:c,replyToReplyID:0,replyToEmployeeID:0,feedSenderID:a,feedReceiverID:b,isSendSms:$(".is-send-sms",l).prop("checked")}},detailDefaultRequestData:function(){return{feedType:d.get("feedType"),feedID:e.feedID}},replyCb:function(a){if(a.success){var c=e.receipt;c&&1==c.myReceiptStatus&&(b._updateReceiptData(c.receiptedCount+1),g.receiptCb&&g.receiptCb.call(b,a,{feedID:f})),g.reloadAfterReply?b.updateModel():($(".is-send-sms",l).prop("checked",!1),a.success&&this.get("listOpts")&&this.addNewReply(a.value))}},listOpts:p,withMedia:q}),m.show(),this.compStore.push(m),i.data("fsReply",m),3==d.get("feedType")&&this.workReplyInit(),m.on("addatrange",function(a){var b,d,e=a.rangeNames,f=_.groupBy(e,function(a){return a.value?"circle":"employee"}),g=[],h=[];b=f.circle?f.circle.length:0,d=f.employee?f.employee.length:0,h=h.concat(_.map(f.employee,function(a){return a.value2})),h=h.concat(_.map(f.circle,function(a){return a.value2})),b>0&&(1==b?g.push(f.circle[0].value2):g.push(b+"个部门")),d>0&&(1==d?g.push(f.employee[0].value2):g.push(d+"个同事")),b+d>0&&$(".item-info .group a,.item-info .schedulesgroup a",c).html(g.join("，")).attr("title",h.join("，"))})),$(".fs-list-item .item-func .aj-cc",i).removeClass("fl-common-up-arrow"),$(".fs-list-item .item-func .aj-modifyapproval",i).removeClass("fl-common-up-arrow"),$(".fs-list-item .item-func .islike-btn",i).removeClass("fl-common-up-arrow"),s.is(":visible")?h.addClass("fl-common-up-arrow"):h.removeClass("fl-common-up-arrow"),a.preventDefault()},workReplyInit:function(){var a,b=this.$el,c=this.model,d=b.data("fsReply"),e=d.element,f=$(".fs-reply-submit-box",e),g=c.get("originData"),h=g.work;a=$('<div class="reply-tbar"></div>'),a.insertAfter(f),h.assignerID==D.id&&h.canComment&&(a.addClass("swr-action-tbar"),a.html('<label>确认结果：</label><button type="button" class="aj-feed-fn-com-btn undone-btn button-green" style="padding:6px 15px;line-height:16px;">未完成<br/>继续执行</button>&nbsp;&nbsp;<button type="button" class="aj-feed-fn-com-btn cancel-btn button-green" style="padding:6px 15px;line-height:16px;">取消指令<br/>转他人执行</button>&nbsp;&nbsp;<button type="button" class="aj-feed-fn-com-btn done-btn button-green" style="padding:6px 15px;line-height:16px;">已完成<br/>点评结果</button>'),f.hide()),h.executerID==D.id&&h.canSubmit&&(a.addClass("rwr-action-tbar"),a.html('<label>回复指令：</label><button type="button" class="aj-feed-fn-com-btn normal-btn button-green">普通回复</button>&nbsp;&nbsp;<button type="button" class="aj-feed-fn-com-btn complete-btn button-green">已完成，汇报结果</button>'),f.hide())},_showSwrUndoneDialog:function(){mb.set("itemV",this),mb.show()},_showSwrDoneDialog:function(){ob.set("itemV",this),ob.show()},_showSwrCancelDialog:function(){pb.set("itemV",this),pb.show()},_showRwrNormalDialog:function(){rb.set("itemV",this),rb.show()},_showRwrCompleteDialog:function(){tb.set("itemV",this),tb.show()},_showSarNormalDialog:function(){vb.set("itemV",this),vb.show()},_showApproveHisDialog:function(){xb.set("itemV",this),xb.show(),xb.reload()},funcmore:function(a){var b=$(a.currentTarget),c=b.closest(".handle"),d=$(".more-menu",c);return d.is(":visible")?d.hide():($(".handle .more-menu").hide(),d.show()),$(".fs-tip").hide(),!1},fctrVisibleH:function(a){var b=$(a.currentTarget),c=b.closest(".comment-list"),d=this.model,e=d.get("feedFormatContents"),f=b.data("index"),g=e[f].leftHtml,h=$(".feed-topreply-summary-text",c),i=$(".feed-left-text",c),j=$(".feed-topreply-content-visible-h",c),k=$(".feed-content-ellipsis",c);0==i.length?(i=$('<span class="feed-left-text">'+g+"</span>"),i.insertAfter(h),j.text("收起正文"),k.hide()):i.is(":visible")?(i.hide(),j.text("展开正文，（共"+e[f].feedWordNum+"个字）"),k.show()):(i.show(),j.text("收起正文"),k.hide()),a.preventDefault()},fcVisibleH:function(a){var b=this.model,c=b.get("feedFormatContent"),d=c.leftHtml,e=$(".item-text",this.$el),f=$(".feed-summary-text",e),g=$(".feed-left-text",e),h=$(".feed-content-visible-h",e),i=$(".feed-content-ellipsis",e);0==g.length?(g=$('<span class="feed-left-text">'+d+"</span>"),g.insertAfter(f),h.text("收起正文"),i.hide()):g.is(":visible")?(g.hide(),h.text("展开正文，（共"+c.feedWordNum+"个字）"),i.show()):(g.show(),h.text("收起正文"),i.hide()),a.preventDefault()},commen:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".replay-section",d),f=this.model,g=f.get("originData"),h=f.get("feedID"),i=this.options,j=$(".reply-commen",e),k='<div class="list-repeat reply-commen"><div class="LR-feed"><table width="100%" border="0" cellspacing="0" cellpadding="0" class=""><tr><td width="70">选择操作：</td><td><button type="submit" class="button-green place-btn aj-commenton-btn">点评日志</button></td></tr></table></div><div class="commen-replylistwarp">这里面放回复列表</div></div>';e.children().is(".reply-commen")?j.is(":visible")?(j.hide(),c.removeClass("fl-common-up-arrow")):(j.show(),$(".fs-list-item .item-func a",d).removeClass("fl-common-up-arrow"),c.addClass("fl-common-up-arrow")):(e.append(k),c.addClass("fl-common-up-arrow")),e.addClass("commen-replay-section");var l,m=!1,o=$(".commen-replylistwarp",d),p=_.extend({listPath:"/Feed/GetFeedReplysByFeedID",withPagination:!0,replyListCb:function(a){var c;a.success&&(c=a.value.totalCount,0==c&&b.showCommentDialog(!0))}},i.replyListOpts),q=!!this.options.replyWithMedia,r=c.closest(".item-func");r.siblings(".feed-reply"),d.data("fsReply")||(l=new n({feedID:457,trigger:c,element:o,bbarTpl:'<span class="fs-reply-send-sms label-for fn-hide"><input type="checkbox" name="send_sms" class="is-send-sms" '+(m?'disabled="disabled"':"")+' /> <label>推送短信给：<em class="user-name">'+f.get("senderNameNoLink")+"</em></label></span>",defaultRequestData:function(){return{feedID:h}},replyDefaultRequestData:function(){var a=0,b=0,c=f.get("feedType");return 3==c?(a=g.sender.employeeID,b=g.work.executerID):4==c&&(a=g.sender.employeeID,b=g.approve.currentApproverID),{feedType:c,replyToReplyID:0,replyToEmployeeID:0,feedSenderID:a,feedReceiverID:b,isSendSms:$(".is-send-sms",o).prop("checked")}},detailDefaultRequestData:function(){return{feedType:f.get("feedType"),feedID:g.feedID}},replyCb:function(a){if(a.success){var c=g.receipt;c&&1==c.myReceiptStatus&&i.receiptCb&&i.receiptCb.call(b,a,{feedID:h}),i.reloadAfterReply?b.updateModel():($(".is-send-sms",o).prop("checked",!1),a.success&&this.get("listOpts")&&this.addNewReply(a.value))}},listOpts:p,withMedia:q}),l.show(),this.compStore.push(l),d.data("fsReply",l))},addReplyCountPlusOne:function(){var a=$(".aj-Reply",this.$el),b=$(".num",a);b.length>0?b.text(parseInt(b.text())+1):a.html('回复(<span class="num">1</span>)')},commenbtn:function(){P.itemV=this,P.rendered||P.render(),P.show()},showCommentDialog:function(a){var b,c,d=P.element;this.commenbtn(),b=$(".dialog-right",d),c=$(".look-history",d),a?(c.text("收起历史日志<<"),P.set("width",909),b.show()):(c.text("查看历史日志>>"),P.set("width",458),b.hide())},pof:function(a){$(a.currentTarget),S.rendered||S.render(),S.itemV=this,S.show()},modfiypof:function(a){var b=$(a.currentTarget),c=b.closest(".archive-remind"),d=$(".ar-tip a",c),e="";d.each(function(a){e+=d.eq(a).text()+" "}),S.rendered||S.render(),this.model,S.itemV=this,S.thisTags=e,S.show()},showScheduleDelBtn:function(a){var b=this,c=$(a.currentTarget),d=this.model,e=d.get("originData"),f=e.sender.employeeID,i=g.getContactData().u.id,j=e.schedule.relateEmployees.length,k='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>确定删除这条日程吗</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';this.cTipEl=$(".show-slide-up-tip-warp"),i==f&&j>1?g.confirm("该日程共有"+j+"位参与者，删除日程将会删除所有参与者的日程，是否继续？","确认删除",function(){b.submitcancelschedule(a)}):0==this.cTipEl.length?this.cTip=new h.showSlideUpTip({element:c,autohide:!1,width:175,height:99,template:k,top:15,callback:function(){b.submitcancelschedule(a)}}):(this.cTipEl.remove(),this.cTip=new h.showSlideUpTip({element:c,autohide:!1,width:175,height:99,template:k,top:15,callback:function(){b.submitcancelschedule(a)}}))},showunpof:function(a){var b=this,c=$(a.currentTarget),d='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>确定要取消归档这条信息吗</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';this.cTipEl=$(".show-slide-up-tip-warp"),0==this.cTipEl.length?this.cTip=new h.showSlideUpTip({element:c,autohide:!1,width:210,height:99,template:d,top:50,callback:function(){b.unpofbt(a)}}):(this.cTipEl.remove(),this.cTip=new h.showSlideUpTip({element:c,autohide:!1,width:210,height:99,template:d,top:50,callback:function(){b.unpofbt(a)}}))},unpofbt:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".item-face",c).attr("feedid"),e=this.options.withArchive;g.api({type:"post",data:{feedID:Number(d)},url:"/FeedArchive/CancelFeedArchive",success:function(a){if(e&&c.slideUp(250),a.success){var b=$(".aj-unplaceonfile",c);b.text("归档").attr("class","aj-placeonfile aj-feed-fn-com-btn");var d=new i({width:"",closeTpl:"",visibleWithAnimate:!0,content:'<div class="fs-successtip"><img src="../../html/fs/assets/images/success.gif" width="50" height="50" /> 取消归档成功</div>',className:"common-style-richard fs-feed-comment-dialog"}).render();d.show(),setTimeout(function(){d.hide()},1500)}}})},unattbt:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=$(".myatt",d),f=$(".follow-action-h",d),h=$(".item-face",d).attr("feedid"),j=this.options.withFollowTime;g.api({url:"/Feed/CancelFeedFollow",type:"post",data:{feedID:h},success:function(c){if(c.success)if(j&&d.slideUp(250),b.cancel(a),1==e.length)b.remove();else{var g=new i({width:"",closeTpl:"",content:'<div class="fs-successtip"><img src="../../html/fs/assets/images/success.gif" width="50" height="50" /> 取消关注成功</div>',className:"common-style-richard fs-feed-comment-dialog"}).render();g.show(),setTimeout(function(){g.hide()},1500),f.addClass("aj-attention").removeClass("aj-unattention").text("关注")}}})},att:function(a){var b=$(a.currentTarget),c=b.closest(".list-item"),d=$(".follow-action-h",c),e=$(".item-face",c).attr("feedid");g.api({url:"/Feed/AddFeedFollow",type:"post",data:{feedID:e},dataType:"json",success:function(a){a.success&&(h.showAlertDialog("关注成功"),d.addClass("aj-unattention").removeClass("aj-attention").text("取消关注"))}})},showunatt:function(a){var b=$(a.currentTarget),c=b.closest(".handle"),d=$(".cancelmenu",c),e=$(".cancelmenu-box",c),f=$(".cancel-text",c),g=$(".f-submit",c);f.text("确定要取消关注这条信息吗"),g.attr("class","f-submit button-green unatt-bt"),d.show(),e.css({top:"100px"}).animate({top:"15"},400)},fwd:function(){U.itemV=this,U.rendered?U.show():U.render().show()},ped:function(){X.itemV=this,X.rendered?X.show():X.render().show()},showDel:function(a){var b,c=$(a.currentTarget),d=this.model,e=d.get("originData"),f=this,g=e.feedType,i="",j=35,k=221;switch(this.cTipEl=$(".show-slide-up-tip-warp"),g){case 101:case 1001:case 1:i="确定删除这条信息吗(信息仅限24小时内可以删除)",b=this.del;break;case 2:i="确定删除这条日志吗（日志点评人点评后不能删除）",b=this.submitcancelplan;break;case 3:i="确定取消这条指令吗",b=this.submitcancelwork,k=175;break;case 4:i="确定取消这条审批吗",b=this.submitcancelappr,j=60,k=175}var l='<div><img src="../../html/fs/assets/images/tipconfirm.png" alt=""/>'+i+'</div><div class="button-warp"><button class="f-sub button-green">确定</button>&nbsp;&nbsp;<button class="f-cancel button-green">取消</button></div>';0==this.cTipEl.length?this.cTip=new h.showSlideUpTip({element:c,autohide:!1,width:k,height:99,template:l,top:j,callback:function(){b.call(f,a)}}):(this.cTipEl.remove(),this.cTip=new h.showSlideUpTip({element:c,autohide:!1,width:k,height:99,template:l,top:j,callback:function(){b.call(f,a)}}))},cancel:function(a){var b=$(a.currentTarget),c=b.closest(".handle"),d=$(".cancelmenu-box",c);d.animate({top:"120"},400)},del:function(a){var b=this,c=this.options,d=$(a.currentTarget),e=d.closest(".list-item"),f=$(".item-face",e).attr("feedid");g.api({url:"/Feed/DeleteFeedByID",type:"post",data:{feedID:f},success:function(a){a.success&&e.slideUp(250,function(){b.destroy(),c.deleteCb&&c.deleteCb.call(b,a,{feedID:f})})}})},submitcancelplan:function(a){var b=this,c=this.options,d=$(a.currentTarget),e=d.closest(".list-item"),f=$(".item-face",e).attr("feedid");g.api({url:"/FeedPlan/DeleteFeedPlanByID",type:"post",data:{feedID:f},success:function(a){a.success&&e.slideUp(250,function(){b.destroy(),c.deleteCb&&c.deleteCb.call(b,a,{feedID:f})})}})},submitcancelwork:function(a){var b=this,c=D.employeeID,d=this.model,e=d.get("originData"),f=$(a.currentTarget),h=f.closest(".list-item"),i=f.closest(".handle"),j=e.work.executer.employeeID,k=($(".cancelmenu-box",i),$(".item-face",h).attr("feedid")),l="/FeedWork/AssignerSendFeedWorkReply",m={feedID:k,replyContent:"取消该指令",operationType:3,fileInfos:[],rate:0,isSendSms:!1,atEmployeeIDs:[]};j==c&&(l="/FeedWork/ExecuterSendFeedWorkReply",m={feedID:k,replyContent:"取消该指令",operationType:3,fileInfos:[],isSendSms:!1}),g.api({url:l,type:"post",data:m,success:function(a){a.success&&b.updateModel()}})},submitcancelappr:function(a){var b=this,c=$(a.currentTarget),d=c.closest(".list-item"),e=c.closest(".handle");c.attr("approver"),$(".cancelmenu-box",e);var f=this.options,h=$(".item-face",d).attr("feedid");g.api({url:"/FeedApprove/ApproverSendFeedReply",type:"post",data:{feedID:h,replyContent:"取消该审批",operationType:3,replyToReplyID:0,replyToEmployeeID:0,isSendSms:!1},success:function(a){a.success&&(b.updateModel(),f.deleteCb&&f.deleteCb.call(b,a,{feedID:h}))}})},submitcancelschedule:function(a){var b,c=this,d=this.model,e=d.get("originData"),f=(e.schedule,e.sender.employeeID),h=this.options,i=$(a.currentTarget),j=i.closest(".list-item"),k=i.closest(".handle");$(".cancelmenu-box",k);var l=$(".item-face",j).attr("feedid");b=f==D.id?"/Feed/DeleteFeedByID":"/Schedule/CancelSchedule",g.api({url:b,type:"post",data:{feedID:l},success:function(a){a.success&&j.slideUp(250,function(){c.destroy(),h.deleteCb&&h.deleteCb.call(c,a,{feedID:l})})}})},updateModel:function(a){var b=this,c=this.model,d=this.$el,e=$(".feed-reply",d).is(":visible");g.api({url:"/Feed/GetFeedByFeedID",type:"get",data:{feedID:c.get("feedID")},success:function(c){var f=new u;c.success&&(b.model.set(f.parse(c)[0],{silent:!0}),b.render(),e&&($(".aj-Reply",d).length>0&&$(".aj-Reply",d).click(),$(".aj-approval",d).length>0&&$(".aj-approval",d).click()),a&&a.call(b,c))}},{mask:d,maskCls:"fs-feed-mask"})},initialize:function(){this.compStore=[];var a=this.model.get("feedType"),b=this.model.get("schedule"),c=this.model.get("voteItem"),d=this.model.get("announcement");switch(a){case 101:case 1001:case 1:this.template=Cb,b&&(this.template=1==this.options.scheduleStyle?Db:Eb),c&&(this.template=Fb),d&&(1==this.options.noticeStyle?this.template=Gb:2==this.options.noticeStyle&&(this.template=Hb));break;case 2:this.template=Ib;break;case 3:this.template=Jb;break;case 4:1==this.options.detailStyle?this.template=Kb:2==this.options.detailStyle&&(this.template=Lb)}this.listenTo(this.model,"change",this.render)},render:function(){var a=this.model,b=a.get("originData"),c=this.$el;this.$el.addClass("fs-feed-item"),this.empty(),this.$el.html(this.template(this.model.toJSON())),this.options.withArchive?($(".archive-remind",this.$el).show(),$(".aj-placeonfile",this.$el).text("取消归档").attr("class","aj-unplaceonfile")):$(".archive-remind",this.$el).hide(),this.options.withFollowTime?$(".followtimeinfo",this.$el).show():$(".followtimeinfo",this.$el).hide(),this.options.withShowBoteFeed&&a.get("voteItem")&&$(".aj-open-vote-btn",this.$el).click(),this.options.withAvatar===!1&&($(".item-face",this.$el).hide(),$(".item-detail",this.$el).css({"margin-left":"0px"}));var d=$(".item-func",this.$el);this.options.withActionBtn===!1&&($(".handle",d).hide(),$('<div class="action-btn-summary"><a href="#stream/showfeed/=/id-'+b.feedID+'" class="to-detail-l">点击查看原文>></a></div>').appendTo(d));var f,h,i,k,l,m,n,o,p,q=this.model.get("schedule"),r=g.getContactData().u.id;return q&&(f=this.options.scheduleStyle,h=b.feedRangeDescription,i=$(".schedulesgroup a",c),k=b.schedule.startTime,p=$(".rc-time",c),3==f&&(i.text(h),p.text(j.unix(k).format("HH:mm")),l=q.relateEmployees,o=l.length,_.each(l,function(a){var b=a.employeeID,c=a.name;a.profileImage,n+=c+"，",1==o?(m=n.substr(0,n.length-1),b==r&&i.text("个人日程")):i.text("参与者共"+o+"人")}))),2==this.options.detailStyle&&g.api({url:"/Feed/GetFeedReplysByFeedID",type:"get",dataType:"json",data:{feedID:b.feedID,pageNumber:1,pageSize:100},success:function(a){var b=a.value,c=$(".fs-list-item"),d=$(".printreplys",c),f="";_.each(b.items,function(a){var c=a.replyContent,h=a.pictures,i="",k="",l="",m=g.getDateSummaryDesc(j.unix(a.createTime),j.unix(a.serviceTime),1);l=a.sourceDescription?1==a.source?"":"，来自"+g.getSourceNameFromCode(a.source):"",_.each(c,function(a){i+=a.text}),_.each(h,function(a){k+='<span class="print-img-warp"><img src="'+e.API_PATH+"/df/get?id="+a.attachPath+'1.jpg" alt="" class="print-pictures"><img src="../../html/fs/assets/images/print-del-pic-ico.gif" title="不打印该图" class="print-del-pic-ico aj-feed-fn-com-btn" /></span>'}),f='<div class="printreplys-item"><div class="printreplys-item-txt"><i>'+a.sender.name+"</i>："+i+"("+m+l+')</div><div class="printreplys-item-media">'+k+"</div></div>",b.items.length>1&&d.append(f)})}}),this},reRenderArchive:function(a){var b=this.$el,c=$(".archive-remind",b);c.replaceWith(a)},empty:function(){var a=this.model,b=a.get("feedID");$(".show-slide-up-tip-warp").remove(),this.$el.removeData(),_.each(this.compStore,function(a){a.destroy&&a.destroy()}),this.audioRendered&&"flash"===this.audioRendered&&r.removeSWF("audio-flash-player-"+b),this.compStore=[]},destroy:function(){this.empty(),this.remove()}});b.itemV=Mb});