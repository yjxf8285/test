/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("modules/feed-list/feed-list-c",["util","modules/feed-list/fl-util","moment","modules/feed-list/feed-list-m","./feed-list-helper"],function(a,b){function c(a){var b={};b=_.extend(b,r.common(a));var c=parseInt(a.feedType);switch(c){case 101:case 1001:case 1:b=_.extend(b,r.share(a,b));break;case 2:b=_.extend(b,r.plan(a,b));break;case 3:b=_.extend(b,r.work(a,b));break;case 4:b=_.extend(b,r.approve(a,b))}return b.originData=a,b.feedType=c,b}var d=window,e=d.FS,f=e.tpl;f.store,f.event;var g=a("util"),h=a("modules/feed-list/fl-util"),i=a("moment"),j=a("modules/feed-list/feed-list-m"),k=a("./feed-list-helper"),l=k.feedContentFormat,m=k.picturesFormat,n=k.filesFormat,o=g.getContactData(),p=o.u,q=k.feedContentFormat_,r={common:function(a){var b={};b.rootPath=e.API_PATH,b.isWhat=a.isWhat||"",b.feedContent=a.feedContent,b.fiveStar=a.fiveStar||"",b.leaderinfo=a.leaderinfo||"",b.replyContent=a.replyContent||"",b.feedID=a.feedID||"",b.employeeID=a.sender.employeeID||"",b.textcur=a.textcur||"",b.textbtn=a.textbtn||"",b.feedPic=a.feedPic||"",b.feedFiles=a.feedFiles||"",b.pictures=a.pictures||"",b.sourceDescription=a.sourceDescription||"",b.archive=a.archive||"",b.serviceTime=a.serviceTime||"",b.announcement=a.announcement||null,b.voteItem=a.voteItem||null,b.schedule=a.schedule||null,b.isHide="",b.morePendingW="",b.onencrypted="",b.isencryptedTit="";var c=a.isEncrypted;c&&(b.onencrypted="onencrypted",b.isencryptedTit=a.encryptTitle,b.isHide="hide");var d=a.like.likeCount,f=a.isAlreadyLike,h="",j="取消赞",o="islike cur",r='(<span class="likecountnum">'+d+"</span>)",s=a.like.likeEmployees,t="",u="",v="";s&&(_.each(s,function(a){var b=a.name,c=g.getAvatarLink(a.profileImage,"2"),d=a.employeeID;u+='<a href="#profile/=/empid-'+d+'" class="js-empids" title="'+b+'"><img alt="'+b+'" src="'+c+'"></a>'}),v=s.length>5?'<a href="#stream/showfeed/=/id-'+b.feedID+'/open-like" title="更多" class="islike-more"></a>':'<a href="#stream/showfeed/=/id-'+b.feedID+'/open-like" title="更多" class="islike-more hide"></a>'),f||(j="赞",o="islike",r="",t=""),t='<div class="islike-tip" style="display:none;"><div class="toparrow"> <em>◆</em> <span>◆</span> </div>'+u+v+"</div>",d>0?r='(<span class="likecountnum">'+d+"</span>)":t="",h='<div class="'+o+'"><span class="islike-btn aj-feed-fn-com-btn" title="'+j+'"><b></b><a href="javascript:void(0);" class="likecount">'+r+'</a><i class="S_txt3">|</i></span>'+t+"</div>",b.islike=h;var w=0,x='<div class="'+o+'"><span class="islike-btn aj-feed-fn-com-btn islikelist-btn" title="'+j+'"><b></b><a href="javascript:void(0);" class="likecount">'+r+'</a><i class="S_txt3">|</i></span></div>';w&&(b.islike=x),b.listprofileImage=g.getAvatarLink(a.sender.profileImage,"2");var y='<div class="img-new"></div>';b.newico=a.isUnRead?y:"";var z=a.followTime,A="";z?(z=i.unix(z).format("YYYY年MMMDD日 HH:mm"),A='<div class="followtimeinfo">关注于：'+z+"</div>",b.oftimetext=A):b.oftimetext="";var B=g.getFeedTypeName(a.feedType);2==a.feedType&&(B=g.getPlanTypeName(a.plan.planType)),b.feedTypeDescription=B,b.feedRangeDescription=a.feedRangeDescription?'<span>-</span> <span class="group"> <a href="javascript:void(0);" title="'+a.feedRangeTip+'"> '+a.feedRangeDescription+"</a> </span>":'<span>-</span> <span class="group"> <a href="javascript:void(0);" title="'+a.feedRangeTip+'"> 数据错误 </a> </span>',b.sendername='<a class="employee-name" href="#profile/=/empid-'+a.sender.employeeID+'">'+a.sender.name+"</a>",b.senderNameNoLink=a.sender.name,_.extend(b,m(a.pictures||[]));var C=function(){var c=a.feedNDFiles,d="",f="",h='<a class="networklink-btn" href="#entnetworkdisk">进入网盘</a>';c.length>0?(_.each(c,function(a){var b=a.isPreview;f=b?'<a href="#" class="attach-preview-l v">预览</a>':"",d+='<dl attachid="'+a.ndFileID+'"><dt><img src="'+e.ASSETS_PATH+"/images/file/"+a.fileIcon+'.png" alt=""></dt><dd><p>'+a.attachName+"("+g.getFileSize(a.attachSize)+')</p><p><a href="'+g.getDfLink(a.attachPath,a.attachName,!0)+'" class="d" title="'+a.name+'" target="_blank">下载</a> '+f+"</p></dd></dl>"}),b.feedFiles='<div class="feed-files feed-attach fn-clear netdiskfile">'+d+h+"</div>"):_.extend(b,n(a.files||[]))};C(),b.archiveData=b.archive,b.archive=k.renderArchiveBar(b.archive,a);var D=a.createTime,E=g.getDateSummaryDesc(i.unix(D),i.unix(a.serviceTime),1);b.createTimeNoLink=E,b.createTime='<a href="#stream/showfeed/=/id-'+b.feedID+'" class="f-date"> '+E+"</a>",b.nolinkcreateTime=E;var F=l(a.feedContent,a);b.feedText=F,b.pendfeedText=F,b.feedFormatContent=q(300,a);var G=a.replyCount;G=0==G?"":'(<span class="num">'+G+"</span>)";var H='<a href="javascript:void(0);" class="aj-delete aj-feed-fn-com-btn">删除</a>',I='<a href="javascript:void(0);" class="aj-unplaceonfile aj-feed-fn-com-btn">取消归档</a>',J='<a href="javascript:void(0);" class="aj-unattention follow-action-h aj-feed-fn-com-btn">取消关注</a>',K='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-pending aj-feed-fn-com-btn">待办</a></div>',L='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-Reply aj-feed-fn-com-btn"> 回复'+G+"</a></div>",M='<div class="fl-fn-btn"><a href="javascript:void(0);" class="aj-Reply aj-feed-fn-com-btn"> 同事回复'+G+"</a></div>";b.fnReplyPre='<div class="fl-fn-btn"><a href="javascript:void(0);" class="aj-replytext aj-feed-fn-com-btn"> 回复'+G+"</a></div>",b.fnDeleteW="",b.fnUnplaceonfileW="",b.fnApprovalW="",b.fnPendingW=K,b.fnCommentonW="",b.fnCcW="",b.fnModifyapprovalW="",b.fnWorkingReW="",b.fnWorkSendW="",b.fnReplyW=L,b.fnReplyRcW=M,p.id==b.employeeID&&a.canDelete&&(b.fnDeleteW=H),b.fnUnattentionW=a.isFollowed?J:'<a href="javascript:void(0);" class="aj-attention follow-action-h aj-feed-fn-com-btn">关注</a>',b.fnUnplaceonfileW=a.isArchived?I:'<a class="aj-placeonfile aj-feed-fn-com-btn" href="javascript:;">归档</a>';var N=function(){var c,d,e=a.audio;e?(d=e.attachPath,d=g.getFileNamePath(d)+".mp3",d=g.getDfLink(d,"",!1,""),c=e.attachSize,c=c>360?"值错":c>60&&360>c?parseInt(c/60)+":"+parseInt(60*(parseFloat(c/60)-parseInt(c/60))):"00:"+parseInt(c),b.audioBtn='<div class="aj-feed-fn-com-btn feed-audio-open-btn audio-btn">('+c+")</div>",b.attachPath=d,b.audioWarp=' <div class="audio-warp"> <div class="aj-feed-fn-com-btn feed-audio-close-btn audio-close"><img src="../../html/fs/assets/images/audio_colse_ico.gif" alt="">收起</div> <div class="audio-box"></div> </div>'):(b.audioBtn="",b.attachPath="",b.audioWarp="")};N(),b.feedLocationStr="";var O,P=a.feedLocation,Q="",R="",S="",T="",U="",V="",W="",X="",Y="";return P&&(O=P.isTokenChenged,S=P.country,T=P.province,U=P.city,V=P.district,W=P.street,X=P.streetNumber,R=S+T+U+V+W+X,O&&(Y='<img src="../../html/fs/assets/images/location_istokenchenged.png" class="istokenchenged-ico" title="该用户本次签到所用设备与上次不同"> '),Q='<div class="feed-location"><img src="../../html/fs/assets/images/feedlocation_ico.gif" alt=""/ class="feed-location-ico"><span class="feed-location-text">'+R+'</span><span class="feed-location-fn"><a href="#" class="feed-location-fn-map">显示地图</a> | <a href="javascript: void(0);" class="aj-feed-fn-com-btn feed-location-fn-equipment">查看设备</a></span>'+Y+"</div>",b.feedLocationStr=Q,b.feedLocation=P),b},share:function(a){var b,c={},d=a.announcement,f="";c.deletegg="",d?(f=d.title,b=d.isShow,c.isShowText=b?"不显示":"显示",_.some(p.functionPermissions,function(a){return 1==a.value})&&d.canDelete&&(c.deletegg='<a class="aj-delete" href="javascript:void(0);">删除</a><i class="S_txt3">|</i>',c.fnDeleteW='<a href="javascript:void(0);" class="aj-delete">删除</a>'),c.announcetit=f):c.announcetit="";var h=a.voteItem,j="",k="";h?(k=h.voteEmpCount,c.votecount=k,j=e.API_PATH+"/df/GetVoteResultExcel?feedID="+a.feedID,c.votedownurl=j):(c.votecount="",c.votedownurl=""),c.schedule=a.schedule;var l,m,n,o,q,r,s,t=a.schedule,u=a.sender.employeeID,v=g.getContactData().u.id,w="",x=a.serviceTime;t?(t.relateEmployees&&(m=t.relateEmployees,n=m.length,_.each(m,function(b){var c=(b.employeeID,b.name);b.profileImage,w+=c+"，",q=a.feedRangeDescription}),w=w.substr(0,w.length-1),w="",c.feedRangeDescription='<span>-</span> <span class="schedulesgroup"> <a href="javascript:void(0);" title="'+w+'"> '+q+" </a> </span>"),r=i.unix(t.startTime).format("YYYY"),s=i.unix(x).format("YYYY"),l=r==s?i.unix(t.startTime).format("MMMDD日 (dddd) HH:mm"):i.unix(t.startTime).format("YYYY年MMMDD日 (dddd) HH:mm"),o=g.getSmsRemindTypeName(t.smsRemindType),u==v?(c.voteico="voteico.gif",c.voteSenderInfo=""):(c.voteico="voteico_blue.gif",c.voteSenderInfo='<div class="from">该日程由<a href="#profile/=/empid-'+a.sender.employeeID+'">'+a.sender.name+"</a>为您创建。</div>"),c.startTime=l,c.smsRemindTypeText=o):c.startTime="错误了";var y=a.smsRemaindCount;a.readCount,c.smsRemaind=0==y?"":' <a href="#" class="msmremaindcount alertlistbtn">短信提醒'+y+"人</a>";var z=a.receipt,A=0,B=0,C=0,D=!1,E="";return c.receiptfn="",c.receiptRemaind="",z&&(A=z.requireReceiptCount,B=z.receiptedCount,C=z.myReceiptStatus,D=z.isSendSms,1==C?c.receiptfn='<div class="receiptfnBtnwarp"><a href="javascript:void(0);" class="aj-receipt-fn">回执</a><i class="S_txt3">|</i></div>':2==C&&(c.receiptfn='<div class="receiptfnBtnwarp"><a href="javascript:void(0);" class="disable"><img src="../../html/fs/assets/images/receipted.gif" alt="" class="vm">已回执</a><i class="S_txt3">|</i></div>'),D&&(E="已发短信，"),c.receiptRemaind=' <div class="receiptfnwarp"><a href="#" class="receiptalertlist alertlistbtn">需要'+A+"人回执，"+E+"已回执"+B+"人</a></div>",c.receiptedCount=B),c},plan:function(a){var b,c={},d=l(a.feedContent,a),e=l(a.plan.reportContent,a),f=l(a.plan.planContent,a),h="",j="",k=a.replyCount;k=0==k?"":'(<span class="num">'+k+"</span>)";var m='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-commenton">点评'+k+"</a></div>";switch(c.feedID=a.feedID,a.plan.planType){case 0:j="planType为0";break;case 1:j='<p class="work-tit">今日工作总结</p><p>'+e+'</p><p>&nbsp;</p><p class="work-tit">明日工作计划</p><p>'+f+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+d+"</p>";break;case 2:j='<p class="work-tit">本周工作总结</p><p>'+e+'</p><p>&nbsp;</p><p class="work-tit">本周工作计划</p><p>'+f+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+d+"</p>";break;case 3:j='<p class="work-tit">本月工作总结</p><p>'+e+'</p><p>&nbsp;</p><p class="work-tit">本月工作计划</p><p>'+f+'</p><p>&nbsp;</p><p class="work-tit">工作心得体会</p><p>'+d+"</p>"}c.pendfeedText=d+" "+e+" "+f,c.feedText=j,a.plan.isComment?(c.leaderinfo="",c.isWhat='<span>-</span><span class="con"><a href="javascript:void(0);">已点评</a></span>'):(a.plan.leader?(h=a.plan.leader.name,b=a.plan.leader.employeeID,h='<a class="employee-name" href="#profile/=/empid-'+b+'">'+h+"</a>",c.leaderinfo='<div class="plan-leader"><a class="employee-name" href="#profile/=/empid-'+b+'"><img src = "'+g.getAvatarLink(a.plan.leader.profileImage,"3")+'" / ></a>该日志由'+h+"点评。</div>"):c.leaderinfo="",c.isWhat='<span>-</span><span class="con"><a href="javascript:void(0);">未点评</a></span>',c.replyContent="");var n=a.plan.rate,o="";if(n>0){switch(n){case 1:o="一分：严重批评";break;case 2:o="二分：不合格";break;case 3:o="三分：符合要求";break;case 4:o="四分：超过预期";break;case 5:o="五分：非常满意"}c.fiveStar='<div class="five-star num'+n+'" title="'+o+'"></div>'}else c.fiveStar="";var r=a.replies,s="",t="",u="",v="",w="",x="",y="1",z="",A="以下为日志点评人的点评",B=[];return r.length>0?(_.each(r,function(b,c){y=g.getWorkOperationTypeName(b.operationType),z=1==b.source?"":"，来自"+g.getSourceNameFromCode(b.source),u=g.getDateSummaryDesc(i.unix(b.createTime),i.unix(a.serviceTime),1);var d=q(300,b),e="",f="";x=d.summaryHtml,B.push(d),d.leftHtml.length>0&&(f='<span class="feed-content-ellipsis">&#8230;</span>',e='<br/><br/><a href="javascript:;" class="feed-topreply-content-visible-h" data-index="'+c+'"> 展开正文，（共'+d.feedWordNum+"个字）</a>"),b.sender?(w=b.sender.profileImage,t=b.sender.name,v=b.sender.employeeID,p.name==t&&(t="我"),t='<a href="#profile/=/empid-'+v+'"> '+t+"</a>"):(w="",t=""),s+='<dl class="comment-list fn-clear"><dt><a class="master-reply-face-l" href="javascript:void(0);"><a href="#profile/=/empid-'+v+'"><img src = "'+g.getAvatarLink(w,"3")+'" / ></a></a></dt><dd><a href="#">'+t+'</a>： <span class="feed-topreply-summary-text">'+x+"</span>"+f+"("+u+"，点评"+z+")"+e+"</dd></dl>"}),c.feedFormatContents=B,c.replyContent='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-tit">'+A+'</div><div class="RC-feed">'+s+"</div></div>"):c.replyContent="",a.plan.canComment?(c.fnCommentonW=m,c.fnReplyW=""):c.fnCommentonW="",c.planType=a.plan.planType,c},work:function(a){var b,c,d={};d.feedID=a.feedID,d.canCancel=a.canCancel;var e=a.work.rate;d.fiveStar=e>0?'<div class="five-star num'+e+'"></div>':"";var f="不提醒";switch(a.work.smsRemindType){case 1:f="";break;case 2:f="短信提醒一次";break;case 3:f="短信提醒两次";break;case 4:f="短信提醒三次"}var h="第一次短信提醒："+i.unix(a.work.smsRemindTime1).format("MMMDD日 HH:mm")+"&#10;";b=a.work.smsRemindTime2?"第二次短信提醒："+i.unix(a.work.smsRemindTime2).format("MMMDD日 HH:mm")+"&#10;":"",c=a.work.smsRemindTime3?"第三次短信提醒："+i.unix(a.work.smsRemindTime3).format("MMMDD日 HH:mm"):"";var j=h+b+c,k=g.getWorkStatusName(a.work.status);a.work.isComment&&(k="已点评"),d.isWhat=a.work.smsRemindType>1?'<span>-</span><span class="con"><a href="javascript:void(0);">'+k+'</a></span><span>-</span><span class="con"><a href="javascript:void(0);" title="'+j+'">'+f+"</a></span>":'<span>-</span><span class="con"><a href="javascript:void(0);">'+k+"</a></span>";var l=g.getDateSummaryDesc(i.unix(a.work.deadline),i.unix(a.serviceTime),2),o=g.getDateSummaryDesc(i.unix(a.work.endTime),i.unix(a.serviceTime),2),r="",s=a.work.executer.name,t=g.getContactData().u.id,u=a.work.executer.employeeID;switch(s='<a class="employee-name" href="#profile/=/empid-'+u+'">'+s+"</a>",d.executer=t==u?"1":"0",a.work.status){case 1:r=a.work.deadline<a.serviceTime?"应于"+l+'前完成，<span class="highlight">该指令已超时。</span>':"应于"+l+"前完成，该指令正在执行。";break;case 2:r="该指令已于"+o+"完成。";break;case 3:r="已于"+o+"取消。"}d.leaderinfo='<div class="plan-leader"><a class="employee-name" href="#profile/=/empid-'+u+'"><img src = "'+g.getAvatarLink(a.work.executer.profileImage,"3")+'" / ></a>该指令由'+s+"执行，"+r+"</div>";var v=a.replies,w="",x="",y="",z="",A="",B="",C="",D="1",E="以下为指令关键节点的回复：";if(v.length>0){var F=[];_.each(v,function(b,c){D=g.getWorkOperationTypeName(b.operationType),C=1==b.source?"":"，来自"+g.getSourceNameFromCode(b.source),y=g.getDateSummaryDesc(i.unix(b.createTime),i.unix(a.serviceTime),1);var d=q(300,b),e="",f="";B=d.summaryHtml,F.push(d),d.leftHtml.length>0&&(f='<span class="feed-content-ellipsis">&#8230;</span>',e='<br/><br/><a href="javascript:;" class="feed-topreply-content-visible-h" data-index="'+c+'"> 展开正文，（共'+d.feedWordNum+"个字）</a>"),b.sender?(A=b.sender.profileImage,x=b.sender.name,p.name==x&&(x="我"),z=b.sender.employeeID,x='<a href="#profile/=/empid-'+z+'"> '+x+"</a>"):(A="",x="");var h=b.files,j=b.pictures,k=n(h).feedFiles,l=m(j).feedPic,o="",r="",s="";h.length>0||j.length>0?(o='<div class="open-replies-imgorfile aj-feed-fn-com-btn"><a href="javascript:;">查看附件</a></div>',r=l+k,s='<div class="replies-imgorfile-warp">'+o+'<div class="replies-imgorfile"><div class="item-media">'+r+"</div></div></div>"):s="";var t,u,v,E,G,H=b.audio;H?(u=g.getFileNamePath(H.attachPath)+".mp3",u=g.getDfLink(u,"",!1,""),t=H.attachSize,t=t>360?"值错":t>60&&360>t?parseInt(t/60)+":"+parseInt(60*(parseFloat(t/60)-parseInt(t/60))):"00:"+parseInt(t),E='<div class="aj-feed-fn-com-btn feed-audio-open-btn important-reply-audio replies audio-btn" data-attachpath="'+u+'" data-attachsize="'+H.attachSize+'">('+t+")</div>",G=' <div class="audio-warp"> <div class="aj-feed-fn-com-btn feed-audio-close-btn important-reply-audio audio-close"><img src="../../html/fs/assets/images/audio_colse_ico.gif" alt="">收起</div> <div class="audio-box"></div> </div>',v='<div class="audio-el">'+E+G+"</div>"):v="",w+='<dl class="comment-list fn-clear"><dt><a class="master-reply-face-l" href="#profile/=/empid-'+z+'"><img src = "'+g.getAvatarLink(A,"3")+'" / ></a></dt><dd><a href="#">'+x+'</a>：<span class="feed-topreply-summary-text">'+B+"</span>"+f+" ("+y+"，"+D+C+")"+e+"</dd></dl>"+v+s}),d.feedFormatContents=F,d.replyContent='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-tit">'+E+'</div><div class="RC-feed">'+w+"</div></div>"}else d.replyContent="";return a.work.canCancel&&(d.fnDeleteW='<a href="javascript:void(0);" class="aj-delete">取消</a>'),d},approve:function(a){var b={},c=a.replyCount||"";b.feedID=a.feedID,b.canCancel=a.canCancel,s=g.getContactData().u.id;var d='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-approval aj-feed-fn-com-btn">批复</a></div>',f='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-cc aj-feed-fn-com-btn">抄送</a></div>',j='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-pending aj-feed-fn-com-btn">待办</a></div>',k='<div class="fl-fn-btn"><i class="S_txt3">|</i><a href="javascript:void(0);" class="aj-modifyapproval aj-feed-fn-com-btn">修改审批人</a></div>',m='<a href="javascript:void(0);" class="aj-pending aj-feed-fn-com-btn">待办</a>',n=g.getApproveStatusName(a.approve.status);if(c>0&&(d='<div class="fl-fn-btn"><i class="S_txt3">|</i> <a href="javascript:void(0);" class="aj-approval aj-feed-fn-com-btn">批复('+c+")</a></div>"),a.approve&&p.id==a.approve.senderID&&a.approve.canCancel&&(b.fnDeleteW='<a href="javascript:void(0);" class="aj-delete aj-feed-fn-com-btn">取消</a>'),b.isWhat='<span>-</span><span class="con"><a href="javascript:void(0);">'+n+"</a></span>",1==a.approve.status){var o=a.approve.currentApprover.name||"",r=a.approve.currentApprover.employeeID||"",s=g.getContactData().u.id;o='<a class="employee-name" href="#profile/=/empid-'+r+'">'+o+"</a>",b.leaderinfo='<div class="plan-leader"><a href="#profile/=/empid-'+r+'" class="employee-name"><img src = "'+g.getAvatarLink(a.approve.currentApprover.profileImage,"3")+'" / ></a>已提交，待<a href="#">'+o+"</a>审批。</div>"}s==r?(b.approver="1",o="我"):b.approver="0";var t="",u="",v="",w="",x="",y="",z="",A=[];return _.each(a.replies,function(b,c){var d=g.getDateSummaryDesc(i.unix(b.createTime),i.unix(a.serviceTime),1),e=q(300,b),f="",j="",k="",m="",n=l(b.replyContent,a);y=e.summaryHtml,A.push(e),e.leftHtml.length>0&&(j='<span class="feed-content-ellipsis">&#8230;</span>',f='<br/><br/><a href="javascript:;" class="feed-topreply-content-visible-h" data-index="'+c+'"> 展开正文，（共'+e.feedWordNum+"个字）</a>"),function(){switch(b.operationType){case 1:v="同意",x='<img src="../../html/fs/assets/images/agree.gif" alt="" class="approve-isagree">';break;case 2:v="不同意",x='<img src="../../html/fs/assets/images/unagree.gif" alt="" class="approve-isagree">';break;case 3:v="设置为已取消",x=""}}(),function(){z=1==b.source?"":"，来自"+g.getSourceNameFromCode(b.source),b.sender?(r=b.sender.employeeID,o=s==r?"我":b.sender.name,w=b.sender.profileImage,k=b.sender.name,o='<a href="#profile/=/empid-'+r+'"> '+o+"</a>"):(o="",r="",w="")}(),m=h.delStrLink(n),t+='<dl class="comment-list fn-clear isappr"><dt>'+x+'<a class="master-reply-face-l" href="#profile/=/empid-'+r+'"><img src = "'+g.getAvatarLink(w,"3")+'" / ></a></dt><dd>'+o+'：<span class="feed-topreply-summary-text">'+y+"</span>"+j+" ("+d+"，"+v+z+")"+f+"</dd></dl>",u+='<dl class="comment-list fn-clear isappr-print"><dt>'+x+'</dt><dd><span class="print-approvername">'+k+"</span>："+m+" ("+d+"，"+v+z+")</dd></dl>"}),b.feedFormatContents=A,""==t?(b.replyContent="",b.printReplyContent=""):(b.replyContent='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-tit">以下为审批人的批复意见</div><div class="RC-feed">'+t+"</div></div>",b.printReplyContent='<div class="reply-content"><div class="RC-arrow"><em class="S_line1_c">◆</em><span>◆</span></div><div class="RC-feed">'+u+"</div></div>"),b.fnCcW="",b.fnModifyapprovalW="",b.fnApprovalW="",b.fnPendingW=j,b.morePendingW="",a.approve.canApprove&&(b.fnApprovalW=d,b.fnReplyW=""),a.approve.canAddAtEmployees&&(b.fnCcW=f,b.fnPendingW="",b.morePendingW=m),a.approve.canChangeApprover&&(b.fnModifyapprovalW=k,b.fnPendingW="",0==a.approve.currentApproverID&&(b.fnModifyapprovalW='<div class="fl-fn-btn"><i class="S_txt3">|</i><a href="javascript:void(0);" class="aj-modifyapproval aj-feed-fn-com-btn">转审批人</a></div>')),function(){b.printSendername='<span class="print-sendername">'+a.sender.name+"</span>"||"",b.printPictures="",b.printFiles="",b.printText="",_.each(a.feedContent,function(a){b.printText+=a.text}),b.printText=b.printText.replace(/[\n|\r]/g,"<br/>"),_.each(a.pictures,function(a){b.printPictures+='<div class="print-img-item"><span class="print-img-warp"><img src="'+e.API_PATH+"/df/get?id="+a.attachPath+'1.jpg" class="print-pictures"/><img src="../../html/fs/assets/images/print-del-pic-ico.gif" title="不打印该图" class="print-del-pic-ico aj-feed-fn-com-btn" /></span></div>'});var c=1;_.each(a.files,function(a){b.printFiles+='<div class="print-feedfile">附件'+c+"："+a.attachName+" ("+g.getFileSize(a.attachSize)+")</div>",c++}),b.printCTime=i.unix(a.createTime).format("YYYY年MMMDD日 HH:mm")}(),b}},s=Backbone.Collection.extend({model:j.itemM,url:"/Feed/GetFeeds",sync:function(a,b,c){var d=c.data||{};return c.data=_.extend({circleID:0,subType:0,feedType:0,keyword:"",pageSize:30,pageNumber:2},d),Backbone.sync("read",b,_.extend(c,{apiCb:function(){}}))},parse:function(a){var b,d=[];return a.success&&(b=a.value.items,_.each(b,function(b,e){b.serviceTime=a.serviceTime,d[e]=c(b)})),d}});b.listC=s});