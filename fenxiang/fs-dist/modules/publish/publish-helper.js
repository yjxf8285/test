/**
 * 纷享模块逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("modules/publish/publish-helper",["util","events","placeholder","calendar","select","moment","modules/publish/publish.css"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.store,e.event;var f=(a("util"),a("events")),g=a("placeholder"),h=a("calendar"),i=a("select"),j=a("moment");a("modules/publish/publish.css");var k=h.extend({attrs:{showTodayBtn:!1,align:{getter:function(){var a=this.get("trigger");return a?{selfXY:[0,0],baseElement:a,baseXY:[13,13]}:{selfXY:[0,0],baseXY:[0,0]}}}}}),l=function(a){a=_.extend({element:null,placeholder:"请选择日期",formatStr:"YYYY-MM-DD"},a||{}),this.element=$(a.element),this.opts=a,this.init()};l.prototype.init=function(){var a,b,c,d=this,e=this.element,f=this.opts,h=[],l=f.formatStr;e.html('<input type="text" class="fs-publish-dateselect-input" readonly="readonly" placeholder="'+f.placeholder+'" />'),a=$(".fs-publish-dateselect-input",e),g(a),b=j(),c=b.format(l),h[0]={value:c,text:"今天"},b=j().add("days",1),c=b.format(l),h[1]={value:c,text:"明天"},b=j().startOf("week").add("days",5),c=b.format(l),h[2]={value:c,text:"本周五"},b=j().startOf("week").add("days",8),c=b.format(l),h[3]={value:c,text:"下周一"},b=j().startOf("month").add("months",1).subtract("days",1),c=b.format(l),h[4]={value:c,text:"本月底"};var m=new i({trigger:a,className:"fs-publish-dateselect",template:'<div class="{{classPrefix}}"><div class="fs-publish-dateselect-title">请选择日期<a class="reset-l" href="javascript:;">清空</a></div><div class="fs-publish-dateselect-calendar"></div><ul class="{{classPrefix}}-content" data-role="content">{{#each select}}<li data-role="item" class="{{../classPrefix}}-item" data-value="{{value}}" data-defaultSelected="{{defaultSelected}}" data-selected="{{selected}}"><a href="javascript:;" title="{{{text}}}" class="fs-prevent-default">{{{text}}}</a></li>{{/each}}</ul></div>',model:h,zIndex:2e3,autoWidth:!1}).render(),n=m.element,o=$(".fs-publish-dateselect-calendar",n),p=new k({trigger:o,zIndex:2e3});p.on("selectDate",function(b){var c=b.format(l);a.val(c),m.hide(),d.trigger("change",c)}),m.on("change",function(b){var c=b.data("value");a.val(c),d.trigger("change",c)}),m.after("show",function(){p.show(),p.setFocus_(d.getValue(!0)||new Date)}),m.after("hide",function(){p.hide()}),n.on("click",".reset-l",function(b){a.val(""),a[0].focus(),a[0].blur(),m.set("selectedIndex",-1),m.hide(),d.trigger("change",""),b.preventDefault()}),p.element.on("click",function(a){a.stopPropagation()}),this.calendar=p,this.selector=m},l.prototype.getValue=function(a){var b=this.opts,c=b.formatStr,d=this.element,e=$(".fs-publish-dateselect-input",d),f=_.str.trim(e.val()),g=j(f,c);return a?g:_.str.trim(g?g.format("YYYY-MM-DD"):"")},l.prototype.setValue=function(a){var b=j(a),c=this.calendar;c.setFocus(b),c.trigger("selectDate",b)},l.prototype.clear=function(){var a=this.element,b=$(".fs-publish-dateselect-input",a);this.selector.select(-1),b.val("")},l.prototype.destroy=function(){this.calendar&&this.calendar.destroy(),this.selector&&this.selector.destroy()},f.mixTo(l);var m=function(a){a=_.extend({element:null,placeholder:"请选择时间"},a||{}),this.element=$(a.element),this.opts=a,this.init()};m.prototype.init=function(){var a,b=this,c=this.element,d=this.opts,e=[],f=0,h=j("20130423080000","YYYYMMDDhhmmss"),k=h;for(c.html('<input type="text" class="fs-publish-timeselect-input" readonly="readonly" placeholder="'+d.placeholder+'" />'),a=$(".fs-publish-timeselect-input",c),g(a),f=0;48>f;f++)e.push({value:k.format("HH:mm"),text:k.format("HH:mm")}),k=h.add("minutes",30);this.selector=new i({trigger:a,model:e,zIndex:2e3,autoWidth:!1,className:"fs-publish-timeselect",template:'<div class="{{classPrefix}}"><div class="fs-publish-timeselect-title">请选择时间<a class="reset-l" href="javascript:;">清空</a></div><ul class="{{classPrefix}}-content" data-role="content">{{#each select}}<li data-role="item" class="{{../classPrefix}}-item" data-value="{{value}}" data-defaultSelected="{{defaultSelected}}" data-selected="{{selected}}"><a class="fs-prevent-default" href="javascript:;" title="{{{text}}}">{{{text}}}</a></li>{{/each}}</ul></div>'}).render().on("change",function(c){var d=c.data("value");a.val(d),b.trigger("change",d)}),this.selector.element.on("click",".reset-l",function(c){a.val(""),a[0].focus(),a[0].blur(),b.selector.hide(),b.selector.set("selectedIndex",-1),b.trigger("change",""),c.preventDefault()})},m.prototype.getValue=function(){var a=this.element,b=$(".fs-publish-timeselect-input",a);return _.str.trim(b.val())},m.prototype.setValue=function(a){var b=this.selector;b.select(a)},m.prototype.clear=function(){var a=this.element,b=$(".fs-publish-timeselect-input",a);return this.selector.select(-1),b.val("")},m.prototype.destroy=function(){this.selector&&this.selector.destroy()},f.mixTo(m),_.extend(b,{DateSelect:l,TimeSelect:m})});