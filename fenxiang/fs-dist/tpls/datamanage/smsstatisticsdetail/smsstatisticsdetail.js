/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/datamanage/smsstatisticsdetail/smsstatisticsdetail",["util","uilibs/pagination"],function(a,b){var c=window,d=c.FS;d.tpl;var e=a("util"),f=a("uilibs/pagination"),g=d.getAppStore("globalData"),h=g.model;b.init=function(){var a=e.getTplQueryParams(),c=a?a.id:0,d=a?a.name:0;b.tplName;var g=b.tplEl,i=$(".smsstatisticsdetail-nulltip",g),j=$(".smsstatisticsdetail-table",g),k=$("thead",j),l=$("tbody",j),m=$(".smsstatisticsdetail-pagination",g),n=$(".smsstatisticsdetail-top-info",g),o=$(".smsstatisticsdetail-tit .h1",g),p=$(".smsstatisticsdetail-top-back",g);$("select",g),p.html('<a href="#datamanage/smsstatistics">返回查看全部</a> > '+d);var q=new f({element:m,pageSize:20}).render();q.on("page",function(a){s(a)});var r=function(a){var b="",c=a.records||[];return _.each(c,function(a){a.employeeName,a.employeeID;var c=a.yearMonth.toString(),d=a.workAmount,e=a.customerAmount,f=a.netMarketingAmount,g=a.smsMarketingAmount,i=c.substring(0,4)+"-"+c.substring(4);b+=1==h?'<tr><td class="txt-left">'+i+'</td><td class="txt-center">'+d+'</td><td class="txt-center">'+e+"</td></tr>":'<tr><td class="txt-left">'+i+'</td><td class="txt-center">'+d+'</td><td class="txt-center">'+e+'</td><td class="txt-center">'+f+'</td><td class="txt-center">'+g+"</td></tr>"}),b},s=function(a){e.api({url:"/Management/GetSMSStatistics",type:"get",dataType:"json",data:{yearMonth:-1,employeeID:c,pageSize:20,pageNumber:a},success:function(a){var b=a.value||{},c=b.records,e=b.totalCount,f=b.workAmount,g=b.customerAmount,m=b.netMarketingAmount,p=b.smsMarketingAmount,s=' <tr><th>员工姓名</th><th width="100" class="txt-center">工作短信(条)</th><th width="100" class="txt-center">客群短信(条)</th><th width="100">营销网信（条）</th><th width="100">营销短信（条）</th></tr>',t="工作短信："+f+"条&nbsp;&nbsp;&nbsp;&nbsp;客群短信："+g+"条";a.success&&(1==h?s=' <tr><th>员工姓名</th><th width="180" class="txt-center">工作短信(条)</th><th width="180" class="txt-center">客群短信(条)</th></tr>':t="工作短信："+f+"条&nbsp;&nbsp;&nbsp;&nbsp;客群短信："+g+"条&nbsp;&nbsp;&nbsp;&nbsp;营销网信："+m+"条&nbsp;&nbsp;&nbsp;&nbsp;营销短信："+p+"条",c.length>0?(k.html(s),l.html(r(b)),i.hide(),j.show()):(j.hide(),i.show()),o.html(""+d+"&nbsp;&nbsp;&nbsp;短信使用明细("+e+")"),n.html(t),q.setTotalSize(e))}})};s(1),e.regTplNav($(".tpl-l .flag-left-list a",g),"fl-item-on")}});