/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/entinfomgt/entinfomgt",["util","json","modules/fs-qx/fs-qx-helper"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=(e.store,e.event),g=a("util"),h=a("json"),i=a("modules/fs-qx/fs-qx-helper"),j=i.Uploader;b.init=function(){var a=b.tplEl,c=b.tplName,e=$(".flag-left-list",a),i=$(".ent-setup-wrap",a),k=$(".login-setup-wrap",a),l=$(".custom-manage-wrap",a);e.find("li").click(function(){e.find("a").removeClass("fl-item-on");var a=$(this),b=a.index();$("a",a).addClass("fl-item-on"),0==b?(i.show(),k.hide(),l.hide()):1==b?(i.hide(),l.hide(),k.show()):2==b&&(i.hide(),k.hide(),l.show())});var m=$(".lsu-inp-text",a),n=$(".lsu-view-color",a),o=$(".lsu-sel-wrap",a),p=$(".lsu-sel-view",a),q=$(".lsu-view-cvalue",o),r=$(".lsu-sel-list",o);r.find("li").click(function(){var a=$(this);r.find("li").removeClass("lslon"),a.addClass("lslon");var b=a.attr("color");q.css("background-color",b),n.css("background-color",b),m.val(b.slice(1,7)),r.hide()}),p.click(function(a){p.addClass("lsuvcon"),r.is(":visible")?r.hide():r.show(),a.stopPropagation()}),$(document).click(function(){r.hide(),p.removeClass("lsuvcon")}),m.keyup(function(){var a=$(this),b=a.val();6==a.val().length&&n.css("background-color","#"+b)});var i=$(".ent-setup-wrap",a),s=$(".sms-enterprise-name",i),t=$(".sms-enterprise-btn",i),u=$(".all-company-inp",i),v=$(".all-company-btn",i),w=$(".enterprise-bgcolor-btn",a),x=$(".enterprise-bgc-default-btn",a);g.api({type:"get",data:{},url:"/Management/GetEnterpriseInfo",success:function(a){if(a.success){var b=a.value,c=b.enterpriseName,d=b.allCompanyDefaultString,e=b.enterpriseBackgroundColor;s.val(c),u.val(d),m.val(e),n.css("background-color","#"+e);var f=r.find("li");f.each(function(){var a=$(this);a.attr("color").slice(1)==e&&(a.addClass("lslon"),q.css("background-color","#"+e))})}}}),t.click(function(){var a=_.str.trim(s.val());0==a.length?g.showInputError(s):g.api({type:"post",data:{enterpriseName:a},url:"/Management/SetEnterpriseName",success:function(b){b.success&&($(".hd .enterprise-name").text(a),g.alert("保存成功。"))}})}),v.click(function(){var a=_.str.trim(u.val());0==a.length?g.showInputError(u):g.api({type:"post",data:{allCompanyDefaultString:a},url:"/Management/SetAllCompanyDefaultString",success:function(b){b.success&&(g.setTplStore("entinfomgt",{enterpriseName:a}),g.alert("保存成功。"))}})}),w.click(function(){var a=_.str.trim(m.val());a.length<6?g.showInputError(m):g.api({type:"post",data:{backgroundColor:a},url:"/Management/SetEnterpriseBackgroundColor",success:function(a){a.success&&g.alert("保存成功。")}})}),x.click(function(){var a="a6ce39";g.api({type:"post",data:{backgroundColor:a},url:"/Management/SetEnterpriseBackgroundColor",success:function(b){b.success&&(m.val(a),n.css("background-color","#"+a),q.css("background-color","#"+a),r.find("li").removeClass("lslon"),r.find("li").eq(0).addClass("lslon"))}})});var y=$(".up-logo-file",a),z=$(".up-logo-default-btn",a),A=$(".up-mainimg-file",a),B=$(".up-mainimg-default-btn",a),C=$(".hd .logo-img"),D=$(".logo-img",a),E=$(".login-img",a),F=d.getAppStore("globalData"),G=d.API_PATH+"/Authorize/GetLogoImg?type=1&ent="+F.enterprise,H=d.API_PATH+"/Authorize/GetLogoImg?type=2&ent="+F.enterprise;new j({element:y,h5UploadPath:"/Management/uploadFile",flashUploadPath:"/Management/UploadFileByForm",h5Opts:{multiple:!1,accept:"image/*",filter:function(a){var b=[];return _.each(a,function(a){"jpg"==g.getFileType(a)?b.push(a):g.alert("请选择图片格式的文件")}),b}},flashOpts:{file_types:"*.jpg;*.gif;*.jpeg;*.png",file_types_description:"图片格式",button_width:80,button_height:25},onSelect:function(){this.startUpload()},onSuccess:function(a,b){var c,d=h.parse(b);d.success&&(c=d.value.filePath,g.api({type:"post",data:{logoPath:c},url:"/Management/UploadLogo",success:function(a){var b=new Date/1;a.success&&(C.attr("src",G+"&r="+b),D.attr("src",G+"&r="+b))}}))},onComplete:function(){this.removeAllFile()}}),new j({element:A,h5UploadPath:"/Management/uploadFile",flashUploadPath:"/Management/UploadFileByForm",h5Opts:{multiple:!1,accept:"image/*",filter:function(a){var b=[];return _.each(a,function(a){"jpg"==g.getFileType(a)?b.push(a):g.alert("请选择图片格式的文件")}),b}},flashOpts:{file_types:"*.jpg;*.gif;*.jpeg;*.png",file_types_description:"图片格式",button_width:80,button_height:25},onSelect:function(){this.startUpload()},onSuccess:function(a,b){var c,d=h.parse(b);d.success&&(c=d.value.filePath,g.api({type:"post",data:{picPath:c},url:"/Management/UploadMainPic",success:function(a){var b=new Date/1;a.success&&E.attr("src",H+"&r="+b)}}))},onComplete:function(){this.removeAllFile()}}),z.click(function(){g.api({type:"post",url:"/Management/ClearLogo",success:function(a){var b=new Date/1;a.success&&(C.attr("src",G+"&r="+b),D.attr("src",G+"&r="+b))}})}),B.click(function(){g.api({type:"post",url:"/Management/ClearMainPic",success:function(a){var b=new Date/1;a.success&&E.attr("src",H+"&r="+b)}})}),D.attr("src",G+"&r="+new Date/1),E.attr("src",H+"&r="+new Date/1),l.on("click",".f-sub",function(){var a=$(".control-modify-parent",l).prop("checked");g.api({type:"post",data:{isAllow:!a},url:"/Management/SetIsAllowSetOwnLeader",success:function(b){b.success&&(F.isAllowSetOwnLeader=!a,g.alert("保存成功"))}})}),f.on("switched",function(a){a==c&&$(".control-modify-parent",l).prop("checked",!F.isAllowSetOwnLeader)}),F.isLoginPagePersonalization&&$(".login-setting-item",a).show()}});