/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/plan/plan-common",["util","moment","./plan-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=a("util"),g=a("moment"),h=a("./plan-common.html"),i=$(h),j=function(a){var b=$(".planr-my-list-wrap",a),c=$(".planr-ups-list-wrap",a);b.empty(),c.empty(),f.api({type:"get",data:{},url:"/feedPlan/getFeedPlansInAbeyance",success:function(a){if(a.success){var d=a.value.toBeIs,e=a.value.toBeICount;if($(".planr-my-title-count").text(e),d.length>5&&(d=d.slice(0,5)),d.length>0){var h="";_.each(d,function(a){if(a.employee){var b=a.employee.name,c=a.employeeID,d=f.getAvatarLink(a.employee.profileImage,3),e=g.unix(a.dateTime).format("MM-DD HH:mm"),i=a.feedID,j=a.report+a.planContent+a.feedContent;h+="<div class='rightc-listwrap fn-clear'><a href='javascript:;' class='rlist-headimg-wrap'><img class='rlist-headimg' src='"+d+"' /></a><p class='rlist-pname'><a href='#profile/=/empid-"+c+"' class='fna-blue'>"+b+"</a> <span class='rlist-pname-apvdate'>"+e+"</span></p><a class='rlist-atext fna-grey' href='#stream/showfeed/=/id-"+i+"'>"+j+"</a></div>"}}),b.html(h)}else b.append("<div class='right-list-notext color-999999'>无我点评的日志</div>");var i=a.value.iSends,j=a.value.iSendCount;if($(".planr-ups-title-count").text(j),i.length>5&&(i=i.slice(0,5)),i.length>0){var k="";_.each(i,function(a){if(a.employee){var b=a.employee.name,c=a.employeeID,d=f.getAvatarLink(a.employee.profileImage,3),e=g.unix(a.dateTime).format("MM-DD HH:mm"),h=a.feedID,i=a.report+a.planContent+a.feedContent;k+="<div class='rightc-listwrap fn-clear'><a href='javascript:;' class='rlist-headimg-wrap'><img class='rlist-headimg' src='"+d+"' /></a><p class='rlist-pname'><a href='#profile/=/empid-"+c+"' class='fna-blue'>"+b+"</a> <span class='rlist-pname-apvdate'>"+e+"</span></p><a class='rlist-atext fna-grey' href='#stream/showfeed/=/id-"+h+"'>"+i+"</a></div>"}}),c.html(k)}else c.append("<div class='right-list-notext color-999999'>无上级点评的日志</div>")}}})};b.createRightSb=j,b.init=function(a,b){var c=$(".tpl-l .tpl-inner",a),d=f.getContactData(),e=d.u,g={},h=_.template(i.filter(".plan-tpl-left").html());_.extend(g,{userName:e.name,profileImage:e.profileImage}),c.html(h(g)),_.some(e.functionPermissions,function(a){return 6==a.value})?$(".plan-statistics-l",c).closest(".files-nav-item").show():$(".plan-statistics-l",c).closest(".files-nav-item").hide(),f.regTplNav($(".tpl-nav-lb",c),"depw-menu-aon"),j(a,b),f.tplRouterReg($(".tpl-nav-lb",c))}});