/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/stream/showfeed/showfeed",["util","../stream-common","dialog","../stream-common.html","modules/feed-list/feed-list-v","modules/feed-list/feed-list-m","modules/feed-list/feed-list-c"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=a("util"),h=(a("../stream-common"),a("modules/feed-list/feed-list-v")),i=a("modules/feed-list/feed-list-m"),j=a("modules/feed-list/feed-list-c"),k=h.itemV,l=i.itemM,m=j.listC,n=new m;b.init=function(){var a,d=b.tplEl,h=b.tplName,i=$(".feed",d),j=$(".tpl-l .tpl-inner",d),m=(g.getContactData(),$(".show-feed-tpl-left",d)),o=m.html(),p=function(a){var b={},c=_.template(o);_.extend(b,{userId:a.employeeID,userName:a.name,profileImage:g.getAvatarLink(a.profileImage,2)}),j.html(c(b))},q=function(){var b=g.getTplQueryParams(),c=b?b.id:0,d=b?b.pn:1,f=!1,h=!1,j=b?b.open:"reply";j||(j="reply"),b&&b.isprint&&(f=!0),b&&b.showvotedetail&&(h=!0),0!=c&&g.api({url:"/Feed/GetFeedByFeedID",data:{feedID:c},type:"get",success:function(b){var c;if(b.success){c=n.parse(b),p(c[0].originData.sender),a=new k({model:new l(c[0]),replyListOpts:{listPath:"/Feed/GetFeedReplysByFeedID",withPagination:!0,activePageNumber:d},withShowBoteFeed:h,withAvatar:!1,replyWithMedia:!0,noticeStyle:1,likeStyle:2,scheduleStyle:1,detailStyle:f?2:1,reloadAfterReply:!1,deleteCb:function(a){var b=this.model,c=b.get("feedType");a.success&&4!=c&&e.navRouter.navigate("stream",{trigger:!0})}}).render(),a.$el.appendTo(i),"reply"==j?$(".aj-Reply",a.$el).click():"like"==j&&a.islikelistbtn(),f&&s();var g=$(".aj-commenton",a.$el);g.is(":visible")&&(g.click(),a.showCommentDialog(!0));var m=$(".aj-approval",a.$el);m.is(":visible")&&m.click()}}})},r=function(){a.destroy(),i.empty()},s=function(){$(".tpl-l,.tpl-r",d).remove(),$(".hd,.ft").remove(),$("html").addClass("fs-print-html"),$("body").addClass("fs-print-body"),$(".right-apv-wrapper").remove(),$(".fs-qx,.fs-chat-panel").addClass("fn-hide-abs").hide(),$(".browser-upgrade-tip").remove(),c.printModelCb&&c.printModelCb()};f.on("switched",function(b){b==h?(a?(r(),q()):q(),$("#tip-home").addClass("tnavon state-active")):j.html("&nbsp;")})}});