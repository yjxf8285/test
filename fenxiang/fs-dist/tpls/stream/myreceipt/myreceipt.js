/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/stream/myreceipt/myreceipt",["tabs","util","modules/feed-list/feed-list","../stream-common","dialog","../stream-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=(a("tabs"),a("util")),h=a("modules/feed-list/feed-list"),i=a("../stream-common");b.init=function(){var a=b.tplEl,c=b.tplName,d=$(".receipt-list",a),e=$(".receipt-list-pagination",a),j=$(".search-wrap",a),k=$(".search-inp",a),l=$(".search-btn",a),m=$(".filter-wrapper",a),n=$(".sub-filter",m),o=!1,p=g.getEnterpriseConfig(107,!0)||{},q=g.getContactData(),r=q.u;_.isUndefined(p.IsShowReceiptionGuide)&&(p.IsShowReceiptionGuide=!0),i.init(a,c);var s=new h({element:d,pagSelector:e,pagOpts:{pageSize:20,visiblePageNums:7},listPath:"/Feed/GetReceiptFeedsOfIReceive",loadSize:15,defaultRequestData:function(){var a,b={},c=$(".filter .depw-menu-aon",m).attr("receipttype");return b.keyword=_.str.trim(k.val()),b.receiptType=c,"received"==c&&(a=$(".sub-filter .depw-tabs-aon",m).attr("receiptstatus"),b.receiptType=a),b},listXhrBeforeSend:function(){o=!1,$(".fs-guide-receipt-bracket").remove()},itemReadyCb:function(){var a=this.$el,b=$(".aj-receipt-fn",a);!r.isDemoAccount&&p.IsShowReceiptionGuide&&b.length>0&&!o&&(o=!0,g.showGuideTip(b,{leftTopIncrement:-10,rightTopIncrement:-10,imageName:"receiption-item.png",imagePosition:{top:"-94px",left:"20px"},renderCb:function(a,b,c,d){var e=$('<div class="fs-guide-shadow-link"></div>'),f=$('<div class="fs-guide-shadow-link"></div>'),h=function(){p.IsShowReceiptionGuide=!1,g.setEnterpriseConfig(107,p,!0),g.updateEnterpriseConfig(107),b.remove(),c.remove()};b.addClass("fs-guide-receipt-bracket"),c.addClass("fs-guide-receipt-bracket"),e.css({width:"26px",height:"26px",position:"absolute",top:"9px",left:"240px",cursor:"pointer"}).appendTo(a),f.css({width:"130px",height:"32px",position:"absolute",top:"124px",left:"100px",cursor:"pointer"}).appendTo(a),e.click(function(){h()}),f.click(function(){h()}),d.one("click",function(){h()})}}))},reloadAfterReply:!1,searchOpts:{inputSelector:k,btnSelector:l}});l.click(function(a){s.reload(),a.preventDefault()}),m.on("click",".filter-field",function(a){var b=$(this),c=b.attr("receipttype");$(".filter-field",m).removeClass("depw-menu-aon"),b.addClass("depw-menu-aon"),"received"==c?(s.opts.listPath="/Feed/GetReceiptFeedsOfIReceive",n.show()):(s.opts.listPath="/Feed/GetReceiptFeedsOfISend",n.hide()),$(".empty-h",j).click(),s.reload(),a.preventDefault()}).on("click",".receipt-status",function(a){var b=$(this);$(".receipt-status",m).removeClass("depw-tabs-aon"),b.addClass("depw-tabs-aon"),s.reload(),a.preventDefault()});var t=!0;f.on("switched",function(a){a==c?(t?(s.load(),t=!1):($(".filter-field",m).removeClass("depw-menu-aon").eq(0).addClass("depw-menu-aon"),s.opts.listPath="/Feed/GetReceiptFeedsOfIReceive",s.reload()),$(".fs-guide-group-bracket,.fs-guide-avatar-bracket").css("visibility","hidden")):$(".fs-guide-group-bracket,.fs-guide-avatar-bracket").css("visibility","visible")})}});