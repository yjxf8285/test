/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/stream/mytopics/mytopics",["tabs","util","modules/fs-topic/fs-topic","../stream-common","dialog","../stream-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=(a("tabs"),a("util")),h=a("modules/fs-topic/fs-topic"),i=a("../stream-common"),j=h.Mytopics;b.init=function(){var a=b.tplEl,c=b.tplName,d=$(".topic-model-warp",a),e=$(".topic-list-pagination",a),h=$(".search-inp",a),k=$(".search-btn",a),l=$(".filter",a),m=$(".topic-num .num",a),n=new j({element:d,listPath:"/Topic/GetTopics",pagSelector:e,defaultRequestData:function(){return{type:$(".depw-menu-aon",l).attr("topictype"),keyword:_.str.trim(h.val())}},searchOpts:{inputSelector:h,btnSelector:k},listSuccessCb:function(a){var b,c,d;a.success&&(b=a.value,m.text(b.totalCount),c=$(".depw-menu-aon",l),d=c.attr("topictype"),"1"==d?n.setTopVisible(!0):n.setTopVisible(!1),"0"==d&&n.setFollowAction(!1))}});k.click(function(a){n.load(),a.preventDefault()}),l.on("click",".filter-field",function(a){var b=$(this);$(".filter-field",l).removeClass("depw-menu-aon"),b.addClass("depw-menu-aon"),n.load(),a.preventDefault()}),i.init(a,c),g.tplRouterReg("#stream/mytopics/=/:topictype-:value");var o=!0;f.on("switched",function(b){if(b==c){var d=g.getTplQueryParams(),e=d?d.topictype:0;$(".filter-field",l).removeClass("depw-menu-aon"),$('[topictype="'+e+'"]',l).addClass("depw-menu-aon"),$('.tpl-l [href="#stream/mytopics"]',a).addClass("depw-menu-aon"),n.resetSearch(),o?(n.load(),o=!1):n.load()}});var p=$(".right-fixedtopics-wrap",a),q=$(".right-followtopics-wrap",a),r=$(".right-newtopics-wrap",a),s=$(".right-mosttopics-wrap",a),t=$(".mytopics-img-wrap",a),u=g.getContactData(),v=function(){g.api({type:"get",data:{},url:"/Topic/GetTopicAdmins",success:function(a){var b;u.p,a.success&&(b=a.value,b.length>14&&(b=b.slice(0,14)),t.empty(),_.each(b,function(a){var b=a.name,c=a.employeeID,d=a.profileImage,e="<a href='#profile/=/empid-"+c+"' title='"+b+"'><img src='"+g.getAvatarLink(d,3)+"' width='24' height='24' /></a>";t.append(e)}),$(".mytopics-admin-count").text(b.length))}})};v();var w=function(){g.api({type:"get",data:{},url:"/Topic/GetTopicList",success:function(a){if(a.success){var b;b=a.value.fixedTopics,b.length>5&&(b=b.slice(0,5)),b.length<1?$(".fixedtopics-wrapper").hide():$(".fixedtopics-wrapper").show(),p.empty(),_.each(b,function(a){var b,c=a.topicID;b="<li><a href='#stream/showtopic/=/id-"+c+"' class='fna-blue'>#"+a.name+"#</a><span class='rfl-li-apv color-999999'>"+a.count+"</span></li>",p.append(b)});var c;c=a.value.followTopics,c.length>5&&(c=c.slice(0,5)),c.length<1?$(".followtopics-wrapper").hide():$(".followtopics-wrapper").show(),q.empty(),_.each(c,function(a){var b,c=a.topicID;b="<li><a href='#stream/showtopic/=/id-"+c+"' class='fna-blue'>#"+a.name+"#</a><span class='rfl-li-apv color-999999'>"+a.count+"</span></li>",q.append(b)});var d;d=a.value.newTopics,d.length>5&&(d=d.slice(0,5)),d.length<1?$(".newtopics-wrapper").hide():$(".newtopics-wrapper").show(),r.empty(),_.each(d,function(a){var b,c=a.topicID;b="<li><a href='#stream/showtopic/=/id-"+c+"' class='fna-blue'>#"+a.name+"#</a><span class='rfl-li-apv color-999999'>"+a.count+"</span></li>",r.append(b)});var e;e=a.value.mostTopics,e.length>5&&(e=e.slice(0,5)),e.length<1?$(".mosttopics-wrapper").hide():$(".mosttopics-wrapper").show(),s.empty(),_.each(e,function(a){var b=a.topicID,c="<li><a href='#stream/showtopic/=/id-"+b+"' class='fna-blue'>#"+a.name+"#</a><span class='rfl-li-apv color-999999'>"+a.count+"</span></li>";s.append(c)})}}})};w()}});