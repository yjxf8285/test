/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/stream/receivedreplies/receivedreplies",["tabs","util","modules/fs-reply/fs-reply-list","../stream-common","dialog","../stream-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=a("tabs"),h=a("util"),i=a("modules/fs-reply/fs-reply-list"),j=a("../stream-common"),k=i.replyList;b.init=function(){var a,c=b.tplEl,e=b.tplName,i=$(".reply-tabs",c),l=$(".filter",c),m=$(".search-inp",c),n=$(".search-btn",c);j.init(c,e);var o=function(a){0==a.get("activeIndex")?a.trigger("switched",0,-1):a.switchTo(0)},p=function(a){a.success&&this.addNewReply(a.value)},q=function(a){var b=$(".depw-menu-aon",l).attr("replytype");a.opts.listPath="/feed/getFeedReplysOfI"+_.str.capitalize(b),a.opts.replyCb="send"==b?function(){a.reload()}:d.EMPTY_FN},r=null;a=new g({element:i,triggers:$(".ui-tab-item",i),panels:$(".ui-tab-panel",i),activeIndex:0,activeTriggerClass:"ui-tab-item-current",triggerType:"click"}).render(),a.on("switched",function(a){var b=this.get("panels").eq(a),c=$(".reply-list",b),d=$(".reply-list-pagination",b),e=b.data("replyList"),f=b.attr("feedtype");e?(q(e),e.reload()):(e=new k({element:c,pagSelector:d,pagOpts:{pageSize:45,visiblePageNums:7},listPath:"/feed/getFeedReplysOfIReceive",defaultRequestData:function(){return{feedType:f,keyword:_.str.trim(m.val())}},searchOpts:{inputSelector:m,btnSelector:n},replyCb:p}),q(e),e.load(),b.data("replyList",e)),r=e}),f.on("switched",function(b){var c,d,e=$(".filter-field",l);e.removeClass("depw-menu-aon"),"stream-receivedreplies"==b&&(c=h.getTplQueryParams(),d=c?c.type:"receive","receive"==d?e.eq(0).addClass("depw-menu-aon"):"send"==d?e.eq(1).addClass("depw-menu-aon"):e.eq(2).addClass("depw-menu-aon"),o(a))}),n.click(function(a){r.reload(),a.preventDefault()}),l.on("click",".filter-field",function(a){var b=$(this);$(".filter-field",l).removeClass("depw-menu-aon"),b.addClass("depw-menu-aon"),q(r),r.reload(),a.preventDefault()})}});