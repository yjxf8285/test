/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/worktodo/worktodo",["modules/fs-worktodo/worktodo-list","modules/fs-worktodo/fs-worktodo","dialog","modules/publish/publish","./worktodo-common","util","moment","./worktodo-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=e.event,g=a("modules/fs-worktodo/worktodo-list"),h=a("modules/fs-worktodo/fs-worktodo"),i=(a("dialog"),a("modules/publish/publish.js")),j=a("./worktodo-common"),k=a("util"),l=h.NewWorktodoDialog;i.selectBar,i.atInput,b.init=function(){var a=b.tplEl,c=b.tplName,d=$(".filter",a),e=$(".worktodo-list",a),h=$(".worktodo-list-pagination",a),i=$(".add-worktodo-btn",a),m=$(".search-inp",d),n=$(".search-btn",d);j.init(a,c);var o=k.getContactData(),p=o.u,q=new g({element:e,pagSelector:h,defaultRequestData:function(){return{isImportant:$(".important",d).filter(".depw-tabs-aon").attr("val"),isCompleted:$(".complete",d).filter(".depw-tabs-aon").attr("val"),keyword:_.str.trim(m.val())}},searchOpts:{inputSelector:m,btnSelector:n}});new l({trigger:i,successCb:function(a,b){a.success&&(_.find(b.employeeIDs,function(a){return a==p.id})&&q.prependNewTask(a.value.workToDoListID),this.hide())}}),n.click(function(a){q.reload(),a.preventDefault()}),d.on("click",".important,.complete",function(){var a=$(this);a.hasClass("important")?$(".important",d).removeClass("depw-tabs-aon"):$(".complete",d).removeClass("depw-tabs-aon"),a.addClass("depw-tabs-aon"),q.reload()}),q.load();var r=!0;f.on("switched",function(a){a==c&&(r?r=!1:q.reload())})}});