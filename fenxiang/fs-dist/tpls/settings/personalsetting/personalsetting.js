/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/settings/personalsetting/personalsetting",["tabs","util","../settings-common","../settings-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=(a("tabs"),a("util")),g=a("../settings-common"),h=f.getContactData(),i=h.u;b.init=function(){var a=b.tplEl,c=b.tplName,d=$(".personalsetting-form",a),e=$(".settings-input,.settings-textarea",d);$(".settings-textarea",d);var h=$("#user-fullname"),j=$("#user-name"),k=$("#user-account"),l=$("#s-sex-male"),m=$("#s-sex-female"),n=$("#user-department"),o=$("#user-post"),p=$("#user-qq"),q=$("#user-msn"),r=$("#user-email"),s=$("#user-tel"),t=$("#user-description");d.on("keyup","#user-qq,#user-msn,#user-email,#user-tel",function(){var a=$(this);a.val(a.val().replace(/[^\x00-\xff]/gi,""))});var u=function(){var a={};return a.employeeID=i.id,a.account=k.val(),a.name=j.val(),a.tel=s.val(),a.department=n.val(),a.post=o.val(),a.qq=p.val(),a.msn=q.val(),a.email=r.val(),l.is(":checked")?a.gender="M":m.is(":checked")&&(a.gender="F"),a.description=t.val(),a},v=function(){var a=!0,b=k.val(),c=(_.str.trim(n.val()),_.str.trim(o.val()),_.str.trim(p.val()),_.str.trim(q.val()),_.str.trim(r.val()),_.str.trim(s.val()),_.str.trim(t.val()));return 0==b.length&&(a=!1),c.length>500&&(f.alert("请控制工作介绍在500字内，目前已超出<em>"+(c.length-500)+"</em>个字"),a=!1),a};d.on("click",".settings-input,.settings-textarea",function(a){var b=$(this);e.each(function(){var a=$(this);a.removeClass("settings-input-on"),a.next().hide()}),b.addClass("settings-input-on"),b.next().show(),a.stopPropagation()}).on("click",".save-success-btn",function(b){var d;v()&&(d=u(),f.api({type:"post",url:"/Account/SaveCurrentUser/",data:d,success:function(b){b.success&&g.saveSuccessAnimated(a,c)}})),b.preventDefault()}),f.api({type:"get",data:{employeeID:i.id},url:"/Account/GetEmployeeByID",success:function(a){var b;a.success&&(b=a.value,h.val(b.fullName),j.val(b.name),k.val(b.account),"M"==b.gender?l.prop("checked",!0):"F"==b.gender&&m.prop("checked",!0),n.val(b.department),o.val(b.post),p.val(b.qq),q.val(b.msn),r.val(b.email),s.val(b.tel),t.val(b.description))}}),f.regGlobalClick(e,function(){e.each(function(){var a=$(this);a.removeClass("settings-input-on"),a.next().hide()})}),g.init(a,c)}});