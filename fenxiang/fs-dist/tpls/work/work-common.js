/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/work/work-common",["util","moment","./work-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl;e.event;var f=a("util"),g=a("moment"),h=a("./work-common.html"),i=$(h),j=function(a){var b=$(".workr-do-list-wrap",a),c=$(".workr-my-list-wrap",a),d=$(".workr-ups-list-wrap",a);b.empty(),c.empty(),d.empty(),f.api({type:"get",data:{},url:"/feedWork/getFeedWorksInAbeyance",success:function(a){if(a.success){var e=a.value.iExecuters,h=a.value.iExecuterCount;$(".workr-do-title-count").text(h),e.length>5&&(e=e.slice(0,5)),e.length>0?_.each(e,function(a){var c=a.employee.name,d=a.employeeID,e=f.getAvatarLink(a.employee.profileImage,3),h=g.unix(a.dateTime).format("MM-DD HH:mm"),i=a.feedID,j=a.feedContent,k="<div class='rightc-listwrap fn-clear'><a href='javascript:;' class='rlist-headimg-wrap'><img class='rlist-headimg' src='"+e+"' /></a><p class='rlist-pname'><a href='#profile/=/empid-"+d+"' class='fna-blue'>"+c+"</a> <span class='rlist-pname-apvdate'>"+h+"</span></p><a class='rlist-atext fna-grey' href='#stream/showfeed/=/id-"+i+"'>"+j+"</a></div>";b.append(k)}):b.append("<div class='right-list-notext color-999999'>无我执行的指令</div>");var i=a.value.iSends,j=a.value.iSendCount;if($(".workr-my-title-count").text(j),i.length>5&&(i=i.slice(0,5)),i.length>0){var k="";_.each(i,function(a){if(a.employee){var b=a.employee.name,c=a.employeeID,d=f.getAvatarLink(a.employee.profileImage,3),e=g.unix(a.dateTime).format("MM-DD HH:mm"),h=a.feedID,i=a.feedContent;k+="<div class='rightc-listwrap fn-clear'><a href='javascript:;' class='rlist-headimg-wrap'><img class='rlist-headimg' src='"+d+"' /></a><p class='rlist-pname'><a href='#profile/=/empid-"+c+"' class='fna-blue'>"+b+"</a> <span class='rlist-pname-apvdate'>"+e+"</span></p><a class='rlist-atext fna-grey' href='#stream/showfeed/=/id-"+h+"'>"+i+"</a></div>"}}),c.html(k)}else c.append("<div class='right-list-notext color-999999'>无我发出执行的指令</div>");var l=a.value.toBeIs,m=a.value.toBeICount;0==m&&$(".workr-ups-tpl-wrap").hide(),$(".workr-ups-title-count").text(m),l.length>5&&(l=l.slice(0,5));var n="";_.each(l,function(a){if(a.employee){var b=a.employee.name,c=a.employeeID,d=f.getAvatarLink(a.employee.profileImage,3),e=g.unix(a.dateTime).format("MM-DD HH:mm"),h=a.feedID,i=a.feedContent;n+="<div class='rightc-listwrap fn-clear'><a href='javascript:;' class='rlist-headimg-wrap'><img class='rlist-headimg' src='"+d+"' /></a><p class='rlist-pname'><a href='#profile/=/empid-"+c+"' class='fna-blue'>"+b+"</a> <span class='rlist-pname-apvdate'>"+e+"</span></p><a class='rlist-atext fna-grey' href='#stream/showfeed/=/id-"+h+"'>"+i+"</a></div>"}}),d.html(n)}}})};b.createRightSb=j,b.init=function(a,b){var c=$(".tpl-l .tpl-inner",a),d=f.getContactData(),e=d.u,g=e.functionPermissions,h={},k=_.template(i.filter(".work-tpl-left").html());_.extend(h,{userName:e.name,profileImage:e.profileImage}),c.html(k(h)),_.some(g,function(a){return 5==a.value})&&$(".performance-nav-item",c).show(),f.regTplNav($(".tpl-nav-lb",c),"depw-menu-aon"),j(a,b),f.tplRouterReg($(".tpl-nav-lb",c)),f.tplRouterReg("#work/=/:tabindex-:value"),f.tplRouterReg("#work/assignedworks/=/:tabindex-:value")}});