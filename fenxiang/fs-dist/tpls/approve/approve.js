/**
 * 纷享页面逻辑
 * @Author: 纷享网页前端部
 * @Date: 2014-09-02
 */
define("tpls/approve/approve",["util","tabs","modules/feed-list/feed-list","./approve-common","moment","dialog","modules/publish/publish","./approve-common.css","./approve-common.html"],function(a,b){var c=window,d=c.FS,e=d.tpl,f=(e.store,e.event),g=(a("util"),a("tabs")),h=a("modules/feed-list/feed-list"),i=a("./approve-common");b.init=function(){var a,c=b.tplEl,d=b.tplName,e=$(".search-inp",c),j=$(".search-btn",c),k=$(".feed-tabs",c),l=function(a){0==a.get("activeIndex")?a.trigger("switched",0,-1):a.switchTo(0)},m=null;i.init(c,d);var n=function(a){var b=$(a),c=b.data("feedList");c&&c.loadKill()};a=new g({element:k,triggers:$(".ui-tab-item",k),panels:$(".ui-tab-panel",k),activeIndex:0,activeTriggerClass:"ui-tab-item-current",triggerType:"click"}).render(),a.on("switched",function(a){var b=this.get("panels").eq(a),c=$(".feed-list",b),d=$(".feed-list-pagination",b),f=b.data("feedList"),g=b.attr("approvetype");f?f.reload():(f=new h({element:c,pagSelector:d,pagOpts:{pageSize:45,visiblePageNums:7},listPath:"/FeedApprove/GetFeedApproveOfIApprove",loadSize:15,defaultRequestData:function(){return{type:g,keyword:_.str.trim(e.val())}},listEmptyText:"没有需要您审批的事项",searchOpts:{inputSelector:e,btnSelector:j}}),f.load(),b.data("feedList",f)),m=f}).on("switch",function(a,b){n(this.get("panels").eq(b))}),j.click(function(a){m.reload(),a.preventDefault()});var o=function(){var b=a.get("panels");b.each(function(){var a=$(this),b=a.data("feedList");b&&b.destroy(),a.removeData()})};f.one("beforeremove",function(a){a==d&&o()}),l(a)}});