define("arale/autocomplete/1.2.0/autocomplete",["$","arale/overlay/1.0.1/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.1/iframe-shim","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.3/templatable","gallery/handlebars/1.0.0/handlebars","./data-source","./filter","./autocomplete.tpl"],function(t,e,i){function s(t){return"[object String]"===Object.prototype.toString.call(t)}function a(t,e){if(!t)return e;if(r.isFunction(t))return t.call(this,e);if(s(t)){for(var i=t.split("."),a=e;i.length;){var n=i.shift();if(!a[n])break;a=a[n]}return a}return e}function n(t,e){var i=this.highlightIndex,s=0,a=e||this.matchKey||"",n="";if(r.isArray(i)){for(var l=0,u=i.length;u>l;l++){var o,c,d=i[l];if(r.isArray(d)?(o=d[0],c=d[1]-d[0]):(o=d,c=1),o>s&&(n+=a.substring(s,o)),a.length>o&&(n+='<span class="'+t+'-item-hl">'+a.substr(o,c)+"</span>"),s=o+c,s>=a.length)break}return a.length>s&&(n+=a.substring(s,a.length)),new h.SafeString(n)}return a}var r=t("$"),l=t("arale/overlay/1.0.1/overlay"),u=t("arale/widget/1.0.3/templatable"),h=t("gallery/handlebars/1.0.0/handlebars"),o=t("./data-source"),c=t("./filter"),d=t("./autocomplete.tpl"),f={UP:38,DOWN:40,LEFT:37,RIGHT:39,ENTER:13,ESC:27,BACKSPACE:8},g=l.extend({Implements:u,attrs:{trigger:{value:null,getter:function(t){return r(t)}},classPrefix:"ui-autocomplete",align:{baseXY:[0,"100%"]},template:d,submitOnEnter:!0,dataSource:[],locator:"data",filter:void 0,inputFilter:function(t){return t},disabled:!1,selectFirst:!1,delay:100,selectedIndex:void 0,inputValue:"",data:[]},events:{"mousedown [data-role=item]":function(t){var e=this.items.index(t.currentTarget);this.set("selectedIndex",e),this.selectItem(),this._firstMousedown=!0},mousedown:function(){this._secondMousedown=!0},"mouseenter [data-role=item]":function(t){var e=this.get("classPrefix")+"-item-hover";this.currentItem&&this.currentItem.removeClass(e),r(t.currentTarget).addClass(e)},"mouseleave [data-role=item]":function(t){var e=this.get("classPrefix")+"-item-hover";r(t.currentTarget).removeClass(e)}},templateHelpers:{highlightItem:n},parseElement:function(){this.model={classPrefix:this.get("classPrefix"),items:[]},g.superclass.parseElement.call(this)},setup:function(){var t=this.get("trigger"),e=this;g.superclass.setup.call(this),this.dataSource=new o({source:this.get("dataSource")}).on("data",this._filterData,this),this._initFilter(),this._blurHide([t]),this._tweakAlignDefaultValue(),t.attr("autocomplete","off").on("blur.autocomplete",r.proxy(this._blurEvent,this)).on("keydown.autocomplete",r.proxy(this._keydownEvent,this)).on("keyup.autocomplete",function(){clearTimeout(e._timeout),e._timeout=setTimeout(function(){e._timeout=null,e._keyupEvent.call(e)},e.get("delay"))})},destroy:function(){this._clear(),this.element.remove(),g.superclass.destroy.call(this)},hide:function(){this._timeout&&clearTimeout(this._timeout),this.dataSource.abort(),g.superclass.hide.call(this)},selectItem:function(){this.hide();var t=this.currentItem,e=this.get("selectedIndex"),i=this.get("data")[e];if(t){var s=t.attr("data-value");this.get("trigger").val(s),this.set("inputValue",s),this.trigger("itemSelect",i),this._clear()}},setInputValue:function(t){if(this.get("inputValue")!==t){this._start=!0,this.set("inputValue",t);var e=this.get("trigger");e.val()!==t&&e.val(t)}},_onRenderInputValue:function(t){if(this._start&&t){var e=this.queryValue;this.queryValue=this.get("inputFilter").call(this,t),this.queryValue&&this.queryValue!==e&&(this.dataSource.abort(),this.dataSource.getData(this.queryValue))}else this.queryValue="";""!==t&&this.queryValue||(this.set("data",[]),this.hide()),delete this._start},_filterData:function(t){var e=this.get("filter"),i=this.get("locator");t=a(i,t),t=e.func.call(this,t,this.queryValue,e.options),this.set("data",t)},_onRenderData:function(t){this._clear(),this.model.items=t,this.renderPartial("[data-role=items]"),this.items=this.$("[data-role=items]").children(),this.currentItem=null,this.get("selectFirst")&&this.set("selectedIndex",0),r.trim(this.$("[data-role=items]").text())?this.show():this.hide()},_onRenderSelectedIndex:function(t){if(-1!==t){var e=this.get("classPrefix")+"-item-hover";this.currentItem&&this.currentItem.removeClass(e),this.currentItem=this.items.eq(t).addClass(e),this.trigger("indexChange",t,this.lastIndex),this.lastIndex=t}},_initFilter:function(){var t=this.get("filter");t=void 0===t?"url"===this.dataSource.get("type")?null:{name:"startsWith",func:c.startsWith,options:{key:"value"}}:r.isPlainObject(t)?c[t.name]?{name:t.name,func:c[t.name],options:t.options}:null:r.isFunction(t)?{func:t}:c[t]?{name:t,func:c[t]}:null,t||(t={name:"default",func:c["default"]}),this.set("filter",t)},_blurEvent:function(){r.browser.msie||(this._secondMousedown?this._firstMousedown&&(this.get("trigger").focus(),this.hide()):this.hide(),delete this._firstMousedown,delete this._secondMousedown)},_keyupEvent:function(){if(!this.get("disabled")&&this._keyupStart){delete this._keyupStart;var t=this.get("trigger").val();this.setInputValue(t)}},_keydownEvent:function(t){if(!this.get("disabled"))switch(delete this._keyupStart,t.which){case f.ESC:this.hide();break;case f.UP:this._keyUp(t);break;case f.DOWN:this._keyDown(t);break;case f.LEFT:case f.RIGHT:break;case f.ENTER:this._keyEnter(t);break;default:this._keyupStart=!0}},_keyUp:function(t){if(t.preventDefault(),this.get("data").length){if(!this.get("visible"))return this.show(),void 0;this._step(-1)}},_keyDown:function(t){if(t.preventDefault(),this.get("data").length){if(!this.get("visible"))return this.show(),void 0;this._step(1)}},_keyEnter:function(t){this.get("visible")&&(this.selectItem(),this.get("submitOnEnter")||t.preventDefault())},_step:function(t){var e=this.get("selectedIndex");-1===t?e>0?this.set("selectedIndex",e-1):this.set("selectedIndex",this.items.length-1):1===t&&(this.items.length-1>e?this.set("selectedIndex",e+1):this.set("selectedIndex",0))},_clear:function(){this.$("[data-role=items]").empty(),this.set("selectedIndex",-1),delete this.items,delete this.lastIndex,delete this.currentItem},_tweakAlignDefaultValue:function(){var t=this.get("align");t.baseElement=this.get("trigger"),this.set("align",t)}});i.exports=g}),define("arale/autocomplete/1.2.0/data-source",["arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","$"],function(t,e,i){function s(t){return"[object String]"===Object.prototype.toString.call(t)}function a(t){return t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}var n=t("arale/base/1.0.1/base"),r=t("$"),l=n.extend({attrs:{source:null,type:"array"},initialize:function(t){l.superclass.initialize.call(this,t),this.id=0,this.callbacks=[];var e=this.get("source");if(s(e))this.set("type","url");else if(r.isArray(e))this.set("type","array");else if(r.isPlainObject(e))this.set("type","object");else{if(!r.isFunction(e))throw Error("Source Type Error");this.set("type","function")}},getData:function(t){return this["_get"+a(this.get("type")||"")+"Data"](t)},abort:function(){this.callbacks=[]},_done:function(t){this.trigger("data",t)},_getUrlData:function(t){var e,i=this,s={query:t?encodeURIComponent(t):"",timestamp:(new Date).getTime()},a=this.get("source").replace(/{{(.*?)}}/g,function(t,e){return s[e]}),n="callback_"+this.id++;this.callbacks.push(n),e=/^(https?:\/\/)/.test(a)?{dataType:"jsonp"}:{dataType:"json"},r.ajax(a,e).success(function(t){r.inArray(n,i.callbacks)>-1&&(delete i.callbacks[n],i._done(t))}).error(function(){r.inArray(n,i.callbacks)>-1&&(delete i.callbacks[n],i._done({}))})},_getArrayData:function(){var t=this.get("source");return this._done(t),t},_getObjectData:function(){var t=this.get("source");return this._done(t),t},_getFunctionData:function(t){function e(t){i._done(t)}var i=this,s=this.get("source"),a=s.call(this,t,e);a&&this._done(a)}});i.exports=l}),define("arale/autocomplete/1.2.0/filter",["$"],function(t,e,i){function s(t,e){if(r.isPlainObject(t)){var i=e&&e.key||"value";return t[i]||""}return t}function a(t,e){for(var i=[],s=t.split(""),a=0,n=e.split(""),r=0,l=s.length;l>r;r++){var u=s[r];if(u==n[a]){if(a===n.length-1){i.push([r-n.length+1,r+1]),a=0;continue}a++}else a=0}return i}function n(t){return(t||"").replace(u,"\\$1")}var r=t("$"),l={"default":function(t,e,i){var a=[];return r.each(t,function(t,e){var n={},l=s(e,i);r.isPlainObject(e)&&(n=r.extend({},e)),n.matchKey=l,a.push(n)}),a},startsWith:function(t,e,i){var a=[],l=e.length,u=RegExp("^"+n(e));return l?(r.each(t,function(t,e){var n={},h=s(e,i);r.isPlainObject(e)&&(n=r.extend({},e)),u.test(h)&&(n.matchKey=h,l>0&&(n.highlightIndex=[[0,l]]),a.push(n))}),a):[]},stringMatch:function(t,e,i){e=e||"";var n=[],l=e.length;return l?(r.each(t,function(t,l){var u={},h=s(l,i);r.isPlainObject(l)&&(u=r.extend({},l)),h.indexOf(e)>-1&&(u.matchKey=h,u.highlightIndex=a(h,e),n.push(u))}),n):[]}};i.exports=l;var u=/(\[|\[|\]|\^|\$|\||\(|\)|\{|\}|\+|\*|\?)/g}),define("arale/autocomplete/1.2.0/autocomplete.tpl",[],'<div class="{{classPrefix}}">\n    <ul class="{{classPrefix}}-ctn" data-role="items">\n        {{#each items}}\n            <li data-role="item" class="{{../classPrefix}}-item" data-value="{{matchKey}}">{{highlightItem ../classPrefix matchKey}}</li>\n        {{/each}}\n    </ul>\n</div>\n');
