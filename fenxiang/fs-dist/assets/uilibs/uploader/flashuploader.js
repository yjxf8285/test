define("uilibs/uploader/flashuploader",["swfupload"],function(a,b,c){function d(a,b,c){try{var d="error.gif",e="";if(b===o.errorCode_QUEUE_LIMIT_EXCEEDED&&(e="You have attempted to queue too many files."),""!==e)return alert(e),void 0;switch(b){case o.QUEUE_ERROR.ZERO_BYTE_FILE:d="zerobyte.gif";break;case o.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:d="toobig.gif";break;case o.QUEUE_ERROR.ZERO_BYTE_FILE:case o.QUEUE_ERROR.INVALID_FILETYPE:default:alert(c)}j("images/"+d)}catch(f){this.debug(f)}}function e(a,b){try{b>0&&this.startUpload()}catch(c){this.debug(c)}}function f(a,b){try{var c=Math.ceil(100*(b/a.size)),d=new l(a,this.customSettings.upload_target);d.setProgress(c),100===c?(d.setStatus("Creating thumbnail..."),d.toggleCancel(!1,this)):(d.setStatus("Uploading..."),d.toggleCancel(!0,this))}catch(e){this.debug(e)}}function g(a,b){try{var c=new l(a,this.customSettings.upload_target);"FILEID:"===b.substring(0,7)?(j("thumbnail.php?id="+b.substring(7)),c.setStatus("Thumbnail Created."),c.toggleCancel(!1)):(j("images/error.gif"),c.setStatus("Error."),c.toggleCancel(!1),alert(b))}catch(d){this.debug(d)}}function h(a){try{if(this.getStats().files_queued>0)this.startUpload();else{var b=new l(a,this.customSettings.upload_target);b.setComplete(),b.setStatus("All images received."),b.toggleCancel(!1)}}catch(c){this.debug(c)}}function i(a,b,c){var d,e="error.gif";try{switch(b){case o.UPLOAD_ERROR.FILE_CANCELLED:try{d=new l(a,this.customSettings.upload_target),d.setCancelled(),d.setStatus("Cancelled"),d.toggleCancel(!1)}catch(f){this.debug(f)}break;case o.UPLOAD_ERROR.UPLOAD_STOPPED:try{d=new l(a,this.customSettings.upload_target),d.setCancelled(),d.setStatus("Stopped"),d.toggleCancel(!0)}catch(g){this.debug(g)}case o.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:e="uploadlimit.gif";break;default:alert(c)}j("images/"+e)}catch(h){this.debug(h)}}function j(a){var b=document.createElement("img");if(b.style.margin="5px",document.getElementById("thumbnails").appendChild(b),b.filters)try{b.filters.item("DXImageTransform.Microsoft.Alpha").opacity=0}catch(c){b.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}else b.style.opacity=0;b.onload=function(){k(b,0)},b.src=a}function k(a,b){var c=5,d=30;if(100>b)if(b+=c,b>100&&(b=100),a.filters)try{a.filters.item("DXImageTransform.Microsoft.Alpha").opacity=b}catch(e){a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+b+")"}else a.style.opacity=b/100;100>b&&setTimeout(function(){k(a,b)},d)}function l(a,b){if(this.fileProgressID="divFileProgress",this.fileProgressWrapper=document.getElementById(this.fileProgressID),this.fileProgressWrapper)this.fileProgressElement=this.fileProgressWrapper.firstChild,this.fileProgressElement.childNodes[1].firstChild.nodeValue=a.name;else{this.fileProgressWrapper=document.createElement("div"),this.fileProgressWrapper.className="progressWrapper",this.fileProgressWrapper.id=this.fileProgressID,this.fileProgressElement=document.createElement("div"),this.fileProgressElement.className="progressContainer";var c=document.createElement("a");c.className="progressCancel",c.href="#",c.style.visibility="hidden",c.appendChild(document.createTextNode(" "));var d=document.createElement("div");d.className="progressName",d.appendChild(document.createTextNode(a.name));var e=document.createElement("div");e.className="progressBarInProgress";var f=document.createElement("div");f.className="progressBarStatus",f.innerHTML="&nbsp;",this.fileProgressElement.appendChild(c),this.fileProgressElement.appendChild(d),this.fileProgressElement.appendChild(f),this.fileProgressElement.appendChild(e),this.fileProgressWrapper.appendChild(this.fileProgressElement),document.getElementById(b).appendChild(this.fileProgressWrapper),k(this.fileProgressWrapper,0)}this.height=this.fileProgressWrapper.offsetHeight}var m=window,n=m.FS,o=a("swfupload");o.prototype.cleanUp=function(a){try{if(this.movieElement&&"unknown"==typeof a.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var b in a)try{"function"==typeof a[b]&&b[0]<="Z"&&(a[b]=null)}catch(c){}}}catch(d){}window.__flash__removeCallback=function(a,b){try{a&&(a[b]=null)}catch(c){}}},l.prototype.setProgress=function(a){this.fileProgressElement.className="progressContainer green",this.fileProgressElement.childNodes[3].className="progressBarInProgress",this.fileProgressElement.childNodes[3].style.width=a+"%"},l.prototype.setComplete=function(){this.fileProgressElement.className="progressContainer blue",this.fileProgressElement.childNodes[3].className="progressBarComplete",this.fileProgressElement.childNodes[3].style.width=""},l.prototype.setError=function(){this.fileProgressElement.className="progressContainer red",this.fileProgressElement.childNodes[3].className="progressBarError",this.fileProgressElement.childNodes[3].style.width=""},l.prototype.setCancelled=function(){this.fileProgressElement.className="progressContainer",this.fileProgressElement.childNodes[3].className="progressBarError",this.fileProgressElement.childNodes[3].style.width=""},l.prototype.setStatus=function(a){this.fileProgressElement.childNodes[2].innerHTML=a},l.prototype.toggleCancel=function(a,b){if(this.fileProgressElement.childNodes[0].style.visibility=a?"visible":"hidden",b){var c=this.fileProgressID;this.fileProgressElement.childNodes[0].onclick=function(){return b.cancelUpload(c),!1}}};var p=function(a){var b,c,j,k,l=this;a=_.extend({upload_url:"#",file_post_name:"file",post_params:{},file_size_limit:0,file_upload_limit:0,file_queue_error_handler:d,file_dialog_complete_handler:e,upload_progress_handler:f,upload_total_progress_handler:n.EMPTY_FN,upload_error_handler:i,upload_success_handler:g,upload_complete_handler:h,upload_all_complete_handler:n.EMPTY_FN,button_width:18,button_height:18,button_text:'<span class="button">Select Images <span class="buttonSmall">(2 MB Max)</span></span>',button_text_style:".button { font-family: Helvetica, Arial, sans-serif; font-size: 12pt; } .buttonSmall { font-size: 10pt; }",button_text_top_padding:0,button_text_left_padding:18,button_window_mode:o.WINDOW_MODE.TRANSPARENT,button_cursor:o.CURSOR.HAND,flash_url:n.BASE_PATH+"/html/fs/assets/swfupload/swfupload.swf",custom_settings:{upload_target:"divFileProgressContainer"},debug:!1},a||{}),k=a.upload_start_handler,a.upload_start_handler=function(a){return l._updateFileStore(a),l._updateFileStore({id:a.id,uploaded:!1,uploadedSize:0}),k&&k.apply(this,arguments)},b=a.upload_progress_handler,a.upload_progress_handler=function(c,d){l._updateFileStore({id:c.id,uploadedSize:d}),b&&b.apply(this,arguments),a.upload_total_progress_handler.call(this,l.getTotalUploadedSize(),l.getTotalUploadSize())},j=a.upload_success_handler,a.upload_success_handler=function(a){return l._updateFileStore({id:a.id,uploaded:!0}),j&&j.apply(this,arguments)},c=a.upload_complete_handler,a.upload_complete_handler=function(){for(var b,d=0,e=!0;b=this.getFile(d);)(b.filestatus==o.FILE_STATUS.IN_PROGRESS||b.filestatus==o.FILE_STATUS.QUEUED)&&(e=!1),d++;c&&c.apply(this,arguments),e&&a.upload_all_complete_handler.call(this),l.totalUploadedSize=0};var m=new o(a);this.type="flash",this._files=[],this.core=m};_.extend(p.prototype,{startUpload:function(){var a=this.core;return a.startUpload.apply(a,arguments)},cancelUpload:function(){var a=this.core;return a.cancelUpload.apply(a,arguments)},removeFile:function(){return this.cancelUpload.apply(this,arguments)},removeAllFile:function(a){for(var b,c=this.core,d=0;b=c.getFile(d);)this.removeFile(b.id,a),d++},getFiles:function(a){for(var b,c=this.core,d=0,e=[];b=c.getFile(d);)a?(b.filestatus==o.FILE_STATUS.QUEUED||b.filestatus==o.FILE_STATUS.IN_PROGRESS)&&e.push(b):e.push(b),d++;return e},_updateFileStore:function(a){var b=this._files,c=!1;_.some(b,function(b){b.id==a.id&&(c=!0,_.extend(b,a))}),c||this._files.push(_.extend({},a))},_getFileFullData:function(a){var b=this._files;return _.find(b,function(b){return b.id==a})},getTotalUploadSize:function(){var a=0,b=this.getFiles();b=_.filter(b,function(a){return a.filestatus!=o.FILE_STATUS.CANCELLED});for(var c,d=0;c=b[d];d++)a+=c.size;return a},getTotalUploadedSize:function(){var a,b=0,c=this.getFiles();c=_.filter(c,function(a){return a.filestatus!=o.FILE_STATUS.CANCELLED});for(var d,e=0;d=c[e];e++)a=this._getFileFullData(d.id),a&&a.uploadedSize&&(b+=a.uploadedSize);return b},setDisable:function(a){var b=this.core;b.setButtonDisabled(a)},destroy:function(){this._files=null,this.core.destroy()}}),c.exports=p});