define("arale/autocomplete/1.2.0/textarea-complete",["$","lepture/selection/0.9.0/selection","./autocomplete","arale/overlay/1.0.1/overlay","arale/position/1.0.0/position","arale/iframe-shim/1.0.1/iframe-shim","arale/widget/1.0.3/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.3/templatable","gallery/handlebars/1.0.0/handlebars","./data-source","./filter","./autocomplete.tpl"],function(t,e,i){var s=t("$"),a=t("lepture/selection/0.9.0/selection"),r=t("./autocomplete"),n=r.extend({attrs:{cursor:!1},setup:function(){n.superclass.setup.call(this),this.sel=a(this.get("trigger"));var t=this.get("inputFilter"),e=this;this.set("inputFilter",function(i){var s=i.substring(0,e.sel.cursor()[1]);return t.call(e,s)}),this.get("cursor")&&(this.mirror=l.init(this.get("trigger")),this.dataSource.before("getData",function(){e.mirror.setContent(e.get("inputValue"),e.queryValue,e.sel.cursor())}))},_keyUp:function(t){this.get("visible")&&(t.preventDefault(),this.get("data").length&&this._step(-1))},_keyDown:function(t){this.get("visible")&&(t.preventDefault(),this.get("data").length&&this._step(1))},_keyEnter:function(t){this.get("visible")&&(this.currentItem?(t.preventDefault(),t.stopImmediatePropagation(),this.selectItem()):this.hide())},show:function(){var t=this.get("cursor");if(t){if(s.isArray(t))var e=t;else var e=[0,0];var i=this.mirror.getFlagRect(),a=this.get("align");a.baseXY=[i.left+e[0],i.bottom+e[1]],a.selfXY=[0,0],this.set("align",a)}n.superclass.show.call(this)},selectItem:function(){this.hide();var t=this.currentItem,e=this.get("selectedIndex"),i=this.get("data")[e];if(t){var s=t.attr("data-value"),a=this.sel.cursor()[1],r=a-this.queryValue.length;this.sel.cursor(r,a).text("").append(s,"right");var n=this.get("trigger").val();this.set("inputValue",n),this.mirror&&this.mirror.setContent(n,"",this.sel.cursor()),this.trigger("itemSelect",i),this._clear()}}}),l={mirror:null,css:["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX"],init:function(t){t=s(t);var e={position:"absolute",left:-9999,top:0,zIndex:-2e4,"white-space":"pre-wrap"};return s.each(this.css,function(i,s){return e[s]=t.css(s)}),this.mirror=s("<div><span></span></div>").css(e).insertAfter(t),this},setContent:function(t,e,i){var s=e?i[1]-e.length:i[1],a=i[1],r=["<span>",t.substring(0,s),"</span>",'<span id="flag">',e||"","</span>","<span>",t.substring(a),"</span>"].join("");return this.mirror.html(r),this},getFlagRect:function(){var t,e,i;return i=this.mirror.find("span#flag"),t=i.position(),e={left:t.left,right:i.width()+t.left,top:t.top,bottom:i.height()+t.top}}};i.exports=n}),define("arale/autocomplete/1.2.0/data-source",["arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","$"],function(t,e,i){function s(t){return"[object String]"===Object.prototype.toString.call(t)}function a(t){return t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}var r=t("arale/base/1.0.1/base"),n=t("$"),l=r.extend({attrs:{source:null,type:"array"},initialize:function(t){l.superclass.initialize.call(this,t),this.id=0,this.callbacks=[];var e=this.get("source");if(s(e))this.set("type","url");else if(n.isArray(e))this.set("type","array");else if(n.isPlainObject(e))this.set("type","object");else{if(!n.isFunction(e))throw Error("Source Type Error");this.set("type","function")}},getData:function(t){return this["_get"+a(this.get("type")||"")+"Data"](t)},abort:function(){this.callbacks=[]},_done:function(t){this.trigger("data",t)},_getUrlData:function(t){var e,i=this,s={query:t?encodeURIComponent(t):"",timestamp:(new Date).getTime()},a=this.get("source").replace(/{{(.*?)}}/g,function(t,e){return s[e]}),r="callback_"+this.id++;this.callbacks.push(r),e=/^(https?:\/\/)/.test(a)?{dataType:"jsonp"}:{dataType:"json"},n.ajax(a,e).success(function(t){n.inArray(r,i.callbacks)>-1&&(delete i.callbacks[r],i._done(t))}).error(function(){n.inArray(r,i.callbacks)>-1&&(delete i.callbacks[r],i._done({}))})},_getArrayData:function(){var t=this.get("source");return this._done(t),t},_getObjectData:function(){var t=this.get("source");return this._done(t),t},_getFunctionData:function(t){function e(t){i._done(t)}var i=this,s=this.get("source"),a=s.call(this,t,e);a&&this._done(a)}});i.exports=l}),define("arale/autocomplete/1.2.0/filter",["$"],function(t,e,i){function s(t,e){if(n.isPlainObject(t)){var i=e&&e.key||"value";return t[i]||""}return t}function a(t,e){for(var i=[],s=t.split(""),a=0,r=e.split(""),n=0,l=s.length;l>n;n++){var o=s[n];if(o==r[a]){if(a===r.length-1){i.push([n-r.length+1,n+1]),a=0;continue}a++}else a=0}return i}function r(t){return(t||"").replace(o,"\\$1")}var n=t("$"),l={"default":function(t,e,i){var a=[];return n.each(t,function(t,e){var r={},l=s(e,i);n.isPlainObject(e)&&(r=n.extend({},e)),r.matchKey=l,a.push(r)}),a},startsWith:function(t,e,i){var a=[],l=e.length,o=RegExp("^"+r(e));return l?(n.each(t,function(t,e){var r={},c=s(e,i);n.isPlainObject(e)&&(r=n.extend({},e)),o.test(c)&&(r.matchKey=c,l>0&&(r.highlightIndex=[[0,l]]),a.push(r))}),a):[]},stringMatch:function(t,e,i){e=e||"";var r=[],l=e.length;return l?(n.each(t,function(t,l){var o={},c=s(l,i);n.isPlainObject(l)&&(o=n.extend({},l)),c.indexOf(e)>-1&&(o.matchKey=c,o.highlightIndex=a(c,e),r.push(o))}),r):[]}};i.exports=l;var o=/(\[|\[|\]|\^|\$|\||\(|\)|\{|\}|\+|\*|\?)/g}),define("arale/autocomplete/1.2.0/autocomplete.tpl",[],'<div class="{{classPrefix}}">\n    <ul class="{{classPrefix}}-ctn" data-role="items">\n        {{#each items}}\n            <li data-role="item" class="{{../classPrefix}}-item" data-value="{{matchKey}}">{{highlightItem ../classPrefix matchKey}}</li>\n        {{/each}}\n    </ul>\n</div>\n');
